"use strict";(()=>{var e={};e.id=6911,e.ids=[6911],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49498:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>d,dynamic:()=>u,revalidate:()=>l});var s=r(49303),n=r(88716),i=r(60670),o=r(87070),c=r(85662);let u="force-dynamic",l=0;async function d(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("days")||"30"),a=new Date;a.setDate(a.getDate()-r);let{data:s,error:n}=await c.pR.from("users").select("id, created_at, role").gte("created_at",a.toISOString()).order("created_at",{ascending:!0}),{data:i,error:u}=await c.pR.from("analytics_events").select("*").gte("created_at",a.toISOString()).order("created_at",{ascending:!0});if(u)return o.NextResponse.json({success:!1,error:u.message},{status:500});let l=["/debug/data","/debug","/api/debug","/api/analytics"],d=i?.filter(e=>{let t=e.page_path||"";return!l.some(e=>t.includes(e))})||[];if(u)return o.NextResponse.json({success:!1,error:u.message},{status:500});let p={totalVisits:d?.length||0,uniqueVisitors:new Set(d?.map(e=>e.session_id)).size||0,uniqueCountries:new Set(d?.map(e=>e.country)).size||0,avgVisitDuration:d?.length>0?Math.round(d.reduce((e,t)=>e+(t.duration_seconds||0),0)/d.length):0,newUsersRegistered:s?.length||0,newCandidates:s?.filter(e=>"candidate"===e.role).length||0,newRecruiters:s?.filter(e=>"recruiter"===e.role).length||0,newBusinesses:s?.filter(e=>"business"===e.role||"company"===e.role).length||0},g={};d?.forEach(e=>{e.country&&(g[e.country]=(g[e.country]||0)+1)});let y=Object.entries(g).map(([e,t])=>({country:e,visitors:t})).sort((e,t)=>t.visitors-e.visitors).slice(0,10),m={};d?.forEach(e=>{e.device_type&&(m[e.device_type]=(m[e.device_type]||0)+1)});let v=Object.entries(m).map(([e,t])=>({name:e,value:t})),h={};d?.forEach(e=>{e.browser&&(h[e.browser]=(h[e.browser]||0)+1)});let _=Object.entries(h).map(([e,t])=>({name:e,value:t})).sort((e,t)=>t.value-e.value),w={};d?.forEach(e=>{e.page_path&&(w[e.page_path]=(w[e.page_path]||0)+1)});let f=Object.entries(w).map(([e,t])=>({page:e,views:t})).sort((e,t)=>t.views-e.views).slice(0,10),S={},E={};d?.forEach(e=>{let t=new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});S[t]=(S[t]||0)+1}),s?.forEach(e=>{let t=new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});E[t]=(E[t]||0)+1});let b=new Set([...Object.keys(S),...Object.keys(E)]),R=Array.from(b).map(e=>({date:e,visits:S[e]||0,registrations:E[e]||0})).sort((e,t)=>new Date(e.date)-new Date(t.date)),j={};d?.forEach(e=>{if(e.city&&e.country){let t=`${e.city}, ${e.country_code}`;j[t]=(j[t]||0)+1}});let A=Object.entries(j).map(([e,t])=>({city:e,visitors:t})).sort((e,t)=>t.visitors-e.visitors).slice(0,10),O=d?.slice(-20).reverse().map(e=>({date:new Date(e.created_at).toLocaleString(),country:e.country,city:e.city,page:e.page_path,device:e.device_type,browser:e.browser}))||[];return o.NextResponse.json({success:!0,stats:p,countryData:y,deviceData:v,browserData:_,topPages:f,timelineData:R,topCities:A,recentVisitors:O})}catch(e){return console.error("[Analytics Data API] Error:",e),o.NextResponse.json({success:!1,error:e.message},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/data/route",pathname:"/api/analytics/data",filename:"route",bundlePath:"app/api/analytics/data/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\analytics\\data\\route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:m}=p,v="/api/analytics/data/route";function h(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:y})}},85662:(e,t,r)=>{r.d(t,{OQ:()=>o,pR:()=>c});var a=r(76596);let s=process.env.NEXT_PUBLIC_SUPABASE_URL,n=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,i=process.env.SUPABASE_SERVICE_ROLE_KEY,o=null,c=null;s&&n&&(o=(0,a.eI)(s,n),c=(0,a.eI)(s,i||n))}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,6596],()=>r(49498));module.exports=a})();