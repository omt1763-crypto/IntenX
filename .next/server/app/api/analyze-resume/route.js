(()=>{var e={};e.id=7452,e.ids=[7452],e.modules={6840:e=>{function webpackEmptyAsyncContext(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}webpackEmptyAsyncContext.keys=()=>[],webpackEmptyAsyncContext.resolve=webpackEmptyAsyncContext,webpackEmptyAsyncContext.id=6840,e.exports=webpackEmptyAsyncContext},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57310:e=>{"use strict";e.exports=require("url")},21515:(e,t,s)=>{"use strict";let r;s.r(t),s.d(t,{headerHooks:()=>g,originalPathname:()=>d,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var n={};s.r(n),s.d(n,{POST:()=>POST});var o=s(10884),a=s(16132),l=s(95798);let i=process.env.OPENAI_API_KEY;async function getPdfParser(){if(!r)try{r=s(18889)}catch(e){return console.warn("pdf-parse not available, will use text-based approach"),null}return r}async function POST(e){try{let t=await e.json(),{fileName:s,fileType:r,fileContent:n}=t;if(console.log("[AnalyzeResume] Starting analysis for:",s),console.log("[AnalyzeResume] File type:",r),console.log("[AnalyzeResume] Content size:",n?.length),!n)return l.Z.json({error:"No resume content provided"},{status:400});if(!i)return console.error("[AnalyzeResume] OPENAI_API_KEY not set"),l.Z.json({error:"OpenAI API key not configured"},{status:500});let o=n;if(n.startsWith("data:")){let e=n.split(",");o=e[1]}console.log("[AnalyzeResume] Base64 length:",o.length);let a="";try{let e=Buffer.from(o,"base64");console.log("[AnalyzeResume] Buffer size:",e.length);let t=await getPdfParser();if(t&&r?.includes("pdf"))try{let s=await t(e);a=s.text||"",console.log("[AnalyzeResume] PDF parsed successfully, text length:",a.length)}catch(t){console.warn("[AnalyzeResume] pdf-parse failed, falling back to text extraction:",t.message),a=e.toString("utf-8",0,Math.min(e.length,1e5))}else a=e.toString("utf-8",0,Math.min(e.length,1e5));if(a=a.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g," ").replace(/\s+/g," ").trim(),console.log("[AnalyzeResume] Extracted text length:",a.length),a.length<30)return console.warn("[AnalyzeResume] Warning: Very short extracted text"),l.Z.json({error:"Could not extract text from resume. File may be corrupted, image-based, or not a valid document."},{status:400})}catch(e){return console.error("[AnalyzeResume] Text extraction error:",e.message),l.Z.json({error:`Resume extraction failed: ${e.message}`},{status:400})}console.log("[AnalyzeResume] Text preview:",a.substring(0,300));let c=`You are an expert recruiter and career coach. Analyze this resume and provide comprehensive feedback.

RESUME TEXT:
${a.substring(0,5e3)}

Return ONLY a valid JSON object (no markdown, no code blocks, no explanations, no extra text) with this structure:
{
  "score": <number 0-100>,
  "strengths": ["strength1", "strength2", "strength3", "strength4", "strength5"],
  "improvements": ["improvement1", "improvement2", "improvement3", "improvement4", "improvement5"],
  "suggestions": ["suggestion1", "suggestion2", "suggestion3", "suggestion4"],
  "skills": ["skill1", "skill2", "skill3", "skill4", "skill5", "skill6", "skill7", "skill8"],
  "atsScore": <number 0-100>,
  "recommendations": ["recommendation1", "recommendation2", "recommendation3"]
}`;console.log("[AnalyzeResume] Calling OpenAI GPT-4...");let u=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a recruiter. Output ONLY valid JSON, no other text."},{role:"user",content:c}],temperature:.7,max_tokens:1500})});if(console.log("[AnalyzeResume] OpenAI response status:",u.status),!u.ok){let e=await u.text();return console.error("[AnalyzeResume] OpenAI error response:",e.substring(0,500)),l.Z.json({error:`OpenAI API error: ${u.status}`},{status:u.status})}let m=await u.json();if(console.log("[AnalyzeResume] Got response from OpenAI"),!m.choices?.[0]?.message?.content)return console.error("[AnalyzeResume] Invalid response structure"),l.Z.json({error:"Invalid response from OpenAI"},{status:500});let p=m.choices[0].message.content;console.log("[AnalyzeResume] Response content length:",p.length);let g=null;try{g=JSON.parse(p)}catch(e){try{let e=p;e.startsWith("```json")?e=e.replace(/^```json\s*/,"").replace(/\s*```$/,""):e.startsWith("```")&&(e=e.replace(/^```\s*/,"").replace(/\s*```$/,"")),g=JSON.parse(e)}catch(t){try{let e=p.match(/\{[\s\S]*\}/);e&&(g=JSON.parse(e[0]))}catch(t){console.error("[AnalyzeResume] Could not parse JSON:",e.message),console.log("[AnalyzeResume] Raw content:",p.substring(0,300))}}}g||(g={score:70,strengths:["Resume provided","Professional format"],improvements:["Add more details","Improve formatting"],suggestions:["Enhance content"],skills:["Communication"],atsScore:70,recommendations:["Review and improve"]});let y={score:"number"==typeof g.score?g.score:70,strengths:Array.isArray(g.strengths)?g.strengths.slice(0,5):[],improvements:Array.isArray(g.improvements)?g.improvements.slice(0,5):[],suggestions:Array.isArray(g.suggestions)?g.suggestions.slice(0,4):[],skills:Array.isArray(g.skills)?g.skills.slice(0,8):[],atsScore:"number"==typeof g.atsScore?g.atsScore:70,recommendations:Array.isArray(g.recommendations)?g.recommendations.slice(0,3):[]};return console.log("[AnalyzeResume] Analysis complete"),l.Z.json({success:!0,analysis:y})}catch(e){return console.error("[AnalyzeResume] Unexpected error:",e.message),console.error("[AnalyzeResume] Stack:",e.stack),l.Z.json({error:`Server error: ${e.message}`},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze-resume/route",pathname:"/api/analyze-resume",filename:"route",bundlePath:"app/api/analyze-resume/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\analyze-resume\\route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:p,headerHooks:g,staticGenerationBailout:y}=c,d="/api/analyze-resume/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[729,5798,8889],()=>__webpack_exec__(21515));module.exports=s})();