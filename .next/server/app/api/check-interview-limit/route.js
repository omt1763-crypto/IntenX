"use strict";(()=>{var e={};e.id=6786,e.ids=[6786],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21765:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>d,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v});var r={};i.r(r),i.d(r,{POST:()=>c});var n=i(49303),s=i(88716),o=i(60670),a=i(87070),u=i(85662);async function c(e){try{let{userId:t}=await e.json();if(!t)return a.NextResponse.json({error:"User ID required"},{status:400});console.log("[CheckInterviewLimit API] Checking limit for user:",t);let{data:i,error:r,count:n}=await u.OQ.from("interviews").select("*",{count:"exact"}).eq("user_id",t).in("status",["completed","submitted"]);if(r)return console.error("[CheckInterviewLimit API] Database error:",r),a.NextResponse.json({canContinue:!0,interviewCount:0,freeInterviewsRemaining:2,message:"Interview limit check failed, proceeding with interview"});let s=n||0,o=Math.max(0,2-s),c=s<2;console.log("[CheckInterviewLimit API] User stats:",{userId:t,completedCount:s,freeLimit:2,freeInterviewsRemaining:o,canContinue:c});let{data:p}=await u.OQ.from("subscriptions").select("subscription_type, subscription_status").eq("user_id",t).single(),l=p?.subscription_status==="active";if(c||l)return a.NextResponse.json({canContinue:!0,interviewCount:s,freeInterviewsRemaining:o,hasSubscription:!!l,message:`You have ${o} free interviews remaining`+(l?" (or unlimited with subscription)":"")});return a.NextResponse.json({canContinue:!1,interviewCount:s,freeInterviewsRemaining:0,hasSubscription:!1,planName:"Free Plan",remainingInterviews:0,message:"You've completed your 2 free interviews. Upgrade to a paid plan for unlimited interviews."},{status:403})}catch(e){return console.error("[CheckInterviewLimit API] Error:",e),a.NextResponse.json({canContinue:!0,interviewCount:0,freeInterviewsRemaining:2,message:"Unable to verify interview limit, proceeding with interview"})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/check-interview-limit/route",pathname:"/api/check-interview-limit",filename:"route",bundlePath:"app/api/check-interview-limit/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\check-interview-limit\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:v,serverHooks:m}=p,d="/api/check-interview-limit/route";function w(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}},85662:(e,t,i)=>{i.d(t,{OQ:()=>a,pR:()=>u});var r=i(76596);let n=process.env.NEXT_PUBLIC_SUPABASE_URL,s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,o=process.env.SUPABASE_SERVICE_ROLE_KEY,a=null,u=null;n&&s&&(a=(0,r.eI)(n,s),u=(0,r.eI)(n,o||s))}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[8948,5972,6596],()=>i(21765));module.exports=r})();