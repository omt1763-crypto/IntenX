"use strict";(()=>{var e={};e.id=7604,e.ids=[7604],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35235:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>S,patchFetch:()=>_,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>u});var r={};s.r(r),s.d(r,{POST:()=>v});var o=s(49303),n=s(88716),a=s(60670),i=s(87070),c=s(85662);async function v(e){try{let{interviewId:t,applicantId:s,messages:r,messageCount:o,startTime:n,endTime:a,conversationText:v}=await e.json();if(console.log("[SaveConversation API] Request received:",{interviewId:t,applicantId:s,messageCount:o}),!t)return i.NextResponse.json({error:"Interview ID is required"},{status:400});if(!r||0===r.length)return i.NextResponse.json({error:"No messages to save"},{status:400});let l={id:`conv-${Date.now()}`,interview_id:t,applicant_id:s,messages:r,message_count:o,start_time:n,end_time:a,conversation_text:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("[SaveConversation API] Saving conversation record");let{data:d,error:u}=await c.pR.from("interview_conversations").insert([l]).select().single();if(u){if("PGRST116"===u.code){console.log("[SaveConversation API] Table does not exist, creating..."),await c.pR.rpc("exec",{sql:`
            CREATE TABLE IF NOT EXISTS public.interview_conversations (
              id TEXT PRIMARY KEY,
              interview_id TEXT NOT NULL,
              applicant_id TEXT,
              messages JSONB NOT NULL,
              message_count INTEGER,
              start_time TIMESTAMP,
              end_time TIMESTAMP,
              conversation_text TEXT,
              created_at TIMESTAMP DEFAULT NOW(),
              updated_at TIMESTAMP DEFAULT NOW()
            );
          `}).catch(e=>(console.error("[SaveConversation API] Error creating table:",e),null));let{data:e,error:t}=await c.pR.from("interview_conversations").insert([l]).select().single();if(t)return console.error("[SaveConversation API] Database error after table creation:",t),i.NextResponse.json({error:t.message||"Failed to save conversation",details:t.details,code:t.code},{status:500});return console.log("[SaveConversation API] Conversation saved successfully after table creation:",e.id),i.NextResponse.json({success:!0,conversation:e,message:"Conversation saved successfully"},{status:201})}return console.error("[SaveConversation API] Database error:",u),i.NextResponse.json({error:u.message||"Failed to save conversation",details:u.details,code:u.code},{status:500})}if(console.log("[SaveConversation API] Conversation saved successfully:",d.id),t){let{error:e}=await c.pR.from("interviews").update({conversation_id:d.id,updated_at:new Date().toISOString()}).eq("id",t);e&&console.warn("[SaveConversation API] Warning: Could not update interview record:",e)}return i.NextResponse.json({success:!0,conversation:d,message:"Conversation saved successfully"},{status:201})}catch(e){return console.error("[SaveConversation API] Unexpected error:",e),i.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/interviews/save-conversation/route",pathname:"/api/interviews/save-conversation",filename:"route",bundlePath:"app/api/interviews/save-conversation/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\interviews\\save-conversation\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:u,serverHooks:p}=l,S="/api/interviews/save-conversation/route";function _(){return(0,a.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:u})}},85662:(e,t,s)=>{s.d(t,{OQ:()=>i,pR:()=>c});var r=s(76596);let o=process.env.NEXT_PUBLIC_SUPABASE_URL,n=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=process.env.SUPABASE_SERVICE_ROLE_KEY,i=null,c=null;o&&n&&(i=(0,r.eI)(o,n),c=(0,r.eI)(o,a||n))}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972,6596],()=>s(35235));module.exports=r})();