"use strict";(()=>{var e={};e.id=7604,e.ids=[7604],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},91660:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>u,originalPathname:()=>_,requestAsyncStorage:()=>v,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>p});var o={};r.r(o),r.d(o,{POST:()=>POST});var s=r(10884),a=r(16132),n=r(95798),i=r(47770);async function POST(e){try{let{interviewId:t,applicantId:r,messages:o,messageCount:s,startTime:a,endTime:c,conversationText:v}=await e.json();if(console.log("[SaveConversation API] Request received:",{interviewId:t,applicantId:r,messageCount:s}),!t)return n.Z.json({error:"Interview ID is required"},{status:400});if(!o||0===o.length)return n.Z.json({error:"No messages to save"},{status:400});let d={id:`conv-${Date.now()}`,interview_id:t,applicant_id:r,messages:o,message_count:s,start_time:a,end_time:c,conversation_text:v,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("[SaveConversation API] Saving conversation record");let{data:l,error:u}=await i.pR.from("interview_conversations").insert([d]).select().single();if(u){if("PGRST116"===u.code){console.log("[SaveConversation API] Table does not exist, creating..."),await i.pR.rpc("exec",{sql:`
            CREATE TABLE IF NOT EXISTS public.interview_conversations (
              id TEXT PRIMARY KEY,
              interview_id TEXT NOT NULL,
              applicant_id TEXT,
              messages JSONB NOT NULL,
              message_count INTEGER,
              start_time TIMESTAMP,
              end_time TIMESTAMP,
              conversation_text TEXT,
              created_at TIMESTAMP DEFAULT NOW(),
              updated_at TIMESTAMP DEFAULT NOW()
            );
          `}).catch(e=>(console.error("[SaveConversation API] Error creating table:",e),null));let{data:e,error:t}=await i.pR.from("interview_conversations").insert([d]).select().single();if(t)return console.error("[SaveConversation API] Database error after table creation:",t),n.Z.json({error:t.message||"Failed to save conversation",details:t.details,code:t.code},{status:500});return console.log("[SaveConversation API] Conversation saved successfully after table creation:",e.id),n.Z.json({success:!0,conversation:e,message:"Conversation saved successfully"},{status:201})}return console.error("[SaveConversation API] Database error:",u),n.Z.json({error:u.message||"Failed to save conversation",details:u.details,code:u.code},{status:500})}if(console.log("[SaveConversation API] Conversation saved successfully:",l.id),t){let{error:e}=await i.pR.from("interviews").update({conversation_id:l.id,updated_at:new Date().toISOString()}).eq("id",t);e&&console.warn("[SaveConversation API] Warning: Could not update interview record:",e)}return n.Z.json({success:!0,conversation:l,message:"Conversation saved successfully"},{status:201})}catch(e){return console.error("[SaveConversation API] Unexpected error:",e),n.Z.json({error:e.message||"Internal server error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/interviews/save-conversation/route",pathname:"/api/interviews/save-conversation",filename:"route",bundlePath:"app/api/interviews/save-conversation/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\interviews\\save-conversation\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:d,serverHooks:l,headerHooks:u,staticGenerationBailout:p}=c,_="/api/interviews/save-conversation/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[729,5798,8617,7770],()=>__webpack_exec__(91660));module.exports=r})();