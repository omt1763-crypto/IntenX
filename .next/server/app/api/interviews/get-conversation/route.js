"use strict";(()=>{var e={};e.id=9419,e.ids=[9419],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25808:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var r={};t.r(r),t.d(r,{GET:()=>p,POST:()=>v,dynamic:()=>c});var n=t(49303),o=t(88716),a=t(60670),i=t(87070),u=t(85662);let c="force-dynamic";async function p(e){try{let{searchParams:s}=new URL(e.url),t=s.get("interviewId"),r=s.get("applicantId");if(!t)return i.NextResponse.json({error:"Interview ID is required"},{status:400});console.log("[GetConversation API] Fetching conversation:",{interviewId:t,applicantId:r});let{data:n,error:o}=await u.pR.from("interview_conversations").select("*").eq("interview_id",t).single();if(o&&"PGRST116"!==o.code&&"PGRST301"!==o.code)return console.error("[GetConversation API] Database error:",o),i.NextResponse.json({success:!1,messages:[],message:"Conversation not found yet"},{status:200});if(n)return console.log("[GetConversation API] Found conversation with",n.message_count,"messages"),i.NextResponse.json({success:!0,conversation:n,messages:n.messages||[],messageCount:n.message_count},{status:200});return i.NextResponse.json({success:!1,messages:[],message:"Conversation not found"},{status:200})}catch(e){return console.error("[GetConversation API] Unexpected error:",e),i.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}async function v(e){try{let{interviewId:s,applicantId:t,messageType:r="both"}=await e.json();if(!s)return i.NextResponse.json({error:"Interview ID is required"},{status:400});console.log("[GetConversation API] POST - Getting latest messages:",{interviewId:s,messageType:r});let{data:n,error:o}=await u.pR.from("interview_conversations").select("messages, message_count, updated_at").eq("interview_id",s).order("created_at",{ascending:!1}).limit(1).single();if(o)return console.warn("[GetConversation API] No conversation data yet"),i.NextResponse.json({success:!1,messages:[],messageCount:0},{status:200});let a=n.messages||[];return"ai"===r?a=a.filter(e=>"ai"===e.role):"user"===r&&(a=a.filter(e=>"user"===e.role)),i.NextResponse.json({success:!0,messages:a,messageCount:n.message_count,updatedAt:n.updated_at},{status:200})}catch(e){return console.error("[GetConversation API] Unexpected error:",e),i.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/interviews/get-conversation/route",pathname:"/api/interviews/get-conversation",filename:"route",bundlePath:"app/api/interviews/get-conversation/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\interviews\\get-conversation\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:m}=d,w="/api/interviews/get-conversation/route";function _(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},85662:(e,s,t)=>{t.d(s,{OQ:()=>i,pR:()=>u});var r=t(76596);let n=process.env.NEXT_PUBLIC_SUPABASE_URL,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!n||!o)throw Error("Missing Supabase environment variables");let i=(0,r.eI)(n,o),u=(0,r.eI)(n,a||o)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,5972,6596],()=>t(25808));module.exports=r})();