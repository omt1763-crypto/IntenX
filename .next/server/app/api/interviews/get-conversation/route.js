"use strict";(()=>{var e={};e.id=9419,e.ids=[9419],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},80099:(e,s,t)=>{t.r(s),t.d(s,{headerHooks:()=>l,originalPathname:()=>m,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>g});var r={};t.r(r),t.d(r,{GET:()=>GET,POST:()=>POST});var n=t(10884),o=t(16132),a=t(95798),i=t(47770);async function GET(e){try{let{searchParams:s}=new URL(e.url),t=s.get("interviewId"),r=s.get("applicantId");if(!t)return a.Z.json({error:"Interview ID is required"},{status:400});console.log("[GetConversation API] Fetching conversation:",{interviewId:t,applicantId:r});let{data:n,error:o}=await i.pR.from("interview_conversations").select("*").eq("interview_id",t).single();if(o&&"PGRST116"!==o.code&&"PGRST301"!==o.code)return console.error("[GetConversation API] Database error:",o),a.Z.json({success:!1,messages:[],message:"Conversation not found yet"},{status:200});if(n)return console.log("[GetConversation API] Found conversation with",n.message_count,"messages"),a.Z.json({success:!0,conversation:n,messages:n.messages||[],messageCount:n.message_count},{status:200});return a.Z.json({success:!1,messages:[],message:"Conversation not found"},{status:200})}catch(e){return console.error("[GetConversation API] Unexpected error:",e),a.Z.json({error:e.message||"Internal server error"},{status:500})}}async function POST(e){try{let{interviewId:s,applicantId:t,messageType:r="both"}=await e.json();if(!s)return a.Z.json({error:"Interview ID is required"},{status:400});console.log("[GetConversation API] POST - Getting latest messages:",{interviewId:s,messageType:r});let{data:n,error:o}=await i.pR.from("interview_conversations").select("messages, message_count, updated_at").eq("interview_id",s).order("created_at",{ascending:!1}).limit(1).single();if(o)return console.warn("[GetConversation API] No conversation data yet"),a.Z.json({success:!1,messages:[],messageCount:0},{status:200});let u=n.messages||[];return"ai"===r?u=u.filter(e=>"ai"===e.role):"user"===r&&(u=u.filter(e=>"user"===e.role)),a.Z.json({success:!0,messages:u,messageCount:n.message_count,updatedAt:n.updated_at},{status:200})}catch(e){return console.error("[GetConversation API] Unexpected error:",e),a.Z.json({error:e.message||"Internal server error"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/interviews/get-conversation/route",pathname:"/api/interviews/get-conversation",filename:"route",bundlePath:"app/api/interviews/get-conversation/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\interviews\\get-conversation\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:v,serverHooks:d,headerHooks:l,staticGenerationBailout:g}=u,m="/api/interviews/get-conversation/route"}};var s=require("../../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[729,5798,8617,7770],()=>__webpack_exec__(80099));module.exports=t})();