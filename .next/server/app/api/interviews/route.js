"use strict";(()=>{var e={};e.id=8247,e.ids=[8247],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},99965:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>_,requestAsyncStorage:()=>v,routeModule:()=>u,serverHooks:()=>w,staticGenerationAsyncStorage:()=>I});var i={};t.r(i),t.d(i,{GET:()=>p,POST:()=>c,dynamic:()=>d});var n=t(49303),o=t(88716),s=t(60670),a=t(87070),l=t(85662);let d="force-dynamic";async function c(e){try{let r=await e.json();if(console.log("[SaveInterview API] Saving interview:",{userId:r.user_id,jobId:r.job_id,applicantId:r.applicant_id,duration:r.duration}),console.log("[SaveInterview API] Full data being saved:",JSON.stringify({job_id:r.job_id,applicant_id:r.applicant_id,user_id:r.user_id,status:r.status,timestamp:r.timestamp},null,2)),!r.user_id)return a.NextResponse.json({error:"Missing required field: user_id"},{status:400});let t={id:r.id,user_id:r.user_id,applicant_id:r.applicant_id||null,job_id:r.job_id||null,interview_type:r.interview_type||"real",title:r.title||"Technical Interview",position:r.position||"Interview",company:r.company||"Unknown",client:r.client||"Unknown",duration:parseInt(r.duration)||0,status:r.status||"completed",timestamp:r.timestamp||new Date().toISOString(),skills:Array.isArray(r.skills)?r.skills:[],conversation:Array.isArray(r.conversation)?r.conversation:[],notes:r.notes||"",created_at:new Date().toISOString()};console.log("[SaveInterview API] Clean data to insert:",JSON.stringify(t,null,2));let{data:i,error:n}=await l.pR.from("interviews").insert([t]).select().single();if(n){if(console.error("[SaveInterview API] Full error object:",JSON.stringify(n,null,2)),console.error("[SaveInterview API] Error message:",n.message),console.error("[SaveInterview API] Error code:",n.code),console.error("[SaveInterview API] Error details:",n.details),n.message&&(n.message.includes("does not exist")||"42P01"===n.code))return console.error("[SaveInterview API] Table does not exist"),a.NextResponse.json({error:"Interviews table not set up. Please run the table creation SQL.",code:"TABLE_MISSING"},{status:503});return a.NextResponse.json({error:n.message||"Failed to save interview",code:n.code,details:n.details||n,fullError:JSON.stringify(n)},{status:400})}if(console.log("[SaveInterview API] Interview saved successfully:",i.id),console.log("[SaveInterview API] Saved interview with job_id:",i.job_id,"applicant_id:",i.applicant_id),t.applicant_id){let{error:e}=await l.pR.from("job_applicants").update({interview_id:i.id,status:"completed"}).eq("id",t.applicant_id);e?console.error("[SaveInterview API] Error updating applicant:",e):console.log("[SaveInterview API] Applicant updated with interview_id:",i.id)}else if(t.job_id){console.log("[SaveInterview API] No applicant ID provided, creating new applicant record for job:",t.job_id);let{data:e,error:r}=await l.pR.from("job_applicants").insert([{job_id:t.job_id,name:t.position||"Interview Candidate",email:t.company||"candidate@example.com",phone:null,position_applied:t.position||"Unknown Position",resume_url:null,interview_id:i.id,status:"completed",created_at:new Date().toISOString()}]).select().single();if(r)console.error("[SaveInterview API] Error creating applicant record:",r),console.error("[SaveInterview API] Error code:",r.code),console.error("[SaveInterview API] Error message:",r.message);else if(console.log("[SaveInterview API] ✅ New applicant created for interview:",e?.id),e?.id){let{error:r}=await l.pR.from("interviews").update({applicant_id:e.id}).eq("id",i.id);r?console.error("[SaveInterview API] Error linking interview to applicant:",r):console.log("[SaveInterview API] ✅ Interview linked to applicant:",e.id)}}return a.NextResponse.json({success:!0,data:i,message:"Interview saved successfully"})}catch(e){return console.error("[SaveInterview API] Error:",e),a.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}async function p(e){try{let{searchParams:r}=new URL(e.url),t=r.get("userId"),i=r.get("jobId");if(console.log("[GetInterviews API] Request received:",{userId:t,jobId:i}),!t&&!i)return a.NextResponse.json({error:"Missing userId or jobId parameter"},{status:400});let n=l.pR.from("interviews").select("*");t&&(n=n.eq("user_id",t),console.log("[GetInterviews API] Querying by userId:",t)),i&&(n=n.eq("job_id",i),console.log("[GetInterviews API] Querying by jobId:",i));let{data:o,error:s}=await n.order("created_at",{ascending:!1});if(console.log("[GetInterviews API] Supabase query completed"),console.log("[GetInterviews API] Returned rows:",o?.length||0),s)return console.error("[GetInterviews API] Supabase error:",s.message),console.error("[GetInterviews API] Error code:",s.code),a.NextResponse.json({error:s.message||"Failed to fetch interviews",code:s.code},{status:400});return console.log("[GetInterviews API] ✅ Success: returning",o?.length||0,"interviews"),a.NextResponse.json({success:!0,data:o||[],count:o?.length||0})}catch(e){return console.error("[GetInterviews API] Catch block error:",e.message),console.error("[GetInterviews API] Full error:",e),a.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/interviews/route",pathname:"/api/interviews",filename:"route",bundlePath:"app/api/interviews/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\interviews\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:I,serverHooks:w}=u,g="/api/interviews/route";function _(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:I})}},85662:(e,r,t)=>{t.d(r,{OQ:()=>a,pR:()=>l});var i=t(76596);let n=process.env.NEXT_PUBLIC_SUPABASE_URL,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,s=process.env.SUPABASE_SERVICE_ROLE_KEY,a=null,l=null;n&&o&&(a=(0,i.eI)(n,o),l=(0,i.eI)(n,s||o))}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[8948,5972,6596],()=>t(99965));module.exports=i})();