"use strict";(()=>{var e={};e.id=4457,e.ids=[4457],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84864:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{GET:()=>u,dynamic:()=>c,revalidate:()=>d});var a=t(49303),n=t(88716),s=t(60670),i=t(87070),l=t(85662);let c="force-dynamic",d=0;async function u(e){try{let{searchParams:r}=new URL(e.url),t=r.get("recruiterId");if(!t)return i.NextResponse.json({error:"Missing recruiterId",success:!1},{status:400});console.log("[JobsSummary API] Fetching summary for recruiter:",t);let{data:o,error:a}=await l.pR.from("jobs").select("*").eq("recruiter_id",t).order("created_at",{ascending:!1}).limit(200);a&&console.error("[JobsSummary API] Jobs error:",a);let n=(o||[]).map(e=>e.id).filter(Boolean),s=[];if(n.length>0){let{data:e,error:r}=await l.pR.from("job_applicants").select("*").in("job_id",n).order("created_at",{ascending:!1});r&&console.error("[JobsSummary API] Applicants error:",r),s=e||[]}let c=[];if(n.length>0){let{data:e,error:r}=await l.pR.from("interviews").select("*").in("job_id",n).order("created_at",{ascending:!1});r&&console.error("[JobsSummary API] Interviews error:",r),c=e||[]}if((0===c.length||0===n.length)&&s.length>0){let e=s.map(e=>e.id).filter(Boolean);if(e.length>0){console.log("[JobsSummary API] Fetching interviews via applicant_id for",e.length,"applicants");let{data:r,error:t}=await l.pR.from("interviews").select("*").in("applicant_id",e).order("created_at",{ascending:!1});t&&console.warn("[JobsSummary API] Interviews via applicant_id error:",t),c=[...c||[],...r||[]]}}let d={};s.forEach(e=>{e&&e.job_id&&(d[e.job_id]=(d[e.job_id]||0)+1)});let u={};c.forEach(e=>{e&&e.job_id&&(u[e.job_id]=(u[e.job_id]||0)+1)});let p=(o||[]).map(e=>({...e,applicant_count:d[e.id]||0,interview_count:u[e.id]||0})),m={pending:0,shortlisted:0,rejected:0,accepted:0};s.forEach(e=>{let r=e&&e.status||"pending";m.hasOwnProperty(r)?m[r]++:m.pending++});let g=new Date,h=new Date(g.getFullYear(),g.getMonth(),1),_=new Date(g.getFullYear(),g.getMonth()+1,1),b=(o||[]).filter(e=>{try{let r=new Date(e.created_at);return r>=h&&r<_}catch(e){return!1}}).length,f=(o||[]).length,v={success:!0,jobs:p,totalJobs:f,totalApplicants:s.length,totalInterviews:c.length,applicationStats:m,totalShortlisted:m.shortlisted||0,jobsThisMonth:b,jobPercentOfTotal:f>0?Math.round(b/f*100):0};return i.NextResponse.json(v)}catch(e){return console.error("[JobsSummary API] Error:",e),i.NextResponse.json({success:!1,error:e.message},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/recruiter/jobs-summary/route",pathname:"/api/recruiter/jobs-summary",filename:"route",bundlePath:"app/api/recruiter/jobs-summary/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\recruiter\\jobs-summary\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h}=p,_="/api/recruiter/jobs-summary/route";function b(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},85662:(e,r,t)=>{t.d(r,{OQ:()=>i,pR:()=>l});var o=t(76596);let a=process.env.NEXT_PUBLIC_SUPABASE_URL,n=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,s=process.env.SUPABASE_SERVICE_ROLE_KEY,i=null,l=null;a&&n&&(i=(0,o.eI)(a,n),l=(0,o.eI)(a,s||n))}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[8948,5972,6596],()=>t(84864));module.exports=o})();