"use strict";(()=>{var e={};e.id=3654,e.ids=[3654],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},69701:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>g,originalPathname:()=>m,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>f});var t={};s.r(t),s.d(t,{POST:()=>POST});var a=s(10884),o=s(16132),i=s(95798),n=s(47770),u=s(58983);async function POST(e){try{let{firstName:r,lastName:s,email:t,password:a,role:o}=await e.json();if(!r||!s||!t||!a||!o)return i.Z.json({error:"All fields are required"},{status:400});console.log("[Signup] Validating email address:",t);let l=await (0,u.V3)(t);if(!l.valid)return console.log("[Signup] Email validation failed:",l.reason),i.Z.json({error:l.reason},{status:400});if(a.length<6)return i.Z.json({error:"Password must be at least 6 characters"},{status:400});let{data:p,error:c}=await n.pR.from("users").select("id, email").eq("email",t);if(p&&p.length>0)return console.log("[Signup] User already exists in database:",t),i.Z.json({error:"This email is already registered. Please log in or use a different email."},{status:409});c&&console.error("[Signup] Error checking existing user:",c),console.log("[Signup] Creating auth user for:",t);let{data:d,error:g}=await n.pR.auth.admin.createUser({email:t,password:a,email_confirm:!0});if(g){if(console.error("[Signup] Auth creation error:",g),g.message?.includes("already registered")||g.message?.includes("User already exists"))return i.Z.json({error:"This email is already registered. Please log in."},{status:409});return i.Z.json({error:g.message||"Failed to create auth account"},{status:400})}let f=d.user.id;console.log("[Signup] Auth user created with ID:",f),console.log("[Signup] Creating user profile in database...");let{data:m,error:h}=await n.pR.from("users").insert([{id:f,email:t,first_name:r,last_name:s,role:o,password_hash:"MANAGED_BY_SUPABASE_AUTH"}]).select().single();if(h)return console.error("[Signup] User profile creation error:",h),console.log("[Signup] Rolling back: Deleting auth user after profile creation failure..."),await n.pR.auth.admin.deleteUser(f),i.Z.json({error:"Failed to create user profile"},{status:500});return console.log("[Signup] User profile created successfully"),console.log("[Signup] Signup completed successfully for:",t),i.Z.json({user:m,message:"Account created successfully! You can now log in.",redirect:"/auth/login"},{status:201})}catch(e){return console.error("[Signup] Unexpected error:",e),i.Z.json({error:e.message||"Internal server error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\auth\\signup\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:c,serverHooks:d,headerHooks:g,staticGenerationBailout:f}=l,m="/api/auth/signup/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[729,5798,8617,6709,7770,8983],()=>__webpack_exec__(69701));module.exports=s})();