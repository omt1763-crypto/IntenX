"use strict";(()=>{var e={};e.id=3654,e.ids=[3654],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},76637:(e,r,a)=>{a.r(r),a.d(r,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var t={};a.r(t),a.d(t,{POST:()=>m});var i=a(49303),o=a(88716),s=a(60670),n=a(87070),l=a(85662),u=a(25092),c=a(76706);async function m(e){try{let{firstName:r,lastName:a,email:t,password:i,role:o}=await e.json();if(!r||!a||!t||!i||!o)return n.NextResponse.json({error:"All fields are required"},{status:400});console.log("[Signup] Validating email address:",t);let s=await (0,u.V3)(t);if(!s.valid)return console.log("[Signup] Email validation failed:",s.reason),n.NextResponse.json({error:s.reason},{status:400});if(i.length<6)return n.NextResponse.json({error:"Password must be at least 6 characters"},{status:400});let{data:m,error:p}=await l.pR.from("users").select("id, email").eq("email",t);if(m&&m.length>0)return console.log("[Signup] User already exists in database:",t),n.NextResponse.json({error:"This email is already registered. Please log in or use a different email."},{status:409});p&&console.error("[Signup] Error checking existing user:",p),console.log("[Signup] Creating auth user for:",t);let{data:d,error:g}=await l.pR.auth.admin.createUser({email:t,password:i,email_confirm:!1});if(g){if(console.error("[Signup] Auth creation error:",g),g.message?.includes("already registered")||g.message?.includes("User already exists"))return n.NextResponse.json({error:"This email is already registered. Please log in."},{status:409});return n.NextResponse.json({error:g.message||"Failed to create auth account"},{status:400})}let f=d.user.id;console.log("[Signup] Auth user created with ID:",f),console.log("[Signup] Sending verification email to:",t);try{let{error:e}=await l.pR.auth.resend({type:"signup",email:t});e?console.error("[Signup] Warning: Failed to send verification email:",e):console.log("[Signup] Verification email sent successfully")}catch(e){console.error("[Signup] Exception sending verification email:",e)}console.log("[Signup] Creating user profile in database...");let{data:h,error:y}=await l.pR.from("users").insert([{id:f,email:t,first_name:r,last_name:a,role:o,password_hash:"MANAGED_BY_SUPABASE_AUTH"}]).select().single();if(y)return console.error("[Signup] User profile creation error:",y),console.log("[Signup] Rolling back: Deleting auth user after profile creation failure..."),await l.pR.auth.admin.deleteUser(f),n.NextResponse.json({error:"Failed to create user profile"},{status:500});return console.log("[Signup] User profile created successfully"),await (0,c.ag)({userId:f,action:"signup",entityType:"user",entityId:f,description:`New user signed up as ${o}`,metadata:{email:t,firstName:r,lastName:a,role:o},ipAddress:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),userAgent:e.headers.get("user-agent")}),console.log("[Signup] Signup completed successfully for:",t),console.log("[Signup] Supabase has sent verification email to:",t),n.NextResponse.json({user:h,message:"Account created! Check your email to verify your address before logging in.",redirect:"/auth/verify-email-pending?email="+encodeURIComponent(t)},{status:201})}catch(e){return console.error("[Signup] Unexpected error:",e),n.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\auth\\signup\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:f}=p,h="/api/auth/signup/route";function y(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},76706:(e,r,a)=>{a.d(r,{Cf:()=>o,ag:()=>i});var t=a(85662);async function i({userId:e,action:r,entityType:a=null,entityId:i=null,description:o="",metadata:s={},ipAddress:n=null,userAgent:l=null}){try{if(!e||!r){console.warn("[ActivityLog] Missing required fields: userId, action");return}console.log(`[ActivityLog] Logging ${r} for user ${e}`);let{error:u}=await t.pR.from("activity_logs").insert([{user_id:e,action:r,entity_type:a,entity_id:i,description:o,ip_address:n,user_agent:l,metadata:s}]);u?console.error("[ActivityLog] Error logging activity:",u):console.log(`[ActivityLog] âœ… ${r} logged successfully`)}catch(e){console.error("[ActivityLog] Exception:",e)}}async function o(e){try{let{error:r}=await t.pR.from("users").update({last_login_at:new Date().toISOString(),login_count:t.pR.rpc("increment_login_count",{user_id:e})}).eq("id",e);r&&console.error("[LastLogin] Error updating last login:",r)}catch(e){console.error("[LastLogin] Exception:",e)}}},25092:(e,r,a)=>{a.d(r,{V3:()=>c});var t=a(38991),i=a(55245),o=a(80665);let s=(0,a(21764).promisify)(o.resolveMx);async function n(e){try{if(!(0,t.G)(e))return{valid:!1,reason:"Invalid email format"};let r=e.split("@")[1];if(!r)return{valid:!1,reason:"Email domain is invalid"};let a=await s(r).catch(e=>(console.error(`[Email Validation] MX lookup failed for ${r}:`,e.message),null));if(!a||0===a.length)return{valid:!1,reason:`Domain '${r}' does not accept emails (no MX records found)`};return await l(e,a[0])||console.log(`[Email Validation] SMTP verification failed for ${e}, but allowing due to valid MX records`),{valid:!0,reason:"Email address is valid"}}catch(e){return console.error("[Email Validation] Unexpected error during validation:",e),{valid:!0,reason:"Email validation passed (with warnings)",warning:e.message}}}async function l(e,r){return new Promise(e=>{let a=setTimeout(()=>{e(!0)},5e3);try{let t=(0,i.createTransport)({host:r.exchange,port:25,secure:!1,tls:{rejectUnauthorized:!1},connectionTimeout:3e3,socketTimeout:3e3});t.verify((i,o)=>{clearTimeout(a),i?(console.log(`[Email Validation] SMTP verification failed for ${r.exchange}:`,i.message),e(!1)):e(!0),t.close()})}catch(r){clearTimeout(a),console.error("[Email Validation] SMTP connection error:",r.message),e(!1)}})}let u=new Set(["tempmail.com","tempmail.net","tempmail.org","temp-mail.io","temp-mail.org","temporary-mail.net","throwaway.email","throwaway.email.com","trashmail.com","maildrop.cc","mailnesia.com","spam4.me","dispostable.com","fakeinbox.com","mailinator.com","guerrillamail.com","guerrillamail.net","guerrillamail.info","guerrillamail.org","10minutemail.com","10minutemail.net","yopmail.com","yopmail.net","mintemail.com","tempail.com","spamgourmet.com","sharklasers.com","pokemail.net","grr.la","getnada.com","getresponse.com","inboxkitten.com","temp-mail.tk","throwawaymail.com","sharklasers.com","spam.la","0-mail.com","0box.eu","10minutemail.info","10minutemail.fr","10minutemail.de","1secmail.com","a-bc.net","acompanhado.top","acompanhados.com","achatasafe.com","abcdefghijklmnop.com","abcinbox.com","abcinbox.eu","fakegmail.com","fake-email.com","fakemail.com","fake-email.net","testnator.com","testmail.de","temp123.com"]);async function c(e){return!function(e){let r=e.split("@")[1]?.toLowerCase();return!!(!r||u.has(r)||r.includes("tempmail")||r.includes("temp-mail")||r.includes("temporary")||r.includes("throwaway")||r.includes("spam")||r.includes("fake")||r.includes("test")||r.includes("trash")||r.includes("10minute"))}(e)?await n(e):{valid:!1,reason:"Disposable/temporary email addresses are not allowed. Please use a real email address."}}},85662:(e,r,a)=>{a.d(r,{OQ:()=>n,pR:()=>l});var t=a(76596);let i=process.env.NEXT_PUBLIC_SUPABASE_URL,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,s=process.env.SUPABASE_SERVICE_ROLE_KEY,n=null,l=null;i&&o&&(n=(0,t.eI)(i,o),l=(0,t.eI)(i,s||o))},38991:(e,r)=>{var a=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-*\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/;r.G=function(e){if(!e||e.length>254||!a.test(e))return!1;var r=e.split("@");return!(r[0].length>64||r[1].split(".").some(function(e){return e.length>63}))}}};var r=require("../../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[8948,5972,6596,5245],()=>a(76637));module.exports=t})();