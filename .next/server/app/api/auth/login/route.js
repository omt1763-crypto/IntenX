"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},37593:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>c,originalPathname:()=>f,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>g});var s={};o.r(s),o.d(s,{POST:()=>POST});var t=o(10884),a=o(16132),i=o(95798),n=o(47770);async function POST(e){try{let{email:r,password:o,role:s}=await e.json();if(!r||!o||!s)return i.Z.json({error:"Email, password, and role are required"},{status:400});console.log("[Login] Attempting to authenticate:",{email:r,role:s});let{data:t,error:a}=await n.OQ.auth.signInWithPassword({email:r,password:o});if(a)return console.error("[Login] Auth error:",{message:a.message,code:a.code,status:a.status}),i.Z.json({error:"Invalid email or password. Make sure you signed up first."},{status:401});console.log("[Login] Auth successful, user ID:",t.user?.id);let{data:u,error:l}=await n.pR.from("users").select("*").eq("id",t.user.id),d=null;if(l){console.error("[Login] Profile fetch error:",l),console.log("[Login] Creating missing user profile...");let{data:e,error:r}=await n.pR.from("users").insert([{id:t.user.id,email:t.user.email,first_name:t.user.email.split("@")[0],last_name:"User",role:s||"candidate",password_hash:"MANAGED_BY_SUPABASE_AUTH"}]).select().single();if(r||!e)return console.error("[Login] Failed to create profile:",r),i.Z.json({error:"Failed to setup user profile"},{status:500});d=e}else u&&u.length>0&&(d=u[0]);if(!d)return console.error("[Login] No user profile found or created"),i.Z.json({error:"User profile not found"},{status:404});return console.log("[Login] User profile found, role:",d.role),i.Z.json({user:d,session:t.session},{status:200})}catch(e){return console.error("Login error:",e),i.Z.json({error:"Failed to login"},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\auth\\login\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:p,headerHooks:c,staticGenerationBailout:g}=u,f="/api/auth/login/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[729,5798,8617,7770],()=>__webpack_exec__(37593));module.exports=o})();