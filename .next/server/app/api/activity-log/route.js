"use strict";(()=>{var e={};e.id=9851,e.ids=[9851],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20179:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>v,routeModule:()=>u,serverHooks:()=>_,staticGenerationAsyncStorage:()=>y});var i={};r.r(i),r.d(i,{GET:()=>p,POST:()=>g,dynamic:()=>l,revalidate:()=>d});var s=r(49303),a=r(88716),o=r(60670),n=r(87070),c=r(85662);let l="force-dynamic",d=0;async function g(e){try{let{userId:t,activityType:r,severity:i,description:s,ipAddress:a,metadata:o}=await e.json(),l=new Date().toISOString();console.log(`[Activity Log] ${i.toUpperCase()} - ${r}:`,s);let{data:d,error:g}=await c.pR.from("activity_logs").insert([{user_id:t||null,activity_type:r,severity:i||"low",description:s,ip_address:a,metadata:o||{},created_at:l,reviewed:!1}]).select();if(g)return console.error("[Activity Log] Insert error:",g),n.NextResponse.json({success:!1,error:g.message},{status:400});return n.NextResponse.json({success:!0,data:d})}catch(e){return console.error("[Activity Log] Error:",e),n.NextResponse.json({success:!1,error:e.message},{status:500})}}async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("severity"),i=parseInt(t.get("limit")||"100"),s=parseInt(t.get("offset")||"0");console.log("[Activity Log] Fetching logs with:",{severity:r,limit:i,offset:s});let a=[],o=c.pR.from("activity_logs").select("*",{count:"exact"}).order("created_at",{ascending:!1});r&&"all"!==r&&(o=o.eq("severity",r));let{data:l,error:d,count:g}=await o.range(s,s+i-1);d?console.log("[Activity Log] Activity logs not available:",d.code):a=l||[];let p=[],{data:u,error:v}=await c.pR.from("login_logs").select("*").order("created_at",{ascending:!1}).limit(100);v?console.log("[Activity Log] Login logs not available:",v.code):p=u||[];let y=[];a.forEach(e=>{y.push({id:e.id,type:"activity",activity_type:e.activity_type||"unknown",description:e.description||"",severity:e.severity||"low",user_id:e.user_id,ip_address:e.ip_address,created_at:e.created_at,reviewed:e.reviewed||!1})}),p.forEach(e=>{let t=[e.city,e.country].filter(Boolean).join(", ")||"Unknown";y.push({id:e.id,type:"login",activity_type:"user_login",description:`ðŸ” Login: ${e.email||e.user_id} | ${t}`,severity:"low",user_id:e.user_id,email:e.email,ip_address:e.ip_address,user_agent:e.user_agent,country:e.country,city:e.city,device:e.device,browser:e.browser,os:e.os,created_at:e.created_at,reviewed:!1})}),y.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)),r&&"all"!==r&&(y=y.filter(e=>e.severity===r));let _={total:y.length,activities:a.length,logins:p.length,low:y.filter(e=>"low"===e.severity).length,medium:y.filter(e=>"medium"===e.severity).length,high:y.filter(e=>"high"===e.severity).length,critical:y.filter(e=>"critical"===e.severity).length},m=n.NextResponse.json({success:!0,timestamp:new Date().toISOString(),data:y.slice(s,s+i),stats:_,pagination:{total:y.length,limit:i,offset:s}});return m.headers.set("Cache-Control","no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0"),m.headers.set("Pragma","no-cache"),m.headers.set("Expires","0"),m}catch(e){return console.error("[Activity Log] Error:",e),n.NextResponse.json({success:!0,data:[],stats:{low:0,medium:0,high:0,critical:0,total:0,activities:0,logins:0},message:"Activity logs and login logs tables not yet created."})}}let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/activity-log/route",pathname:"/api/activity-log",filename:"route",bundlePath:"app/api/activity-log/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\activity-log\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:y,serverHooks:_}=u,m="/api/activity-log/route";function h(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:y})}},85662:(e,t,r)=>{r.d(t,{OQ:()=>n,pR:()=>c});var i=r(76596);let s=process.env.NEXT_PUBLIC_SUPABASE_URL,a=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!s||!a)throw Error("Missing Supabase environment variables");let n=(0,i.eI)(s,a),c=(0,i.eI)(s,o||a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,6596],()=>r(20179));module.exports=i})();