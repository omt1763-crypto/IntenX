"use strict";(()=>{var e={};e.id=9851,e.ids=[9851],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63074:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>y,originalPathname:()=>_,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>p});var r={};i.r(r),i.d(r,{GET:()=>GET,POST:()=>POST,dynamic:()=>c,revalidate:()=>l});var a=i(10884),o=i(16132),s=i(95798),n=i(47770);let c="force-dynamic",l=0;async function POST(e){try{let{userId:t,activityType:i,severity:r,description:a,ipAddress:o,metadata:c}=await e.json(),l=new Date().toISOString();console.log(`[Activity Log] ${r.toUpperCase()} - ${i}:`,a);let{data:d,error:g}=await n.pR.from("activity_logs").insert([{user_id:t||null,activity_type:i,severity:r||"low",description:a,ip_address:o,metadata:c||{},created_at:l,reviewed:!1}]).select();if(g)return console.error("[Activity Log] Insert error:",g),s.Z.json({success:!1,error:g.message},{status:400});return s.Z.json({success:!0,data:d})}catch(e){return console.error("[Activity Log] Error:",e),s.Z.json({success:!1,error:e.message},{status:500})}}async function GET(e){try{let{searchParams:t}=new URL(e.url),i=t.get("severity"),r=parseInt(t.get("limit")||"100"),a=parseInt(t.get("offset")||"0");console.log("[Activity Log] Fetching logs with:",{severity:i,limit:r,offset:a});let o=[],c=n.pR.from("activity_logs").select("*",{count:"exact"}).order("created_at",{ascending:!1});i&&"all"!==i&&(c=c.eq("severity",i));let{data:l,error:d,count:g}=await c.range(a,a+r-1);d?console.log("[Activity Log] Activity logs not available:",d.code):o=l||[];let u=[],{data:v,error:y}=await n.pR.from("login_logs").select("*").order("created_at",{ascending:!1}).limit(100);y?console.log("[Activity Log] Login logs not available:",y.code):u=v||[];let p=[];o.forEach(e=>{p.push({id:e.id,type:"activity",activity_type:e.activity_type||"unknown",description:e.description||"",severity:e.severity||"low",user_id:e.user_id,ip_address:e.ip_address,created_at:e.created_at,reviewed:e.reviewed||!1})}),u.forEach(e=>{let t=[e.city,e.country].filter(Boolean).join(", ")||"Unknown";p.push({id:e.id,type:"login",activity_type:"user_login",description:`ðŸ” Login: ${e.email||e.user_id} | ${t}`,severity:"low",user_id:e.user_id,email:e.email,ip_address:e.ip_address,user_agent:e.user_agent,country:e.country,city:e.city,device:e.device,browser:e.browser,os:e.os,created_at:e.created_at,reviewed:!1})}),p.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)),i&&"all"!==i&&(p=p.filter(e=>e.severity===i));let _={total:p.length,activities:o.length,logins:u.length,low:p.filter(e=>"low"===e.severity).length,medium:p.filter(e=>"medium"===e.severity).length,high:p.filter(e=>"high"===e.severity).length,critical:p.filter(e=>"critical"===e.severity).length},m=s.Z.json({success:!0,timestamp:new Date().toISOString(),data:p.slice(a,a+r),stats:_,pagination:{total:p.length,limit:r,offset:a}});return m.headers.set("Cache-Control","no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0"),m.headers.set("Pragma","no-cache"),m.headers.set("Expires","0"),m}catch(e){return console.error("[Activity Log] Error:",e),s.Z.json({success:!0,data:[],stats:{low:0,medium:0,high:0,critical:0,total:0,activities:0,logins:0},message:"Activity logs and login logs tables not yet created."})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/activity-log/route",pathname:"/api/activity-log",filename:"route",bundlePath:"app/api/activity-log/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\activity-log\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:u,serverHooks:v,headerHooks:y,staticGenerationBailout:p}=d,_="/api/activity-log/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[729,5798,8617,7770],()=>__webpack_exec__(63074));module.exports=i})();