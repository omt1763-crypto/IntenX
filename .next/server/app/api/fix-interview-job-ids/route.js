"use strict";(()=>{var e={};e.id=9734,e.ids=[9734],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},75719:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>b,requestAsyncStorage:()=>v,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w});var i={};r.r(i),r.d(i,{GET:()=>u,POST:()=>c,dynamic:()=>l});var s=r(49303),o=r(88716),n=r(60670),a=r(87070),d=r(85662);let l="force-dynamic";async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("recruiterId");if(!r)return a.NextResponse.json({error:"Missing recruiterId parameter"},{status:400});console.log("[FixInterviewJobIds] Diagnostic check for recruiter:",r);let{data:i}=await d.pR.from("jobs").select("id, title").eq("recruiter_id",r),s=i?.map(e=>e.id)||[];console.log("[FixInterviewJobIds] Recruiter has",s.length,"jobs");let{data:o}=await d.pR.from("interviews").select("id, created_at, job_id").in("job_id",s.length>0?s:["null"]).order("created_at",{ascending:!1}),{data:n}=await d.pR.from("interviews").select("id, applicant_id, user_id, created_at").is("job_id",null).limit(100);console.log("[FixInterviewJobIds] Found",o?.length||0,"interviews WITH job_id"),console.log("[FixInterviewJobIds] Found",n?.length||0,"interviews WITHOUT job_id");let l={recruiter_id:r,total_jobs:s.length,jobs:i,interviews_with_job_id:o?.length||0,interviews_without_job_id:n?.length||0,sample_no_job_id:n?.slice(0,5)||[],recommendation:n&&n.length>0?`Found ${n.length} interviews missing job_id. These are likely from old interviews. Need manual linking or batch update.`:"All interviews have job_id. No issues found."};return a.NextResponse.json({success:!0,diagnostics:l})}catch(e){return console.error("[FixInterviewJobIds] Error:",e),a.NextResponse.json({error:e.message},{status:500})}}async function c(e){try{let{recruiterId:t,applicantId:r,jobId:i}=await e.json();if(!t||!i)return a.NextResponse.json({error:"Missing recruiterId or jobId"},{status:400});if(console.log("[FixInterviewJobIds] Attempting to link interviews for recruiter:",t),console.log("[FixInterviewJobIds] jobId:",i),r){let{data:e,error:t}=await d.pR.from("interviews").update({job_id:i}).eq("applicant_id",r).is("job_id",null).select();if(t)return console.error("[FixInterviewJobIds] Error updating:",t),a.NextResponse.json({error:t.message},{status:400});return a.NextResponse.json({success:!0,message:`Updated ${e?.length||0} interview(s)`,updated:e})}let{data:s,error:o}=await d.pR.from("interviews").select("id, applicant_id").is("job_id",null).limit(50);if(o)return console.error("[FixInterviewJobIds] Fetch error:",o),a.NextResponse.json({error:o.message},{status:400});if(console.log("[FixInterviewJobIds] Found",s?.length||0,"interviews to update"),!s||0===s.length)return a.NextResponse.json({success:!0,message:"No interviews to update"});let{data:n,error:l}=await d.pR.from("interviews").update({job_id:i}).is("job_id",null).limit(50).select();if(l)return console.error("[FixInterviewJobIds] Batch update error:",l),a.NextResponse.json({error:l.message},{status:400});return a.NextResponse.json({success:!0,message:`Updated ${n?.length||0} interviews with job_id: ${i}`,updated_count:n?.length||0})}catch(e){return console.error("[FixInterviewJobIds] Exception:",e),a.NextResponse.json({error:e.message},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/fix-interview-job-ids/route",pathname:"/api/fix-interview-job-ids",filename:"route",bundlePath:"app/api/fix-interview-job-ids/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\fix-interview-job-ids\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:g}=p,_="/api/fix-interview-job-ids/route";function b(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}},85662:(e,t,r)=>{r.d(t,{OQ:()=>a,pR:()=>d});var i=r(76596);let s=process.env.NEXT_PUBLIC_SUPABASE_URL,o=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,n=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!s||!o)throw Error("Missing Supabase environment variables");let a=(0,i.eI)(s,o),d=(0,i.eI)(s,n||o)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,6596],()=>r(75719));module.exports=i})();