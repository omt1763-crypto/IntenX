"use strict";(()=>{var e={};e.id=9734,e.ids=[9734],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45059:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>p,originalPathname:()=>v,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>c,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>w});var i={};r.r(i),r.d(i,{GET:()=>GET,POST:()=>POST});var o=r(10884),s=r(16132),n=r(95798),a=r(47770);async function GET(e){try{let{searchParams:t}=new URL(e.url),r=t.get("recruiterId");if(!r)return n.Z.json({error:"Missing recruiterId parameter"},{status:400});console.log("[FixInterviewJobIds] Diagnostic check for recruiter:",r);let{data:i}=await a.pR.from("jobs").select("id, title").eq("recruiter_id",r),o=i?.map(e=>e.id)||[];console.log("[FixInterviewJobIds] Recruiter has",o.length,"jobs");let{data:s}=await a.pR.from("interviews").select("id, created_at, job_id").in("job_id",o.length>0?o:["null"]).order("created_at",{ascending:!1}),{data:d}=await a.pR.from("interviews").select("id, applicant_id, user_id, created_at").is("job_id",null).limit(100);console.log("[FixInterviewJobIds] Found",s?.length||0,"interviews WITH job_id"),console.log("[FixInterviewJobIds] Found",d?.length||0,"interviews WITHOUT job_id");let l={recruiter_id:r,total_jobs:o.length,jobs:i,interviews_with_job_id:s?.length||0,interviews_without_job_id:d?.length||0,sample_no_job_id:d?.slice(0,5)||[],recommendation:d&&d.length>0?`Found ${d.length} interviews missing job_id. These are likely from old interviews. Need manual linking or batch update.`:"All interviews have job_id. No issues found."};return n.Z.json({success:!0,diagnostics:l})}catch(e){return console.error("[FixInterviewJobIds] Error:",e),n.Z.json({error:e.message},{status:500})}}async function POST(e){try{let{recruiterId:t,applicantId:r,jobId:i}=await e.json();if(!t||!i)return n.Z.json({error:"Missing recruiterId or jobId"},{status:400});if(console.log("[FixInterviewJobIds] Attempting to link interviews for recruiter:",t),console.log("[FixInterviewJobIds] jobId:",i),r){let{data:e,error:t}=await a.pR.from("interviews").update({job_id:i}).eq("applicant_id",r).is("job_id",null).select();if(t)return console.error("[FixInterviewJobIds] Error updating:",t),n.Z.json({error:t.message},{status:400});return n.Z.json({success:!0,message:`Updated ${e?.length||0} interview(s)`,updated:e})}let{data:o,error:s}=await a.pR.from("interviews").select("id, applicant_id").is("job_id",null).limit(50);if(s)return console.error("[FixInterviewJobIds] Fetch error:",s),n.Z.json({error:s.message},{status:400});if(console.log("[FixInterviewJobIds] Found",o?.length||0,"interviews to update"),!o||0===o.length)return n.Z.json({success:!0,message:"No interviews to update"});let{data:d,error:l}=await a.pR.from("interviews").update({job_id:i}).is("job_id",null).limit(50).select();if(l)return console.error("[FixInterviewJobIds] Batch update error:",l),n.Z.json({error:l.message},{status:400});return n.Z.json({success:!0,message:`Updated ${d?.length||0} interviews with job_id: ${i}`,updated_count:d?.length||0})}catch(e){return console.error("[FixInterviewJobIds] Exception:",e),n.Z.json({error:e.message},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/fix-interview-job-ids/route",pathname:"/api/fix-interview-job-ids",filename:"route",bundlePath:"app/api/fix-interview-job-ids/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\fix-interview-job-ids\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:u,serverHooks:c,headerHooks:p,staticGenerationBailout:w}=d,v="/api/fix-interview-job-ids/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[729,5798,8617,7770],()=>__webpack_exec__(45059));module.exports=r})();