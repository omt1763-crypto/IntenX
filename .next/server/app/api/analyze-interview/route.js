"use strict";(()=>{var e={};e.id=3621,e.ids=[3621],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9147:(e,n,r)=>{r.r(n),r.d(n,{headerHooks:()=>p,originalPathname:()=>A,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>u});var t={};r.r(t),r.d(t,{POST:()=>POST});var o=r(10884),a=r(16132),i=r(95798),s=r(47770);let l=process.env.OPENAI_API_KEY;async function POST(e){try{let n;let r=await e.json(),{conversation:t,skills:o,duration:a,applicantId:c,interviewId:d}=r;if(console.log("[AnalyzeInterview API] Request body:",JSON.stringify(r,null,2)),console.log("[AnalyzeInterview API] Analyzing interview for applicant:",c),console.log("[AnalyzeInterview API] Conversation messages:",t?.length||0),console.log("[AnalyzeInterview API] Skills extracted:",o?.length||0),!t||!Array.isArray(t)||0===t.length)return console.error("[AnalyzeInterview API] Invalid conversation:",t),i.Z.json({error:"No conversation data to analyze",received:t},{status:400});if(!l)return console.error("[AnalyzeInterview API] Missing OPENAI_API_KEY"),i.Z.json({error:"API key not configured"},{status:500});let I=t.map(e=>`${"user"===e.role?"Candidate":"Interviewer"}: ${e.content}`).join("\n\n"),v=o&&o.length>0?o.map(e=>`- ${"string"==typeof e?e:e.name||e}`).join("\n"):"No specific skills identified",p=`Analyze this job interview VERY CAREFULLY. Return ONLY a valid JSON object, no other text.

INTERVIEW CONVERSATION:
${I}

TARGET SKILLS:
${v}

INTERVIEW DURATION: ${a} seconds

Analyze the candidate's performance and respond with ONLY this JSON structure (no markdown, no extra text):
{
  "jobSuitability": <number 0-100>,
  "relevantAccomplishments": <number 0-100>,
  "driveInitiative": <number 0-100>,
  "problemSolving": <number 0-100>,
  "cultureScopes": <number 0-100>,
  "leadershipInfluence": <number 0-100>,
  "overall": <number 0-100>,
  "recommendation": "<'Strong Candidate' or 'Consider for Interview' or 'Do Not Hire'>",
  "summary": "<2-3 sentence summary of candidate performance>",
  "strengths": ["<strength 1>", "<strength 2>", "<strength 3>"],
  "weaknesses": ["<weakness 1>", "<weakness 2>"],
  "areasToExplore": ["<area 1>", "<area 2>"]
}`;console.log("[AnalyzeInterview API] Sending to OpenAI for analysis...");let u=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are an expert HR recruiter and interview analyst. Provide detailed assessments ONLY in valid JSON format. Return proper JSON object."},{role:"user",content:p}],temperature:.7,max_tokens:2e3})});if(!u.ok){let e=await u.json();return console.error("[AnalyzeInterview API] OpenAI error:",e),i.Z.json({error:"Failed to analyze interview",details:e},{status:400})}let A=await u.json(),w=A.choices[0].message.content;console.log("[AnalyzeInterview API] AI Response length:",w.length),console.log("[AnalyzeInterview API] AI Response first 200 chars:",w.substring(0,200));try{n=JSON.parse(w),console.log("[AnalyzeInterview API] Successfully parsed JSON analysis")}catch(r){console.error("[AnalyzeInterview API] Failed to parse AI response as JSON:",r),console.error("[AnalyzeInterview API] Response content:",w);let e=w.match(/\{[\s\S]*\}/);if(e)try{n=JSON.parse(e[0]),console.log("[AnalyzeInterview API] Successfully extracted and parsed JSON")}catch(e){throw console.error("[AnalyzeInterview API] Failed to parse extracted JSON:",e),Error(`Could not parse AI response as JSON: ${e.message}`)}else throw Error("Could not find JSON in AI response")}if(console.log("[AnalyzeInterview API] Analysis parsed:",JSON.stringify(n).substring(0,200)),d){console.log("[AnalyzeInterview API] Saving analysis directly to interview:",d);let{error:e}=await s.pR.from("interviews").update({analysis:n,score:Math.round(n.overall||0),updated_at:new Date().toISOString()}).eq("id",d);e?console.error("[AnalyzeInterview API] Error updating interview with analysis:",e):console.log("[AnalyzeInterview API] Interview analysis saved successfully to interview id:",d)}else if(c){console.log("[AnalyzeInterview API] Saving analysis for applicantId:",c);let{data:e,error:r}=await s.pR.from("interviews").select("id").eq("applicant_id",c).order("created_at",{ascending:!1}).limit(1).single();if(r)console.error("[AnalyzeInterview API] Error fetching interview:",r);else if(e){console.log("[AnalyzeInterview API] Found interview to update:",e.id);let{error:r}=await s.pR.from("interviews").update({analysis:n,score:Math.round(n.overall||0),updated_at:new Date().toISOString()}).eq("id",e.id);r?console.error("[AnalyzeInterview API] Error updating interview with analysis:",r):console.log("[AnalyzeInterview API] Interview analysis saved successfully to interview id:",e.id)}else console.log("[AnalyzeInterview API] No interview found for applicantId:",c)}else console.log("[AnalyzeInterview API] No interviewId or applicantId provided, analysis not saved to database");return i.Z.json({success:!0,analysis:n})}catch(e){return console.error("[AnalyzeInterview API] Error:",e),i.Z.json({error:e.message||"Internal server error"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze-interview/route",pathname:"/api/analyze-interview",filename:"route",bundlePath:"app/api/analyze-interview/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\analyze-interview\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:I,serverHooks:v,headerHooks:p,staticGenerationBailout:u}=c,A="/api/analyze-interview/route"}};var n=require("../../../webpack-runtime.js");n.C(e);var __webpack_exec__=e=>n(n.s=e),r=n.X(0,[729,5798,8617,7770],()=>__webpack_exec__(9147));module.exports=r})();