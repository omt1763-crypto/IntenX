"use strict";(()=>{var e={};e.id=3621,e.ids=[3621],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21955:(e,n,r)=>{r.r(n),r.d(n,{originalPathname:()=>u,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>p,serverHooks:()=>A,staticGenerationAsyncStorage:()=>I});var t={};r.r(t),r.d(t,{POST:()=>d});var o=r(49303),a=r(88716),s=r(60670),i=r(87070),l=r(85662);let c=process.env.OPENAI_API_KEY;async function d(e){try{let n;let r=await e.json(),{conversation:t,skills:o,duration:a,applicantId:s,interviewId:d}=r;if(console.log("[AnalyzeInterview API] Request body:",JSON.stringify(r,null,2)),console.log("[AnalyzeInterview API] Analyzing interview for applicant:",s),console.log("[AnalyzeInterview API] Conversation messages:",t?.length||0),console.log("[AnalyzeInterview API] Skills extracted:",o?.length||0),!t||!Array.isArray(t)||0===t.length)return console.error("[AnalyzeInterview API] Invalid conversation:",t),i.NextResponse.json({error:"No conversation data to analyze",received:t},{status:400});if(!c)return console.error("[AnalyzeInterview API] Missing OPENAI_API_KEY"),i.NextResponse.json({error:"API key not configured"},{status:500});let p=t.map(e=>`${"user"===e.role?"Candidate":"Interviewer"}: ${e.content}`).join("\n\n"),v=o&&o.length>0?o.map(e=>`- ${"string"==typeof e?e:e.name||e}`).join("\n"):"No specific skills identified",I=`Analyze this job interview VERY CAREFULLY. Return ONLY a valid JSON object, no other text.

INTERVIEW CONVERSATION:
${p}

TARGET SKILLS:
${v}

INTERVIEW DURATION: ${a} seconds

Analyze the candidate's performance and respond with ONLY this JSON structure (no markdown, no extra text):
{
  "jobSuitability": <number 0-100>,
  "relevantAccomplishments": <number 0-100>,
  "driveInitiative": <number 0-100>,
  "problemSolving": <number 0-100>,
  "cultureScopes": <number 0-100>,
  "leadershipInfluence": <number 0-100>,
  "overall": <number 0-100>,
  "recommendation": "<'Strong Candidate' or 'Consider for Interview' or 'Do Not Hire'>",
  "summary": "<2-3 sentence summary of candidate performance>",
  "strengths": ["<strength 1>", "<strength 2>", "<strength 3>"],
  "weaknesses": ["<weakness 1>", "<weakness 2>"],
  "areasToExplore": ["<area 1>", "<area 2>"]
}`;console.log("[AnalyzeInterview API] Sending to OpenAI for analysis...");let A=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are an expert HR recruiter and interview analyst. Provide detailed assessments ONLY in valid JSON format. Return proper JSON object."},{role:"user",content:I}],temperature:.7,max_tokens:2e3})});if(!A.ok){let e=await A.json();return console.error("[AnalyzeInterview API] OpenAI error:",e),i.NextResponse.json({error:"Failed to analyze interview",details:e},{status:400})}let u=(await A.json()).choices[0].message.content;console.log("[AnalyzeInterview API] AI Response length:",u.length),console.log("[AnalyzeInterview API] AI Response first 200 chars:",u.substring(0,200));try{n=JSON.parse(u),console.log("[AnalyzeInterview API] Successfully parsed JSON analysis")}catch(r){console.error("[AnalyzeInterview API] Failed to parse AI response as JSON:",r),console.error("[AnalyzeInterview API] Response content:",u);let e=u.match(/\{[\s\S]*\}/);if(e)try{n=JSON.parse(e[0]),console.log("[AnalyzeInterview API] Successfully extracted and parsed JSON")}catch(e){throw console.error("[AnalyzeInterview API] Failed to parse extracted JSON:",e),Error(`Could not parse AI response as JSON: ${e.message}`)}else throw Error("Could not find JSON in AI response")}if(console.log("[AnalyzeInterview API] Analysis parsed:",JSON.stringify(n).substring(0,200)),d){console.log("[AnalyzeInterview API] Saving analysis directly to interview:",d);let{error:e}=await l.pR.from("interviews").update({analysis:n,score:Math.round(n.overall||0),updated_at:new Date().toISOString()}).eq("id",d);e?console.error("[AnalyzeInterview API] Error updating interview with analysis:",e):console.log("[AnalyzeInterview API] Interview analysis saved successfully to interview id:",d)}else if(s){console.log("[AnalyzeInterview API] Saving analysis for applicantId:",s);let{data:e,error:r}=await l.pR.from("interviews").select("id").eq("applicant_id",s).order("created_at",{ascending:!1}).limit(1).single();if(r)console.error("[AnalyzeInterview API] Error fetching interview:",r);else if(e){console.log("[AnalyzeInterview API] Found interview to update:",e.id);let{error:r}=await l.pR.from("interviews").update({analysis:n,score:Math.round(n.overall||0),updated_at:new Date().toISOString()}).eq("id",e.id);r?console.error("[AnalyzeInterview API] Error updating interview with analysis:",r):console.log("[AnalyzeInterview API] Interview analysis saved successfully to interview id:",e.id)}else console.log("[AnalyzeInterview API] No interview found for applicantId:",s)}else console.log("[AnalyzeInterview API] No interviewId or applicantId provided, analysis not saved to database");return i.NextResponse.json({success:!0,analysis:n})}catch(e){return console.error("[AnalyzeInterview API] Error:",e),i.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze-interview/route",pathname:"/api/analyze-interview",filename:"route",bundlePath:"app/api/analyze-interview/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\analyze-interview\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:v,staticGenerationAsyncStorage:I,serverHooks:A}=p,u="/api/analyze-interview/route";function y(){return(0,s.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:I})}},85662:(e,n,r)=>{r.d(n,{OQ:()=>i,pR:()=>l});var t=r(76596);let o=process.env.NEXT_PUBLIC_SUPABASE_URL,a=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,s=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!o||!a)throw Error("Missing Supabase environment variables");let i=(0,t.eI)(o,a),l=(0,t.eI)(o,s||a)}};var n=require("../../../webpack-runtime.js");n.C(e);var r=e=>n(n.s=e),t=n.X(0,[8948,5972,6596],()=>r(21955));module.exports=t})();