"use strict";(()=>{var e={};e.id=3621,e.ids=[3621],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},21955:(e,n,t)=>{t.r(n),t.d(n,{originalPathname:()=>A,patchFetch:()=>g,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>I,staticGenerationAsyncStorage:()=>v});var r={};t.r(r),t.d(r,{POST:()=>d});var o=t(49303),a=t(88716),s=t(60670),i=t(87070),l=t(85662);let c=process.env.OPENAI_API_KEY;async function d(e){try{let n;let t=await e.json(),{conversation:r,skills:o,duration:a,applicantId:s,interviewId:d}=t;if(console.log("[AnalyzeInterview API] Request body:",JSON.stringify(t,null,2)),console.log("[AnalyzeInterview API] Analyzing interview for applicant:",s),console.log("[AnalyzeInterview API] Conversation messages:",r?.length||0),console.log("[AnalyzeInterview API] Skills extracted:",o?.length||0),console.log("[AnalyzeInterview API] Interview duration:",a,"seconds"),!r||!Array.isArray(r)||0===r.length)return console.error("[AnalyzeInterview API] Invalid conversation:",r),i.NextResponse.json({error:"No conversation data to analyze",received:r},{status:400});let p=r.filter(e=>"user"===e.role).filter(e=>e.content&&e.content.trim().length>0);console.log("[AnalyzeInterview API] Candidate messages count:",p.length);let u=p.length>0?p.reduce((e,n)=>e+(n.content?.length||0),0)/p.length:0;if(console.log("[AnalyzeInterview API] Average candidate message length:",u),a<30)return console.warn(`[AnalyzeInterview API] Interview too short: ${a}s < 30s`),i.NextResponse.json({error:"Interview duration too short",message:`Interview must be at least 30 seconds long. Current: ${a}s`,minRequired:30,actual:a},{status:400});if(p.length<2)return console.warn(`[AnalyzeInterview API] Not enough candidate responses: ${p.length} < 2`),i.NextResponse.json({error:"Not enough candidate participation",message:`Candidate must provide at least 2 responses. Got: ${p.length}`,minRequired:2,actual:p.length},{status:400});if(u<10)return console.warn(`[AnalyzeInterview API] Candidate responses too short: avg ${u} chars < 10`),i.NextResponse.json({error:"Candidate responses too brief",message:`Responses must be more detailed. Average length: ${Math.round(u)} characters (minimum: 10)`,minRequired:10,actual:Math.round(u)},{status:400});if(console.log("[AnalyzeInterview API] Interview validation passed - proceeding with analysis"),!c)return console.error("[AnalyzeInterview API] Missing OPENAI_API_KEY"),i.NextResponse.json({error:"API key not configured"},{status:500});let v=r.map(e=>`${"user"===e.role?"Candidate":"Interviewer"}: ${e.content}`).join("\n\n"),I=o&&o.length>0?o.map(e=>`- ${"string"==typeof e?e:e.name||e}`).join("\n"):"No specific skills identified",A=`You are an expert HR recruiter and interview analyst. Analyze this job interview VERY CAREFULLY and critically.

IMPORTANT SCORING GUIDELINES:
- Score 0-30: Candidate showed little to no relevant experience, unclear communication, or lack of preparation
- Score 31-50: Basic understanding but missing depth, limited examples, vague answers
- Score 51-70: Good understanding, relevant examples, clear communication but some gaps
- Score 71-85: Strong understanding, multiple relevant examples, excellent communication
- Score 86-100: Exceptional understanding, comprehensive examples, outstanding communication and fit

INTERVIEW CONVERSATION:
${v}

TARGET SKILLS:
${I}

INTERVIEW DURATION: ${a} seconds

CRITICAL EVALUATION REQUIREMENTS:
1. ONLY score high (>70) if candidate demonstrates CLEAR, SPECIFIC examples of relevant experience
2. ONLY score high if candidate shows UNDERSTANDING of the target skills/role
3. Score lower if candidate gives generic, vague, or off-topic answers
4. Weight scores based on how specifically candidate addressed job requirements
5. If candidate barely spoke, scores should be much lower (0-40 range)
6. Be HARSH on vague answers - require concrete examples

Respond with ONLY valid JSON (no markdown, no extra text):
{
  "jobSuitability": <number 0-100 - How well does candidate fit this specific job?>,
  "relevantAccomplishments": <number 0-100 - Did candidate show SPECIFIC relevant achievements?>,
  "driveInitiative": <number 0-100 - Did candidate show motivation and proactive thinking?>,
  "problemSolving": <number 0-100 - Did candidate demonstrate problem-solving with concrete examples?>,
  "cultureScopes": <number 0-100 - Would candidate fit company culture?>,
  "leadershipInfluence": <number 0-100 - Did candidate show leadership or collaboration skills?>,
  "overall": <number 0-100 - OVERALL ASSESSMENT (be critical and conservative in scoring)>,
  "recommendation": "<MUST be one of: 'Strong Candidate' (overall 75+) | 'Consider for Interview' (overall 50-74) | 'Do Not Hire' (overall <50)>",
  "summary": "<2-3 sentences - what are the key observations about this candidate? Be specific.>",
  "strengths": ["<specific strength based on what they said>", "<another specific strength>", "<third if applicable>"],
  "weaknesses": ["<specific weakness or gap>", "<another weakness>"],
  "areasToExplore": ["<follow-up question or area>", "<another area to probe>"]
}`;console.log("[AnalyzeInterview API] Sending to OpenAI for analysis...");let g=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are an expert HR recruiter and interview analyst. Provide detailed assessments ONLY in valid JSON format. Return proper JSON object."},{role:"user",content:A}],temperature:.7,max_tokens:2e3})});if(!g.ok){let e=await g.json();return console.error("[AnalyzeInterview API] OpenAI error:",e),i.NextResponse.json({error:"Failed to analyze interview",details:e},{status:400})}let w=(await g.json()).choices[0].message.content;console.log("[AnalyzeInterview API] AI Response length:",w.length),console.log("[AnalyzeInterview API] AI Response first 200 chars:",w.substring(0,200));try{n=JSON.parse(w),console.log("[AnalyzeInterview API] Successfully parsed JSON analysis")}catch(t){console.error("[AnalyzeInterview API] Failed to parse AI response as JSON:",t),console.error("[AnalyzeInterview API] Response content:",w);let e=w.match(/\{[\s\S]*\}/);if(e)try{n=JSON.parse(e[0]),console.log("[AnalyzeInterview API] Successfully extracted and parsed JSON")}catch(e){throw console.error("[AnalyzeInterview API] Failed to parse extracted JSON:",e),Error(`Could not parse AI response as JSON: ${e.message}`)}else throw Error("Could not find JSON in AI response")}if(console.log("[AnalyzeInterview API] Analysis parsed:",JSON.stringify(n).substring(0,200)),d){console.log("[AnalyzeInterview API] Saving analysis directly to interview:",d);let{error:e}=await l.pR.from("interviews").update({analysis:n,score:Math.round(n.overall||0),updated_at:new Date().toISOString()}).eq("id",d);e?console.error("[AnalyzeInterview API] Error updating interview with analysis:",e):console.log("[AnalyzeInterview API] Interview analysis saved successfully to interview id:",d)}else if(s){console.log("[AnalyzeInterview API] Saving analysis for applicantId:",s);let{data:e,error:t}=await l.pR.from("interviews").select("id").eq("applicant_id",s).order("created_at",{ascending:!1}).limit(1).single();if(t)console.error("[AnalyzeInterview API] Error fetching interview:",t);else if(e){console.log("[AnalyzeInterview API] Found interview to update:",e.id);let{error:t}=await l.pR.from("interviews").update({analysis:n,score:Math.round(n.overall||0),updated_at:new Date().toISOString()}).eq("id",e.id);t?console.error("[AnalyzeInterview API] Error updating interview with analysis:",t):console.log("[AnalyzeInterview API] Interview analysis saved successfully to interview id:",e.id)}else console.log("[AnalyzeInterview API] No interview found for applicantId:",s)}else console.log("[AnalyzeInterview API] No interviewId or applicantId provided, analysis not saved to database");return i.NextResponse.json({success:!0,analysis:n})}catch(e){return console.error("[AnalyzeInterview API] Error:",e),i.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analyze-interview/route",pathname:"/api/analyze-interview",filename:"route",bundlePath:"app/api/analyze-interview/route"},resolvedPagePath:"C:\\Users\\omt91\\Downloads\\main\\interviewverse_frontend\\app\\api\\analyze-interview\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:v,serverHooks:I}=p,A="/api/analyze-interview/route";function g(){return(0,s.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:v})}},85662:(e,n,t)=>{t.d(n,{OQ:()=>i,pR:()=>l});var r=t(76596);let o=process.env.NEXT_PUBLIC_SUPABASE_URL,a=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,s=process.env.SUPABASE_SERVICE_ROLE_KEY,i=null,l=null;o&&a&&(i=(0,r.eI)(o,a),l=(0,r.eI)(o,s||a))}};var n=require("../../../webpack-runtime.js");n.C(e);var t=e=>n(n.s=e),r=n.X(0,[8948,5972,6596],()=>t(21955));module.exports=r})();