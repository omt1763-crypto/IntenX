"use strict";exports.id=8889,exports.ids=[8889],exports.modules={18889:(c,A,E)=>{var C,T,M,k,I,N,O,U,j,$,V,G,W,q,X,Y,g=c=>{throw TypeError(c)},m=(c,A,E)=>A.has(c)||g("Cannot "+E),f=(c,A,E)=>(m(c,A,"read from private field"),E?E.call(c):A.get(c)),b=(c,A,E)=>A.has(c)?g("Cannot add the same private member more than once"):A instanceof WeakSet?A.add(c):A.set(c,E),v=(c,A,E,C)=>(m(c,A,"write to private field"),C?C.call(c,E):A.set(c,E),E),y=(c,A,E)=>(m(c,A,"access private method"),E);Object.defineProperty(A,Symbol.toStringTag,{value:"Module"});var K="undefined"!=typeof document?document.currentScript:null,J={34:(c,A,E)=>{var C=E(4901);c.exports=function(c){return"object"==typeof c?null!==c:C(c)}},81:(c,A,E)=>{var C=E(9565),T=E(9306),M=E(8551),k=E(6823),I=E(851),N=TypeError;c.exports=function(c,A){var E=arguments.length<2?I(c):A;if(T(E))return M(C(E,c));throw new N(k(c)+" is not iterable")}},116:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(2652),k=E(9306),I=E(8551),N=E(1767),O=E(9539),U=E(4549)("find",TypeError);C({target:"Iterator",proto:!0,real:!0,forced:U},{find:function(c){I(this);try{k(c)}catch(c){O(this,"throw",c)}if(U)return T(U,this,c);var A=N(this),E=0;return M(A,function(A,C){if(c(A,E++))return C(A)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},283:(c,A,E)=>{var C=E(9504),T=E(9039),M=E(4901),k=E(9297),I=E(3724),N=E(350).CONFIGURABLE,O=E(3706),U=E(1181),j=U.enforce,$=U.get,V=String,G=Object.defineProperty,W=C("".slice),q=C("".replace),X=C([].join),Y=I&&!T(function(){return 8!==G(function(){},"length",{value:8}).length}),K=String(String).split("String"),J=c.exports=function(c,A,E){"Symbol("===W(V(A),0,7)&&(A="["+q(V(A),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),E&&E.getter&&(A="get "+A),E&&E.setter&&(A="set "+A),(!k(c,"name")||N&&c.name!==A)&&(I?G(c,"name",{value:A,configurable:!0}):c.name=A),Y&&E&&k(E,"arity")&&c.length!==E.arity&&G(c,"length",{value:E.arity});try{E&&k(E,"constructor")&&E.constructor?I&&G(c,"prototype",{writable:!1}):c.prototype&&(c.prototype=void 0)}catch(c){}var C=j(c);return k(C,"source")||(C.source=X(K,"string"==typeof A?A:"")),c};Function.prototype.toString=J(function(){return M(this)&&$(this).source||O(this)},"toString")},350:(c,A,E)=>{var C=E(3724),T=E(9297),M=Function.prototype,k=C&&Object.getOwnPropertyDescriptor,I=T(M,"name"),N=I&&(!C||C&&k(M,"name").configurable);c.exports={EXISTS:I,PROPER:I&&"something"===(function(){}).name,CONFIGURABLE:N}},397:(c,A,E)=>{var C=E(7751);c.exports=C("document","documentElement")},421:c=>{c.exports={}},456:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(9504),k=E(4154),I=E(5169),N=M(1.1.toString),O=T.Uint8Array,U=!O||!O.prototype.toHex||!function(){try{return"ffffffffffffffff"===new O([255,255,255,255,255,255,255,255]).toHex()}catch(c){return!1}}();O&&C({target:"Uint8Array",proto:!0,forced:U},{toHex:function(){k(this),I(this.buffer);for(var c="",A=0,E=this.length;A<E;A++){var C=N(this[A],16);c+=1===C.length?"0"+C:C}return c}})},507:(c,A,E)=>{var C=E(9565);c.exports=function(c,A,E){for(var T,M,k=E?c:c.iterator,I=c.next;!(T=C(I,k)).done;)if(void 0!==(M=A(T.value)))return M}},531:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(9306),k=E(8551),I=E(1767),N=E(8646),O=E(9462),U=E(9539),j=E(6395),$=E(684),V=E(4549),G=!j&&!$("flatMap",function(){}),W=!j&&!G&&V("flatMap",TypeError),q=j||G||W,X=O(function(){for(var c,A,E=this.iterator,C=this.mapper;;){if(A=this.inner)try{if(!(c=k(T(A.next,A.iterator))).done)return c.value;this.inner=null}catch(c){U(E,"throw",c)}if(c=k(T(this.next,E)),this.done=!!c.done)return;try{this.inner=N(C(c.value,this.counter++),!1)}catch(c){U(E,"throw",c)}}});C({target:"Iterator",proto:!0,real:!0,forced:q},{flatMap:function(c){k(this);try{M(c)}catch(c){U(this,"throw",c)}return W?T(W,this,c):new X(I(this),{mapper:c,inner:null})}})},616:(c,A,E)=>{var C=E(9039);c.exports=!C(function(){var c=(function(){}).bind();return"function"!=typeof c||c.hasOwnProperty("prototype")})},655:(c,A,E)=>{var C=E(6955),T=String;c.exports=function(c){if("Symbol"===C(c))throw TypeError("Cannot convert a Symbol value to a string");return T(c)}},679:(c,A,E)=>{var C=E(1625),T=TypeError;c.exports=function(c,A){if(C(A,c))return c;throw new T("Incorrect invocation")}},684:c=>{c.exports=function(c,A){var E="function"==typeof Iterator&&Iterator.prototype[c];if(E)try{E.call({next:null},A).next()}catch(c){return!0}}},741:c=>{var A=Math.ceil,E=Math.floor;c.exports=Math.trunc||function(c){var C=+c;return(C>0?E:A)(C)}},757:(c,A,E)=>{var C=E(7751),T=E(4901),M=E(1625),k=E(7040),I=Object;c.exports=k?function(c){return"symbol"==typeof c}:function(c){var A=C("Symbol");return T(A)&&M(A.prototype,I(c))}},851:(c,A,E)=>{var C=E(6955),T=E(5966),M=E(4117),k=E(6269),I=E(8227)("iterator");c.exports=function(c){if(!M(c))return T(c,I)||T(c,"@@iterator")||k[C(c)]}},944:c=>{var A=TypeError;c.exports=function(c){var E=c&&c.alphabet;if(void 0===E||"base64"===E||"base64url"===E)return E||"base64";throw new A("Incorrect `alphabet` option")}},1072:(c,A,E)=>{var C=E(1828),T=E(8727);c.exports=Object.keys||function(c){return C(c,T)}},1103:c=>{c.exports=function(c){try{return{error:!1,value:c()}}catch(c){return{error:!0,value:c}}}},1108:(c,A,E)=>{var C=E(6955);c.exports=function(c){var A=C(c);return"BigInt64Array"===A||"BigUint64Array"===A}},1148:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(2652),k=E(9306),I=E(8551),N=E(1767),O=E(9539),U=E(4549)("every",TypeError);C({target:"Iterator",proto:!0,real:!0,forced:U},{every:function(c){I(this);try{k(c)}catch(c){O(this,"throw",c)}if(U)return T(U,this,c);var A=N(this),E=0;return!M(A,function(A,C){if(!c(A,E++))return C()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1181:(c,A,E)=>{var C,T,M,k=E(8622),I=E(4576),N=E(34),O=E(6699),U=E(9297),j=E(7629),$=E(6119),V=E(421),G="Object already initialized",W=I.TypeError,q=I.WeakMap;if(k||j.state){var X=j.state||(j.state=new q);X.get=X.get,X.has=X.has,X.set=X.set,C=function(c,A){if(X.has(c))throw new W(G);return A.facade=c,X.set(c,A),A},T=function(c){return X.get(c)||{}},M=function(c){return X.has(c)}}else{var Y=$("state");V[Y]=!0,C=function(c,A){if(U(c,Y))throw new W(G);return A.facade=c,O(c,Y,A),A},T=function(c){return U(c,Y)?c[Y]:{}},M=function(c){return U(c,Y)}}c.exports={set:C,get:T,has:M,enforce:function(c){return M(c)?T(c):C(c,{})},getterFor:function(c){return function(A){var E;if(!N(A)||(E=T(A)).type!==c)throw new W("Incompatible receiver, "+c+" required");return E}}}},1291:(c,A,E)=>{var C=E(741);c.exports=function(c){var A=+c;return A!=A||0===A?0:C(A)}},1385:(c,A,E)=>{var C=E(9539);c.exports=function(c,A,E){for(var T=c.length-1;T>=0;T--)if(void 0!==c[T])try{E=C(c[T].iterator,A,E)}catch(c){A="throw",E=c}if("throw"===A)throw E;return E}},1548:(c,A,E)=>{var C=E(4576),T=E(9039),M=E(9519),k=E(4215),I=C.structuredClone;c.exports=!!I&&!T(function(){if("DENO"===k&&M>92||"NODE"===k&&M>94||"BROWSER"===k&&M>97)return!1;var c=new ArrayBuffer(8),A=I(c,{transfer:[c]});return 0!==c.byteLength||8!==A.byteLength})},1549:(c,A,E)=>{E(6632)},1625:(c,A,E)=>{var C=E(9504);c.exports=C({}.isPrototypeOf)},1689:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(8745),k=E(7680),I=E(6043),N=E(9306),O=E(1103),U=T.Promise,j=!1;C({target:"Promise",stat:!0,forced:!U||!U.try||O(function(){U.try(function(c){j=8===c},8)}).error||!j},{try:function(c){var A=arguments.length>1?k(arguments,1):[],E=I.f(this),C=O(function(){return M(N(c),void 0,A)});return(C.error?E.reject:E.resolve)(C.value),E.promise}})},1698:(c,A,E)=>{var C=E(6518),T=E(4204),M=E(9835);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("union")||!M("union")},{union:T})},1701:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(9306),k=E(8551),I=E(1767),N=E(9462),O=E(6319),U=E(9539),j=E(684),$=E(4549),V=E(6395),G=!V&&!j("map",function(){}),W=!V&&!G&&$("map",TypeError),q=V||G||W,X=N(function(){var c=this.iterator,A=k(T(this.next,c));if(!(this.done=!!A.done))return O(c,this.mapper,[A.value,this.counter++],!0)});C({target:"Iterator",proto:!0,real:!0,forced:q},{map:function(c){k(this);try{M(c)}catch(c){U(this,"throw",c)}return W?T(W,this,c):new X(I(this),{mapper:c})}})},1767:c=>{c.exports=function(c){return{iterator:c,next:c.next,done:!1}}},1828:(c,A,E)=>{var C=E(9504),T=E(9297),M=E(5397),k=E(9617).indexOf,I=E(421),N=C([].push);c.exports=function(c,A){var E,C=M(c),O=0,U=[];for(E in C)!T(I,E)&&T(C,E)&&N(U,E);for(;A.length>O;)T(C,E=A[O++])&&(~k(U,E)||N(U,E));return U}},2106:(c,A,E)=>{var C=E(283),T=E(4913);c.exports=function(c,A,E){return E.get&&C(E.get,A,{getter:!0}),E.set&&C(E.set,A,{setter:!0}),T.f(c,A,E)}},2140:(c,A,E)=>{var C={};C[E(8227)("toStringTag")]="z",c.exports="[object z]"===String(C)},2195:(c,A,E)=>{var C=E(9504),T=C({}.toString),M=C("".slice);c.exports=function(c){return M(T(c),8,-1)}},2211:(c,A,E)=>{var C=E(9039);c.exports=!C(function(){function t1(){}return t1.prototype.constructor=null,Object.getPrototypeOf(new t1)!==t1.prototype})},2303:(c,A,E)=>{var C=E(4576),T=E(9504),M=C.Uint8Array,k=C.SyntaxError,I=C.parseInt,N=Math.min,O=/[^\da-f]/i,U=T(O.exec),j=T("".slice);c.exports=function(c,A){var E=c.length;if(E%2!=0)throw new k("String should be an even number of characters");for(var C=A?N(A.length,E/2):E/2,T=A||new M(C),$=0,V=0;V<C;){var G=j(c,$,$+=2);if(U(O,G))throw new k("String should only contain hex characters");T[V++]=I(G,16)}return{bytes:T,read:$}}},2360:(c,A,E)=>{var C,T=E(8551),M=E(6801),k=E(8727),I=E(421),N=E(397),O=E(4055),U=E(6119),j="prototype",$="script",V=U("IE_PROTO"),g=function(){},m=function(c){return"<"+$+">"+c+"</"+$+">"},f=function(c){c.write(m("")),c.close();var A=c.parentWindow.Object;return c=null,A},b=function(){try{C=new ActiveXObject("htmlfile")}catch(c){}b="undefined"!=typeof document?document.domain&&C?f(C):((A=O("iframe")).style.display="none",N.appendChild(A),A.src=String("java"+$+":"),(c=A.contentWindow.document).open(),c.write(m("document.F=Object")),c.close(),c.F):f(C);for(var c,A,E=k.length;E--;)delete b[j][k[E]];return b()};I[V]=!0,c.exports=Object.create||function(c,A){var E;return null!==c?(g[j]=T(c),E=new g,g[j]=null,E[V]=c):E=b(),void 0===A?E:M.f(E,A)}},2475:(c,A,E)=>{var C=E(6518),T=E(8527);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("isSupersetOf",function(c){return!c})},{isSupersetOf:T})},2489:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(9306),k=E(8551),I=E(1767),N=E(9462),O=E(6319),U=E(6395),j=E(9539),$=E(684),V=E(4549),G=!U&&!$("filter",function(){}),W=!U&&!G&&V("filter",TypeError),q=U||G||W,X=N(function(){for(var c,A,E=this.iterator,C=this.predicate,M=this.next;;){if(c=k(T(M,E)),this.done=!!c.done)return;if(O(E,C,[A=c.value,this.counter++],!0))return A}});C({target:"Iterator",proto:!0,real:!0,forced:q},{filter:function(c){k(this);try{M(c)}catch(c){j(this,"throw",c)}return W?T(W,this,c):new X(I(this),{predicate:c})}})},2529:c=>{c.exports=function(c,A){return{value:c,done:A}}},2603:(c,A,E)=>{var C=E(655);c.exports=function(c,A){return void 0===c?arguments.length<2?"":A:C(c)}},2652:(c,A,E)=>{var C=E(6080),T=E(9565),M=E(8551),k=E(6823),I=E(4209),N=E(6198),O=E(1625),U=E(81),j=E(851),$=E(9539),V=TypeError,g=function(c,A){this.stopped=c,this.result=A},G=g.prototype;c.exports=function(c,A,E){var W,q,X,Y,K,J,Q,Z=E&&E.that,tt=!(!E||!E.AS_ENTRIES),ta=!(!E||!E.IS_RECORD),to=!(!E||!E.IS_ITERATOR),tl=!(!E||!E.INTERRUPTED),th=C(A,Z),D=function(c){return W&&$(W,"normal"),new g(!0,c)},P=function(c){return tt?(M(c),tl?th(c[0],c[1],D):th(c[0],c[1])):tl?th(c,D):th(c)};if(ta)W=c.iterator;else if(to)W=c;else{if(!(q=j(c)))throw new V(k(c)+" is not iterable");if(I(q)){for(X=0,Y=N(c);Y>X;X++)if((K=P(c[X]))&&O(G,K))return K;return new g(!1)}W=U(c,q)}for(J=ta?c.next:W.next;!(Q=T(J,W)).done;){try{K=P(Q.value)}catch(c){$(W,"throw",c)}if("object"==typeof K&&K&&O(G,K))return K}return new g(!1)}},2777:(c,A,E)=>{var C=E(9565),T=E(34),M=E(757),k=E(5966),I=E(4270),N=E(8227),O=TypeError,U=N("toPrimitive");c.exports=function(c,A){if(!T(c)||M(c))return c;var E,N=k(c,U);if(N){if(void 0===A&&(A="default"),!T(E=C(N,c,A))||M(E))return E;throw new O("Can't convert object to primitive value")}return void 0===A&&(A="number"),I(c,A)}},2787:(c,A,E)=>{var C=E(9297),T=E(4901),M=E(8981),k=E(6119),I=E(2211),N=k("IE_PROTO"),O=Object,U=O.prototype;c.exports=I?O.getPrototypeOf:function(c){var A=M(c);if(C(A,N))return A[N];var E=A.constructor;return T(E)&&A instanceof E?E.prototype:A instanceof O?U:null}},2796:(c,A,E)=>{var C=E(9039),T=E(4901),M=/#|\.prototype\./,a=function(c,A){var E=I[k(c)];return E===O||E!==N&&(T(A)?C(A):!!A)},k=a.normalize=function(c){return String(c).replace(M,".").toLowerCase()},I=a.data={},N=a.NATIVE="N",O=a.POLYFILL="P";c.exports=a},2804:c=>{var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",E=A+"+/",C=A+"-_",n=function(c){for(var A={},E=0;E<64;E++)A[c.charAt(E)]=E;return A};c.exports={i2c:E,c2i:n(E),i2cUrl:C,c2iUrl:n(C)}},2812:c=>{var A=TypeError;c.exports=function(c,E){if(c<E)throw new A("Not enough arguments");return c}},2839:(c,A,E)=>{var C=E(4576).navigator,T=C&&C.userAgent;c.exports=T?String(T):""},2967:(c,A,E)=>{var C=E(6706),T=E(34),M=E(7750),k=E(3506);c.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var c,A=!1,E={};try{(c=C(Object.prototype,"__proto__","set"))(E,[]),A=E instanceof Array}catch(c){}return function(E,C){return M(E),k(C),T(E)&&(A?c(E,C):E.__proto__=C),E}}():void 0)},3068:(c,A,E)=>{var C=E(6518),T=E(9504),M=E(2652),k=RangeError,I=TypeError,N=1/0,O=Math.abs,U=Math.pow,j=T([].push),$=U(2,1023),V=U(2,53)-1,G=Number.MAX_VALUE,W=U(2,971),q={},X={},Y={},K={},J={},x=function(c,A){var E=c+A;return{hi:E,lo:A-(E-c)}};C({target:"Math",stat:!0},{sumPrecise:function(c){var A=[],E=0,C=K;switch(M(c,function(c){if(++E>=V)throw new k("Maximum allowed index exceeded");if("number"!=typeof c)throw new I("Value is not a number");C!==q&&(c!=c?C=q:c===N?C=C===X?q:Y:c===-1/0?C=C===Y?q:X:0===c&&1/c!==N||C!==K&&C!==J||(C=J,j(A,c)))}),C){case q:return NaN;case X:return-1/0;case Y:return N;case K:return -0}for(var T,U,Q,Z,tt,ta,to=[],tl=0,th=0;th<A.length;th++){T=A[th];for(var td=0,tc=0;tc<to.length;tc++){if(U=to[tc],O(T)<O(U)&&(ta=T,T=U,U=ta),Z=(Q=x(T,U)).hi,tt=Q.lo,O(Z)===N){var tu=Z===N?1:-1;tl+=tu,O(T=T-tu*$-tu*$)<O(U)&&(ta=T,T=U,U=ta),Z=(Q=x(T,U)).hi,tt=Q.lo}0!==tt&&(to[td++]=tt),T=Z}to.length=td,0!==T&&j(to,T)}var tp=to.length-1;if(Z=0,tt=0,0!==tl){var tg=tp>=0?to[tp]:0;if(tp--,O(tl)>1||tl>0&&tg>0||tl<0&&tg<0)return tl>0?N:-1/0;if(Z=(Q=x(tl*$,tg/2)).hi,tt=2*Q.lo,O(2*Z)===N)return Z>0?Z===$&&tt===-W/2&&tp>=0&&to[tp]<0?G:N:Z===-$&&tt===W/2&&tp>=0&&to[tp]>0?-G:-1/0;0!==tt&&(to[++tp]=tt,tt=0),Z*=2}for(;tp>=0&&(Z=(Q=x(Z,to[tp--])).hi,0===(tt=Q.lo)););return tp>=0&&(tt<0&&to[tp]<0||tt>0&&to[tp]>0)&&(U=2*tt)==(T=Z+U)-Z&&(Z=T),Z}})},3167:(c,A,E)=>{var C=E(4901),T=E(34),M=E(2967);c.exports=function(c,A,E){var k,I;return M&&C(k=A.constructor)&&k!==E&&T(I=k.prototype)&&I!==E.prototype&&M(c,I),c}},3238:(c,A,E)=>{var C=E(4576),T=E(7811),M=E(7394),k=C.DataView;c.exports=function(c){if(!T||0!==M(c))return!1;try{return new k(c),!1}catch(c){return!0}}},3392:(c,A,E)=>{var C=E(9504),T=0,M=Math.random(),k=C(1.1.toString);c.exports=function(c){return"Symbol("+(void 0===c?"":c)+")_"+k(++T+M,36)}},3440:(c,A,E)=>{var C=E(7080),T=E(4402),M=E(9286),k=E(5170),I=E(3789),N=E(8469),O=E(507),U=T.has,j=T.remove;c.exports=function(c){var A=C(this),E=I(c),T=M(A);return k(A)<=E.size?N(A,function(c){E.includes(c)&&j(T,c)}):O(E.getIterator(),function(c){U(T,c)&&j(T,c)}),T}},3463:c=>{var A=TypeError;c.exports=function(c){if("string"==typeof c)return c;throw new A("Argument is not a string")}},3506:(c,A,E)=>{var C=E(3925),T=String,M=TypeError;c.exports=function(c){if(C(c))return c;throw new M("Can't set "+T(c)+" as a prototype")}},3579:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(2652),k=E(9306),I=E(8551),N=E(1767),O=E(9539),U=E(4549)("some",TypeError);C({target:"Iterator",proto:!0,real:!0,forced:U},{some:function(c){I(this);try{k(c)}catch(c){O(this,"throw",c)}if(U)return T(U,this,c);var A=N(this),E=0;return M(A,function(A,C){if(c(A,E++))return C()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:(c,A,E)=>{var C=E(7080),T=E(4402),M=E(9286),k=E(3789),I=E(507),N=T.add,O=T.has,U=T.remove;c.exports=function(c){var A=C(this),E=k(c).getIterator(),T=M(A);return I(E,function(c){O(A,c)?U(T,c):N(T,c)}),T}},3706:(c,A,E)=>{var C=E(9504),T=E(4901),M=E(7629),k=C(Function.toString);T(M.inspectSource)||(M.inspectSource=function(c){return k(c)}),c.exports=M.inspectSource},3717:(c,A)=>{A.f=Object.getOwnPropertySymbols},3724:(c,A,E)=>{var C=E(9039);c.exports=!C(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},3789:(c,A,E)=>{var C=E(9306),T=E(8551),M=E(9565),k=E(1291),I=E(1767),N="Invalid size",O=RangeError,U=TypeError,j=Math.max,u=function(c,A){this.set=c,this.size=j(A,0),this.has=C(c.has),this.keys=C(c.keys)};u.prototype={getIterator:function(){return I(T(M(this.keys,this.set)))},includes:function(c){return M(this.has,this.set,c)}},c.exports=function(c){T(c);var A=+c.size;if(A!=A)throw new U(N);var E=k(A);if(E<0)throw new O(N);return new u(c,E)}},3838:(c,A,E)=>{var C=E(7080),T=E(5170),M=E(8469),k=E(3789);c.exports=function(c){var A=C(this),E=k(c);return!(T(A)>E.size)&&!1!==M(A,function(c){if(!E.includes(c))return!1},!0)}},3853:(c,A,E)=>{var C=E(6518),T=E(4449);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("isDisjointFrom",function(c){return!c})},{isDisjointFrom:T})},3925:(c,A,E)=>{var C=E(34);c.exports=function(c){return C(c)||null===c}},3972:(c,A,E)=>{var C=E(34),T=String,M=TypeError;c.exports=function(c){if(void 0===c||C(c))return c;throw new M(T(c)+" is not an object or undefined")}},4055:(c,A,E)=>{var C=E(4576),T=E(34),M=C.document,k=T(M)&&T(M.createElement);c.exports=function(c){return k?M.createElement(c):{}}},4114:(c,A,E)=>{var C=E(6518),T=E(8981),M=E(6198),k=E(4527),I=E(6837);C({target:"Array",proto:!0,arity:1,forced:E(9039)(function(){return 4294967297!==[].push.call({length:4294967296},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(c){return c instanceof TypeError}}()},{push:function(c){var A=T(this),E=M(A),C=arguments.length;I(E+C);for(var N=0;N<C;N++)A[E]=arguments[N],E++;return k(A,E),E}})},4117:c=>{c.exports=function(c){return null==c}},4149:c=>{var A=RangeError;c.exports=function(c){if(c==c)return c;throw new A("NaN is not allowed")}},4154:(c,A,E)=>{var C=E(6955),T=TypeError;c.exports=function(c){if("Uint8Array"===C(c))return c;throw new T("Argument is not an Uint8Array")}},4204:(c,A,E)=>{var C=E(7080),T=E(4402).add,M=E(9286),k=E(3789),I=E(507);c.exports=function(c){var A=C(this),E=k(c).getIterator(),N=M(A);return I(E,function(c){T(N,c)}),N}},4209:(c,A,E)=>{var C=E(8227),T=E(6269),M=C("iterator"),k=Array.prototype;c.exports=function(c){return void 0!==c&&(T.Array===c||k[M]===c)}},4215:(c,A,E)=>{var C=E(4576),T=E(2839),M=E(2195),a=function(c){return T.slice(0,c.length)===c};c.exports=a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":C.Bun&&"string"==typeof Bun.version?"BUN":C.Deno&&"object"==typeof Deno.version?"DENO":"process"===M(C.process)?"NODE":C.window&&C.document?"BROWSER":"REST"},4226:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(3463),k=E(4154),I=E(5169),N=E(2303);T.Uint8Array&&C({target:"Uint8Array",proto:!0},{setFromHex:function(c){k(this),M(c),I(this.buffer);var A=N(c,this).read;return{read:A,written:A/2}}})},4235:(c,A,E)=>{E(3068)},4270:(c,A,E)=>{var C=E(9565),T=E(4901),M=E(34),k=TypeError;c.exports=function(c,A){var E,I;if("string"===A&&T(E=c.toString)&&!M(I=C(E,c))||T(E=c.valueOf)&&!M(I=C(E,c))||"string"!==A&&T(E=c.toString)&&!M(I=C(E,c)))return I;throw new k("Can't convert object to primitive value")}},4376:(c,A,E)=>{var C=E(2195);c.exports=Array.isArray||function(c){return"Array"===C(c)}},4402:(c,A,E)=>{var C=E(9504),T=Set.prototype;c.exports={Set:Set,add:C(T.add),has:C(T.has),remove:C(T.delete),proto:T}},4449:(c,A,E)=>{var C=E(7080),T=E(4402).has,M=E(5170),k=E(3789),I=E(8469),N=E(507),O=E(9539);c.exports=function(c){var A=C(this),E=k(c);if(M(A)<=E.size)return!1!==I(A,function(c){if(E.includes(c))return!1},!0);var U=E.getIterator();return!1!==N(U,function(c){if(T(A,c))return O(U,"normal",!1)})}},4483:(c,A,E)=>{var C,T,M,k,I=E(4576),N=E(9429),O=E(1548),U=I.structuredClone,j=I.ArrayBuffer,$=I.MessageChannel,V=!1;if(O)V=function(c){U(c,{transfer:[c]})};else if(j)try{$||(C=N("worker_threads"))&&($=C.MessageChannel),$&&(T=new $,M=new j(2),k=function(c){T.port1.postMessage(null,[c])},2===M.byteLength&&(k(M),0===M.byteLength&&(V=k)))}catch(c){}c.exports=V},4495:(c,A,E)=>{var C=E(9519),T=E(9039),M=E(4576).String;c.exports=!!Object.getOwnPropertySymbols&&!T(function(){var c=Symbol("symbol detection");return!M(c)||!(Object(c) instanceof Symbol)||!Symbol.sham&&C&&C<41})},4527:(c,A,E)=>{var C=E(3724),T=E(4376),M=TypeError,k=Object.getOwnPropertyDescriptor,I=C&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(c){return c instanceof TypeError}}();c.exports=I?function(c,A){if(T(c)&&!k(c,"length").writable)throw new M("Cannot set read only .length");return c.length=A}:function(c,A){return c.length=A}},4549:(c,A,E)=>{var C=E(4576);c.exports=function(c,A){var E=C.Iterator,T=E&&E.prototype,M=T&&T[c],k=!1;if(M)try{M.call({next:function(){return{done:!0}},return:function(){k=!0}},-1)}catch(c){c instanceof A||(k=!1)}if(!k)return M}},4576:function(c){var e=function(c){return c&&c.Math===Math&&c};c.exports=e("object"==typeof globalThis&&globalThis)||e(!1)||e("object"==typeof self&&self)||e("object"==typeof global&&global)||e("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4603:(c,A,E)=>{var C=E(6840),T=E(9504),M=E(655),k=E(2812),I=URLSearchParams,N=I.prototype,O=T(N.append),U=T(N.delete),j=T(N.forEach),$=T([].push),V=new I("a=1&a=2&b=3");V.delete("a",1),V.delete("b",void 0),V+""!="a=2"&&C(N,"delete",function(c){var A=arguments.length,E=A<2?void 0:arguments[1];if(A&&void 0===E)return U(this,c);var C=[];j(this,function(c,A){$(C,{key:A,value:c})}),k(A,1);for(var T,I=M(c),N=M(E),V=0,G=0,W=!1,q=C.length;V<q;)T=C[V++],W||T.key===I?(W=!0,U(this,T.key)):G++;for(;G<q;)(T=C[G++]).key===I&&T.value===N||O(this,T.key,T.value)},{enumerable:!0,unsafe:!0})},4628:(c,A,E)=>{var C=E(6518),T=E(6043);C({target:"Promise",stat:!0},{withResolvers:function(){var c=T.f(this);return{promise:c.promise,resolve:c.resolve,reject:c.reject}}})},4644:(c,A,E)=>{var C,T,M,k=E(7811),I=E(3724),N=E(4576),O=E(4901),U=E(34),j=E(9297),$=E(6955),V=E(6823),G=E(6699),W=E(6840),q=E(2106),X=E(1625),Y=E(2787),K=E(2967),J=E(8227),Q=E(3392),Z=E(1181),tt=Z.enforce,ta=Z.get,to=N.Int8Array,tl=to&&to.prototype,th=N.Uint8ClampedArray,td=th&&th.prototype,tc=to&&Y(to),tu=tl&&Y(tl),tp=Object.prototype,tg=N.TypeError,tf=J("toStringTag"),tm=Q("TYPED_ARRAY_TAG"),tb="TypedArrayConstructor",tv=k&&!!K&&"Opera"!==$(N.opera),ty=!1,tw={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},tA={BigInt64Array:8,BigUint64Array:8},z=function(c){var A=Y(c);if(U(A)){var E=ta(A);return E&&j(E,tb)?E[tb]:z(A)}},H=function(c){if(!U(c))return!1;var A=$(c);return j(tw,A)||j(tA,A)};for(C in tw)(M=(T=N[C])&&T.prototype)?tt(M)[tb]=T:tv=!1;for(C in tA)(M=(T=N[C])&&T.prototype)&&(tt(M)[tb]=T);if((!tv||!O(tc)||tc===Function.prototype)&&(tc=function(){throw new tg("Incorrect invocation")},tv))for(C in tw)N[C]&&K(N[C],tc);if((!tv||!tu||tu===tp)&&(tu=tc.prototype,tv))for(C in tw)N[C]&&K(N[C].prototype,tu);if(tv&&Y(td)!==tu&&K(td,tu),I&&!j(tu,tf))for(C in ty=!0,q(tu,tf,{configurable:!0,get:function(){return U(this)?this[tm]:void 0}}),tw)N[C]&&G(N[C],tm,C);c.exports={NATIVE_ARRAY_BUFFER_VIEWS:tv,TYPED_ARRAY_TAG:ty&&tm,aTypedArray:function(c){if(H(c))return c;throw new tg("Target is not a typed array")},aTypedArrayConstructor:function(c){if(O(c)&&(!K||X(tc,c)))return c;throw new tg(V(c)+" is not a typed array constructor")},exportTypedArrayMethod:function(c,A,E,C){if(I){if(E)for(var T in tw){var M=N[T];if(M&&j(M.prototype,c))try{delete M.prototype[c]}catch(E){try{M.prototype[c]=A}catch(c){}}}tu[c]&&!E||W(tu,c,E?A:tv&&tl[c]||A,C)}},exportTypedArrayStaticMethod:function(c,A,E){var C,T;if(I){if(K){if(E){for(C in tw)if((T=N[C])&&j(T,c))try{delete T[c]}catch(c){}}if(tc[c]&&!E)return;try{return W(tc,c,E?A:tv&&tc[c]||A)}catch(c){}}for(C in tw)(T=N[C])&&(!T[c]||E)&&W(T,c,A)}},getTypedArrayConstructor:z,isView:function(c){if(!U(c))return!1;var A=$(c);return"DataView"===A||j(tw,A)||j(tA,A)},isTypedArray:H,TypedArray:tc,TypedArrayPrototype:tu}},4659:(c,A,E)=>{var C=E(3724),T=E(4913),M=E(6980);c.exports=function(c,A,E){C?T.f(c,A,M(0,E)):c[A]=E}},4901:c=>{var A="object"==typeof document&&document.all;c.exports=void 0===A&&void 0!==A?function(c){return"function"==typeof c||c===A}:function(c){return"function"==typeof c}},4913:(c,A,E)=>{var C=E(3724),T=E(5917),M=E(8686),k=E(8551),I=E(6969),N=TypeError,O=Object.defineProperty,U=Object.getOwnPropertyDescriptor,j="enumerable",$="configurable",V="writable";A.f=C?M?function(c,A,E){if(k(c),A=I(A),k(E),"function"==typeof c&&"prototype"===A&&"value"in E&&V in E&&!E[V]){var C=U(c,A);C&&C[V]&&(c[A]=E.value,E={configurable:$ in E?E[$]:C[$],enumerable:j in E?E[j]:C[j],writable:!1})}return O(c,A,E)}:O:function(c,A,E){if(k(c),A=I(A),k(E),T)try{return O(c,A,E)}catch(c){}if("get"in E||"set"in E)throw new N("Accessors not supported");return"value"in E&&(c[A]=E.value),c}},4916:(c,A,E)=>{var C=E(7751),n=function(c){return{size:c,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},r=function(c){return{size:c,has:function(){return!0},keys:function(){throw Error("e")}}};c.exports=function(c,A){var E=C("Set");try{(new E)[c](n(0));try{return(new E)[c](n(-1)),!1}catch(C){if(!A)return!0;try{return(new E)[c](r(-1/0)),!1}catch(C){var T=new E;return T.add(1),T.add(2),A(T[c](r(1/0)))}}}catch(c){return!1}}},4972:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(8551),k=E(1767),I=E(4149),N=E(9590),O=E(9462),U=E(9539),j=E(4549),$=E(6395),V=!$&&j("take",RangeError),G=O(function(){var c=this.iterator;if(!this.remaining--)return this.done=!0,U(c,"normal",void 0);var A=M(T(this.next,c));return(this.done=!!A.done)?void 0:A.value});C({target:"Iterator",proto:!0,real:!0,forced:$||V},{take:function(c){var A;M(this);try{A=N(I(+c))}catch(c){U(this,"throw",c)}return V?T(V,this,A):new G(k(this),{remaining:A})}})},4979:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(7751),k=E(6980),I=E(4913).f,N=E(9297),O=E(679),U=E(3167),j=E(2603),$=E(5002),V=E(8574),G=E(3724),W=E(6395),q="DOMException",X=M("Error"),Y=M(q),y=function(){O(this,K);var c=arguments.length,A=j(c<1?void 0:arguments[0]),E=j(c<2?void 0:arguments[1],"Error"),C=new Y(A,E),T=new X(A);return T.name=q,I(C,"stack",k(1,V(T.stack,1))),U(C,this,y),C},K=y.prototype=Y.prototype,J="stack"in new X(q),Q="stack"in new Y(1,2),Z=Y&&G&&Object.getOwnPropertyDescriptor(T,q),tt=!(!Z||Z.writable&&Z.configurable),ta=J&&!tt&&!Q;C({global:!0,constructor:!0,forced:W||ta},{DOMException:ta?y:Y});var to=M(q),tl=to.prototype;if(tl.constructor!==to){for(var th in W||I(tl,"constructor",k(1,to)),$)if(N($,th)){var td=$[th],tc=td.s;N(to,tc)||I(to,tc,k(6,td.c))}}},5002:c=>{c.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5024:(c,A,E)=>{var C=E(6518),T=E(3650),M=E(9835);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("symmetricDifference")||!M("symmetricDifference")},{symmetricDifference:T})},5031:(c,A,E)=>{var C=E(7751),T=E(9504),M=E(8480),k=E(3717),I=E(8551),N=T([].concat);c.exports=C("Reflect","ownKeys")||function(c){var A=M.f(I(c)),E=k.f;return E?N(A,E(c)):A}},5169:(c,A,E)=>{var C=E(3238),T=TypeError;c.exports=function(c){if(C(c))throw new T("ArrayBuffer is detached");return c}},5170:(c,A,E)=>{var C=E(6706),T=E(4402);c.exports=C(T.proto,"size","get")||function(c){return c.size}},5213:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(5370),k=E(9143),I=T.Uint8Array,N=!I||!I.fromBase64||!function(){try{return void I.fromBase64("a")}catch(c){}try{I.fromBase64("",null)}catch(c){return!0}}();I&&C({target:"Uint8Array",stat:!0,forced:N},{fromBase64:function(c){var A=k(c,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return M(I,A.bytes)}})},5370:(c,A,E)=>{var C=E(6198);c.exports=function(c,A,E){for(var T=0,M=arguments.length>2?E:C(A),k=new c(M);M>T;)k[T]=A[T++];return k}},5397:(c,A,E)=>{var C=E(7055),T=E(7750);c.exports=function(c){return C(T(c))}},5610:(c,A,E)=>{var C=E(1291),T=Math.max,M=Math.min;c.exports=function(c,A){var E=C(c);return E<0?T(E+A,0):M(E,A)}},5623:(c,A,E)=>{E(456)},5636:(c,A,E)=>{var C=E(4576),T=E(9504),M=E(6706),k=E(7696),I=E(5169),N=E(7394),O=E(4483),U=E(1548),j=C.structuredClone,$=C.ArrayBuffer,V=C.DataView,G=Math.min,W=$.prototype,q=V.prototype,X=T(W.slice),Y=M(W,"resizable","get"),K=M(W,"maxByteLength","get"),J=T(q.getInt8),Q=T(q.setInt8);c.exports=(U||O)&&function(c,A,E){var C,T=N(c),M=void 0===A?T:k(A),W=!Y||!Y(c);if(I(c),U&&(c=j(c,{transfer:[c]}),T===M&&(E||W)))return c;if(T>=M&&(!E||W))C=X(c,0,M);else{C=new $(M,E&&!W&&K?{maxByteLength:K(c)}:void 0);for(var q=new V(c),Z=new V(C),tt=G(M,T),ta=0;ta<tt;ta++)Q(Z,ta,J(q,ta))}return U||O(c),C}},5745:(c,A,E)=>{var C=E(7629);c.exports=function(c,A){return C[c]||(C[c]=A||{})}},5781:(c,A,E)=>{var C=E(6518),T=E(7751),M=E(2812),k=E(655),I=E(7416),N=T("URL");C({target:"URL",stat:!0,forced:!I},{parse:function(c){var A=M(arguments.length,1),E=k(c),C=A<2||void 0===arguments[1]?void 0:k(arguments[1]);try{return new N(E,C)}catch(c){return null}}})},5854:(c,A,E)=>{var C=E(2777),T=TypeError;c.exports=function(c){var A=C(c,"number");if("number"==typeof A)throw new T("Can't convert number to bigint");return BigInt(A)}},5876:(c,A,E)=>{var C=E(6518),T=E(3838);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("isSubsetOf",function(c){return c})},{isSubsetOf:T})},5917:(c,A,E)=>{var C=E(3724),T=E(9039),M=E(4055);c.exports=!C&&!T(function(){return 7!==Object.defineProperty(M("div"),"a",{get:function(){return 7}}).a})},5966:(c,A,E)=>{var C=E(9306),T=E(4117);c.exports=function(c,A){var E=c[A];return T(E)?void 0:C(E)}},6043:(c,A,E)=>{var C=E(9306),T=TypeError,r=function(c){var A,E;this.promise=new c(function(c,C){if(void 0!==A||void 0!==E)throw new T("Bad Promise constructor");A=c,E=C}),this.resolve=C(A),this.reject=C(E)};c.exports.f=function(c){return new r(c)}},6080:(c,A,E)=>{var C=E(7476),T=E(9306),M=E(616),k=C(C.bind);c.exports=function(c,A){return T(c),void 0===A?c:M?k(c,A):function(){return c.apply(A,arguments)}}},6119:(c,A,E)=>{var C=E(5745),T=E(3392),M=C("keys");c.exports=function(c){return M[c]||(M[c]=T(c))}},6193:(c,A,E)=>{var C=E(4215);c.exports="NODE"===C},6198:(c,A,E)=>{var C=E(8014);c.exports=function(c){return C(c.length)}},6269:c=>{c.exports={}},6279:(c,A,E)=>{var C=E(6840);c.exports=function(c,A,E){for(var T in A)C(c,T,A[T],E);return c}},6319:(c,A,E)=>{var C=E(8551),T=E(9539);c.exports=function(c,A,E,M){try{return M?A(C(E)[0],E[1]):A(E)}catch(A){T(c,"throw",A)}}},6395:c=>{c.exports=!1},6518:(c,A,E)=>{var C=E(4576),T=E(7347).f,M=E(6699),k=E(6840),I=E(9433),N=E(7740),O=E(2796);c.exports=function(c,A){var E,U,j,$,V,G=c.target,W=c.global,q=c.stat;if(E=W?C:q?C[G]||I(G,{}):C[G]&&C[G].prototype)for(U in A){if($=A[U],j=c.dontCallGetSet?(V=T(E,U))&&V.value:E[U],!O(W?U:G+(q?".":"#")+U,c.forced)&&void 0!==j){if(typeof $==typeof j)continue;N($,j)}(c.sham||j&&j.sham)&&M($,"sham",!0),k(E,U,$,c)}}},6573:(c,A,E)=>{var C=E(3724),T=E(2106),M=E(3238),k=ArrayBuffer.prototype;!C||"detached"in k||T(k,"detached",{configurable:!0,get:function(){return M(this)}})},6632:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(9143),k=E(4154),I=T.Uint8Array,N=!I||!I.prototype.setFromBase64||!function(){var c=new I([255,255,255,255,255]);try{return void c.setFromBase64("",null)}catch(c){}try{return void c.setFromBase64("a")}catch(c){}try{c.setFromBase64("MjYyZg===")}catch(A){return 50===c[0]&&54===c[1]&&50===c[2]&&255===c[3]&&255===c[4]}}();I&&C({target:"Uint8Array",proto:!0,forced:N},{setFromBase64:function(c){k(this);var A=M(c,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:A.read,written:A.written}}})},6699:(c,A,E)=>{var C=E(3724),T=E(4913),M=E(6980);c.exports=C?function(c,A,E){return T.f(c,A,M(1,E))}:function(c,A,E){return c[A]=E,c}},6706:(c,A,E)=>{var C=E(9504),T=E(9306);c.exports=function(c,A,E){try{return C(T(Object.getOwnPropertyDescriptor(c,A)[E]))}catch(c){}}},6801:(c,A,E)=>{var C=E(3724),T=E(8686),M=E(4913),k=E(8551),I=E(5397),N=E(1072);A.f=C&&!T?Object.defineProperties:function(c,A){k(c);for(var E,C=I(A),T=N(A),O=T.length,U=0;O>U;)M.f(c,E=T[U++],C[E]);return c}},6823:c=>{var A=String;c.exports=function(c){try{return A(c)}catch(c){return"Object"}}},6837:c=>{var A=TypeError;c.exports=function(c){if(c>9007199254740991)throw A("Maximum allowed index exceeded");return c}},6840:(c,A,E)=>{var C=E(4901),T=E(4913),M=E(283),k=E(9433);c.exports=function(c,A,E,I){I||(I={});var N=I.enumerable,O=void 0!==I.name?I.name:A;if(C(E)&&M(E,O,I),I.global)N?c[A]=E:k(A,E);else{try{I.unsafe?c[A]&&(N=!0):delete c[A]}catch(c){}N?c[A]=E:T.f(c,A,{value:E,enumerable:!1,configurable:!I.nonConfigurable,writable:!I.nonWritable})}return c}},6955:(c,A,E)=>{var C=E(2140),T=E(4901),M=E(2195),k=E(8227)("toStringTag"),I=Object,N="Arguments"===M(function(){return arguments}());c.exports=C?M:function(c){var A,E,C;return void 0===c?"Undefined":null===c?"Null":"string"==typeof(E=function(c,A){try{return c[A]}catch(c){}}(A=I(c),k))?E:N?M(A):"Object"===(C=M(A))&&T(A.callee)?"Arguments":C}},6969:(c,A,E)=>{var C=E(2777),T=E(757);c.exports=function(c){var A=C(c,"string");return T(A)?A:A+""}},6980:c=>{c.exports=function(c,A){return{enumerable:!(1&c),configurable:!(2&c),writable:!(4&c),value:A}}},7040:(c,A,E)=>{var C=E(4495);c.exports=C&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055:(c,A,E)=>{var C=E(9504),T=E(9039),M=E(2195),k=Object,I=C("".split);c.exports=T(function(){return!k("z").propertyIsEnumerable(0)})?function(c){return"String"===M(c)?I(c,""):k(c)}:k},7080:(c,A,E)=>{var C=E(4402).has;c.exports=function(c){return C(c),c}},7347:(c,A,E)=>{var C=E(3724),T=E(9565),M=E(8773),k=E(6980),I=E(5397),N=E(6969),O=E(9297),U=E(5917),j=Object.getOwnPropertyDescriptor;A.f=C?j:function(c,A){if(c=I(c),A=N(A),U)try{return j(c,A)}catch(c){}if(O(c,A))return k(!T(M.f,c,A),c[A])}},7394:(c,A,E)=>{var C=E(4576),T=E(6706),M=E(2195),k=C.ArrayBuffer,I=C.TypeError;c.exports=k&&T(k.prototype,"byteLength","get")||function(c){if("ArrayBuffer"!==M(c))throw new I("ArrayBuffer expected");return c.byteLength}},7416:(c,A,E)=>{var C=E(9039),T=E(8227),M=E(3724),k=E(6395),I=T("iterator");c.exports=!C(function(){var c=new URL("b?a=1&b=2&c=3","https://a"),A=c.searchParams,E=new URLSearchParams("a=1&a=2&b=3"),C="";return c.pathname="c%20d",A.forEach(function(c,E){A.delete("b"),C+=E+c}),E.delete("a",2),E.delete("b",void 0),k&&(!c.toJSON||!E.has("a",1)||E.has("a",2)||!E.has("a",void 0)||E.has("b"))||!A.size&&(k||!M)||!A.sort||"https://a/c%20d?a=1&c=3"!==c.href||"3"!==A.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!A[I]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://тест").host||"#%D0%B1"!==new URL("https://a#б").hash||"a1c3"!==C||"x"!==new URL("https://x",void 0).host})},7476:(c,A,E)=>{var C=E(2195),T=E(9504);c.exports=function(c){if("Function"===C(c))return T(c)}},7566:(c,A,E)=>{var C=E(6840),T=E(9504),M=E(655),k=E(2812),I=URLSearchParams,N=I.prototype,O=T(N.getAll),U=T(N.has),j=new I("a=1");!j.has("a",2)&&j.has("a",void 0)||C(N,"has",function(c){var A=arguments.length,E=A<2?void 0:arguments[1];if(A&&void 0===E)return U(this,c);var C=O(this,c);k(A,1);for(var T=M(E),I=0;I<C.length;)if(C[I++]===T)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(2652),k=E(9306),I=E(8551),N=E(1767),O=E(9539),U=E(4549)("forEach",TypeError);C({target:"Iterator",proto:!0,real:!0,forced:U},{forEach:function(c){I(this);try{k(c)}catch(c){O(this,"throw",c)}if(U)return T(U,this,c);var A=N(this),E=0;M(A,function(A){c(A,E++)},{IS_RECORD:!0})}})},7629:(c,A,E)=>{var C=E(6395),T=E(4576),M=E(9433),k="__core-js_shared__",I=c.exports=T[k]||M(k,{});(I.versions||(I.versions=[])).push({version:"3.45.1",mode:C?"pure":"global",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.1/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:(c,A,E)=>{var C=E(6518),T=E(3440),M=E(9039);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("difference",function(c){return 0===c.size})||M(function(){var c=new Set([1,2,3,4]);return 3!==c.difference({size:1,has:function(){return!0},keys:function(){var A=0;return{next:function(){var E=A++>1;return c.has(1)&&c.clear(),{done:E,value:2}}}}}).size})},{difference:T})},7657:(c,A,E)=>{var C,T,M,k=E(9039),I=E(4901),N=E(34),O=E(2360),U=E(2787),j=E(6840),$=E(8227),V=E(6395),G=$("iterator"),W=!1;[].keys&&("next"in(M=[].keys())?(T=U(U(M)))!==Object.prototype&&(C=T):W=!0),!N(C)||k(function(){var c={};return C[G].call(c)!==c})?C={}:V&&(C=O(C)),I(C[G])||j(C,G,function(){return this}),c.exports={IteratorPrototype:C,BUGGY_SAFARI_ITERATORS:W}},7680:(c,A,E)=>{var C=E(9504);c.exports=C([].slice)},7696:(c,A,E)=>{var C=E(1291),T=E(8014),M=RangeError;c.exports=function(c){if(void 0===c)return 0;var A=C(c),E=T(A);if(A!==E)throw new M("Wrong length or index");return E}},7740:(c,A,E)=>{var C=E(9297),T=E(5031),M=E(7347),k=E(4913);c.exports=function(c,A,E){for(var I=T(A),N=k.f,O=M.f,U=0;U<I.length;U++){var j=I[U];C(c,j)||E&&C(E,j)||N(c,j,O(A,j))}}},7750:(c,A,E)=>{var C=E(4117),T=TypeError;c.exports=function(c){if(C(c))throw new T("Can't call method on "+c);return c}},7751:(c,A,E)=>{var C=E(4576),T=E(4901);c.exports=function(c,A){var E;return arguments.length<2?T(E=C[c])?E:void 0:C[c]&&C[c][A]}},7811:c=>{c.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7936:(c,A,E)=>{var C=E(6518),T=E(5636);T&&C({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return T(this,arguments.length?arguments[0]:void 0,!1)}})},8004:(c,A,E)=>{var C=E(6518),T=E(9039),M=E(8750);C({target:"Set",proto:!0,real:!0,forced:!E(4916)("intersection",function(c){return 2===c.size&&c.has(1)&&c.has(2)})||T(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))})},{intersection:M})},8014:(c,A,E)=>{var C=E(1291),T=Math.min;c.exports=function(c){var A=C(c);return A>0?T(A,9007199254740991):0}},8100:(c,A,E)=>{var C=E(6518),T=E(5636);T&&C({target:"ArrayBuffer",proto:!0},{transfer:function(){return T(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(679),k=E(8551),I=E(4901),N=E(2787),O=E(2106),U=E(4659),j=E(9039),$=E(9297),V=E(8227),G=E(7657).IteratorPrototype,W=E(3724),q=E(6395),X="constructor",Y="Iterator",K=V("toStringTag"),J=TypeError,Q=T[Y],Z=q||!I(Q)||Q.prototype!==G||!j(function(){Q({})}),_=function(){if(M(this,G),N(this)===G)throw new J("Abstract class Iterator not directly constructable")},S=function(c,A){W?O(G,c,{configurable:!0,get:function(){return A},set:function(A){if(k(this),this===G)throw new J("You can't redefine this property");$(this,c)?this[c]=A:U(this,c,A)}}):G[c]=A};$(G,K)||S(K,Y),!Z&&$(G,X)&&G[X]!==Object||S(X,_),_.prototype=G,C({global:!0,constructor:!0,forced:Z},{Iterator:_})},8227:(c,A,E)=>{var C=E(4576),T=E(5745),M=E(9297),k=E(3392),I=E(4495),N=E(7040),O=C.Symbol,U=T("wks"),j=N?O.for||O:O&&O.withoutSetter||k;c.exports=function(c){return M(U,c)||(U[c]=I&&M(O,c)?O[c]:j("Symbol."+c)),U[c]}},8235:(c,A,E)=>{var C=E(9504),T=E(9297),M=SyntaxError,k=parseInt,I=String.fromCharCode,N=C("".charAt),O=C("".slice),U=C(/./.exec),j={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"	"},$=/^[\da-f]{4}$/i,V=/^[\u0000-\u001F]$/;c.exports=function(c,A){for(var E=!0,C="";A<c.length;){var G=N(c,A);if("\\"===G){var W=O(c,A,A+2);if(T(j,W))C+=j[W],A+=2;else{if("\\u"!==W)throw new M('Unknown escape sequence: "'+W+'"');var q=O(c,A+=2,A+4);if(!U($,q))throw new M("Bad Unicode escape at: "+A);C+=I(k(q,16)),A+=4}}else{if('"'===G){E=!1,A++;break}if(U(V,G))throw new M("Bad control character in string literal at: "+A);C+=G,A++}}if(E)throw new M("Unterminated string at: "+A);return{value:C,end:A}}},8237:(c,A,E)=>{var C=E(6518),T=E(2652),M=E(9306),k=E(8551),I=E(1767),N=E(9539),O=E(4549),U=E(8745),j=E(9039),$=TypeError,V=j(function(){[].keys().reduce(function(){},void 0)}),G=!V&&O("reduce",$);C({target:"Iterator",proto:!0,real:!0,forced:V||G},{reduce:function(c){k(this);try{M(c)}catch(c){N(this,"throw",c)}var A=arguments.length<2,E=A?void 0:arguments[1];if(G)return U(G,this,A?[c]:[c,E]);var C=I(this),O=0;if(T(C,function(C){A?(A=!1,E=C):E=c(E,C,O),O++},{IS_RECORD:!0}),A)throw new $("Reduce of empty iterator with no initial value");return E}})},8335:(c,A,E)=>{var C=E(6518),T=E(3724),M=E(4576),k=E(7751),I=E(9504),N=E(9565),O=E(4901),U=E(34),j=E(4376),$=E(9297),V=E(655),G=E(6198),W=E(4659),q=E(9039),X=E(8235),Y=E(4495),K=M.JSON,J=M.Number,Q=M.SyntaxError,Z=K&&K.parse,tt=k("Object","keys"),ta=Object.getOwnPropertyDescriptor,to=I("".charAt),tl=I("".slice),th=I(/./.exec),td=I([].push),tc=/^\d$/,tu=/^[1-9]$/,tp=/^[\d-]$/,tg=/^[\t\n\r ]$/,R=function(c,A,E,C){var T,M,k,I,O,V=c[A],W=C&&V===C.value,q=W&&"string"==typeof C.source?{source:C.source}:{};if(U(V)){var X=j(V),Y=W?C.nodes:X?[]:{};if(X)for(T=Y.length,k=G(V),I=0;I<k;I++)L(V,I,R(V,""+I,E,I<T?Y[I]:void 0));else for(k=G(M=tt(V)),I=0;I<k;I++)L(V,O=M[I],R(V,O,E,$(Y,O)?Y[O]:void 0))}return N(E,c,A,V,q)},L=function(c,A,E){if(T){var C=ta(c,A);if(C&&!C.configurable)return}void 0===E?delete c[A]:W(c,A,E)},B=function(c,A,E,C){this.value=c,this.end=A,this.source=E,this.nodes=C},F=function(c,A){this.source=c,this.index=A};F.prototype={fork:function(c){return new F(this.source,c)},parse:function(){var c=this.source,A=this.skip(tg,this.index),E=this.fork(A),C=to(c,A);if(th(tp,C))return E.number();switch(C){case"{":return E.object();case"[":return E.array();case'"':return E.string();case"t":return E.keyword(!0);case"f":return E.keyword(!1);case"n":return E.keyword(null)}throw new Q('Unexpected character: "'+C+'" at: '+A)},node:function(c,A,E,C,T){return new B(A,C,c?null:tl(this.source,E,C),T)},object:function(){for(var c=this.source,A=this.index+1,E=!1,C={},T={};A<c.length;){if("}"===to(c,A=this.until(['"',"}"],A))&&!E){A++;break}var M=this.fork(A).string(),k=M.value;A=M.end,A=this.until([":"],A)+1,A=this.skip(tg,A),W(T,k,M=this.fork(A).parse()),W(C,k,M.value);var I=to(c,A=this.until([",","}"],M.end));if(","===I)E=!0,A++;else if("}"===I){A++;break}}return this.node(1,C,this.index,A,T)},array:function(){for(var c=this.source,A=this.index+1,E=!1,C=[],T=[];A<c.length;){if("]"===to(c,A=this.skip(tg,A))&&!E){A++;break}var M=this.fork(A).parse();if(td(T,M),td(C,M.value),","===to(c,A=this.until([",","]"],M.end)))E=!0,A++;else if("]"===to(c,A)){A++;break}}return this.node(1,C,this.index,A,T)},string:function(){var c=this.index,A=X(this.source,this.index+1);return this.node(0,A.value,c,A.end)},number:function(){var c=this.source,A=this.index,E=A;if("-"===to(c,E)&&E++,"0"===to(c,E))E++;else{if(!th(tu,to(c,E)))throw new Q("Failed to parse number at: "+E);E=this.skip(tc,E+1)}if("."===to(c,E)&&(E=this.skip(tc,E+1)),("e"===to(c,E)||"E"===to(c,E))&&("+"!==to(c,++E)&&"-"!==to(c,E)||E++,E===(E=this.skip(tc,E))))throw new Q("Failed to parse number's exponent value at: "+E);return this.node(0,J(tl(c,A,E)),A,E)},keyword:function(c){var A=""+c,E=this.index,C=E+A.length;if(tl(this.source,E,C)!==A)throw new Q("Failed to parse value at: "+E);return this.node(0,c,E,C)},skip:function(c,A){for(var E=this.source;A<E.length&&th(c,to(E,A));A++);return A},until:function(c,A){A=this.skip(tg,A);for(var E=to(this.source,A),C=0;C<c.length;C++)if(c[C]===E)return A;throw new Q('Unexpected character: "'+E+'" at: '+A)}};var tf=q(function(){var c,A="9007199254740993";return Z(A,function(A,E,C){c=C.source}),c!==A}),tm=Y&&!q(function(){return 1/Z("-0 	")!=-1/0});C({target:"JSON",stat:!0,forced:tf},{parse:function(c,A){return tm&&!O(A)?Z(c):function(c,A){var E=new F(c=V(c),0),C=E.parse(),T=C.value,M=E.skip(tg,C.end);if(M<c.length)throw new Q('Unexpected extra character: "'+to(c,M)+'" after the parsed data at: '+M);return O(A)?R({"":T},"",A,C):T}(c,A)}})},8469:(c,A,E)=>{var C=E(9504),T=E(507),M=E(4402),k=M.Set,I=M.proto,N=C(I.forEach),O=C(I.keys),U=O(new k).next;c.exports=function(c,A,E){return E?T({iterator:O(c),next:U},A):N(c,A)}},8480:(c,A,E)=>{var C=E(1828),T=E(8727).concat("length","prototype");A.f=Object.getOwnPropertyNames||function(c){return C(c,T)}},8527:(c,A,E)=>{var C=E(7080),T=E(4402).has,M=E(5170),k=E(3789),I=E(507),N=E(9539);c.exports=function(c){var A=C(this),E=k(c);if(M(A)<E.size)return!1;var O=E.getIterator();return!1!==I(O,function(c){if(!T(A,c))return N(O,"normal",!1)})}},8551:(c,A,E)=>{var C=E(34),T=String,M=TypeError;c.exports=function(c){if(C(c))return c;throw new M(T(c)+" is not an object")}},8574:(c,A,E)=>{var C=E(9504),T=Error,M=C("".replace),k=String(new T("zxcasd").stack),I=/\n\s*at [^:]*:[^\n]*/,N=I.test(k);c.exports=function(c,A){if(N&&"string"==typeof c&&!T.prepareStackTrace)for(;A--;)c=M(c,I,"");return c}},8622:(c,A,E)=>{var C=E(4576),T=E(4901),M=C.WeakMap;c.exports=T(M)&&/native code/.test(String(M))},8646:(c,A,E)=>{var C=E(9565),T=E(8551),M=E(1767),k=E(851);c.exports=function(c,A){A&&"string"==typeof c||T(c);var E=k(c);return M(T(void 0!==E?C(E,c):c))}},8686:(c,A,E)=>{var C=E(3724),T=E(9039);c.exports=C&&T(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8721:(c,A,E)=>{var C=E(3724),T=E(9504),M=E(2106),k=URLSearchParams.prototype,I=T(k.forEach);!C||"size"in k||M(k,"size",{get:function(){var c=0;return I(this,function(){c++}),c},configurable:!0,enumerable:!0})},8727:c=>{c.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(c,A,E)=>{var C=E(616),T=Function.prototype,M=T.apply,k=T.call;c.exports="object"==typeof Reflect&&Reflect.apply||(C?k.bind(M):function(){return k.apply(M,arguments)})},8750:(c,A,E)=>{var C=E(7080),T=E(4402),M=E(5170),k=E(3789),I=E(8469),N=E(507),O=T.Set,U=T.add,j=T.has;c.exports=function(c){var A=C(this),E=k(c),T=new O;return M(A)>E.size?N(E.getIterator(),function(c){j(A,c)&&U(T,c)}):I(A,function(c){E.includes(c)&&U(T,c)}),T}},8773:(c,A)=>{var E={}.propertyIsEnumerable,C=Object.getOwnPropertyDescriptor,T=C&&!E.call({1:2},1);A.f=T?function(c){var A=C(this,c);return!!A&&A.enumerable}:E},8981:(c,A,E)=>{var C=E(7750),T=Object;c.exports=function(c){return T(C(c))}},9039:c=>{c.exports=function(c){try{return!!c()}catch(c){return!0}}},9143:(c,A,E)=>{var C=E(4576),T=E(9504),M=E(3972),k=E(3463),I=E(9297),N=E(2804),O=E(944),U=E(5169),j=N.c2i,$=N.c2iUrl,V=C.SyntaxError,G=C.TypeError,W=T("".charAt),f=function(c,A){for(var E=c.length;A<E;A++){var C=W(c,A);if(" "!==C&&"	"!==C&&"\n"!==C&&"\f"!==C&&"\r"!==C)break}return A},b=function(c,A,E){var C=c.length;C<4&&(c+=2===C?"AA":"A");var T=(A[W(c,0)]<<18)+(A[W(c,1)]<<12)+(A[W(c,2)]<<6)+A[W(c,3)],M=[T>>16&255,T>>8&255,255&T];if(2===C){if(E&&0!==M[1])throw new V("Extra bits");return[M[0]]}if(3===C){if(E&&0!==M[2])throw new V("Extra bits");return[M[0],M[1]]}return M},v=function(c,A,E){for(var C=A.length,T=0;T<C;T++)c[E+T]=A[T];return E+C};c.exports=function(c,A,E,C){k(c),M(A);var T="base64"===O(A)?j:$,N=A?A.lastChunkHandling:void 0;if(void 0===N&&(N="loose"),"loose"!==N&&"strict"!==N&&"stop-before-partial"!==N)throw new G("Incorrect `lastChunkHandling` option");E&&U(E.buffer);var q=c.length,X=E||[],Y=0,K=0,J="",Q=0;if(C)for(;;){if((Q=f(c,Q))===q){if(J.length>0){if("stop-before-partial"===N)break;if("loose"!==N)throw new V("Missing padding");if(1===J.length)throw new V("Malformed padding: exactly one additional character");Y=v(X,b(J,T,!1),Y)}K=q;break}var Z=W(c,Q);if(++Q,"="===Z){if(J.length<2)throw new V("Padding is too early");if(Q=f(c,Q),2===J.length){if(Q===q){if("stop-before-partial"===N)break;throw new V("Malformed padding: only one =")}"="===W(c,Q)&&(Q=f(c,++Q))}if(Q<q)throw new V("Unexpected character after padding");Y=v(X,b(J,T,"strict"===N),Y),K=q;break}if(!I(T,Z))throw new V("Unexpected character");var tt=C-Y;if(1===tt&&2===J.length||2===tt&&3===J.length||4===(J+=Z).length&&(Y=v(X,b(J,T,!1),Y),J="",K=Q,Y===C))break}return{bytes:X,read:K,written:Y}}},9286:(c,A,E)=>{var C=E(4402),T=E(8469),M=C.Set,k=C.add;c.exports=function(c){var A=new M;return T(c,function(c){k(A,c)}),A}},9297:(c,A,E)=>{var C=E(9504),T=E(8981),M=C({}.hasOwnProperty);c.exports=Object.hasOwn||function(c,A){return M(T(c),A)}},9306:(c,A,E)=>{var C=E(4901),T=E(6823),M=TypeError;c.exports=function(c){if(C(c))return c;throw new M(T(c)+" is not a function")}},9314:(c,A,E)=>{var C=E(6518),T=E(9565),M=E(8551),k=E(1767),I=E(4149),N=E(9590),O=E(9539),U=E(9462),j=E(684),$=E(4549),V=E(6395),G=!V&&!j("drop",0),W=!V&&!G&&$("drop",RangeError),q=V||G||W,X=U(function(){for(var c,A=this.iterator,E=this.next;this.remaining;)if(this.remaining--,c=M(T(E,A)),this.done=!!c.done)return;if(c=M(T(E,A)),!(this.done=!!c.done))return c.value});C({target:"Iterator",proto:!0,real:!0,forced:q},{drop:function(c){var A;M(this);try{A=N(I(+c))}catch(c){O(this,"throw",c)}return W?T(W,this,A):new X(k(this),{remaining:A})}})},9429:(c,A,E)=>{var C=E(4576),T=E(6193);c.exports=function(c){if(T){try{return C.process.getBuiltinModule(c)}catch(c){}try{return Function('return require("'+c+'")')()}catch(c){}}}},9432:(c,A,E)=>{E(5213)},9433:(c,A,E)=>{var C=E(4576),T=Object.defineProperty;c.exports=function(c,A){try{T(C,c,{value:A,configurable:!0,writable:!0})}catch(E){C[c]=A}return A}},9462:(c,A,E)=>{var C=E(9565),T=E(2360),M=E(6699),k=E(6279),I=E(8227),N=E(1181),O=E(5966),U=E(7657).IteratorPrototype,j=E(2529),$=E(9539),V=E(1385),G=I("toStringTag"),W="IteratorHelper",q="WrapForValidIterator",X="normal",Y="throw",K=N.set,w=function(c){var A=N.getterFor(c?q:W);return k(T(U),{next:function(){var E=A(this);if(c)return E.nextHandler();if(E.done)return j(void 0,!0);try{var C=E.nextHandler();return E.returnHandlerResult?C:j(C,E.done)}catch(c){throw E.done=!0,c}},return:function(){var E=A(this),T=E.iterator;if(E.done=!0,c){var M=O(T,"return");return M?C(M,T):j(void 0,!0)}if(E.inner)try{$(E.inner.iterator,X)}catch(c){return $(T,Y,c)}if(E.openIters)try{V(E.openIters,X)}catch(c){return $(T,Y,c)}return T&&$(T,X),j(void 0,!0)}})},J=w(!0),Q=w(!1);M(Q,G,"Iterator Helper"),c.exports=function(c,A,E){var s=function(C,T){T?(T.iterator=C.iterator,T.next=C.next):T=C,T.type=A?q:W,T.returnHandlerResult=!!E,T.nextHandler=c,T.counter=0,T.done=!1,K(this,T)};return s.prototype=A?J:Q,s}},9486:(c,A,E)=>{var C=E(6518),T=E(4576),M=E(9504),k=E(3972),I=E(4154),N=E(5169),O=E(2804),U=E(944),j=O.i2c,$=O.i2cUrl,V=M("".charAt),G=T.Uint8Array,W=!G||!G.prototype.toBase64||!function(){try{(new G).toBase64(null)}catch(c){return!0}}();G&&C({target:"Uint8Array",proto:!0,forced:W},{toBase64:function(){var c=I(this),A=arguments.length?k(arguments[0]):void 0,E="base64"===U(A)?j:$,C=!!A&&!!A.omitPadding;N(this.buffer);for(var T,M="",O=0,G=c.length,m=function(c){return V(E,T>>6*c&63)};O+2<G;O+=3)T=(c[O]<<16)+(c[O+1]<<8)+c[O+2],M+=m(3)+m(2)+m(1)+m(0);return O+2===G?(T=(c[O]<<16)+(c[O+1]<<8),M+=m(3)+m(2)+m(1)+(C?"":"=")):O+1===G&&(T=c[O]<<16,M+=m(3)+m(2)+(C?"":"==")),M}})},9504:(c,A,E)=>{var C=E(616),T=Function.prototype,M=T.call,k=C&&T.bind.bind(M,M);c.exports=C?k:function(c){return function(){return M.apply(c,arguments)}}},9519:(c,A,E)=>{var C,T,M=E(4576),k=E(2839),I=M.process,N=M.Deno,O=I&&I.versions||N&&N.version,U=O&&O.v8;U&&(T=(C=U.split("."))[0]>0&&C[0]<4?1:+(C[0]+C[1])),!T&&k&&(!(C=k.match(/Edge\/(\d+)/))||C[1]>=74)&&(C=k.match(/Chrome\/(\d+)/))&&(T=+C[1]),c.exports=T},9539:(c,A,E)=>{var C=E(9565),T=E(8551),M=E(5966);c.exports=function(c,A,E){var k,I;T(c);try{if(!(k=M(c,"return"))){if("throw"===A)throw E;return E}k=C(k,c)}catch(c){I=!0,k=c}if("throw"===A)throw E;if(I)throw k;return T(k),E}},9565:(c,A,E)=>{var C=E(616),T=Function.prototype.call;c.exports=C?T.bind(T):function(){return T.apply(T,arguments)}},9577:(c,A,E)=>{var C=E(9928),T=E(4644),M=E(1108),k=E(1291),I=E(5854),N=T.aTypedArray,O=T.getTypedArrayConstructor,U=T.exportTypedArrayMethod,j=function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(c){return 8===c}}(),$=j&&function(){try{new Int8Array(1).with(-.5,1)}catch(c){return!0}}();U("with",{with:function(c,A){var E=N(this),T=k(c),U=M(E)?I(A):+A;return C(E,O(E),T,U)}}.with,!j||$)},9590:(c,A,E)=>{var C=E(1291),T=RangeError;c.exports=function(c){var A=C(c);if(A<0)throw new T("The argument can't be less than 0");return A}},9617:(c,A,E)=>{var C=E(5397),T=E(5610),M=E(6198),a=function(c){return function(A,E,k){var I=C(A),N=M(I);if(0===N)return!c&&-1;var O,U=T(k,N);if(c&&E!=E){for(;N>U;)if((O=I[U++])!=O)return!0}else for(;N>U;U++)if((c||U in I)&&I[U]===E)return c||U||0;return!c&&-1}};c.exports={includes:a(!0),indexOf:a(!1)}},9631:(c,A,E)=>{E(9486)},9797:(c,A,E)=>{E(4226)},9835:c=>{c.exports=function(c){try{var A=new Set,E=A[c]({size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return A.clear(),A.add(4),function(){return{done:!0}}}})}});return 1===E.size&&4===E.values().next().value}catch(c){return!1}}},9928:(c,A,E)=>{var C=E(6198),T=E(1291),M=RangeError;c.exports=function(c,A,E,k){var I=C(c),N=T(E),O=N<0?I+N:N;if(O>=I||O<0)throw new M("Incorrect index");for(var U=new A(I),j=0;j<I;j++)U[j]=j===O?k:c[j];return U}}},Q={};function _(c){var A=Q[c];if(void 0!==A)return A.exports;var E=Q[c]={exports:{}};return J[c].call(E.exports,E,E.exports,_),E.exports}_.d=(c,A)=>{for(var E in A)_.o(A,E)&&!_.o(c,E)&&Object.defineProperty(c,E,{enumerable:!0,get:A[E]})},_.o=(c,A)=>Object.prototype.hasOwnProperty.call(c,A),_(4114),_(6573),_(8100),_(7936),_(8111),_(8237),_(1689),_(9577),_(4235),_(9432),_(1549),_(9797),_(9631),_(5623),_(4979),_(5781);let Z=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),tt=[.001,0,0,.001,0,0],ta={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},to="pdfjs_internal_editor_",tl={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},th={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},td={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},tc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},tu={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},tp={ERRORS:0,WARNINGS:1,INFOS:5},tg={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},tf={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},tm=tp.WARNINGS;function ot(){return tm}function lt(c){tm>=tp.INFOS&&console.info(`Info: ${c}`)}function ht(c){tm>=tp.WARNINGS&&console.warn(`Warning: ${c}`)}function ct(c){throw Error(c)}function dt(c,A){c||ct(A)}function ut(c,A=null,E=null){if(!c)return null;if(E&&"string"==typeof c){if(E.addDefaultProtocol&&c.startsWith("www.")){let A=c.match(/\./g);A?.length>=2&&(c=`http://${c}`)}if(E.tryConvertEncoding)try{c=decodeURIComponent(escape(c))}catch{}}let C=A?URL.parse(c,A):URL.parse(c);return!function(c){switch(c?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(C)?null:C}function pt(c,A,E=!1){let C=URL.parse(c);return C?(C.hash=A,C.href):E&&ut(c,"http://example.com")?c.split("#",1)[0]+""+(A?`#${A}`:""):""}function gt(c,A,E,C=!1){return Object.defineProperty(c,A,{value:E,enumerable:!C,configurable:!0,writable:!1}),E}let tb=function(){function t1(c,A){this.message=c,this.name=A}return t1.prototype=Error(),t1.constructor=t1,t1}(),tv=class extends tb{constructor(c,A){super(c,"PasswordException"),this.code=A}},ty=class extends tb{constructor(c,A){super(c,"UnknownErrorException"),this.details=A}},tw=class extends tb{constructor(c){super(c,"InvalidPDFException")}},tA=class extends tb{constructor(c,A,E){super(c,"ResponseException"),this.status=A,this.missing=E}},t_=class extends tb{constructor(c){super(c,"FormatError")}},tx=class extends tb{constructor(c){super(c,"AbortException")}};function At(c){"object"==typeof c&&void 0!==c?.length||ct("Invalid argument for bytesToString");let A=c.length;if(A<8192)return String.fromCharCode.apply(null,c);let E=[];for(let C=0;C<A;C+=8192){let T=Math.min(C+8192,A),M=c.subarray(C,T);E.push(String.fromCharCode.apply(null,M))}return E.join("")}function _t(c){"string"!=typeof c&&ct("Invalid argument for stringToBytes");let A=c.length,E=new Uint8Array(A);for(let C=0;C<A;++C)E[C]=255&c.charCodeAt(C);return E}let St=class St{static get isLittleEndian(){return gt(this,"isLittleEndian",function(){let c=new Uint8Array(4);return c[0]=1,1===new Uint32Array(c.buffer,0,1)[0]}())}static get isEvalSupported(){return gt(this,"isEvalSupported",function(){try{return Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return gt(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get isImageDecoderSupported(){return gt(this,"isImageDecoderSupported","undefined"!=typeof ImageDecoder)}static get platform(){let{platform:c,userAgent:A}=navigator;return gt(this,"platform",{isAndroid:A.includes("Android"),isLinux:c.includes("Linux"),isMac:c.includes("Mac"),isWindows:c.includes("Win"),isFirefox:A.includes("Firefox")})}static get isCSSRoundSupported(){return gt(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}};let tE=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));let Ct=class Ct{static makeHexColor(c,A,E){return`#${tE[c]}${tE[A]}${tE[E]}`}static domMatrixToTransform(c){return[c.a,c.b,c.c,c.d,c.e,c.f]}static scaleMinMax(c,A){let E;c[0]?(c[0]<0&&(E=A[0],A[0]=A[2],A[2]=E),A[0]*=c[0],A[2]*=c[0],c[3]<0&&(E=A[1],A[1]=A[3],A[3]=E),A[1]*=c[3],A[3]*=c[3]):(E=A[0],A[0]=A[1],A[1]=E,E=A[2],A[2]=A[3],A[3]=E,c[1]<0&&(E=A[1],A[1]=A[3],A[3]=E),A[1]*=c[1],A[3]*=c[1],c[2]<0&&(E=A[0],A[0]=A[2],A[2]=E),A[0]*=c[2],A[2]*=c[2]),A[0]+=c[4],A[1]+=c[5],A[2]+=c[4],A[3]+=c[5]}static transform(c,A){return[c[0]*A[0]+c[2]*A[1],c[1]*A[0]+c[3]*A[1],c[0]*A[2]+c[2]*A[3],c[1]*A[2]+c[3]*A[3],c[0]*A[4]+c[2]*A[5]+c[4],c[1]*A[4]+c[3]*A[5]+c[5]]}static multiplyByDOMMatrix(c,A){return[c[0]*A.a+c[2]*A.b,c[1]*A.a+c[3]*A.b,c[0]*A.c+c[2]*A.d,c[1]*A.c+c[3]*A.d,c[0]*A.e+c[2]*A.f+c[4],c[1]*A.e+c[3]*A.f+c[5]]}static applyTransform(c,A,E=0){let C=c[E],T=c[E+1];c[E]=C*A[0]+T*A[2]+A[4],c[E+1]=C*A[1]+T*A[3]+A[5]}static applyTransformToBezier(c,A,E=0){let C=A[0],T=A[1],M=A[2],k=A[3],I=A[4],N=A[5];for(let A=0;A<6;A+=2){let O=c[E+A],U=c[E+A+1];c[E+A]=O*C+U*M+I,c[E+A+1]=O*T+U*k+N}}static applyInverseTransform(c,A){let E=c[0],C=c[1],T=A[0]*A[3]-A[1]*A[2];c[0]=(E*A[3]-C*A[2]+A[2]*A[5]-A[4]*A[3])/T,c[1]=(-E*A[1]+C*A[0]+A[4]*A[1]-A[5]*A[0])/T}static axialAlignedBoundingBox(c,A,E){let C=A[0],T=A[1],M=A[2],k=A[3],I=A[4],N=A[5],O=c[0],U=c[1],j=c[2],$=c[3],V=C*O+I,G=V,W=C*j+I,q=W,X=k*U+N,Y=X,K=k*$+N,J=K;if(0!==T||0!==M){let c=T*O,A=T*j,E=M*U,C=M*$;V+=E,q+=E,W+=C,G+=C,X+=c,J+=c,K+=A,Y+=A}E[0]=Math.min(E[0],V,W,G,q),E[1]=Math.min(E[1],X,K,Y,J),E[2]=Math.max(E[2],V,W,G,q),E[3]=Math.max(E[3],X,K,Y,J)}static inverseTransform(c){let A=c[0]*c[3]-c[1]*c[2];return[c[3]/A,-c[1]/A,-c[2]/A,c[0]/A,(c[2]*c[5]-c[4]*c[3])/A,(c[4]*c[1]-c[5]*c[0])/A]}static singularValueDecompose2dScale(c,A){let E=c[0],C=c[1],T=c[2],M=c[3],k=E**2+C**2,I=T**2+M**2,N=(k+I)/2,O=Math.sqrt(N**2-(k*I-(E*T+C*M)**2));A[0]=Math.sqrt(N+O||1),A[1]=Math.sqrt(N-O||1)}static normalizeRect(c){let A=c.slice(0);return c[0]>c[2]&&(A[0]=c[2],A[2]=c[0]),c[1]>c[3]&&(A[1]=c[3],A[3]=c[1]),A}static intersect(c,A){let E=Math.max(Math.min(c[0],c[2]),Math.min(A[0],A[2])),C=Math.min(Math.max(c[0],c[2]),Math.max(A[0],A[2]));if(E>C)return null;let T=Math.max(Math.min(c[1],c[3]),Math.min(A[1],A[3])),M=Math.min(Math.max(c[1],c[3]),Math.max(A[1],A[3]));return T>M?null:[E,T,C,M]}static pointBoundingBox(c,A,E){E[0]=Math.min(E[0],c),E[1]=Math.min(E[1],A),E[2]=Math.max(E[2],c),E[3]=Math.max(E[3],A)}static rectBoundingBox(c,A,E,C,T){T[0]=Math.min(T[0],c,E),T[1]=Math.min(T[1],A,C),T[2]=Math.max(T[2],c,E),T[3]=Math.max(T[3],A,C)}static #t(c,A,E,C,T,M,k,I,N,O){if(N<=0||N>=1)return;let U=1-N,j=N*N,$=j*N,V=U*(U*(U*c+3*N*A)+3*j*E)+$*C,G=U*(U*(U*T+3*N*M)+3*j*k)+$*I;O[0]=Math.min(O[0],V),O[1]=Math.min(O[1],G),O[2]=Math.max(O[2],V),O[3]=Math.max(O[3],G)}static #e(c,A,E,C,T,M,k,I,N,O,U,j){if(1e-12>Math.abs(N))return void(Math.abs(O)>=1e-12&&this.#t(c,A,E,C,T,M,k,I,-U/O,j));let $=O**2-4*U*N;if($<0)return;let V=Math.sqrt($),G=2*N;this.#t(c,A,E,C,T,M,k,I,(-O+V)/G,j),this.#t(c,A,E,C,T,M,k,I,(-O-V)/G,j)}static bezierBoundingBox(c,A,E,C,T,M,k,I,N){N[0]=Math.min(N[0],c,k),N[1]=Math.min(N[1],A,I),N[2]=Math.max(N[2],c,k),N[3]=Math.max(N[3],A,I),this.#e(c,E,T,k,A,C,M,I,3*(3*(E-T)-c+k),6*(c-2*E+T),3*(E-c),N),this.#e(c,E,T,k,A,C,M,I,3*(3*(C-M)-A+I),6*(A-2*C+M),3*(C-A),N)}};let tS=null,tC=null;function Dt(c){return tS||(tS=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,tC=new Map([["ﬅ","ſt"]])),c.replaceAll(tS,(c,A,E)=>A?A.normalize("NFKC"):tC.get(E))}function Pt(){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();let c=new Uint8Array(32);return crypto.getRandomValues(c),At(c)}let tT="pdfjs_internal_id_";function It(c,A,E){return Math.min(Math.max(c,A),E)}function Rt(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(At(c))}"function"!=typeof Math.sumPrecise&&(Math.sumPrecise=function(c){return c.reduce((c,A)=>c+A,0)}),"function"!=typeof AbortSignal.any&&(AbortSignal.any=function(c){let A=new AbortController,{signal:E}=A;for(let C of c)if(C.aborted)return A.abort(C.reason),E;for(let C of c)C.addEventListener("abort",()=>{A.abort(C.reason)},{signal:E});return E}),_(1701),_(4603),_(7566),_(8721);let Lt=class Lt{static textContent(c){let A=[],E={items:A,styles:Object.create(null)};return function t1(c){if(!c)return;let E=null,C=c.name;if("#text"===C)E=c.value;else{if(!Lt.shouldBuildText(C))return;c?.attributes?.textContent?E=c.attributes.textContent:c.value&&(E=c.value)}if(null!==E&&A.push({str:E}),c.children)for(let A of c.children)t1(A)}(c),E}static shouldBuildText(c){return!("textarea"===c||"input"===c||"option"===c||"select"===c)}};let Bt=class Bt{static setupStorage(c,A,E,C,T){let M=C.getValue(A,{value:null});switch(E.name){case"textarea":if(null!==M.value&&(c.textContent=M.value),"print"===T)break;c.addEventListener("input",c=>{C.setValue(A,{value:c.target.value})});break;case"input":if("radio"===E.attributes.type||"checkbox"===E.attributes.type){if(M.value===E.attributes.xfaOn?c.setAttribute("checked",!0):M.value===E.attributes.xfaOff&&c.removeAttribute("checked"),"print"===T)break;c.addEventListener("change",c=>{C.setValue(A,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(null!==M.value&&c.setAttribute("value",M.value),"print"===T)break;c.addEventListener("input",c=>{C.setValue(A,{value:c.target.value})})}break;case"select":if(null!==M.value)for(let A of(c.setAttribute("value",M.value),E.children))A.attributes.value===M.value?A.attributes.selected=!0:A.attributes.hasOwnProperty("selected")&&delete A.attributes.selected;c.addEventListener("input",c=>{let E=c.target.options,T=-1===E.selectedIndex?"":E[E.selectedIndex].value;C.setValue(A,{value:T})})}}static setAttributes({html:c,element:A,storage:E=null,intent:C,linkService:T}){let{attributes:M}=A,k=c instanceof HTMLAnchorElement;for(let[A,E]of("radio"===M.type&&(M.name=`${M.name}-${C}`),Object.entries(M)))if(null!=E)switch(A){case"class":E.length&&c.setAttribute(A,E.join(" "));break;case"dataId":break;case"id":c.setAttribute("data-element-id",E);break;case"style":Object.assign(c.style,E);break;case"textContent":c.textContent=E;break;default:k&&("href"===A||"newWindow"===A)||c.setAttribute(A,E)}k&&T.addLinkAttributes(c,M.href,M.newWindow),E&&M.dataId&&this.setupStorage(c,M.dataId,A,E)}static render(c){let A=c.annotationStorage,E=c.linkService,C=c.xfaHtml,T=c.intent||"display",M=document.createElement(C.name);C.attributes&&this.setAttributes({html:M,element:C,intent:T,linkService:E});let k="richText"!==T,I=c.div;if(I.append(M),c.viewport){let A=`matrix(${c.viewport.transform.join(",")})`;I.style.transform=A}k&&I.setAttribute("class","xfaLayer xfaFont");let N=[];if(0===C.children.length){if(C.value){let c=document.createTextNode(C.value);M.append(c),k&&Lt.shouldBuildText(C.name)&&N.push(c)}return{textDivs:N}}let O=[[C,-1,M]];for(;O.length>0;){let[c,C,M]=O.at(-1);if(C+1===c.children.length){O.pop();continue}let I=c.children[++O.at(-1)[1]];if(null===I)continue;let{name:U}=I;if("#text"===U){let c=document.createTextNode(I.value);N.push(c),M.append(c);continue}let j=I?.attributes?.xmlns?document.createElementNS(I.attributes.xmlns,U):document.createElement(U);if(M.append(j),I.attributes&&this.setAttributes({html:j,element:I,storage:A,intent:T,linkService:E}),I.children?.length>0)O.push([I,-1,j]);else if(I.value){let c=document.createTextNode(I.value);k&&Lt.shouldBuildText(U)&&N.push(c),j.append(c)}}for(let c of I.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))c.setAttribute("readOnly",!0);return{textDivs:N}}static update(c){let A=`matrix(${c.viewport.transform.join(",")})`;c.div.style.transform=A,c.div.hidden=!1}};let tM="http://www.w3.org/2000/svg";let Ot=class Ot{static{this.CSS=96}static{this.PDF=72}static{this.PDF_TO_CSS_UNITS=this.CSS/this.PDF}};async function Nt(c,A="text"){if(Wt(c,document.baseURI)){let E=await fetch(c);if(!E.ok)throw Error(E.statusText);switch(A){case"arraybuffer":return E.arrayBuffer();case"blob":return E.blob();case"json":return E.json()}return E.text()}return new Promise((E,C)=>{let T=new XMLHttpRequest;T.open("GET",c,!0),T.responseType=A,T.onreadystatechange=()=>{if(T.readyState===XMLHttpRequest.DONE){if(200!==T.status&&0!==T.status)C(Error(T.statusText));else{switch(A){case"arraybuffer":case"blob":case"json":return void E(T.response)}E(T.responseText)}}},T.send(null)})}let Ut=class Ut{constructor({viewBox:c,userUnit:A,scale:E,rotation:C,offsetX:T=0,offsetY:M=0,dontFlip:k=!1}){let I,N,O,U,j,$,V,G;this.viewBox=c,this.userUnit=A,this.scale=E,this.rotation=C,this.offsetX=T,this.offsetY=M,E*=A;let W=(c[2]+c[0])/2,q=(c[3]+c[1])/2;switch((C%=360)<0&&(C+=360),C){case 180:I=-1,N=0,O=0,U=1;break;case 90:I=0,N=1,O=1,U=0;break;case 270:I=0,N=-1,O=-1,U=0;break;case 0:I=1,N=0,O=0,U=-1;break;default:throw Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}k&&(O=-O,U=-U),0===I?(j=Math.abs(q-c[1])*E+T,$=Math.abs(W-c[0])*E+M,V=(c[3]-c[1])*E,G=(c[2]-c[0])*E):(j=Math.abs(W-c[0])*E+T,$=Math.abs(q-c[1])*E+M,V=(c[2]-c[0])*E,G=(c[3]-c[1])*E),this.transform=[I*E,N*E,O*E,U*E,j-I*E*W-O*E*q,$-N*E*W-U*E*q],this.width=V,this.height=G}get rawDims(){let c=this.viewBox;return gt(this,"rawDims",{pageWidth:c[2]-c[0],pageHeight:c[3]-c[1],pageX:c[0],pageY:c[1]})}clone({scale:c=this.scale,rotation:A=this.rotation,offsetX:E=this.offsetX,offsetY:C=this.offsetY,dontFlip:T=!1}={}){return new Ut({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:c,rotation:A,offsetX:E,offsetY:C,dontFlip:T})}convertToViewportPoint(c,A){let E=[c,A];return Ct.applyTransform(E,this.transform),E}convertToViewportRectangle(c){let A=[c[0],c[1]];Ct.applyTransform(A,this.transform);let E=[c[2],c[3]];return Ct.applyTransform(E,this.transform),[A[0],A[1],E[0],E[1]]}convertToPdfPoint(c,A){let E=[c,A];return Ct.applyInverseTransform(E,this.transform),E}};let zt=class zt extends tb{constructor(c,A=0){super(c,"RenderingCancelledException"),this.extraDelay=A}};function Ht(c){let A=c.length,E=0;for(;E<A&&""===c[E].trim();)E++;return"data:"===c.substring(E,E+5).toLowerCase()}function jt(c){return"string"==typeof c&&/\.pdf$/i.test(c)}function $t(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function Vt(c,A="document.pdf"){if("string"!=typeof c)return A;if(Ht(c))return ht('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),A;let E=(c=>{try{return new URL(c)}catch{try{return new URL(decodeURIComponent(c))}catch{try{return new URL(c,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(c),"https://foo.bar")}catch{return null}}}}})(c);if(!E)return A;let s=c=>{try{let A=decodeURIComponent(c);return A.includes("/")?(A=A.split("/").at(-1)).test(/^\.pdf$/i)?A:c:A}catch{return c}},C=/\.pdf$/i,T=E.pathname.split("/").at(-1);if(C.test(T))return s(T);if(E.searchParams.size>0){let c=Array.from(E.searchParams.values()).reverse();for(let A of c)if(C.test(A))return s(A);let A=Array.from(E.searchParams.keys()).reverse();for(let c of A)if(C.test(c))return s(c)}if(E.hash){let c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(E.hash);if(c)return s(c[0])}return A}let Gt=class Gt{time(c){c in this.started&&ht(`Timer is already running for ${c}`),this.started[c]=Date.now()}timeEnd(c){c in this.started||ht(`Timer has not been started for ${c}`),this.times.push({name:c,start:this.started[c],end:Date.now()}),delete this.started[c]}toString(){let c=[],A=0;for(let{name:c}of this.times)A=Math.max(c.length,A);for(let{name:E,start:C,end:T}of this.times)c.push(`${E.padEnd(A)} ${T-C}ms
`);return c.join("")}constructor(){this.started=Object.create(null),this.times=[]}};function Wt(c,A){let E=A?URL.parse(c,A):URL.parse(c);return"http:"===E?.protocol||"https:"===E?.protocol}function qt(c){c.preventDefault()}function Xt(c){c.preventDefault(),c.stopPropagation()}let Yt=class Yt{static #i;static toDateObject(c){if(c instanceof Date)return c;if(!c||"string"!=typeof c)return null;this.#i||=RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let A=this.#i.exec(c);if(!A)return null;let E=parseInt(A[1],10),C=parseInt(A[2],10);C=C>=1&&C<=12?C-1:0;let T=parseInt(A[3],10);T=T>=1&&T<=31?T:1;let M=parseInt(A[4],10);M=M>=0&&M<=23?M:0;let k=parseInt(A[5],10);k=k>=0&&k<=59?k:0;let I=parseInt(A[6],10);I=I>=0&&I<=59?I:0;let N=A[7]||"Z",O=parseInt(A[8],10);O=O>=0&&O<=23?O:0;let U=parseInt(A[9],10)||0;return U=U>=0&&U<=59?U:0,"-"===N?(M+=O,k+=U):"+"===N&&(M-=O,k-=U),new Date(Date.UTC(E,C,T,M,k,I))}};function Kt(c,{scale:A=1,rotation:E=0}){let{width:C,height:T}=c.attributes.style,M=[0,0,parseInt(C),parseInt(T)];return new Ut({viewBox:M,userUnit:1,scale:A,rotation:E})}function Qt(c){if(c.startsWith("#")){let A=parseInt(c.slice(1),16);return[(16711680&A)>>16,(65280&A)>>8,255&A]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(c=>parseInt(c)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(c=>parseInt(c)).slice(0,3):(ht(`Not a valid color format: "${c}"`),[0,0,0])}function Jt(c){let{a:A,b:E,c:C,d:T,e:M,f:k}=c.getTransform();return[A,E,C,T,M,k]}function Zt(c){let{a:A,b:E,c:C,d:T,e:M,f:k}=c.getTransform().invertSelf();return[A,E,C,T,M,k]}function te(c,A,E=!1,C=!0){if(A instanceof Ut){let{pageWidth:C,pageHeight:T}=A.rawDims,{style:M}=c,k=St.isCSSRoundSupported,I=`var(--total-scale-factor) * ${C}px`,N=`var(--total-scale-factor) * ${T}px`,O=k?`round(down, ${I}, var(--scale-round-x))`:`calc(${I})`,U=k?`round(down, ${N}, var(--scale-round-y))`:`calc(${N})`;E&&A.rotation%180!=0?(M.width=U,M.height=O):(M.width=O,M.height=U)}C&&c.setAttribute("data-main-rotation",A.rotation)}let ee=class ee{constructor(){let{pixelRatio:c}=ee;this.sx=c,this.sy=c}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(c,A,E,C,T=-1){let M=1/0,k=1/0,I=1/0;(E=ee.capPixels(E,T))>0&&(M=Math.sqrt(E/(c*A))),-1!==C&&(k=C/c,I=C/A);let N=Math.min(M,k,I);return(this.sx>N||this.sy>N)&&(this.sx=N,this.sy=N,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(c,A){if(A>=0){let E=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+A/100));return c>0?Math.min(c,E):E}return c}};let tk=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];let se=class se{static get isDarkMode(){return gt(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}};let ne=class ne{static get commentForegroundColor(){let c=document.createElement("span");c.classList.add("comment","sidebar");let{style:A}=c;A.width=A.height="0",A.display="none",A.color="var(--comment-fg-color)",document.body.append(c);let{color:E}=window.getComputedStyle(c);return c.remove(),gt(this,"commentForegroundColor",Qt(E))}};function re(c,A,E,C){let T=255*(1-(C=Math.min(Math.max(C??1,0),1)));return[c=Math.round(c*C+T),A=Math.round(A*C+T),E=Math.round(E*C+T)]}function ae(c,A){let E=c[0]/255,C=c[1]/255,T=c[2]/255,M=Math.max(E,C,T),k=Math.min(E,C,T),I=(M+k)/2;if(M===k)A[0]=A[1]=0;else{let c=M-k;switch(A[1]=I<.5?c/(M+k):c/(2-M-k),M){case E:A[0]=60*((C-T)/c+(C<T?6:0));break;case C:A[0]=60*((T-E)/c+2);break;case T:A[0]=60*((E-C)/c+4)}}A[2]=I}function oe(c,A){let E=c[0],C=c[1],T=c[2],M=(1-Math.abs(2*T-1))*C,k=M*(1-Math.abs(E/60%2-1)),I=T-M/2;switch(Math.floor(E/60)){case 0:A[0]=M+I,A[1]=k+I,A[2]=I;break;case 1:A[0]=k+I,A[1]=M+I,A[2]=I;break;case 2:A[0]=I,A[1]=M+I,A[2]=k+I;break;case 3:A[0]=I,A[1]=k+I,A[2]=M+I;break;case 4:A[0]=k+I,A[1]=I,A[2]=M+I;break;case 5:case 6:A[0]=M+I,A[1]=I,A[2]=k+I}}function le(c){return c<=.03928?c/12.92:((c+.055)/1.055)**2.4}function he(c,A,E){oe(c,E),E.map(le);let C=.2126*E[0]+.7152*E[1]+.0722*E[2];oe(A,E),E.map(le);let T=.2126*E[0]+.7152*E[1]+.0722*E[2];return C>T?(C+.05)/(T+.05):(T+.05)/(C+.05)}let tP=new Map;function de(c,A){let E=c[0]+256*c[1]+65536*c[2]+16777216*A[0]+4294967296*A[1]+1099511627776*A[2],C=tP.get(E);if(C)return C;let T=new Float32Array(9),M=T.subarray(0,3),k=T.subarray(3,6);ae(c,k);let I=T.subarray(6,9);ae(A,I);let N=I[2]<.5,O=N?12:4.5;if(k[2]=N?Math.sqrt(k[2]):1-Math.sqrt(1-k[2]),he(k,I,M)<O){let c,A;for(N?(c=k[2],A=1):(c=0,A=k[2]);A-c>.005;){let E=k[2]=(c+A)/2;N===he(k,I,M)<O?c=E:A=E}k[2]=N?A:c}return oe(k,M),C=Ct.makeHexColor(Math.round(255*M[0]),Math.round(255*M[1]),Math.round(255*M[2])),tP.set(E,C),C}function ue({html:c,dir:A,className:E},C){let T=document.createDocumentFragment();if("string"==typeof c){let E=document.createElement("p");E.dir=A||"auto";let C=c.split(/(?:\r\n?|\n)/);for(let c=0,A=C.length;c<A;++c){let T=C[c];E.append(document.createTextNode(T)),c<A-1&&E.append(document.createElement("br"))}T.append(E)}else Bt.render({xfaHtml:c,div:T,intent:"richText"});T.firstChild.classList.add("richText",E),C.append(T)}_(4972),_(4628),_(7642),_(8004),_(3853),_(5876),_(2475),_(5024),_(1698),_(9314),_(1148),_(3579),_(8335);let pe=class pe{#s;#r;#n;#a;#o;#l;#h;#d;static #c=null;constructor(c){this.#s=null,this.#r=null,this.#a=null,this.#o=null,this.#l=null,this.#h=null,this.#d=null,this.#n=c,pe.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){let c=this.#s=document.createElement("div");c.classList.add("editToolbar","hidden"),c.setAttribute("role","toolbar");let A=this.#n._uiManager._signal;A instanceof AbortSignal&&!A.aborted&&(c.addEventListener("contextmenu",qt,{signal:A}),c.addEventListener("pointerdown",pe.#u,{signal:A}));let E=this.#a=document.createElement("div");E.className="buttons",c.append(E);let C=this.#n.toolbarPosition;if(C){let{style:A}=c,E="ltr"===this.#n._uiManager.direction?1-C[0]:C[0];A.insetInlineEnd=100*E+"%",A.top=`calc(${100*C[1]}% + var(--editor-toolbar-vert-offset))`}return c}get div(){return this.#s}static #u(c){c.stopPropagation()}#p(c){this.#n._focusEventsAllowed=!1,Xt(c)}#g(c){this.#n._focusEventsAllowed=!0,Xt(c)}#f(c){let A=this.#n._uiManager._signal;return A instanceof AbortSignal&&!A.aborted&&(c.addEventListener("focusin",this.#p.bind(this),{capture:!0,signal:A}),c.addEventListener("focusout",this.#g.bind(this),{capture:!0,signal:A}),c.addEventListener("contextmenu",qt,{signal:A}),!0)}hide(){this.#s.classList.add("hidden"),this.#r?.hideDropdown()}show(){this.#s.classList.remove("hidden"),this.#o?.shown(),this.#l?.shown()}addDeleteButton(){let{editorType:c,_uiManager:A}=this.#n,E=document.createElement("button");E.classList.add("basic","deleteButton"),E.tabIndex=0,E.setAttribute("data-l10n-id",pe.#c[c]),this.#f(E)&&E.addEventListener("click",c=>{A.delete()},{signal:A._signal}),this.#a.append(E)}get #m(){let c=document.createElement("div");return c.className="divider",c}async addAltText(c){let A=await c.render();this.#f(A),this.#a.append(A,this.#m),this.#o=c}addComment(c,A=null){if(this.#l)return;let E=c.renderForToolbar();if(!E)return;this.#f(E);let C=this.#h=this.#m;A?(this.#a.insertBefore(E,A),this.#a.insertBefore(C,A)):this.#a.append(E,C),this.#l=c,c.toolbar=this}addColorPicker(c){if(this.#r)return;this.#r=c;let A=c.renderButton();this.#f(A),this.#a.append(A,this.#m)}async addEditSignatureButton(c){let A=this.#d=await c.renderEditButton(this.#n);this.#f(A),this.#a.append(A,this.#m)}removeButton(c){"comment"===c&&(this.#l?.removeToolbarCommentButton(),this.#l=null,this.#h?.remove(),this.#h=null)}async addButton(c,A){switch(c){case"colorPicker":this.addColorPicker(A);break;case"altText":await this.addAltText(A);break;case"editSignature":await this.addEditSignatureButton(A);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(A)}}async addButtonBefore(c,A,E){let C=this.#a.querySelector(E);C&&"comment"===c&&this.addComment(A,C)}updateEditSignatureButton(c){this.#d&&(this.#d.title=c)}remove(){this.#s.remove(),this.#r?.destroy(),this.#r=null}};let ge=class ge{#a;#s;#b;constructor(c){this.#a=null,this.#s=null,this.#b=c}#v(){let c=this.#s=document.createElement("div");c.className="editToolbar",c.setAttribute("role","toolbar");let A=this.#b._signal;A instanceof AbortSignal&&!A.aborted&&c.addEventListener("contextmenu",qt,{signal:A});let E=this.#a=document.createElement("div");return E.className="buttons",c.append(E),this.#b.hasCommentManager()&&this.#y("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#b.commentSelection("floating_button")}),this.#y("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#b.highlightSelection("floating_button")}),c}#w(c,A){let E=0,C=0;for(let T of c){let c=T.y+T.height;if(c<E)continue;let M=T.x+(A?T.width:0);c>E?(C=M,E=c):A?M>C&&(C=M):M<C&&(C=M)}return[A?1-C:C,E]}show(c,A,E){let[C,T]=this.#w(A,E),{style:M}=this.#s||=this.#v();c.append(this.#s),M.insetInlineEnd=100*C+"%",M.top=`calc(${100*T}% + var(--editor-toolbar-vert-offset))`}hide(){this.#s.remove()}#y(c,A,E,C){let T=document.createElement("button");T.classList.add("basic",c),T.tabIndex=0,T.setAttribute("data-l10n-id",A);let M=document.createElement("span");T.append(M),M.className="visuallyHidden",M.setAttribute("data-l10n-id",E);let k=this.#b._signal;k instanceof AbortSignal&&!k.aborted&&(T.addEventListener("contextmenu",qt,{signal:k}),T.addEventListener("click",C,{signal:k})),this.#a.append(T)}};function me(c,A,E){for(let C of E)A.addEventListener(C,c[C].bind(c))}let fe=class fe{#A;get id(){return`${to}${this.#A++}`}constructor(){this.#A=0}};let be=class be{#_;#A;#x;static get _isSVGFittingCanvas(){let c=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),A=new Image;return A.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',gt(this,"_isSVGFittingCanvas",A.decode().then(()=>(c.drawImage(A,0,0,1,1,0,0,1,3),0===new Uint32Array(c.getImageData(0,0,1,1).data.buffer)[0])))}async #E(c,A){this.#x||=new Map;let E=this.#x.get(c);if(null===E)return null;if(E?.bitmap)return E.refCounter+=1,E;try{let c;if(E||={bitmap:null,id:`image_${this.#_}_${this.#A++}`,refCounter:0,isSvg:!1},"string"==typeof A?(E.url=A,c=await Nt(A,"blob")):A instanceof File?c=E.file=A:A instanceof Blob&&(c=A),"image/svg+xml"===c.type){let A=be._isSVGFittingCanvas,C=new FileReader,T=new Image,M=new Promise((c,M)=>{T.onload=()=>{E.bitmap=T,E.isSvg=!0,c()},C.onload=async()=>{let c=E.svgUrl=C.result;T.src=await A?`${c}#svgView(preserveAspectRatio(none))`:c},T.onerror=C.onerror=M});C.readAsDataURL(c),await M}else E.bitmap=await createImageBitmap(c);E.refCounter=1}catch(c){ht(c),E=null}return this.#x.set(c,E),E&&this.#x.set(E.id,E),E}async getFromFile(c){let{lastModified:A,name:E,size:C,type:T}=c;return this.#E(`${A}_${E}_${C}_${T}`,c)}async getFromUrl(c){return this.#E(c,c)}async getFromBlob(c,A){let E=await A;return this.#E(c,E)}async getFromId(c){this.#x||=new Map;let A=this.#x.get(c);if(!A)return null;if(A.bitmap)return A.refCounter+=1,A;if(A.file)return this.getFromFile(A.file);if(A.blobPromise){let{blobPromise:c}=A;return delete A.blobPromise,this.getFromBlob(A.id,c)}return this.getFromUrl(A.url)}getFromCanvas(c,A){this.#x||=new Map;let E=this.#x.get(c);if(E?.bitmap)return E.refCounter+=1,E;let C=new OffscreenCanvas(A.width,A.height);return C.getContext("2d").drawImage(A,0,0),E={bitmap:C.transferToImageBitmap(),id:`image_${this.#_}_${this.#A++}`,refCounter:1,isSvg:!1},this.#x.set(c,E),this.#x.set(E.id,E),E}getSvgUrl(c){let A=this.#x.get(c);return A?.isSvg?A.svgUrl:null}deleteId(c){this.#x||=new Map;let A=this.#x.get(c);if(!A||(A.refCounter-=1,0!==A.refCounter))return;let{bitmap:E}=A;if(!A.url&&!A.file){let c=new OffscreenCanvas(E.width,E.height);c.getContext("bitmaprenderer").transferFromImageBitmap(E),A.blobPromise=c.convertToBlob()}E.close?.(),A.bitmap=null}isValidId(c){return c.startsWith(`image_${this.#_}_`)}constructor(){this.#_=Pt(),this.#A=0,this.#x=null}};let ve=class ve{#S;#C;#T;#M;constructor(c=128){this.#S=[],this.#C=!1,this.#M=-1,this.#T=c}add({cmd:c,undo:A,post:E,mustExec:C,type:T=NaN,overwriteIfSameType:M=!1,keepUndo:k=!1}){if(C&&c(),this.#C)return;let I={cmd:c,undo:A,post:E,type:T};if(-1===this.#M)return this.#S.length>0&&(this.#S.length=0),this.#M=0,void this.#S.push(I);if(M&&this.#S[this.#M].type===T)return k&&(I.undo=this.#S[this.#M].undo),void(this.#S[this.#M]=I);let N=this.#M+1;N===this.#T?this.#S.splice(0,1):(this.#M=N,N<this.#S.length&&this.#S.splice(N)),this.#S.push(I)}undo(){if(-1===this.#M)return;this.#C=!0;let{undo:c,post:A}=this.#S[this.#M];c(),A?.(),this.#C=!1,this.#M-=1}redo(){if(this.#M<this.#S.length-1){this.#M+=1,this.#C=!0;let{cmd:c,post:A}=this.#S[this.#M];c(),A?.(),this.#C=!1}}hasSomethingToUndo(){return -1!==this.#M}hasSomethingToRedo(){return this.#M<this.#S.length-1}cleanType(c){if(-1!==this.#M){for(let A=this.#M;A>=0;A--)if(this.#S[A].type!==c)return this.#S.splice(A+1,this.#M-A),void(this.#M=A);this.#S.length=0,this.#M=-1}}destroy(){this.#S=null}};let ye=class ye{constructor(c){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:A}=St.platform;for(let[E,C,T={}]of c)for(let c of E){let E=c.startsWith("mac+");A&&E?(this.callbacks.set(c.slice(4),{callback:C,options:T}),this.allKeys.add(c.split("+").at(-1))):A||E||(this.callbacks.set(c,{callback:C,options:T}),this.allKeys.add(c.split("+").at(-1)))}}#k(c){c.altKey&&this.buffer.push("alt"),c.ctrlKey&&this.buffer.push("ctrl"),c.metaKey&&this.buffer.push("meta"),c.shiftKey&&this.buffer.push("shift"),this.buffer.push(c.key);let A=this.buffer.join("+");return this.buffer.length=0,A}exec(c,A){if(!this.allKeys.has(A.key))return;let E=this.callbacks.get(this.#k(A));if(!E)return;let{callback:C,options:{bubbles:T=!1,args:M=[],checker:k=null}}=E;k&&!k(c,A)||(C.bind(c,...M,A)(),T||Xt(A))}};let we=class we{static{this._colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])}get _colors(){let c=new Map([["CanvasText",null],["Canvas",null]]);return function(c){let A=document.createElement("span");for(let E of(A.style.visibility="hidden",A.style.colorScheme="only light",document.body.append(A),c.keys())){A.style.color=E;let C=window.getComputedStyle(A).color;c.set(E,Qt(C))}A.remove()}(c),gt(this,"_colors",c)}convert(c){let A=Qt(c);if(!window.matchMedia("(forced-colors: active)").matches)return A;for(let[c,E]of this._colors)if(E.every((c,E)=>c===A[E]))return we._colorsMapping.get(c);return A}getHexCode(c){let A=this._colors.get(c);return A?Ct.makeHexColor(...A):c}};let xe=class xe{#P;#R;#D;#I;#L;#F;#N;#O;#B;#U;#z;#j;#H;#$;#V;#G;#W;#q;#X;#Y;#K;#J;#Q;#Z;#tt;#te;#ti;#ts;#tr;#tn;#ta;#to;#tl;#th;#td;#tc;#tu;#tp;#tg;#tf;#tm;#tb;#tv;#ty;#tw;#tA;#t_;#tx;#tE;static{this.TRANSLATE_SMALL=1}static{this.TRANSLATE_BIG=10}static get _keyboardManager(){let c=xe.prototype,e=c=>c.#tA.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&c.hasSomethingToControl(),i=(c,{target:A})=>{if(A instanceof HTMLInputElement){let{type:c}=A;return"text"!==c&&"number"!==c}return!0},A=this.TRANSLATE_SMALL,E=this.TRANSLATE_BIG;return gt(this,"_keyboardManager",new ye([[["ctrl+a","mac+meta+a"],c.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],c.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],c.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],c.delete,{checker:i}],[["Enter","mac+Enter"],c.addNewEditorFromKeyboard,{checker:(c,{target:A})=>!(A instanceof HTMLButtonElement)&&c.#tA.contains(A)&&!c.isEnterHandled}],[[" ","mac+ "],c.addNewEditorFromKeyboard,{checker:(c,{target:A})=>!(A instanceof HTMLButtonElement)&&c.#tA.contains(document.activeElement)}],[["Escape","mac+Escape"],c.unselectAll],[["ArrowLeft","mac+ArrowLeft"],c.translateSelectedEditors,{args:[-A,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],c.translateSelectedEditors,{args:[-E,0],checker:e}],[["ArrowRight","mac+ArrowRight"],c.translateSelectedEditors,{args:[A,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],c.translateSelectedEditors,{args:[E,0],checker:e}],[["ArrowUp","mac+ArrowUp"],c.translateSelectedEditors,{args:[0,-A],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],c.translateSelectedEditors,{args:[0,-E],checker:e}],[["ArrowDown","mac+ArrowDown"],c.translateSelectedEditors,{args:[0,A],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],c.translateSelectedEditors,{args:[0,E],checker:e}]]))}constructor(c,A,E,C,T,M,k,I,N,O,U,j,$,V,G,W){this.#P=new AbortController,this.#R=null,this.#D=null,this.#I=new Map,this.#L=new Map,this.#F=null,this.#N=null,this.#O=null,this.#B=new ve,this.#U=null,this.#z=null,this.#j=null,this.#H=0,this.#$=new Set,this.#V=null,this.#G=null,this.#W=new Set,this._editorUndoBar=null,this.#q=!1,this.#X=!1,this.#Y=!1,this.#K=null,this.#J=null,this.#Q=null,this.#Z=null,this.#tt=!1,this.#te=null,this.#ti=new fe,this.#ts=!1,this.#tr=!1,this.#tn=!1,this.#ta=null,this.#to=null,this.#tl=null,this.#th=null,this.#td=null,this.#tc=tl.NONE,this.#tu=new Set,this.#tp=null,this.#tg=null,this.#tf=null,this.#tm=null,this.#tb=null,this.#tv={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1},this.#ty=[0,0],this.#tw=null,this.#tA=null,this.#t_=null,this.#tx=null,this.#tE=null;let q=this._signal=this.#P.signal;this.#tA=c,this.#t_=A,this.#tx=E,this.#F=C,this.#U=T,this.#tg=M,this.#tb=I,this._eventBus=k,k._on("editingaction",this.onEditingAction.bind(this),{signal:q}),k._on("pagechanging",this.onPageChanging.bind(this),{signal:q}),k._on("scalechanging",this.onScaleChanging.bind(this),{signal:q}),k._on("rotationchanging",this.onRotationChanging.bind(this),{signal:q}),k._on("setpreference",this.onSetPreference.bind(this),{signal:q}),k._on("switchannotationeditorparams",c=>this.updateParams(c.type,c.value),{signal:q}),window.addEventListener("pointerdown",()=>{this.#tr=!0},{capture:!0,signal:q}),window.addEventListener("pointerup",()=>{this.#tr=!1},{capture:!0,signal:q}),this.#tS(),this.#tC(),this.#tT(),this.#N=I.annotationStorage,this.#K=I.filterFactory,this.#tf=N,this.#Z=O||null,this.#q=U,this.#X=j,this.#Y=$,this.#td=V||null,this.viewParameters={realScale:Ot.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=G||null,this._supportsPinchToZoom=!1!==W,T?.setSidebarUiManager(this)}destroy(){for(let c of(this.#tE?.resolve(),this.#tE=null,this.#P?.abort(),this.#P=null,this._signal=null,this.#L.values()))c.destroy();this.#L.clear(),this.#I.clear(),this.#W.clear(),this.#th?.clear(),this.#R=null,this.#tu.clear(),this.#B.destroy(),this.#F?.destroy(),this.#U?.destroy(),this.#tg?.destroy(),this.#te?.hide(),this.#te=null,this.#tl?.destroy(),this.#tl=null,this.#D=null,this.#J&&(clearTimeout(this.#J),this.#J=null),this.#tw&&(clearTimeout(this.#tw),this.#tw=null),this._editorUndoBar?.destroy(),this.#tb=null}combinedSignal(c){return AbortSignal.any([this._signal,c.signal])}get mlManager(){return this.#td}get useNewAltTextFlow(){return this.#X}get useNewAltTextWhenAddingImage(){return this.#Y}get hcmFilter(){return gt(this,"hcmFilter",this.#tf?this.#K.addHCMFilter(this.#tf.foreground,this.#tf.background):"none")}get direction(){return gt(this,"direction",getComputedStyle(this.#tA).direction)}get _highlightColors(){return gt(this,"_highlightColors",this.#Z?new Map(this.#Z.split(",").map(c=>((c=c.split("=").map(c=>c.trim()))[1]=c[1].toUpperCase(),c))):null)}get highlightColors(){let{_highlightColors:c}=this;if(!c)return gt(this,"highlightColors",null);let A=new Map,E=!!this.#tf;for(let[C,T]of c){let c=C.endsWith("_HCM");E&&c?A.set(C.replace("_HCM",""),T):E||c||A.set(C,T)}return gt(this,"highlightColors",A)}get highlightColorNames(){return gt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,c=>c.reverse())):null)}getNonHCMColor(c){if(!this._highlightColors)return c;let A=this.highlightColorNames.get(c);return this._highlightColors.get(A)||c}getNonHCMColorName(c){return this.highlightColorNames.get(c)||c}setCurrentDrawingSession(c){c?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#j=c}setMainHighlightColorPicker(c){this.#tl=c}editAltText(c,A=!1){this.#F?.editAltText(this,c,A)}hasCommentManager(){return!!this.#U}editComment(c,A,E,C){this.#U?.showDialog(this,c,A,E,C)}selectComment(c,A){let E=this.#L.get(c),C=E?.getEditorByUID(A);C?.toggleComment(!0,!0)}updateComment(c){this.#U?.updateComment(c.getData())}updatePopupColor(c){this.#U?.updatePopupColor(c)}removeComment(c){this.#U?.removeComments([c.uid])}toggleComment(c,A,E){this.#U?.toggleCommentPopup(c,A,E)}makeCommentColor(c,A){return c&&this.#U?.makeCommentColor(c,A)||null}getCommentDialogElement(){return this.#U?.dialogElement||null}async waitForEditorsRendered(c){if(this.#L.has(c-1))return;let{resolve:A,promise:E}=Promise.withResolvers(),s=E=>{E.pageNumber===c&&(this._eventBus._off("editorsrendered",s),A())};this._eventBus.on("editorsrendered",s),await E}getSignature(c){this.#tg?.getSignature({uiManager:this,editor:c})}get signatureManager(){return this.#tg}switchToMode(c,A){this._eventBus.on("annotationeditormodechanged",A,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:c})}setPreference(c,A){this._eventBus.dispatch("setpreference",{source:this,name:c,value:A})}onSetPreference({name:c,value:A}){"enableNewAltTextWhenAddingImage"===c&&(this.#Y=A)}onPageChanging({pageNumber:c}){this.#H=c-1}focusMainContainer(){this.#tA.focus()}findParent(c,A){for(let E of this.#L.values()){let{x:C,y:T,width:M,height:k}=E.div.getBoundingClientRect();if(c>=C&&c<=C+M&&A>=T&&A<=T+k)return E}return null}disableUserSelect(c=!1){this.#t_.classList.toggle("noUserSelect",c)}addShouldRescale(c){this.#W.add(c)}removeShouldRescale(c){this.#W.delete(c)}onScaleChanging({scale:c}){for(let A of(this.commitOrRemove(),this.viewParameters.realScale=c*Ot.PDF_TO_CSS_UNITS,this.#W))A.onScaleChanging();this.#j?.onScaleChanging()}onRotationChanging({pagesRotation:c}){this.commitOrRemove(),this.viewParameters.rotation=c}#tM({anchorNode:c}){return c.nodeType===Node.TEXT_NODE?c.parentElement:c}#tk(c){let{currentLayer:A}=this;if(A.hasTextLayer(c))return A;for(let A of this.#L.values())if(A.hasTextLayer(c))return A;return null}highlightSelection(c="",A=!1){let E=document.getSelection();if(!E||E.isCollapsed)return;let{anchorNode:C,anchorOffset:T,focusNode:M,focusOffset:k}=E,I=E.toString(),N=this.#tM(E).closest(".textLayer"),O=this.getSelectionBoxes(N);if(!O)return;E.empty();let U=this.#tk(N),j=this.#tc===tl.NONE,u=()=>{let E=U?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:c,boxes:O,anchorNode:C,anchorOffset:T,focusNode:M,focusOffset:k,text:I});j&&this.showAllEditors("highlight",!0,!0),A&&E?.editComment()};j?this.switchToMode(tl.HIGHLIGHT,u):u()}commentSelection(c=""){this.highlightSelection(c,!0)}#tP(){let c=document.getSelection();if(!c||c.isCollapsed)return;let A=this.#tM(c).closest(".textLayer"),E=this.getSelectionBoxes(A);E&&(this.#te||=new ge(this),this.#te.show(A,E,"ltr"===this.direction))}getAndRemoveDataFromAnnotationStorage(c){if(!this.#N)return null;let A=`${to}${c}`,E=this.#N.getRawValue(A);return E&&this.#N.remove(A),E}addToAnnotationStorage(c){c.isEmpty()||!this.#N||this.#N.has(c.id)||this.#N.setValue(c.id,c)}a11yAlert(c,A=null){let E=this.#tx;E&&(E.setAttribute("data-l10n-id",c),A?E.setAttribute("data-l10n-args",JSON.stringify(A)):E.removeAttribute("data-l10n-args"))}#tR(){let c=document.getSelection();if(!c||c.isCollapsed)return void(this.#tp&&(this.#te?.hide(),this.#tp=null,this.#tD({hasSelectedText:!1})));let{anchorNode:A}=c;if(A===this.#tp)return;let E=this.#tM(c).closest(".textLayer");if(E){if(this.#te?.hide(),this.#tp=A,this.#tD({hasSelectedText:!0}),(this.#tc===tl.HIGHLIGHT||this.#tc===tl.NONE)&&(this.#tc===tl.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#tt=this.isShiftKeyDown,!this.isShiftKeyDown)){let c=this.#tc===tl.HIGHLIGHT?this.#tk(E):null;if(c?.toggleDrawing(),this.#tr){let A=new AbortController,E=this.combinedSignal(A),s=E=>{"pointerup"===E.type&&0!==E.button||(A.abort(),c?.toggleDrawing(!0),"pointerup"===E.type&&this.#tI("main_toolbar"))};window.addEventListener("pointerup",s,{signal:E}),window.addEventListener("blur",s,{signal:E})}else c?.toggleDrawing(!0),this.#tI("main_toolbar")}}else this.#tp&&(this.#te?.hide(),this.#tp=null,this.#tD({hasSelectedText:!1}))}#tI(c=""){this.#tc===tl.HIGHLIGHT?this.highlightSelection(c):this.#q&&this.#tP()}#tS(){document.addEventListener("selectionchange",this.#tR.bind(this),{signal:this._signal})}#tL(){if(this.#Q)return;this.#Q=new AbortController;let c=this.combinedSignal(this.#Q);window.addEventListener("focus",this.focus.bind(this),{signal:c}),window.addEventListener("blur",this.blur.bind(this),{signal:c})}#tF(){this.#Q?.abort(),this.#Q=null}blur(){if(this.isShiftKeyDown=!1,this.#tt&&(this.#tt=!1,this.#tI("main_toolbar")),!this.hasSelection)return;let{activeElement:c}=document;for(let A of this.#tu)if(A.div.contains(c)){this.#to=[A,c],A._focusEventsAllowed=!1;break}}focus(){if(!this.#to)return;let[c,A]=this.#to;this.#to=null,A.addEventListener("focusin",()=>{c._focusEventsAllowed=!0},{once:!0,signal:this._signal}),A.focus()}#tT(){if(this.#ta)return;this.#ta=new AbortController;let c=this.combinedSignal(this.#ta);window.addEventListener("keydown",this.keydown.bind(this),{signal:c}),window.addEventListener("keyup",this.keyup.bind(this),{signal:c})}#tN(){this.#ta?.abort(),this.#ta=null}#tO(){if(this.#z)return;this.#z=new AbortController;let c=this.combinedSignal(this.#z);document.addEventListener("copy",this.copy.bind(this),{signal:c}),document.addEventListener("cut",this.cut.bind(this),{signal:c}),document.addEventListener("paste",this.paste.bind(this),{signal:c})}#tB(){this.#z?.abort(),this.#z=null}#tC(){let c=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:c}),document.addEventListener("drop",this.drop.bind(this),{signal:c})}addEditListeners(){this.#tT(),this.#tO()}removeEditListeners(){this.#tN(),this.#tB()}dragOver(c){for(let{type:A}of c.dataTransfer.items)for(let E of this.#G)if(E.isHandlingMimeForPasting(A))return c.dataTransfer.dropEffect="copy",void c.preventDefault()}drop(c){for(let A of c.dataTransfer.items)for(let E of this.#G)if(E.isHandlingMimeForPasting(A.type))return E.paste(A,this.currentLayer),void c.preventDefault()}copy(c){if(c.preventDefault(),this.#R?.commitOrRemove(),!this.hasSelection)return;let A=[];for(let c of this.#tu){let E=c.serialize(!0);E&&A.push(E)}0!==A.length&&c.clipboardData.setData("application/pdfjs",JSON.stringify(A))}cut(c){this.copy(c),this.delete()}async paste(c){c.preventDefault();let{clipboardData:A}=c;for(let c of A.items)for(let A of this.#G)if(A.isHandlingMimeForPasting(c.type))return void A.paste(c,this.currentLayer);let E=A.getData("application/pdfjs");if(!E)return;try{E=JSON.parse(E)}catch(c){return void ht(`paste: "${c.message}".`)}if(!Array.isArray(E))return;this.unselectAll();let C=this.currentLayer;try{let c=[];for(let A of E){let E=await C.deserialize(A);if(!E)return;c.push(E)}this.addCommands({cmd:()=>{for(let A of c)this.#tU(A);this.#tz(c)},undo:()=>{for(let A of c)A.remove()},mustExec:!0})}catch(c){ht(`paste: "${c.message}".`)}}keydown(c){this.isShiftKeyDown||"Shift"!==c.key||(this.isShiftKeyDown=!0),this.#tc===tl.NONE||this.isEditorHandlingKeyboard||xe._keyboardManager.exec(this,c)}keyup(c){this.isShiftKeyDown&&"Shift"===c.key&&(this.isShiftKeyDown=!1,this.#tt&&(this.#tt=!1,this.#tI("main_toolbar")))}onEditingAction({name:c}){switch(c){case"undo":case"redo":case"delete":case"selectAll":this[c]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu")}}#tD(c){Object.entries(c).some(([c,A])=>this.#tv[c]!==A)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#tv,c)}),this.#tc===tl.HIGHLIGHT&&!1===c.hasSelectedEditor&&this.#tj([[th.HIGHLIGHT_FREE,!0]]))}#tj(c){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:c})}setEditingState(c){c?(this.#tL(),this.#tO(),this.#tD({isEditing:this.#tc!==tl.NONE,isEmpty:this.#tH(),hasSomethingToUndo:this.#B.hasSomethingToUndo(),hasSomethingToRedo:this.#B.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#tF(),this.#tB(),this.#tD({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(c){if(!this.#G)for(let A of(this.#G=c,this.#G))this.#tj(A.defaultPropertiesToUpdate)}getId(){return this.#ti.id}get currentLayer(){return this.#L.get(this.#H)}getLayer(c){return this.#L.get(c)}get currentPageIndex(){return this.#H}addLayer(c){this.#L.set(c.pageIndex,c),this.#ts?c.enable():c.disable()}removeLayer(c){this.#L.delete(c.pageIndex)}async updateMode(c,A=null,E=!1,C=!1,T=!1){if(this.#tc!==c&&(!this.#tE||(await this.#tE.promise,this.#tE))){if(this.#tE=Promise.withResolvers(),this.#j?.commitOrRemove(),this.#tc===tl.POPUP&&this.#U?.hideSidebar(),this.#U?.destroyPopup(),this.#tc=c,c===tl.NONE){for(let c of(this.setEditingState(!1),this.#t$(),this.#I.values()))c.hideStandaloneCommentButton();return this._editorUndoBar?.hide(),this.toggleComment(null),void this.#tE.resolve()}for(let c of this.#I.values())c.addStandaloneCommentButton();for(let A of(c===tl.SIGNATURE&&await this.#tg?.loadSignatures(),this.setEditingState(!0),await this.#tV(),this.unselectAll(),this.#L.values()))A.updateMode(c);if(c===tl.POPUP){this.#D||=await this.#tb.getAnnotationsByType(new Set(this.#G.map(c=>c._editorType)));let c=new Set,A=[];for(let E of this.#I.values()){let{annotationElementId:C,hasComment:T,deleted:M}=E;C&&c.add(C),T&&!M&&A.push(E.getData())}for(let E of this.#D){let{id:C,popupRef:T,contentsObj:M}=E;T&&M?.str&&!c.has(C)&&!this.#$.has(C)&&A.push(E)}this.#U?.showSidebar(A)}if(!A)return E&&this.addNewEditorFromKeyboard(),void this.#tE.resolve();for(let c of this.#I.values())c.uid===A?(this.setSelected(c),T?c.editComment():C?c.enterInEditMode():c.focus()):c.unselect();this.#tE.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(c){c.mode!==this.#tc&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...c})}updateParams(c,A){if(this.#G){switch(c){case th.CREATE:return void this.currentLayer.addNewEditor(A);case th.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#tm||=new Map).set(c,A),this.showAllEditors("highlight",A)}if(this.hasSelection)for(let E of this.#tu)E.updateParams(c,A);else for(let E of this.#G)E.updateDefaultParams(c,A)}}showAllEditors(c,A,E=!1){for(let E of this.#I.values())E.editorType===c&&E.show(A);(this.#tm?.get(th.HIGHLIGHT_SHOW_ALL)??!0)!==A&&this.#tj([[th.HIGHLIGHT_SHOW_ALL,A]])}enableWaiting(c=!1){if(this.#tn!==c)for(let A of(this.#tn=c,this.#L.values()))c?A.disableClick():A.enableClick(),A.div.classList.toggle("waiting",c)}async #tV(){if(!this.#ts){this.#ts=!0;let c=[];for(let A of this.#L.values())c.push(A.enable());for(let A of(await Promise.all(c),this.#I.values()))A.enable()}}#t$(){if(this.unselectAll(),this.#ts){for(let c of(this.#ts=!1,this.#L.values()))c.disable();for(let c of this.#I.values())c.disable()}}*getEditors(c){for(let A of this.#I.values())A.pageIndex===c&&(yield A)}getEditor(c){return this.#I.get(c)}addEditor(c){this.#I.set(c.id,c)}removeEditor(c){c.div.contains(document.activeElement)&&(this.#J&&clearTimeout(this.#J),this.#J=setTimeout(()=>{this.focusMainContainer(),this.#J=null},0)),this.#I.delete(c.id),c.annotationElementId&&this.#th?.delete(c.annotationElementId),this.unselect(c),c.annotationElementId&&this.#$.has(c.annotationElementId)||this.#N?.remove(c.id)}addDeletedAnnotationElement(c){this.#$.add(c.annotationElementId),this.addChangedExistingAnnotation(c),c.deleted=!0}isDeletedAnnotationElement(c){return this.#$.has(c)}removeDeletedAnnotationElement(c){this.#$.delete(c.annotationElementId),this.removeChangedExistingAnnotation(c),c.deleted=!1}#tU(c){let A=this.#L.get(c.pageIndex);A?A.addOrRebuild(c):(this.addEditor(c),this.addToAnnotationStorage(c))}setActiveEditor(c){this.#R!==c&&(this.#R=c,c&&this.#tj(c.propertiesToUpdate))}get #tG(){let c=null;for(c of this.#tu);return c}updateUI(c){this.#tG===c&&this.#tj(c.propertiesToUpdate)}updateUIForDefaultProperties(c){this.#tj(c.defaultPropertiesToUpdate)}toggleSelected(c){if(this.#tu.has(c))return this.#tu.delete(c),c.unselect(),void this.#tD({hasSelectedEditor:this.hasSelection});this.#tu.add(c),c.select(),this.#tj(c.propertiesToUpdate),this.#tD({hasSelectedEditor:!0})}setSelected(c){for(let A of(this.updateToolbar({mode:c.mode,editId:c.id}),this.#j?.commitOrRemove(),this.#tu))A!==c&&A.unselect();this.#tu.clear(),this.#tu.add(c),c.select(),this.#tj(c.propertiesToUpdate),this.#tD({hasSelectedEditor:!0})}isSelected(c){return this.#tu.has(c)}get firstSelectedEditor(){return this.#tu.values().next().value}unselect(c){c.unselect(),this.#tu.delete(c),this.#tD({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#tu.size}get isEnterHandled(){return 1===this.#tu.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#B.undo(),this.#tD({hasSomethingToUndo:this.#B.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#tH()}),this._editorUndoBar?.hide()}redo(){this.#B.redo(),this.#tD({hasSomethingToUndo:!0,hasSomethingToRedo:this.#B.hasSomethingToRedo(),isEmpty:this.#tH()})}addCommands(c){this.#B.add(c),this.#tD({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#tH()})}cleanUndoStack(c){this.#B.cleanType(c)}#tH(){if(0===this.#I.size)return!0;if(1===this.#I.size)for(let c of this.#I.values())return c.isEmpty();return!1}delete(){this.commitOrRemove();let c=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!c)return;let A=c?[c]:[...this.#tu],i=()=>{for(let c of A)this.#tU(c)};this.addCommands({cmd:()=>{for(let c of(this._editorUndoBar?.show(i,1===A.length?A[0].editorType:A.length),A))c.remove()},undo:i,mustExec:!0})}commitOrRemove(){this.#R?.commitOrRemove()}hasSomethingToControl(){return this.#R||this.hasSelection}#tz(c){for(let c of this.#tu)c.unselect();for(let A of(this.#tu.clear(),c))A.isEmpty()||(this.#tu.add(A),A.select());this.#tD({hasSelectedEditor:this.hasSelection})}selectAll(){for(let c of this.#tu)c.commit();this.#tz(this.#I.values())}unselectAll(){if((!this.#R||(this.#R.commitOrRemove(),this.#tc===tl.NONE))&&!this.#j?.commitOrRemove()&&this.hasSelection){for(let c of this.#tu)c.unselect();this.#tu.clear(),this.#tD({hasSelectedEditor:!1})}}translateSelectedEditors(c,A,E=!1){if(E||this.commitOrRemove(),!this.hasSelection)return;this.#ty[0]+=c,this.#ty[1]+=A;let[C,T]=this.#ty,M=[...this.#tu];for(let E of(this.#tw&&clearTimeout(this.#tw),this.#tw=setTimeout(()=>{this.#tw=null,this.#ty[0]=this.#ty[1]=0,this.addCommands({cmd:()=>{for(let c of M)this.#I.has(c.id)&&(c.translateInPage(C,T),c.translationDone())},undo:()=>{for(let c of M)this.#I.has(c.id)&&(c.translateInPage(-C,-T),c.translationDone())},mustExec:!1})},1e3),M))E.translateInPage(c,A),E.translationDone()}setUpDragSession(){if(this.hasSelection)for(let c of(this.disableUserSelect(!0),this.#V=new Map,this.#tu))this.#V.set(c,{savedX:c.x,savedY:c.y,savedPageIndex:c.pageIndex,newX:0,newY:0,newPageIndex:-1})}endDragSession(){if(!this.#V)return!1;this.disableUserSelect(!1);let c=this.#V;this.#V=null;let A=!1;for(let[{x:E,y:C,pageIndex:T},M]of c)M.newX=E,M.newY=C,M.newPageIndex=T,A||=E!==M.savedX||C!==M.savedY||T!==M.savedPageIndex;if(!A)return!1;let i=(c,A,E,C)=>{if(this.#I.has(c.id)){let T=this.#L.get(C);T?c._setParentAndPosition(T,A,E):(c.pageIndex=C,c.x=A,c.y=E)}};return this.addCommands({cmd:()=>{for(let[A,{newX:E,newY:C,newPageIndex:T}]of c)i(A,E,C,T)},undo:()=>{for(let[A,{savedX:E,savedY:C,savedPageIndex:T}]of c)i(A,E,C,T)},mustExec:!0}),!0}dragSelectedEditors(c,A){if(this.#V)for(let E of this.#V.keys())E.drag(c,A)}rebuild(c){if(null===c.parent){let A=this.getLayer(c.pageIndex);A?(A.changeParent(c),A.addOrRebuild(c)):(this.addEditor(c),this.addToAnnotationStorage(c),c.rebuild())}else c.parent.addOrRebuild(c)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#tu.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(c){return this.#R===c}getActive(){return this.#R}getMode(){return this.#tc}isEditingMode(){return this.#tc!==tl.NONE}get imageManager(){return gt(this,"imageManager",new be)}getSelectionBoxes(c){let A;if(!c)return null;let E=document.getSelection();for(let A=0,C=E.rangeCount;A<C;A++)if(!c.contains(E.getRangeAt(A).commonAncestorContainer))return null;let{x:C,y:T,width:M,height:k}=c.getBoundingClientRect();switch(c.getAttribute("data-main-rotation")){case"90":A=(c,A,E,I)=>({x:(A-T)/k,y:1-(c+E-C)/M,width:I/k,height:E/M});break;case"180":A=(c,A,E,I)=>({x:1-(c+E-C)/M,y:1-(A+I-T)/k,width:E/M,height:I/k});break;case"270":A=(c,A,E,I)=>({x:1-(A+I-T)/k,y:(c-C)/M,width:I/k,height:E/M});break;default:A=(c,A,E,I)=>({x:(c-C)/M,y:(A-T)/k,width:E/M,height:I/k})}let I=[];for(let c=0,C=E.rangeCount;c<C;c++){let C=E.getRangeAt(c);if(!C.collapsed)for(let{x:c,y:E,width:T,height:M}of C.getClientRects())0!==T&&0!==M&&I.push(A(c,E,T,M))}return 0===I.length?null:I}addChangedExistingAnnotation({annotationElementId:c,id:A}){(this.#O||=new Map).set(c,A)}removeChangedExistingAnnotation({annotationElementId:c}){this.#O?.delete(c)}renderAnnotationElement(c){let A=this.#O?.get(c.data.id);if(!A)return;let E=this.#N.getRawValue(A);E&&(this.#tc!==tl.NONE||E.hasBeenModified)&&E.renderAnnotationElement(c)}setMissingCanvas(c,A,E){let C=this.#th?.get(c);C&&(C.setCanvas(A,E),this.#th.delete(c))}addMissingCanvas(c,A){(this.#th||=new Map).set(c,A)}};let Ae=class Ae{#o;#tW;#tq;#tX;#tY;#tK;#tJ;#tQ;#n;#tZ;#t0;#t1;static #t2=null;static{this._l10n=null}constructor(c){this.#o=null,this.#tW=!1,this.#tq=null,this.#tX=null,this.#tY=null,this.#tK=null,this.#tJ=!1,this.#tQ=null,this.#n=null,this.#tZ=null,this.#t0=null,this.#t1=!1,this.#n=c,this.#t1=c._uiManager.useNewAltTextFlow,Ae.#t2||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(c){Ae._l10n??=c}async render(){let c=this.#tq=document.createElement("button");c.className="altText",c.tabIndex="0";let A=this.#tX=document.createElement("span");c.append(A),this.#t1?(c.classList.add("new"),c.setAttribute("data-l10n-id",Ae.#t2.missing),A.setAttribute("data-l10n-id",Ae.#t2["missing-label"])):(c.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),A.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let E=this.#n._uiManager._signal;c.addEventListener("contextmenu",qt,{signal:E}),c.addEventListener("pointerdown",c=>c.stopPropagation(),{signal:E});let s=c=>{c.preventDefault(),this.#n._uiManager.editAltText(this.#n),this.#t1&&this.#n._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#t5}})};return c.addEventListener("click",s,{capture:!0,signal:E}),c.addEventListener("keydown",A=>{A.target===c&&"Enter"===A.key&&(this.#tJ=!0,s(A))},{signal:E}),await this.#t4(),c}get #t5(){return(this.#o?"added":null===this.#o&&this.guessedText&&"review")||"missing"}finish(){this.#tq&&(this.#tq.focus({focusVisible:this.#tJ}),this.#tJ=!1)}isEmpty(){return this.#t1?null===this.#o:!this.#o&&!this.#tW}hasData(){return this.#t1?null!==this.#o||!!this.#tZ:this.isEmpty()}get guessedText(){return this.#tZ}async setGuessedText(c){null===this.#o&&(this.#tZ=c,this.#t0=await Ae._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:c}),this.#t4())}toggleAltTextBadge(c=!1){if(!this.#t1||this.#o)return this.#tQ?.remove(),void(this.#tQ=null);if(!this.#tQ){let c=this.#tQ=document.createElement("div");c.className="noAltTextBadge",this.#n.div.append(c)}this.#tQ.classList.toggle("hidden",!c)}serialize(c){let A=this.#o;return c||this.#tZ!==A||(A=this.#t0),{altText:A,decorative:this.#tW,guessedText:this.#tZ,textWithDisclaimer:this.#t0}}get data(){return{altText:this.#o,decorative:this.#tW}}set data({altText:c,decorative:A,guessedText:E,textWithDisclaimer:C,cancel:T=!1}){E&&(this.#tZ=E,this.#t0=C),this.#o===c&&this.#tW===A||(T||(this.#o=c,this.#tW=A),this.#t4())}toggle(c=!1){this.#tq&&(!c&&this.#tK&&(clearTimeout(this.#tK),this.#tK=null),this.#tq.disabled=!c)}shown(){this.#n._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#t5}})}destroy(){this.#tq?.remove(),this.#tq=null,this.#tX=null,this.#tY=null,this.#tQ?.remove(),this.#tQ=null}async #t4(){let c=this.#tq;if(!c)return;if(this.#t1){if(c.classList.toggle("done",!!this.#o),c.setAttribute("data-l10n-id",Ae.#t2[this.#t5]),this.#tX?.setAttribute("data-l10n-id",Ae.#t2[`${this.#t5}-label`]),!this.#o)return void this.#tY?.remove()}else{if(!this.#o&&!this.#tW)return c.classList.remove("done"),void this.#tY?.remove();c.classList.add("done"),c.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let A=this.#tY;if(!A){this.#tY=A=document.createElement("span"),A.className="tooltip",A.setAttribute("role","tooltip"),A.id=`alt-text-tooltip-${this.#n.id}`;let E=this.#n._uiManager._signal;E.addEventListener("abort",()=>{clearTimeout(this.#tK),this.#tK=null},{once:!0}),c.addEventListener("mouseenter",()=>{this.#tK=setTimeout(()=>{this.#tK=null,this.#tY.classList.add("show"),this.#n._reportTelemetry({action:"alt_text_tooltip"})},100)},{signal:E}),c.addEventListener("mouseleave",()=>{this.#tK&&(clearTimeout(this.#tK),this.#tK=null),this.#tY?.classList.remove("show")},{signal:E})}this.#tW?A.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(A.removeAttribute("data-l10n-id"),A.textContent=this.#o),A.parentNode||c.append(A);let E=this.#n.getElementForAltText();E?.setAttribute("aria-describedby",A.id)}};let _e=class _e{#t3;#t6;#t9;#n;#t8;#t7;#et;#ee;#ei;#es;constructor(c){this.#t3=null,this.#t6=null,this.#t9=!1,this.#n=null,this.#t8=null,this.#t7=null,this.#et=null,this.#ee=null,this.#ei=!1,this.#es=null,this.#n=c}renderForToolbar(){let c=this.#t6=document.createElement("button");return c.className="comment",this.#v(c,!1)}renderForStandalone(){let c=this.#t3=document.createElement("button");c.className="annotationCommentButton";let A=this.#n.commentButtonPosition;if(A){let{style:E}=c;E.insetInlineEnd=`calc(${100*("ltr"===this.#n._uiManager.direction?1-A[0]:A[0])}% - var(--comment-button-dim))`,E.top=`calc(${100*A[1]}% - var(--comment-button-dim))`;let C=this.#n.commentButtonColor;C&&(E.backgroundColor=C)}return this.#v(c,!0)}focusButton(){setTimeout(()=>{(this.#t3??this.#t6)?.focus()},0)}onUpdatedColor(){if(!this.#t3)return;let c=this.#n.commentButtonColor;c&&(this.#t3.style.backgroundColor=c),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#t3?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#es)return this.#es;if(!this.#t3)return null;let{x:c,y:A,height:E}=this.#t3.getBoundingClientRect(),{x:C,y:T,width:M,height:k}=this.#n.parent.boundingClientRect;return[(c-C)/M,(A+E-T)/k]}set commentPopupPositionInLayer(c){this.#es=c}hasDefaultPopupPosition(){return null===this.#es}removeStandaloneCommentButton(){this.#t3?.remove(),this.#t3=null}removeToolbarCommentButton(){this.#t6?.remove(),this.#t6=null}setCommentButtonStates({selected:c,hasPopup:A}){this.#t3&&(this.#t3.classList.toggle("selected",c),this.#t3.ariaExpanded=A)}#v(c,A){if(!this.#n._uiManager.hasCommentManager())return null;c.tabIndex="0",c.ariaHasPopup="dialog",A?(c.ariaControls="commentPopup",c.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(c.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],c.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));let E=this.#n._uiManager._signal;if(!(E instanceof AbortSignal)||E.aborted)return c;c.addEventListener("contextmenu",qt,{signal:E}),A&&(c.addEventListener("focusin",c=>{this.#n._focusEventsAllowed=!1,Xt(c)},{capture:!0,signal:E}),c.addEventListener("focusout",c=>{this.#n._focusEventsAllowed=!0,Xt(c)},{capture:!0,signal:E})),c.addEventListener("pointerdown",c=>c.stopPropagation(),{signal:E});let s=A=>{A.preventDefault(),c===this.#t6?this.edit():this.#n.toggleComment(!0)};return c.addEventListener("click",s,{capture:!0,signal:E}),c.addEventListener("keydown",A=>{A.target===c&&"Enter"===A.key&&(this.#t9=!0,s(A))},{signal:E}),c.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:E}),c.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:E}),c}edit(c){let A,E;let C=this.commentPopupPositionInLayer;if(C)[A,E]=C;else{[A,E]=this.#n.commentButtonPosition;let{width:c,height:C,x:T,y:M}=this.#n;A=T+A*c,E=M+E*C}let T=this.#n.parent.boundingClientRect,{x:M,y:k,width:I,height:N}=T;this.#n._uiManager.editComment(this.#n,M+A*I,k+E*N,{...c,parentDimensions:T})}finish(){this.#t6&&(this.#t6.focus({focusVisible:this.#t9}),this.#t9=!1)}isDeleted(){return this.#ei||""===this.#et}isEmpty(){return null===this.#et}hasBeenEdited(){return this.isDeleted()||this.#et!==this.#t8}serialize(){return this.data}get data(){return{text:this.#et,richText:this.#t7,date:this.#ee,deleted:this.isDeleted()}}set data(c){if(c!==this.#et&&(this.#t7=null),null===c)return this.#et="",void(this.#ei=!0);this.#et=c,this.#ee=new Date,this.#ei=!1}setInitialText(c,A=null){this.#t8=c,this.data=c,this.#ee=null,this.#t7=A}shown(){}destroy(){this.#t6?.remove(),this.#t6=null,this.#t3?.remove(),this.#t3=null,this.#et="",this.#t7=null,this.#ee=null,this.#n=null,this.#t9=!1,this.#ei=!1}};let Se=class Se{#tA;#er;#en;#ea;#eo;#el;#eh;#ed;#ec;#eu;#ep;#eg;constructor({container:c,isPinchingDisabled:A=null,isPinchingStopped:E=null,onPinchStart:C=null,onPinching:T=null,onPinchEnd:M=null,signal:k}){this.#er=!1,this.#en=null,this.#ed=null,this.#eu=null,this.#eg=null,this.#tA=c,this.#en=E,this.#ea=A,this.#eo=C,this.#el=T,this.#eh=M,this.#ep=new AbortController,this.#ec=AbortSignal.any([k,this.#ep.signal]),c.addEventListener("touchstart",this.#ef.bind(this),{passive:!1,signal:this.#ec})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ee.pixelRatio}#ef(c){if(this.#ea?.())return;if(1===c.touches.length){if(this.#ed)return;let c=this.#ed=new AbortController,A=AbortSignal.any([this.#ec,c.signal]),E=this.#tA,C={capture:!0,signal:A,passive:!1},n=c=>{"touch"===c.pointerType&&(this.#ed?.abort(),this.#ed=null)};return E.addEventListener("pointerdown",c=>{"touch"===c.pointerType&&(Xt(c),n(c))},C),E.addEventListener("pointerup",n,C),void E.addEventListener("pointercancel",n,C)}if(!this.#eg){this.#eg=new AbortController;let c=AbortSignal.any([this.#ec,this.#eg.signal]),A=this.#tA,E={signal:c,capture:!1,passive:!1};A.addEventListener("touchmove",this.#em.bind(this),E);let C=this.#eb.bind(this);A.addEventListener("touchend",C,E),A.addEventListener("touchcancel",C,E),E.capture=!0,A.addEventListener("pointerdown",Xt,E),A.addEventListener("pointermove",Xt,E),A.addEventListener("pointercancel",Xt,E),A.addEventListener("pointerup",Xt,E),this.#eo?.()}if(Xt(c),2!==c.touches.length||this.#en?.())return void(this.#eu=null);let[A,E]=c.touches;A.identifier>E.identifier&&([A,E]=[E,A]),this.#eu={touch0X:A.screenX,touch0Y:A.screenY,touch1X:E.screenX,touch1Y:E.screenY}}#em(c){if(!this.#eu||2!==c.touches.length)return;Xt(c);let[A,E]=c.touches;A.identifier>E.identifier&&([A,E]=[E,A]);let{screenX:C,screenY:T}=A,{screenX:M,screenY:k}=E,I=this.#eu,{touch0X:N,touch0Y:O,touch1X:U,touch1Y:j}=I,$=M-C,V=k-T,G=Math.hypot($,V)||1,W=Math.hypot(U-N,j-O)||1;if(!this.#er&&Math.abs(W-G)<=Se.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(I.touch0X=C,I.touch0Y=T,I.touch1X=M,I.touch1Y=k,!this.#er)return void(this.#er=!0);let q=[(C+M)/2,(T+k)/2];this.#el?.(q,W,G)}#eb(c){c.touches.length>=2||(this.#eg&&(this.#eg.abort(),this.#eg=null,this.#eh?.()),this.#eu&&(Xt(c),this.#eu=null,this.#er=!1))}destroy(){this.#ep?.abort(),this.#ep=null,this.#ed?.abort(),this.#ed=null}};let Ee=class Ee{#ev;#ey;#o;#l;#t3;#ew;#eA;#e_;#ex;#eE;#eS;#eC;#eT;#eM;#ek;#eP;#eR;#eD;#eI;#eL;#eF;#eN;#eO;#eB;static{this._l10n=null}static{this._l10nResizer=null}#eU;#ez;static{this._borderLineWidth=-1}static{this._colorManager=new we}static{this._zIndex=1}static{this._telemetryTimeout=1e3}static get _resizerKeyboardManager(){let c=Ee.prototype._resizeWithKeyboard,A=xe.TRANSLATE_SMALL,E=xe.TRANSLATE_BIG;return gt(this,"_resizerKeyboardManager",new ye([[["ArrowLeft","mac+ArrowLeft"],c,{args:[-A,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],c,{args:[-E,0]}],[["ArrowRight","mac+ArrowRight"],c,{args:[A,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],c,{args:[E,0]}],[["ArrowUp","mac+ArrowUp"],c,{args:[0,-A]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],c,{args:[0,-E]}],[["ArrowDown","mac+ArrowDown"],c,{args:[0,A]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],c,{args:[0,E]}],[["Escape","mac+Escape"],Ee.prototype._stopResizingWithKeyboard]]))}constructor(c){this.#ev=null,this.#ey=null,this.#o=null,this.#l=null,this.#t3=null,this.#ew=!1,this.#eA=null,this.#e_="",this.#ex=null,this.#eE=null,this.#eS=null,this.#eC=null,this.#eT=null,this.#eM="",this.#ek=!1,this.#eP=null,this.#eR=!1,this.#eD=!1,this.#eI=!1,this.#eL=null,this.#eF=0,this.#eN=0,this.#eO=null,this.#eB=null,this.isSelected=!1,this._isCopy=!1,this._editToolbar=null,this._initialOptions=Object.create(null),this._initialData=null,this._isVisible=!0,this._uiManager=null,this._focusEventsAllowed=!0,this.#eU=!1,this.#ez=Ee._zIndex++,this.parent=c.parent,this.id=c.id,this.width=this.height=null,this.pageIndex=c.parent.pageIndex,this.name=c.name,this.div=null,this._uiManager=c.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=c.isCentered,this._structTreeParentId=null,this.annotationElementId=c.annotationElementId||null,this.creationDate=c.creationDate||new Date,this.modificationDate=c.modificationDate||null;let{rotation:A,rawDims:{pageWidth:E,pageHeight:C,pageX:T,pageY:M}}=this.parent.viewport;this.rotation=A,this.pageRotation=(360+A-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[E,C],this.pageTranslation=[T,M];let[k,I]=this.parentDimensions;this.x=c.x/k,this.y=c.y/I,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return gt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(c){let A=new Ce({id:c.parent.getNextId(),parent:c.parent,uiManager:c._uiManager});A.annotationElementId=c.annotationElementId,A.deleted=!0,A._uiManager.addToAnnotationStorage(A)}static initialize(c,A){if(Ee._l10n??=c,Ee._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==Ee._borderLineWidth)return;let E=getComputedStyle(document.documentElement);Ee._borderLineWidth=parseFloat(E.getPropertyValue("--outline-width"))||0}static updateDefaultParams(c,A){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(c){return!1}static paste(c,A){ct("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#eU}set _isDraggable(c){this.#eU=c,this.div?.classList.toggle("draggable",c)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){let[c,A]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*A/(2*c),this.y+=this.width*c/(2*A);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*A/(2*c),this.y-=this.width*c/(2*A);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(c){this._uiManager.addCommands(c)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#ez}setParent(c){null!==c?(this.pageIndex=c.pageIndex,this.pageDimensions=c.pageDimensions):(this.#ej(),this.#eC?.remove(),this.#eC=null),this.parent=c}focusin(c){this._focusEventsAllowed&&(this.#ek?this.#ek=!1:this.parent.setSelected(this))}focusout(c){if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let A=c.relatedTarget;A?.closest(`#${this.id}`)||(c.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(c,A,E,C){let[T,M]=this.parentDimensions;[E,C]=this.screenToPageTranslation(E,C),this.x=(c+E)/T,this.y=(A+C)/M,this.fixAndSetPosition()}_moveAfterPaste(c,A){let[E,C]=this.parentDimensions;this.setAt(c*E,A*C,this.width*E,this.height*C),this._onTranslated()}#eH([c,A],E,C){[E,C]=this.screenToPageTranslation(E,C),this.x+=E/c,this.y+=C/A,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(c,A){this.#eH(this.parentDimensions,c,A)}translateInPage(c,A){this.#eP||=[this.x,this.y,this.width,this.height],this.#eH(this.pageDimensions,c,A),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(c,A){this.#eP||=[this.x,this.y,this.width,this.height];let{div:E,parentDimensions:[C,T]}=this;if(this.x+=c/C,this.y+=A/T,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:c,y:A}=this.div.getBoundingClientRect();this.parent.findNewParent(this,c,A)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:M,y:k}=this,[I,N]=this.getBaseTranslation();M+=I,k+=N;let{style:O}=E;O.left=`${(100*M).toFixed(2)}%`,O.top=`${(100*k).toFixed(2)}%`,this._onTranslating(M,k),E.scrollIntoView({block:"nearest"})}_onTranslating(c,A){}_onTranslated(c,A){}get _hasBeenMoved(){return!!this.#eP&&(this.#eP[0]!==this.x||this.#eP[1]!==this.y)}get _hasBeenResized(){return!!this.#eP&&(this.#eP[2]!==this.width||this.#eP[3]!==this.height)}getBaseTranslation(){let[c,A]=this.parentDimensions,{_borderLineWidth:E}=Ee,C=E/c,T=E/A;switch(this.rotation){case 90:return[-C,T];case 180:return[C,T];case 270:return[C,-T];default:return[-C,-T]}}get _mustFixPosition(){return!0}fixAndSetPosition(c=this.rotation){let{div:{style:A},pageDimensions:[E,C]}=this,{x:T,y:M,width:k,height:I}=this;if(k*=E,I*=C,T*=E,M*=C,this._mustFixPosition)switch(c){case 0:T=It(T,0,E-k),M=It(M,0,C-I);break;case 90:T=It(T,0,E-I),M=It(M,k,C);break;case 180:T=It(T,k,E),M=It(M,I,C);break;case 270:T=It(T,I,E),M=It(M,0,C-k)}this.x=T/=E,this.y=M/=C;let[N,O]=this.getBaseTranslation();T+=N,M+=O,A.left=`${(100*T).toFixed(2)}%`,A.top=`${(100*M).toFixed(2)}%`,this.moveInDOM()}static #e$(c,A,E){switch(E){case 90:return[A,-c];case 180:return[-c,-A];case 270:return[-A,c];default:return[c,A]}}screenToPageTranslation(c,A){return Ee.#e$(c,A,this.parentRotation)}pageTranslationToScreen(c,A){return Ee.#e$(c,A,360-this.parentRotation)}#eV(c){switch(c){case 90:{let[c,A]=this.pageDimensions;return[0,-c/A,A/c,0]}case 180:return[-1,0,0,-1];case 270:{let[c,A]=this.pageDimensions;return[0,c/A,-A/c,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:c,pageDimensions:[A,E]}=this;return[A*c,E*c]}setDims(){let{div:{style:c},width:A,height:E}=this;c.width=`${(100*A).toFixed(2)}%`,c.height=`${(100*E).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#eG(){if(this.#ex)return;this.#ex=document.createElement("div"),this.#ex.classList.add("resizers");let c=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],A=this._uiManager._signal;for(let E of c){let c=document.createElement("div");this.#ex.append(c),c.classList.add("resizer",E),c.setAttribute("data-resizer-name",E),c.addEventListener("pointerdown",this.#eW.bind(this,E),{signal:A}),c.addEventListener("contextmenu",qt,{signal:A}),c.tabIndex=-1}this.div.prepend(this.#ex)}#eW(c,A){A.preventDefault();let{isMac:E}=St.platform;if(0!==A.button||A.ctrlKey&&E)return;this.#o?.toggle(!1);let C=this._isDraggable;this._isDraggable=!1,this.#eE=[A.screenX,A.screenY];let T=new AbortController,M=this._uiManager.combinedSignal(T);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#eq.bind(this,c),{passive:!0,capture:!0,signal:M}),window.addEventListener("touchmove",Xt,{passive:!1,signal:M}),window.addEventListener("contextmenu",qt,{signal:M}),this.#eS={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let k=this.parent.div.style.cursor,I=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(A.target).cursor;let l=()=>{T.abort(),this.parent.togglePointerEvents(!0),this.#o?.toggle(!0),this._isDraggable=C,this.parent.div.style.cursor=k,this.div.style.cursor=I,this.#eX()};window.addEventListener("pointerup",l,{signal:M}),window.addEventListener("blur",l,{signal:M})}#eY(c,A,E,C){this.width=E,this.height=C,this.x=c,this.y=A,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#eX(){if(!this.#eS)return;let{savedX:c,savedY:A,savedWidth:E,savedHeight:C}=this.#eS;this.#eS=null;let T=this.x,M=this.y,k=this.width,I=this.height;T===c&&M===A&&k===E&&I===C||this.addCommands({cmd:this.#eY.bind(this,T,M,k,I),undo:this.#eY.bind(this,c,A,E,C),mustExec:!0})}static _round(c){return Math.round(1e4*c)/1e4}#eq(c,A){var E,C;let[T,M]=this.parentDimensions,k=this.x,I=this.y,N=this.width,O=this.height,U=Ee.MIN_SIZE/T,j=Ee.MIN_SIZE/M,$=this.#eV(this.rotation),d=(c,A)=>[$[0]*c+$[2]*A,$[1]*c+$[3]*A],V=this.#eV(360-this.rotation),G,W,q=!1,X=!1;switch(c){case"topLeft":q=!0,G=(c,A)=>[0,0],W=(c,A)=>[c,A];break;case"topMiddle":G=(c,A)=>[c/2,0],W=(c,A)=>[c/2,A];break;case"topRight":q=!0,G=(c,A)=>[c,0],W=(c,A)=>[0,A];break;case"middleRight":X=!0,G=(c,A)=>[c,A/2],W=(c,A)=>[0,A/2];break;case"bottomRight":q=!0,G=(c,A)=>[c,A],W=(c,A)=>[0,0];break;case"bottomMiddle":G=(c,A)=>[c/2,A],W=(c,A)=>[c/2,0];break;case"bottomLeft":q=!0,G=(c,A)=>[0,A],W=(c,A)=>[c,0];break;case"middleLeft":X=!0,G=(c,A)=>[0,A/2],W=(c,A)=>[c,A/2]}let Y=G(N,O),K=W(N,O),J=d(...K),Q=Ee._round(k+J[0]),Z=Ee._round(I+J[1]),tt,ta,to=1,tl=1;if(A.fromKeyboard)({deltaX:tt,deltaY:ta}=A);else{let{screenX:c,screenY:E}=A,[C,T]=this.#eE;[tt,ta]=this.screenToPageTranslation(c-C,E-T),this.#eE[0]=c,this.#eE[1]=E}if([tt,ta]=(E=tt/T,C=ta/M,[V[0]*E+V[2]*C,V[1]*E+V[3]*C]),q){let c=Math.hypot(N,O);to=tl=Math.max(Math.min(Math.hypot(K[0]-Y[0]-tt,K[1]-Y[1]-ta)/c,1/N,1/O),U/N,j/O)}else X?to=It(Math.abs(K[0]-Y[0]-tt),U,1)/N:tl=It(Math.abs(K[1]-Y[1]-ta),j,1)/O;let th=Ee._round(N*to),td=Ee._round(O*tl);J=d(...W(th,td));let tc=Q-J[0],tu=Z-J[1];this.#eP||=[this.x,this.y,this.width,this.height],this.width=th,this.height=td,this.x=tc,this.y=tu,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#o?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#eD)return this._editToolbar;this._editToolbar=new pe(this),this.div.append(this._editToolbar.render());let{toolbarButtons:c}=this;if(c)for(let[A,E]of c)await this._editToolbar.addButton(A,E);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#o?.destroy()}addContainer(c){let A=this._editToolbar?.div;A?A.before(c):this.div.append(c)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#o||(Ae.initialize(Ee._l10n),this.#o=new Ae(this),this.#ev&&(this.#o.data=this.#ev,this.#ev=null)),this.#o}get altTextData(){return this.#o?.data}set altTextData(c){this.#o&&(this.#o.data=c)}get guessedAltText(){return this.#o?.guessedText}async setGuessedAltText(c){await this.#o?.setGuessedText(c)}serializeAltText(c){return this.#o?.serialize(c)}hasAltText(){return!!this.#o&&!this.#o.isEmpty()}hasAltTextData(){return this.#o?.hasData()??!1}focusCommentButton(){this.#l?.focusButton()}addCommentButton(){return this.#l||=new _e(this)}addStandaloneCommentButton(){this.#t3?this._uiManager.isEditingMode()&&this.#t3.classList.remove("hidden"):this.hasComment&&(this.#t3=this.#l.renderForStandalone(),this.div.append(this.#t3))}removeStandaloneCommentButton(){this.#l.removeStandaloneCommentButton(),this.#t3=null}hideStandaloneCommentButton(){this.#t3?.classList.add("hidden")}get comment(){let{data:{richText:c,text:A,date:E,deleted:C}}=this.#l;return{text:A,richText:c,date:E,deleted:C,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(c){this.#l||=new _e(this),this.#l.data=c,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:c,popupRef:A,richText:E}){if(!A||(this.#l||=new _e(this),this.#l.setInitialText(c,E),!this.annotationElementId))return;let C=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);C&&this.updateFromAnnotationLayer(C)}get hasEditedComment(){return this.#l?.hasBeenEdited()}get hasDeletedComment(){return this.#l?.isDeleted()}get hasComment(){return!!this.#l&&!this.#l.isEmpty()&&!this.#l.isDeleted()}async editComment(c){this.#l||=new _e(this),this.#l.edit(c)}toggleComment(c,A){this.hasComment&&this._uiManager.toggleComment(this,c,A)}setSelectedCommentButton(c){this.#l.setSelectedButton(c)}addComment(c){if(this.hasEditedComment){let[,,,A]=c.rect,[E]=this.pageDimensions,[C]=this.pageTranslation,T=C+E+1;c.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[T,A-100,T+180,A]}}}updateFromAnnotationLayer({popup:{contents:c,deleted:A}}){this.#l.data=A?null:c}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){let c=this.div=document.createElement("div");c.setAttribute("data-editor-rotation",(360-this.rotation)%360),c.className=this.name,c.setAttribute("id",this.id),c.tabIndex=this.#ew?-1:0,c.setAttribute("role","application"),this.defaultL10nId&&c.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||c.classList.add("hidden"),this.setInForeground(),this.#eK();let[A,E]=this.parentDimensions;this.parentRotation%180!=0&&(c.style.maxWidth=`${(100*E/A).toFixed(2)}%`,c.style.maxHeight=`${(100*A/E).toFixed(2)}%`);let[C,T]=this.getInitialTranslation();return this.translate(C,T),me(this,c,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#eB||=new Se({container:c,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#eJ.bind(this),onPinching:this.#eQ.bind(this),onPinchEnd:this.#eZ.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),c}#eJ(){this.#eS={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#o?.toggle(!1),this.parent.togglePointerEvents(!1)}#eQ(c,A,E){let C=E/A*.7+1-.7;if(1===C)return;let T=this.#eV(this.rotation),r=(c,A)=>[T[0]*c+T[2]*A,T[1]*c+T[3]*A],[M,k]=this.parentDimensions,I=this.x,N=this.y,O=this.width,U=this.height,j=Ee.MIN_SIZE/M,$=Ee.MIN_SIZE/k;C=Math.max(Math.min(C,1/O,1/U),j/O,$/U);let V=Ee._round(O*C),G=Ee._round(U*C);if(V===O&&G===U)return;this.#eP||=[I,N,O,U];let W=r(O/2,U/2),q=Ee._round(I+W[0]),X=Ee._round(N+W[1]),Y=r(V/2,G/2);this.x=q-Y[0],this.y=X-Y[1],this.width=V,this.height=G,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#eZ(){this.#o?.toggle(!0),this.parent.togglePointerEvents(!0),this.#eX()}pointerdown(c){let{isMac:A}=St.platform;0!==c.button||c.ctrlKey&&A?c.preventDefault():(this.#ek=!0,this._isDraggable?this.#e0(c):this.#e1(c))}#e1(c){let{isMac:A}=St.platform;c.ctrlKey&&!A||c.shiftKey||c.metaKey&&A?this.parent.toggleSelected(this):this.parent.setSelected(this)}#e0(c){let{isSelected:A}=this;this._uiManager.setUpDragSession();let E=!1,C=new AbortController,T=this._uiManager.combinedSignal(C),M={capture:!0,passive:!1,signal:T},a=c=>{C.abort(),this.#eA=null,this.#ek=!1,this._uiManager.endDragSession()||this.#e1(c),E&&this._onStopDragging()};A&&(this.#eF=c.clientX,this.#eN=c.clientY,this.#eA=c.pointerId,this.#e_=c.pointerType,window.addEventListener("pointermove",c=>{E||(E=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());let{clientX:A,clientY:C,pointerId:T}=c;if(T!==this.#eA)return void Xt(c);let[M,k]=this.screenToPageTranslation(A-this.#eF,C-this.#eN);this.#eF=A,this.#eN=C,this._uiManager.dragSelectedEditors(M,k)},M),window.addEventListener("touchmove",Xt,M),window.addEventListener("pointerdown",c=>{c.pointerType===this.#e_&&(this.#eB||c.isPrimary)&&a(c),Xt(c)},M));let o=c=>{this.#eA&&this.#eA!==c.pointerId?Xt(c):a(c)};window.addEventListener("pointerup",o,{signal:T}),window.addEventListener("blur",o,{signal:T})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#eL&&clearTimeout(this.#eL),this.#eL=setTimeout(()=>{this.#eL=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(c,A,E){c.changeParent(this),this.x=A,this.y=E,this.fixAndSetPosition(),this._onTranslated()}getRect(c,A,E=this.rotation){let C=this.parentScale,[T,M]=this.pageDimensions,[k,I]=this.pageTranslation,N=c/C,O=A/C,U=this.x*T,j=this.y*M,$=this.width*T,V=this.height*M;switch(E){case 0:return[U+N+k,M-j-O-V+I,U+N+$+k,M-j-O+I];case 90:return[U+O+k,M-j+N+I,U+O+V+k,M-j+N+$+I];case 180:return[U-N-$+k,M-j+O+I,U-N+k,M-j+O+V+I];case 270:return[U-O-V+k,M-j-N-$+I,U-O+k,M-j-N+I];default:throw Error("Invalid rotation")}}getRectInCurrentCoords(c,A){let[E,C,T,M]=c,k=T-E,I=M-C;switch(this.rotation){case 0:return[E,A-M,k,I];case 90:return[E,A-C,I,k];case 180:return[T,A-C,k,I];case 270:return[T,A-M,I,k];default:throw Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Ee._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#l?.onUpdatedColor()}getData(){let{comment:{text:c,color:A,date:E,opacity:C,deleted:T,richText:M},uid:k,pageIndex:I,creationDate:N,modificationDate:O}=this;return{id:k,pageIndex:I,rect:this.getPDFRect(),richText:M,contentsObj:{str:c},creationDate:N,modificationDate:E||O,popupRef:!T,color:A,opacity:C}}onceAdded(c){}isEmpty(){return!1}enableEditMode(){return!this.isInEditMode()&&(this.parent.setEditingState(!1),this.#eD=!0,!0)}disableEditMode(){return!!this.isInEditMode()&&(this.parent.setEditingState(!0),this.#eD=!1,!0)}isInEditMode(){return this.#eD}shouldGetKeyboardEvents(){return this.#eI}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:c,left:A,bottom:E,right:C}=this.getClientDimensions(),{innerHeight:T,innerWidth:M}=window;return A<M&&C>0&&c<T&&E>0}#eK(){if(this.#eT||!this.div)return;this.#eT=new AbortController;let c=this._uiManager.combinedSignal(this.#eT);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:c}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:c})}rebuild(){this.#eK()}rotate(c){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(c=!1,A=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(c,A,E){let C=new this.prototype.constructor({parent:A,id:A.getNextId(),uiManager:E,annotationElementId:c.annotationElementId,creationDate:c.creationDate,modificationDate:c.modificationDate});C.rotation=c.rotation,C.#ev=c.accessibilityData,C._isCopy=c.isCopy||!1;let[T,M]=C.pageDimensions,[k,I,N,O]=C.getRectInCurrentCoords(c.rect,M);return C.x=k/T,C.y=I/M,C.width=N/T,C.height=O/M,C}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#eT?.abort(),this.#eT=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#eL&&(clearTimeout(this.#eL),this.#eL=null),this.#ej(),this.removeEditToolbar(),this.#eO){for(let c of this.#eO.values())clearTimeout(c);this.#eO=null}this.parent=null,this.#eB?.destroy(),this.#eB=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#eG(),this.#ex.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return"ltr"===this._uiManager.direction?[1,0]:[0,0]}get commentButtonPositionInPage(){let{commentButtonPosition:[c,A]}=this,[E,C,T,M]=this.getPDFRect();return[Ee._round(E+(T-E)*c),Ee._round(C+(M-C)*(1-A))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#l.commentPopupPositionInLayer}set commentPopupPosition(c){this.#l.commentPopupPositionInLayer=c}hasDefaultPopupPosition(){return this.#l.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#l.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(c){this.#l.setCommentButtonStates(c)}keydown(c){if(!this.isResizable||c.target!==this.div||"Enter"!==c.key)return;this._uiManager.setSelected(this),this.#eS={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let A=this.#ex.children;if(!this.#ey){this.#ey=Array.from(A);let c=this.#e2.bind(this),E=this.#e5.bind(this),C=this._uiManager._signal;for(let A of this.#ey){let T=A.getAttribute("data-resizer-name");A.setAttribute("role","spinbutton"),A.addEventListener("keydown",c,{signal:C}),A.addEventListener("blur",E,{signal:C}),A.addEventListener("focus",this.#e4.bind(this,T),{signal:C}),A.setAttribute("data-l10n-id",Ee._l10nResizer[T])}}let E=this.#ey[0],C=0;for(let c of A){if(c===E)break;C++}let T=(360-this.rotation+this.parentRotation)%360/90*(this.#ey.length/4);if(T!==C){if(T<C)for(let c=0;c<C-T;c++)this.#ex.append(this.#ex.firstChild);else if(T>C)for(let c=0;c<T-C;c++)this.#ex.firstChild.before(this.#ex.lastChild);let c=0;for(let E of A){let A=this.#ey[c++].getAttribute("data-resizer-name");E.setAttribute("data-l10n-id",Ee._l10nResizer[A])}}this.#e3(0),this.#eI=!0,this.#ex.firstChild.focus({focusVisible:!0}),c.preventDefault(),c.stopImmediatePropagation()}#e2(c){Ee._resizerKeyboardManager.exec(this,c)}#e5(c){this.#eI&&c.relatedTarget?.parentNode!==this.#ex&&this.#ej()}#e4(c){this.#eM=this.#eI?c:""}#e3(c){if(this.#ey)for(let A of this.#ey)A.tabIndex=c}_resizeWithKeyboard(c,A){this.#eI&&this.#eq(this.#eM,{deltaX:c,deltaY:A,fromKeyboard:!0})}#ej(){this.#eI=!1,this.#e3(-1),this.#eX()}_stopResizingWithKeyboard(){this.#ej(),this.div.focus()}select(){this.isSelected&&this._editToolbar?this._editToolbar.show():(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#o?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()}))}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#ex?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#o?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(c,A){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(c){"BUTTON"!==c.target.nodeName&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#eR}set isEditing(c){this.#eR=c,this.parent&&(c?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(c,A=!1){if(A){this.#eO||=new Map;let{action:A}=c,E=this.#eO.get(A);return E&&clearTimeout(E),E=setTimeout(()=>{this._reportTelemetry(c),this.#eO.delete(A),0===this.#eO.size&&(this.#eO=null)},Ee._telemetryTimeout),void this.#eO.set(A,E)}c.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:c}})}show(c=this._isVisible){this.div.classList.toggle("hidden",!c),this._isVisible=c}enable(){this.div&&(this.div.tabIndex=0),this.#ew=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#ew=!0}updateFakeAnnotationElement(c){if(this.#eC||this.deleted)return this.deleted?(this.#eC.remove(),void(this.#eC=null)):void((this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#eC.updateEdited({rect:this.getPDFRect(),popup:this.comment}));this.#eC=c.addFakeAnnotation(this)}renderAnnotationElement(c){if(this.deleted)return c.hide(),null;let A=c.container.querySelector(".annotationContent");if(A){if("CANVAS"===A.nodeName){let c=A;(A=document.createElement("div")).classList.add("annotationContent",this.editorType),c.before(A)}}else(A=document.createElement("div")).classList.add("annotationContent",this.editorType),c.container.prepend(A);return A}resetAnnotationElement(c){let{firstChild:A}=c.container;"DIV"===A?.nodeName&&A.classList.contains("annotationContent")&&A.remove()}};let Ce=class Ce extends Ee{constructor(c){super(c),this.annotationElementId=c.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}};let Pe=class Pe{constructor(c){this.h1=c?4294967295&c:3285377520,this.h2=c?4294967295&c:3285377520}update(c){let A,E;if("string"==typeof c){A=new Uint8Array(2*c.length),E=0;for(let C=0,T=c.length;C<T;C++){let T=c.charCodeAt(C);T<=255?A[E++]=T:(A[E++]=T>>>8,A[E++]=255&T)}}else{if(!ArrayBuffer.isView(c))throw Error("Invalid data format, must be a string or TypedArray.");E=(A=c.slice()).byteLength}let C=E>>2,T=E-4*C,M=new Uint32Array(A.buffer,0,C),k=0,I=0,N=this.h1,O=this.h2;for(let c=0;c<C;c++)1&c?(N^=k=461845907*(k=(k=3432918353*(k=M[c])&4294901760|11601*k&65535)<<15|k>>>17)&4294901760|13715*k&65535,N=5*(N=N<<13|N>>>19)+3864292196):(O^=I=461845907*(I=(I=3432918353*(I=M[c])&4294901760|11601*I&65535)<<15|I>>>17)&4294901760|13715*I&65535,O=5*(O=O<<13|O>>>19)+3864292196);switch(k=0,T){case 3:k^=A[4*C+2]<<16;case 2:k^=A[4*C+1]<<8;case 1:k^=A[4*C],k=461845907*(k=(k=3432918353*k&4294901760|11601*k&65535)<<15|k>>>17)&4294901760|13715*k&65535,1&C?N^=k:O^=k}this.h1=N,this.h2=O}hexdigest(){let c=this.h1,A=this.h2;return c^=A>>>1,A=4283543511*A&4294901760|(2950163797*(A<<16|(c=3981806797*c&4294901760|36045*c&65535)>>>16)&4294901760)>>>16,c^=A>>>1,A=3301882366*A&4294901760|(3120437893*(A<<16|(c=444984403*c&4294901760|60499*c&65535)>>>16)&4294901760)>>>16,((c^=A>>>1)>>>0).toString(16).padStart(8,"0")+(A>>>0).toString(16).padStart(8,"0")}};let tR=Object.freeze({map:null,hash:"",transfer:void 0});let Ie=class Ie{#e6;#e9;#e8;#e7;constructor(){this.#e6=!1,this.#e9=null,this.#e8=null,this.#e7=new Map,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(c,A){let E=this.#e7.get(c);return void 0===E?A:Object.assign(A,E)}getRawValue(c){return this.#e7.get(c)}remove(c){let A=this.#e7.get(c);if(void 0!==A&&(A instanceof Ee&&this.#e8.delete(A.annotationElementId),this.#e7.delete(c),0===this.#e7.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor)){for(let c of this.#e7.values())if(c instanceof Ee)return;this.onAnnotationEditor(null)}}setValue(c,A){let E=this.#e7.get(c),C=!1;if(void 0!==E)for(let[c,T]of Object.entries(A))E[c]!==T&&(C=!0,E[c]=T);else C=!0,this.#e7.set(c,A);C&&this.#it(),A instanceof Ee&&((this.#e8||=new Map).set(A.annotationElementId,A),"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(A.constructor._type))}has(c){return this.#e7.has(c)}get size(){return this.#e7.size}#it(){this.#e6||(this.#e6=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#e6&&(this.#e6=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new Re(this)}get serializable(){if(0===this.#e7.size)return tR;let c=new Map,A=new Pe,E=[],C=Object.create(null),T=!1;for(let[E,M]of this.#e7){let k=M instanceof Ee?M.serialize(!1,C):M;k&&(c.set(E,k),A.update(`${E}:${JSON.stringify(k)}`),T||=!!k.bitmap)}if(T)for(let A of c.values())A.bitmap&&E.push(A.bitmap);return c.size>0?{map:c,hash:A.hexdigest(),transfer:E}:tR}get editorStats(){let c=null,A=new Map,E=0,C=0;for(let T of this.#e7.values()){if(!(T instanceof Ee)){T.popup&&(T.popup.deleted?C+=1:E+=1);continue}T.isCommentDeleted?C+=1:T.hasEditedComment&&(E+=1);let M=T.telemetryFinalData;if(!M)continue;let{type:k}=M;A.has(k)||A.set(k,Object.getPrototypeOf(T).constructor),c||=Object.create(null);let I=c[k]||=new Map;for(let[c,A]of Object.entries(M)){if("type"===c)continue;let E=I.get(c);E||(E=new Map,I.set(c,E));let C=E.get(A)??0;E.set(A,C+1)}}if((C>0||E>0)&&((c||=Object.create(null)).comments={deleted:C,edited:E}),!c)return null;for(let[E,C]of A)c[E]=C.computeTelemetryFinalData(c[E]);return c}resetModifiedIds(){this.#e9=null}updateEditor(c,A){let E=this.#e8?.get(c);return!!E&&(E.updateFromAnnotationLayer(A),!0)}getEditor(c){return this.#e8?.get(c)||null}get modifiedIds(){if(this.#e9)return this.#e9;let c=[];if(this.#e8)for(let A of this.#e8.values())A.serialize()&&c.push(A.annotationElementId);return this.#e9={ids:new Set(c),hash:c.join(",")}}[Symbol.iterator](){return this.#e7.entries()}};let Re=class Re extends Ie{#ie;constructor(c){super();let{map:A,hash:E,transfer:C}=c.serializable,T=structuredClone(A,C?{transfer:C}:null);this.#ie={map:T,hash:E,transfer:C}}get print(){ct("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#ie}get modifiedIds(){return gt(this,"modifiedIds",{ids:new Set,hash:""})}};let Le=class Le{#ii;constructor({ownerDocument:c=globalThis.document,styleElement:A=null}){this.#ii=new Set,this._document=c,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(c){this.nativeFontFaces.add(c),this._document.fonts.add(c)}removeNativeFontFace(c){this.nativeFontFaces.delete(c),this._document.fonts.delete(c)}insertRule(c){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let A=this.styleElement.sheet;A.insertRule(c,A.cssRules.length)}clear(){for(let c of this.nativeFontFaces)this._document.fonts.delete(c);this.nativeFontFaces.clear(),this.#ii.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:c,disableFontFace:A,_inspectFont:E}){if(c&&!this.#ii.has(c.loadedName)){if(dt(!A,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:A,src:C,style:T}=c,M=new FontFace(A,C,T);this.addNativeFontFace(M);try{await M.load(),this.#ii.add(A),E?.(c)}catch{ht(`Cannot load system font: ${c.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(M)}return}ct("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(c){if(c.attached||c.missingFile&&!c.systemFontInfo)return;if(c.attached=!0,c.systemFontInfo)return void await this.loadSystemFont(c);if(this.isFontLoadingAPISupported){let A=c.createNativeFontFace();if(A){this.addNativeFontFace(A);try{await A.loaded}catch(E){throw ht(`Failed to load font '${A.family}': '${E}'.`),c.disableFontFace=!0,E}}return}let A=c.createFontFaceRule();if(A){if(this.insertRule(A),this.isSyncFontLoadingSupported)return;await new Promise(A=>{let E=this._queueLoadingCallback(A);this._prepareFontLoadEvent(c,E)})}}get isFontLoadingAPISupported(){return gt(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return gt(this,"isSyncFontLoadingSupported",Z||St.platform.isFirefox)}_queueLoadingCallback(c){let{loadingRequests:A}=this,E={done:!1,complete:function(){for(dt(!E.done,"completeRequest() cannot be called twice."),E.done=!0;A.length>0&&A[0].done;){let c=A.shift();setTimeout(c.callback,0)}},callback:c};return A.push(E),E}get _loadTestFont(){return gt(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(c,A){var E;let C,T;function i(c,A){return c.charCodeAt(A)<<24|c.charCodeAt(A+1)<<16|c.charCodeAt(A+2)<<8|255&c.charCodeAt(A+3)}function s(c,A,E,C){return c.substring(0,A)+C+c.substring(A+E)}let M=this._document.createElement("canvas");M.width=1,M.height=1;let k=M.getContext("2d"),I=0,N=`lt${Date.now()}${this.loadTestFontId++}`,O=this._loadTestFont,U=i(O=s(O,976,N.length,N),16);for(C=0,T=N.length-3;C<T;C+=4)U=U-1482184792+i(N,C)|0;C<N.length&&(U=U-1482184792+i(N+"XXX",C)|0),O=s(O,16,4,String.fromCharCode((E=U)>>24&255,E>>16&255,E>>8&255,255&E));let j=`@font-face {font-family:"${N}";src:url(data:font/opentype;base64,${btoa(O)});}`;this.insertRule(j);let $=this._document.createElement("div");for(let A of($.style.visibility="hidden",$.style.width=$.style.height="10px",$.style.position="absolute",$.style.top=$.style.left="0px",[c.loadedName,N])){let c=this._document.createElement("span");c.textContent="Hi",c.style.fontFamily=A,$.append(c)}this._document.body.append($),function t1(c,A){if(++I>30)return ht("Load test font never loaded."),void A();k.font="30px "+c,k.fillText(".",0,20),k.getImageData(0,0,1,1).data[3]>0?A():setTimeout(t1.bind(null,c,A))}(N,()=>{$.remove(),A.complete()})}};let Be=class Be{#is;constructor(c,A=null,E,C){this.compiledGlyphs=Object.create(null),this.#is=c,this._inspectFont=A,E&&Object.assign(this,E),C&&(this.charProcOperatorList=C)}createNativeFontFace(){let c;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){let A={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(A.style=`oblique ${this.cssFontInfo.italicAngle}deg`),c=new FontFace(this.cssFontInfo.fontFamily,this.data,A)}else c=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),c}createFontFaceRule(){let c;if(!this.data||this.disableFontFace)return null;let A=`url(data:${this.mimetype};base64,${Rt(this.data)});`;if(this.cssFontInfo){let E=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(E+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),c=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${E}src:${A}}`}else c=`@font-face {font-family:"${this.loadedName}";src:${A}}`;return this._inspectFont?.(this,A),c}getPathGenerator(c,A){let E;if(void 0!==this.compiledGlyphs[A])return this.compiledGlyphs[A];let C=this.loadedName+"_path_"+A;try{E=c.get(C)}catch(c){ht(`getPathGenerator - ignoring character: "${c}".`)}let T=new Path2D(E||"");return this.fontExtraProperties||c.delete(C),this.compiledGlyphs[A]=T}get black(){return this.#is.black}get bold(){return this.#is.bold}get disableFontFace(){return this.#is.disableFontFace??!1}get fontExtraProperties(){return this.#is.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#is.isInvalidPDFjsFont}get isType3Font(){return this.#is.isType3Font}get italic(){return this.#is.italic}get missingFile(){return this.#is.missingFile}get remeasure(){return this.#is.remeasure}get vertical(){return this.#is.vertical}get ascent(){return this.#is.ascent}get defaultWidth(){return this.#is.defaultWidth}get descent(){return this.#is.descent}get bbox(){return this.#is.bbox}get fontMatrix(){return this.#is.fontMatrix}get fallbackName(){return this.#is.fallbackName}get loadedName(){return this.#is.loadedName}get mimetype(){return this.#is.mimetype}get name(){return this.#is.name}get data(){return this.#is.data}clearData(){this.#is.clearData()}get cssFontInfo(){return this.#is.cssFontInfo}get systemFontInfo(){return this.#is.systemFontInfo}get defaultVMetrics(){return this.#is.defaultVMetrics}};function Fe(c){if("string"!=typeof c)return null;if(c.endsWith("/"))return c;throw Error(`Invalid factory url: "${c}" must include trailing slash.`)}let Oe=c=>"object"==typeof c&&Number.isInteger(c?.num)&&c.num>=0&&Number.isInteger(c?.gen)&&c.gen>=0,tD=(function(c,A,E){if(!Array.isArray(E)||E.length<2)return!1;let[C,T,...M]=E;if(!c(C)&&!Number.isInteger(C)||!A(T))return!1;let k=M.length,I=!0;switch(T.name){case"XYZ":if(k<2||k>3)return!1;break;case"Fit":case"FitB":return 0===k;case"FitH":case"FitBH":case"FitV":case"FitBV":if(k>1)return!1;break;case"FitR":if(4!==k)return!1;I=!1;break;default:return!1}for(let c of M)if(!("number"==typeof c||I&&null===c))return!1;return!0}).bind(null,Oe,c=>"object"==typeof c&&"string"==typeof c?.name);let Ue=class Ue{#ir;#ia;postMessage(c,A){let E={data:structuredClone(c,A?{transfer:A}:null)};this.#ia.then(()=>{for(let[c]of this.#ir)c.call(this,E)})}addEventListener(c,A,E=null){let C=null;if(E?.signal instanceof AbortSignal){let{signal:T}=E;if(T.aborted)return void ht("LoopbackPort - cannot use an `aborted` signal.");let r=()=>this.removeEventListener(c,A);C=()=>T.removeEventListener("abort",r),T.addEventListener("abort",r)}this.#ir.set(A,C)}removeEventListener(c,A){let E=this.#ir.get(A);E?.(),this.#ir.delete(A)}terminate(){for(let[,c]of this.#ir)c?.();this.#ir.clear()}constructor(){this.#ir=new Map,this.#ia=Promise.resolve()}};function Ke(){}function Qe(c){if(c instanceof tx||c instanceof tw||c instanceof tv||c instanceof tA||c instanceof ty)return c;switch(c instanceof Error||"object"==typeof c&&null!==c||ct('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new tx(c.message);case"InvalidPDFException":return new tw(c.message);case"PasswordException":return new tv(c.message,c.code);case"ResponseException":return new tA(c.message,c.status,c.missing);case"UnknownErrorException":return new ty(c.message,c.details)}return new ty(c.message,c.toString())}let Je=class Je{#io;constructor(c,A,E){this.#io=new AbortController,this.sourceName=c,this.targetName=A,this.comObj=E,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),E.addEventListener("message",this.#il.bind(this),{signal:this.#io.signal})}#il({data:c}){if(c.targetName!==this.sourceName)return;if(c.stream)return void this.#ih(c);if(c.callback){let A=c.callbackId,E=this.callbackCapabilities[A];if(!E)throw Error(`Cannot resolve callback ${A}`);if(delete this.callbackCapabilities[A],1===c.callback)E.resolve(c.data);else{if(2!==c.callback)throw Error("Unexpected callback case");E.reject(Qe(c.reason))}return}let A=this.actionHandler[c.action];if(!A)throw Error(`Unknown action from worker: ${c.action}`);if(c.callbackId){let E=this.sourceName,C=c.sourceName,T=this.comObj;return void Promise.try(A,c.data).then(function(A){T.postMessage({sourceName:E,targetName:C,callback:1,callbackId:c.callbackId,data:A})},function(A){T.postMessage({sourceName:E,targetName:C,callback:2,callbackId:c.callbackId,reason:Qe(A)})})}c.streamId?this.#id(c):A(c.data)}on(c,A){let E=this.actionHandler;if(E[c])throw Error(`There is already an actionName called "${c}"`);E[c]=A}send(c,A,E){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:c,data:A},E)}sendWithPromise(c,A,E){let C=this.callbackId++,T=Promise.withResolvers();this.callbackCapabilities[C]=T;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:c,callbackId:C,data:A},E)}catch(c){T.reject(c)}return T.promise}sendWithStream(c,A,E,C){let T=this.streamId++,M=this.sourceName,k=this.targetName,I=this.comObj;return new ReadableStream({start:E=>{let N=Promise.withResolvers();return this.streamControllers[T]={controller:E,startCall:N,pullCall:null,cancelCall:null,isClosed:!1},I.postMessage({sourceName:M,targetName:k,action:c,streamId:T,data:A,desiredSize:E.desiredSize},C),N.promise},pull:c=>{let A=Promise.withResolvers();return this.streamControllers[T].pullCall=A,I.postMessage({sourceName:M,targetName:k,stream:6,streamId:T,desiredSize:c.desiredSize}),A.promise},cancel:c=>{dt(c instanceof Error,"cancel must have a valid reason");let A=Promise.withResolvers();return this.streamControllers[T].cancelCall=A,this.streamControllers[T].isClosed=!0,I.postMessage({sourceName:M,targetName:k,stream:1,streamId:T,reason:Qe(c)}),A.promise}},E)}#id(c){let A=c.streamId,E=this.sourceName,C=c.sourceName,T=this.comObj,M=this,k=this.actionHandler[c.action],I={enqueue(c,M=1,k){if(this.isCancelled)return;let I=this.desiredSize;this.desiredSize-=M,I>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),T.postMessage({sourceName:E,targetName:C,stream:4,streamId:A,chunk:c},k)},close(){this.isCancelled||(this.isCancelled=!0,T.postMessage({sourceName:E,targetName:C,stream:3,streamId:A}),delete M.streamSinks[A])},error(c){dt(c instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,T.postMessage({sourceName:E,targetName:C,stream:5,streamId:A,reason:Qe(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:c.desiredSize,ready:null};I.sinkCapability.resolve(),I.ready=I.sinkCapability.promise,this.streamSinks[A]=I,Promise.try(k,c.data,I).then(function(){T.postMessage({sourceName:E,targetName:C,stream:8,streamId:A,success:!0})},function(c){T.postMessage({sourceName:E,targetName:C,stream:8,streamId:A,reason:Qe(c)})})}#ih(c){let A=c.streamId,E=this.sourceName,C=c.sourceName,T=this.comObj,M=this.streamControllers[A],k=this.streamSinks[A];switch(c.stream){case 8:c.success?M.startCall.resolve():M.startCall.reject(Qe(c.reason));break;case 7:c.success?M.pullCall.resolve():M.pullCall.reject(Qe(c.reason));break;case 6:if(!k){T.postMessage({sourceName:E,targetName:C,stream:7,streamId:A,success:!0});break}k.desiredSize<=0&&c.desiredSize>0&&k.sinkCapability.resolve(),k.desiredSize=c.desiredSize,Promise.try(k.onPull||Ke).then(function(){T.postMessage({sourceName:E,targetName:C,stream:7,streamId:A,success:!0})},function(c){T.postMessage({sourceName:E,targetName:C,stream:7,streamId:A,reason:Qe(c)})});break;case 4:if(dt(M,"enqueue should have stream controller"),M.isClosed)break;M.controller.enqueue(c.chunk);break;case 3:if(dt(M,"close should have stream controller"),M.isClosed)break;M.isClosed=!0,M.controller.close(),this.#ic(M,A);break;case 5:dt(M,"error should have stream controller"),M.controller.error(Qe(c.reason)),this.#ic(M,A);break;case 2:c.success?M.cancelCall.resolve():M.cancelCall.reject(Qe(c.reason)),this.#ic(M,A);break;case 1:if(!k)break;let I=Qe(c.reason);Promise.try(k.onCancel||Ke,I).then(function(){T.postMessage({sourceName:E,targetName:C,stream:2,streamId:A,success:!0})},function(c){T.postMessage({sourceName:E,targetName:C,stream:2,streamId:A,reason:Qe(c)})}),k.sinkCapability.reject(I),k.isCancelled=!0,delete this.streamSinks[A];break;default:throw Error("Unexpected stream case")}}async #ic(c,A){await Promise.allSettled([c.startCall?.promise,c.pullCall?.promise,c.cancelCall?.promise]),delete this.streamControllers[A]}destroy(){this.#io?.abort(),this.#io=null}};let Ze=class Ze{#iu;constructor({enableHWA:c=!1}){this.#iu=!1,this.#iu=c}create(c,A){if(c<=0||A<=0)throw Error("Invalid canvas size");let E=this._createCanvas(c,A);return{canvas:E,context:E.getContext("2d",{willReadFrequently:!this.#iu})}}reset(c,A,E){if(!c.canvas)throw Error("Canvas is not specified");if(A<=0||E<=0)throw Error("Invalid canvas size");c.canvas.width=A,c.canvas.height=E}destroy(c){if(!c.canvas)throw Error("Canvas is not specified");c.canvas.width=0,c.canvas.height=0,c.canvas=null,c.context=null}_createCanvas(c,A){ct("Abstract method `_createCanvas` called.")}};let ti=class ti extends Ze{constructor({ownerDocument:c=globalThis.document,enableHWA:A=!1}){super({enableHWA:A}),this._document=c}_createCanvas(c,A){let E=this._document.createElement("canvas");return E.width=c,E.height=A,E}};let ei=class ei{constructor({baseUrl:c=null,isCompressed:A=!0}){this.baseUrl=c,this.isCompressed=A}async fetch({name:c}){if(!this.baseUrl)throw Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!c)throw Error("CMap name must be specified.");let A=this.baseUrl+c+(this.isCompressed?".bcmap":"");return this._fetch(A).then(c=>({cMapData:c,isCompressed:this.isCompressed})).catch(c=>{throw Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${A}`)})}async _fetch(c){ct("Abstract method `_fetch` called.")}};let ii=class ii extends ei{async _fetch(c){let A=await Nt(c,this.isCompressed?"arraybuffer":"text");return A instanceof ArrayBuffer?new Uint8Array(A):_t(A)}};_(2489);let si=class si{addFilter(c){return"none"}addHCMFilter(c,A){return"none"}addAlphaFilter(c){return"none"}addLuminosityFilter(c){return"none"}addHighlightHCMFilter(c,A,E,C,T){return"none"}destroy(c=!1){}};let ni=class ni extends si{#ip;#ig;#im;#ib;#iv;#iy;#A;constructor({docId:c,ownerDocument:A=globalThis.document}){super(),this.#A=0,this.#ib=c,this.#iv=A}get #x(){return this.#ig||=new Map}get #iw(){return this.#iy||=new Map}get #iA(){if(!this.#im){let c=this.#iv.createElement("div"),{style:A}=c;A.visibility="hidden",A.contain="strict",A.width=A.height=0,A.position="absolute",A.top=A.left=0,A.zIndex=-1;let E=this.#iv.createElementNS(tM,"svg");E.setAttribute("width",0),E.setAttribute("height",0),this.#im=this.#iv.createElementNS(tM,"defs"),c.append(E),E.append(this.#im),this.#iv.body.append(c)}return this.#im}#i_(c){if(1===c.length){let A=c[0],E=Array(256);for(let c=0;c<256;c++)E[c]=A[c]/255;let C=E.join(",");return[C,C,C]}let[A,E,C]=c,T=Array(256),M=Array(256),k=Array(256);for(let c=0;c<256;c++)T[c]=A[c]/255,M[c]=E[c]/255,k[c]=C[c]/255;return[T.join(","),M.join(","),k.join(",")]}#ix(c){if(void 0===this.#ip){this.#ip="";let c=this.#iv.URL;c!==this.#iv.baseURI&&(Ht(c)?ht('#createUrl: ignore "data:"-URL for performance reasons.'):this.#ip=pt(c,""))}return`url(${this.#ip}#${c})`}addFilter(c){if(!c)return"none";let A=this.#x.get(c);if(A)return A;let[E,C,T]=this.#i_(c),M=1===c.length?E:`${E}${C}${T}`;if(A=this.#x.get(M))return this.#x.set(c,A),A;let k=`g_${this.#ib}_transfer_map_${this.#A++}`,I=this.#ix(k);this.#x.set(c,I),this.#x.set(M,I);let N=this.#iE(k);return this.#iS(E,C,T,N),I}addHCMFilter(c,A){let E=`${c}-${A}`,C="base",T=this.#iw.get(C);if(T?.key===E||(T?(T.filter?.remove(),T.key=E,T.url="none",T.filter=null):(T={key:E,url:"none",filter:null},this.#iw.set(C,T)),!c||!A))return T.url;let M=this.#iC(c);c=Ct.makeHexColor(...M);let k=this.#iC(A);if(A=Ct.makeHexColor(...k),this.#iA.style.color="","#000000"===c&&"#ffffff"===A||c===A)return T.url;let I=Array(256);for(let c=0;c<=255;c++){let A=c/255;I[c]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}let N=I.join(","),O=`g_${this.#ib}_hcm_filter`,U=T.filter=this.#iE(O);this.#iS(N,N,N,U),this.#iT(U);let d=(c,A)=>{let E=M[c]/255,C=k[c]/255,T=Array(A+1);for(let c=0;c<=A;c++)T[c]=E+c/A*(C-E);return T.join(",")};return this.#iS(d(0,5),d(1,5),d(2,5),U),T.url=this.#ix(O),T.url}addAlphaFilter(c){let A=this.#x.get(c);if(A)return A;let[E]=this.#i_([c]),C=`alpha_${E}`;if(A=this.#x.get(C))return this.#x.set(c,A),A;let T=`g_${this.#ib}_alpha_map_${this.#A++}`,M=this.#ix(T);this.#x.set(c,M),this.#x.set(C,M);let k=this.#iE(T);return this.#iM(E,k),M}addLuminosityFilter(c){let A,E,C=this.#x.get(c||"luminosity");if(C)return C;if(c?([A]=this.#i_([c]),E=`luminosity_${A}`):E="luminosity",C=this.#x.get(E))return this.#x.set(c,C),C;let T=`g_${this.#ib}_luminosity_map_${this.#A++}`,M=this.#ix(T);this.#x.set(c,M),this.#x.set(E,M);let k=this.#iE(T);return this.#ik(k),c&&this.#iM(A,k),M}addHighlightHCMFilter(c,A,E,C,T){let M=`${A}-${E}-${C}-${T}`,k=this.#iw.get(c);if(k?.key===M||(k?(k.filter?.remove(),k.key=M,k.url="none",k.filter=null):(k={key:M,url:"none",filter:null},this.#iw.set(c,k)),!A||!E))return k.url;let[I,N]=[A,E].map(this.#iC.bind(this)),O=Math.round(.2126*I[0]+.7152*I[1]+.0722*I[2]),U=Math.round(.2126*N[0]+.7152*N[1]+.0722*N[2]),[j,$]=[C,T].map(this.#iC.bind(this));U<O&&([O,U,j,$]=[U,O,$,j]),this.#iA.style.color="";let p=(c,A,E)=>{let C=Array(256),T=(U-O)/E,M=c/255,k=(A-c)/(255*E),I=0;for(let c=0;c<=E;c++){let A=Math.round(O+c*T),E=M+c*k;for(let c=I;c<=A;c++)C[c]=E;I=A+1}for(let c=I;c<256;c++)C[c]=C[I-1];return C.join(",")},V=`g_${this.#ib}_hcm_${c}_filter`,G=k.filter=this.#iE(V);return this.#iT(G),this.#iS(p(j[0],$[0],5),p(j[1],$[1],5),p(j[2],$[2],5),G),k.url=this.#ix(V),k.url}destroy(c=!1){c&&this.#iy?.size||(this.#im?.parentNode.parentNode.remove(),this.#im=null,this.#ig?.clear(),this.#ig=null,this.#iy?.clear(),this.#iy=null,this.#A=0)}#ik(c){let A=this.#iv.createElementNS(tM,"feColorMatrix");A.setAttribute("type","matrix"),A.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),c.append(A)}#iT(c){let A=this.#iv.createElementNS(tM,"feColorMatrix");A.setAttribute("type","matrix"),A.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),c.append(A)}#iE(c){let A=this.#iv.createElementNS(tM,"filter");return A.setAttribute("color-interpolation-filters","sRGB"),A.setAttribute("id",c),this.#iA.append(A),A}#iP(c,A,E){let C=this.#iv.createElementNS(tM,A);C.setAttribute("type","discrete"),C.setAttribute("tableValues",E),c.append(C)}#iS(c,A,E,C){let T=this.#iv.createElementNS(tM,"feComponentTransfer");C.append(T),this.#iP(T,"feFuncR",c),this.#iP(T,"feFuncG",A),this.#iP(T,"feFuncB",E)}#iM(c,A){let E=this.#iv.createElementNS(tM,"feComponentTransfer");A.append(E),this.#iP(E,"feFuncA",c)}#iC(c){return this.#iA.style.color=c,Qt(getComputedStyle(this.#iA).getPropertyValue("color"))}};let ri=class ri{constructor({baseUrl:c=null}){this.baseUrl=c}async fetch({filename:c}){if(!this.baseUrl)throw Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!c)throw Error("Font filename must be specified.");let A=`${this.baseUrl}${c}`;return this._fetch(A).catch(c=>{throw Error(`Unable to load font data at: ${A}`)})}async _fetch(c){ct("Abstract method `_fetch` called.")}};let ai=class ai extends ri{async _fetch(c){let A=await Nt(c,"arraybuffer");return new Uint8Array(A)}};let oi=class oi{constructor({baseUrl:c=null}){this.baseUrl=c}async fetch({filename:c}){if(!this.baseUrl)throw Error("Ensure that the `wasmUrl` API parameter is provided.");if(!c)throw Error("Wasm filename must be specified.");let A=`${this.baseUrl}${c}`;return this._fetch(A).catch(c=>{throw Error(`Unable to load wasm data at: ${A}`)})}async _fetch(c){ct("Abstract method `_fetch` called.")}};let li=class li extends oi{async _fetch(c){let A=await Nt(c,"arraybuffer");return new Uint8Array(A)}};if(Z){let c;try{let A=process.getBuiltinModule("module").createRequire("undefined"==typeof document?E(57310).pathToFileURL(__filename).href:K&&"SCRIPT"===K.tagName.toUpperCase()&&K.src||new URL("index.cjs",document.baseURI).href);try{c=A("@napi-rs/canvas")}catch(c){ht(`Cannot load "@napi-rs/canvas" package: "${c}".`)}}catch(c){ht(`Cannot access the \`require\` function: "${c}".`)}globalThis.DOMMatrix||(c?.DOMMatrix?globalThis.DOMMatrix=c.DOMMatrix:ht("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(c?.ImageData?globalThis.ImageData=c.ImageData:ht("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(c?.Path2D?globalThis.Path2D=c.Path2D:ht("Cannot polyfill `Path2D`, rendering may be broken.")),globalThis.navigator?.language||(globalThis.navigator={language:"en-US",platform:"",userAgent:""})}async function hi(c){let A=process.getBuiltinModule("fs"),E=await A.promises.readFile(c);return new Uint8Array(E)}let ci=class ci extends si{};let di=class di extends Ze{_createCanvas(c,A){return process.getBuiltinModule("module").createRequire("undefined"==typeof document?E(57310).pathToFileURL(__filename).href:K&&"SCRIPT"===K.tagName.toUpperCase()&&K.src||new URL("index.cjs",document.baseURI).href)("@napi-rs/canvas").createCanvas(c,A)}};let ui=class ui extends ei{async _fetch(c){return hi(c)}};let pi=class pi extends ri{async _fetch(c){return hi(c)}};let gi=class gi extends oi{async _fetch(c){return hi(c)}};_(7588);let tI="__forcedDependency",{floor:tL,ceil:tF}=Math;function vi(c,A,E,C,T,M){c[4*A+0]=Math.min(c[4*A+0],E),c[4*A+1]=Math.min(c[4*A+1],C),c[4*A+2]=Math.max(c[4*A+2],T),c[4*A+3]=Math.max(c[4*A+3],M)}let tN=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];let wi=class wi{#iR;#iD;constructor(c,A){this.#iR=c,this.#iD=A}get length(){return this.#iR.length}isEmpty(c){return this.#iR[c]===tN}minX(c){return this.#iD[4*c+0]/256}minY(c){return this.#iD[4*c+1]/256}maxX(c){return(this.#iD[4*c+2]+1)/256}maxY(c){return(this.#iD[4*c+3]+1)/256}};let xi=(c,A)=>{if(!c)return;let E=c.get(A);return E||(E={dependencies:new Set,isRenderingOperation:!1},c.set(A,E)),E};let Ai=class Ai{#iI;#iL;#iF;#iN;#iO;#iB;#iU;#iz;#ij;#iH;#i$;#iV;#iG;#iW;#iq;#iR;#iX;constructor(c,A,E=!1){this.#iI={__proto__:null},this.#iL={__proto__:null,transform:[],moveText:[],sameLineText:[],[tI]:[]},this.#iF=new Map,this.#iN=[],this.#iO=[],this.#iB=[[1,0,0,1,0,0]],this.#iU=[-1/0,-1/0,1/0,1/0],this.#iz=new Float64Array([1/0,1/0,-1/0,-1/0]),this.#ij=-1,this.#iH=new Set,this.#i$=new Map,this.#iV=new Map,this.#iG=c.width,this.#iW=c.height,this.#iY(A),E&&(this.#iX=new Map)}growOperationsCount(c){c>=this.#iR.length&&this.#iY(c,this.#iR)}#iY(c,A){let E=new ArrayBuffer(4*c);this.#iq=new Uint8ClampedArray(E),this.#iR=new Uint32Array(E),A&&A.length>0?(this.#iR.set(A),this.#iR.fill(tN,A.length)):this.#iR.fill(tN)}save(c){return this.#iI={__proto__:this.#iI},this.#iL={__proto__:this.#iL,transform:{__proto__:this.#iL.transform},moveText:{__proto__:this.#iL.moveText},sameLineText:{__proto__:this.#iL.sameLineText},[tI]:{__proto__:this.#iL[tI]}},this.#iU={__proto__:this.#iU},this.#iN.push(c),this}restore(c){let A=Object.getPrototypeOf(this.#iI);if(null===A)return this;this.#iI=A,this.#iL=Object.getPrototypeOf(this.#iL),this.#iU=Object.getPrototypeOf(this.#iU);let E=this.#iN.pop();return void 0!==E&&(xi(this.#iX,c)?.dependencies.add(E),this.#iR[c]=this.#iR[E]),this}recordOpenMarker(c){return this.#iN.push(c),this}getOpenMarker(){return 0===this.#iN.length?null:this.#iN.at(-1)}recordCloseMarker(c){let A=this.#iN.pop();return void 0!==A&&(xi(this.#iX,c)?.dependencies.add(A),this.#iR[c]=this.#iR[A]),this}beginMarkedContent(c){return this.#iO.push(c),this}endMarkedContent(c){let A=this.#iO.pop();return void 0!==A&&(xi(this.#iX,c)?.dependencies.add(A),this.#iR[c]=this.#iR[A]),this}pushBaseTransform(c){return this.#iB.push(Ct.multiplyByDOMMatrix(this.#iB.at(-1),c.getTransform())),this}popBaseTransform(){return this.#iB.length>1&&this.#iB.pop(),this}recordSimpleData(c,A){return this.#iI[c]=A,this}recordIncrementalData(c,A){return this.#iL[c].push(A),this}resetIncrementalData(c,A){return this.#iL[c].length=0,this}recordNamedData(c,A){return this.#iF.set(c,A),this}recordSimpleDataFromNamed(c,A,E){this.#iI[c]=this.#iF.get(A)??E}recordFutureForcedDependency(c,A){return this.recordIncrementalData(tI,A),this}inheritSimpleDataAsFutureForcedDependencies(c){for(let A of c)A in this.#iI&&this.recordFutureForcedDependency(A,this.#iI[A]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(let c of this.#iH)this.recordFutureForcedDependency(tI,c);return this}resetBBox(c){return this.#ij!==c&&(this.#ij=c,this.#iz[0]=1/0,this.#iz[1]=1/0,this.#iz[2]=-1/0,this.#iz[3]=-1/0),this}recordClipBox(c,A,E,C,T,M){let k=Ct.multiplyByDOMMatrix(this.#iB.at(-1),A.getTransform()),I=[1/0,1/0,-1/0,-1/0];Ct.axialAlignedBoundingBox([E,T,C,M],k,I);let N=Ct.intersect(this.#iU,I);return N?(this.#iU[0]=N[0],this.#iU[1]=N[1],this.#iU[2]=N[2],this.#iU[3]=N[3]):(this.#iU[0]=this.#iU[1]=1/0,this.#iU[2]=this.#iU[3]=-1/0),this}recordBBox(c,A,E,C,T,M){let k=this.#iU;if(k[0]===1/0)return this;let I=Ct.multiplyByDOMMatrix(this.#iB.at(-1),A.getTransform());if(k[0]===-1/0)return Ct.axialAlignedBoundingBox([E,T,C,M],I,this.#iz),this;let N=[1/0,1/0,-1/0,-1/0];return Ct.axialAlignedBoundingBox([E,T,C,M],I,N),this.#iz[0]=Math.min(this.#iz[0],Math.max(N[0],k[0])),this.#iz[1]=Math.min(this.#iz[1],Math.max(N[1],k[1])),this.#iz[2]=Math.max(this.#iz[2],Math.min(N[2],k[2])),this.#iz[3]=Math.max(this.#iz[3],Math.min(N[3],k[3])),this}recordCharacterBBox(c,A,E,C=1,T=0,M=0,k){let I,N;let O=E.bbox;if(O&&!1!==(I=O[2]!==O[0]&&O[3]!==O[1]&&this.#iV.get(E))&&(N=[0,0,0,0],Ct.axialAlignedBoundingBox(O,E.fontMatrix,N),1===C&&0===T&&0===M||Ct.scaleMinMax([C,0,0,-C,T,M],N),I))return this.recordBBox(c,A,N[0],N[2],N[1],N[3]);if(!k)return this.recordFullPageBBox(c);let U=k();return O&&N&&void 0===I&&(I=N[0]<=T-U.actualBoundingBoxLeft&&N[2]>=T+U.actualBoundingBoxRight&&N[1]<=M-U.actualBoundingBoxAscent&&N[3]>=M+U.actualBoundingBoxDescent,this.#iV.set(E,I),I)?this.recordBBox(c,A,N[0],N[2],N[1],N[3]):this.recordBBox(c,A,T-U.actualBoundingBoxLeft,T+U.actualBoundingBoxRight,M-U.actualBoundingBoxAscent,M+U.actualBoundingBoxDescent)}recordFullPageBBox(c){return this.#iz[0]=Math.max(0,this.#iU[0]),this.#iz[1]=Math.max(0,this.#iU[1]),this.#iz[2]=Math.min(this.#iG,this.#iU[2]),this.#iz[3]=Math.min(this.#iW,this.#iU[3]),this}getSimpleIndex(c){return this.#iI[c]}recordDependencies(c,A){let E=this.#iH,C=this.#iI,T=this.#iL;for(let c of A)c in this.#iI?E.add(C[c]):c in T&&T[c].forEach(E.add,E);return this}recordNamedDependency(c,A){return this.#iF.has(A)&&this.#iH.add(this.#iF.get(A)),this}recordOperation(c,A=!1){if(this.recordDependencies(c,[tI]),this.#iX){let A=xi(this.#iX,c),{dependencies:E}=A;this.#iH.forEach(E.add,E),this.#iN.forEach(E.add,E),this.#iO.forEach(E.add,E),E.delete(c),A.isRenderingOperation=!0}if(this.#ij===c){let E=tL(256*this.#iz[0]/this.#iG),C=tL(256*this.#iz[1]/this.#iW),T=tF(256*this.#iz[2]/this.#iG),M=tF(256*this.#iz[3]/this.#iW);for(let A of(vi(this.#iq,c,E,C,T,M),this.#iH))A!==c&&vi(this.#iq,A,E,C,T,M);for(let A of this.#iN)A!==c&&vi(this.#iq,A,E,C,T,M);for(let A of this.#iO)A!==c&&vi(this.#iq,A,E,C,T,M);A||(this.#iH.clear(),this.#ij=-1)}return this}recordShowTextOperation(c,A=!1){let E=Array.from(this.#iH);for(let C of(this.recordOperation(c,A),this.recordIncrementalData("sameLineText",c),E))this.recordIncrementalData("sameLineText",C);return this}bboxToClipBoxDropOperation(c,A=!1){return this.#ij===c&&(this.#ij=-1,this.#iU[0]=Math.max(this.#iU[0],this.#iz[0]),this.#iU[1]=Math.max(this.#iU[1],this.#iz[1]),this.#iU[2]=Math.min(this.#iU[2],this.#iz[2]),this.#iU[3]=Math.min(this.#iU[3],this.#iz[3]),A||this.#iH.clear()),this}_takePendingDependencies(){let c=this.#iH;return this.#iH=new Set,c}_extractOperation(c){let A=this.#i$.get(c);return this.#i$.delete(c),A}_pushPendingDependencies(c){for(let A of c)this.#iH.add(A)}take(){return this.#iV.clear(),new wi(this.#iR,this.#iq)}takeDebugMetadata(){return this.#iX}};let _i=class _i{#iK;#iJ;#iQ;#iZ;#i0;constructor(c,A,E){if(this.#iZ=0,this.#i0=0,c instanceof _i&&!!E===c.#iQ)return c;this.#iK=c,this.#iJ=A,this.#iQ=!!E}growOperationsCount(){throw Error("Unreachable")}save(c){return this.#i0++,this.#iK.save(this.#iJ),this}restore(c){return this.#i0>0&&(this.#iK.restore(this.#iJ),this.#i0--),this}recordOpenMarker(c){return this.#iZ++,this}getOpenMarker(){return this.#iZ>0?this.#iJ:this.#iK.getOpenMarker()}recordCloseMarker(c){return this.#iZ--,this}beginMarkedContent(c){return this}endMarkedContent(c){return this}pushBaseTransform(c){return this.#iK.pushBaseTransform(c),this}popBaseTransform(){return this.#iK.popBaseTransform(),this}recordSimpleData(c,A){return this.#iK.recordSimpleData(c,this.#iJ),this}recordIncrementalData(c,A){return this.#iK.recordIncrementalData(c,this.#iJ),this}resetIncrementalData(c,A){return this.#iK.resetIncrementalData(c,this.#iJ),this}recordNamedData(c,A){return this}recordSimpleDataFromNamed(c,A,E){return this.#iK.recordSimpleDataFromNamed(c,A,this.#iJ),this}recordFutureForcedDependency(c,A){return this.#iK.recordFutureForcedDependency(c,this.#iJ),this}inheritSimpleDataAsFutureForcedDependencies(c){return this.#iK.inheritSimpleDataAsFutureForcedDependencies(c),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#iK.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(c){return this.#iQ||this.#iK.resetBBox(this.#iJ),this}recordClipBox(c,A,E,C,T,M){return this.#iQ||this.#iK.recordClipBox(this.#iJ,A,E,C,T,M),this}recordBBox(c,A,E,C,T,M){return this.#iQ||this.#iK.recordBBox(this.#iJ,A,E,C,T,M),this}recordCharacterBBox(c,A,E,C,T,M,k){return this.#iQ||this.#iK.recordCharacterBBox(this.#iJ,A,E,C,T,M,k),this}recordFullPageBBox(c){return this.#iQ||this.#iK.recordFullPageBBox(this.#iJ),this}getSimpleIndex(c){return this.#iK.getSimpleIndex(c)}recordDependencies(c,A){return this.#iK.recordDependencies(this.#iJ,A),this}recordNamedDependency(c,A){return this.#iK.recordNamedDependency(this.#iJ,A),this}recordOperation(c){return this.#iK.recordOperation(this.#iJ,!0),this}recordShowTextOperation(c){return this.#iK.recordShowTextOperation(this.#iJ,!0),this}bboxToClipBoxDropOperation(c){return this.#iQ||this.#iK.bboxToClipBoxDropOperation(this.#iJ,!0),this}take(){throw Error("Unreachable")}takeDebugMetadata(){throw Error("Unreachable")}};let tO=["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],tB=["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],tU=["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],tz=["filter","fillColor","fillAlpha"],tj=["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],tH=["transform"],t$=["transform","fillColor"],tV="Fill",tG="Stroke",tW="Shading";function Li(c,A){if(!A)return;let E=A[2]-A[0],C=A[3]-A[1],T=new Path2D;T.rect(A[0],A[1],E,C),c.clip(T)}let Bi=class Bi{isModifyingCurrentTransform(){return!1}getPattern(){ct("Abstract method `getPattern` called.")}};let Fi=class Fi extends Bi{constructor(c){super(),this._type=c[1],this._bbox=c[2],this._colorStops=c[3],this._p0=c[4],this._p1=c[5],this._r0=c[6],this._r1=c[7],this.matrix=null}_createGradient(c){let A;for(let E of("axial"===this._type?A=c.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(A=c.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)),this._colorStops))A.addColorStop(E[0],E[1]);return A}getPattern(c,A,E,C){let T;if(C===tG||C===tV){let M=A.current.getClippedPathBoundingBox(C,Jt(c))||[0,0,0,0],k=Math.ceil(M[2]-M[0])||1,I=Math.ceil(M[3]-M[1])||1,N=A.cachedCanvases.getCanvas("pattern",k,I),O=N.context;O.clearRect(0,0,O.canvas.width,O.canvas.height),O.beginPath(),O.rect(0,0,O.canvas.width,O.canvas.height),O.translate(-M[0],-M[1]),E=Ct.transform(E,[1,0,0,1,M[0],M[1]]),O.transform(...A.baseTransform),this.matrix&&O.transform(...this.matrix),Li(O,this._bbox),O.fillStyle=this._createGradient(O),O.fill(),T=c.createPattern(N.canvas,"no-repeat");let U=new DOMMatrix(E);T.setTransform(U)}else Li(c,this._bbox),T=this._createGradient(c);return T}};function Oi(c,A,E,C,T,M,k,I){let N,O,U,j,$,V,G,W,q;let X=A.coords,Y=A.colors,K=c.data,J=4*c.width;X[E+1]>X[C+1]&&(N=E,E=C,C=N,N=M,M=k,k=N),X[C+1]>X[T+1]&&(N=C,C=T,T=N,N=k,k=I,I=N),X[E+1]>X[C+1]&&(N=E,E=C,C=N,N=M,M=k,k=N);let Q=(X[E]+A.offsetX)*A.scaleX,Z=(X[E+1]+A.offsetY)*A.scaleY,tt=(X[C]+A.offsetX)*A.scaleX,ta=(X[C+1]+A.offsetY)*A.scaleY,to=(X[T]+A.offsetX)*A.scaleX,tl=(X[T+1]+A.offsetY)*A.scaleY;if(Z>=tl)return;let th=Y[M],td=Y[M+1],tc=Y[M+2],tu=Y[k],tp=Y[k+1],tg=Y[k+2],tf=Y[I],tm=Y[I+1],tb=Y[I+2],tv=Math.round(Z),ty=Math.round(tl);for(let c=tv;c<=ty;c++){let A;if(c<ta){let A=c<Z?0:(Z-c)/(Z-ta);O=Q-(Q-tt)*A,U=th-(th-tu)*A,j=td-(td-tp)*A,$=tc-(tc-tg)*A}else{let A;O=tt-(tt-to)*(A=c>tl?1:ta===tl?0:(ta-c)/(ta-tl)),U=tu-(tu-tf)*A,j=tp-(tp-tm)*A,$=tg-(tg-tb)*A}V=Q-(Q-to)*(A=c<Z?0:c>tl?1:(Z-c)/(Z-tl)),G=th-(th-tf)*A,W=td-(td-tm)*A,q=tc-(tc-tb)*A;let E=Math.round(Math.min(O,V)),C=Math.round(Math.max(O,V)),T=J*c+4*E;for(let c=E;c<=C;c++)(A=(O-c)/(O-V))<0?A=0:A>1&&(A=1),K[T++]=U-(U-G)*A|0,K[T++]=j-(j-W)*A|0,K[T++]=$-($-q)*A|0,K[T++]=255}}function Ni(c,A,E){let C,T;let M=A.coords,k=A.colors;switch(A.type){case"lattice":let I=A.verticesPerRow,N=Math.floor(M.length/I)-1,O=I-1;for(C=0;C<N;C++){let A=C*I;for(let C=0;C<O;C++,A++)Oi(c,E,M[A],M[A+1],M[A+I],k[A],k[A+1],k[A+I]),Oi(c,E,M[A+I+1],M[A+1],M[A+I],k[A+I+1],k[A+1],k[A+I])}break;case"triangles":for(C=0,T=M.length;C<T;C+=3)Oi(c,E,M[C],M[C+1],M[C+2],k[C],k[C+1],k[C+2]);break;default:throw Error("illegal figure")}}let Ui=class Ui extends Bi{constructor(c){super(),this._coords=c[2],this._colors=c[3],this._figures=c[4],this._bounds=c[5],this._bbox=c[6],this._background=c[7],this.matrix=null}_createMeshCanvas(c,A,E){let C=Math.floor(this._bounds[0]),T=Math.floor(this._bounds[1]),M=Math.ceil(this._bounds[2])-C,k=Math.ceil(this._bounds[3])-T,I=Math.min(Math.ceil(Math.abs(M*c[0]*1.1)),3e3),N=Math.min(Math.ceil(Math.abs(k*c[1]*1.1)),3e3),O=M/I,U=k/N,j={coords:this._coords,colors:this._colors,offsetX:-C,offsetY:-T,scaleX:1/O,scaleY:1/U},$=I+4,V=N+4,G=E.getCanvas("mesh",$,V),W=G.context,q=W.createImageData(I,N);if(A){let c=q.data;for(let E=0,C=c.length;E<C;E+=4)c[E]=A[0],c[E+1]=A[1],c[E+2]=A[2],c[E+3]=255}for(let c of this._figures)Ni(q,c,j);return W.putImageData(q,2,2),{canvas:G.canvas,offsetX:C-2*O,offsetY:T-2*U,scaleX:O,scaleY:U}}isModifyingCurrentTransform(){return!0}getPattern(c,A,E,C){Li(c,this._bbox);let T=new Float32Array(2);if(C===tW)Ct.singularValueDecompose2dScale(Jt(c),T);else if(this.matrix){Ct.singularValueDecompose2dScale(this.matrix,T);let[c,E]=T;Ct.singularValueDecompose2dScale(A.baseTransform,T),T[0]*=c,T[1]*=E}else Ct.singularValueDecompose2dScale(A.baseTransform,T);let M=this._createMeshCanvas(T,C===tW?null:this._background,A.cachedCanvases);return C!==tW&&(c.setTransform(...A.baseTransform),this.matrix&&c.transform(...this.matrix)),c.translate(M.offsetX,M.offsetY),c.scale(M.scaleX,M.scaleY),c.createPattern(M.canvas,"no-repeat")}};let zi=class zi extends Bi{getPattern(){return"hotpink"}};let $i=class $i{static{this.MAX_PATTERN_SIZE=3e3}constructor(c,A,E,C){this.color=c[1],this.operatorList=c[2],this.matrix=c[3],this.bbox=c[4],this.xstep=c[5],this.ystep=c[6],this.paintType=c[7],this.tilingType=c[8],this.ctx=A,this.canvasGraphicsFactory=E,this.baseTransform=C}createPatternCanvas(c,A){let{bbox:E,operatorList:C,paintType:T,tilingType:M,color:k,canvasGraphicsFactory:I}=this,{xstep:N,ystep:O}=this;N=Math.abs(N),O=Math.abs(O),lt("TilingType: "+M);let U=E[0],j=E[1],$=E[2],V=E[3],G=$-U,W=V-j,q=new Float32Array(2);Ct.singularValueDecompose2dScale(this.matrix,q);let[X,Y]=q;Ct.singularValueDecompose2dScale(this.baseTransform,q);let K=X*q[0],J=Y*q[1],Q=G,Z=W,tt=!1,ta=!1,to=Math.ceil(N*K),tl=Math.ceil(O*J);to>=Math.ceil(G*K)?Q=N:tt=!0,tl>=Math.ceil(W*J)?Z=O:ta=!0;let th=this.getSizeAndScale(Q,this.ctx.canvas.width,K),td=this.getSizeAndScale(Z,this.ctx.canvas.height,J),tc=c.cachedCanvases.getCanvas("pattern",th.size,td.size),tu=tc.context,tp=I.createCanvasGraphics(tu,A);if(tp.groupLevel=c.groupLevel,this.setFillAndStrokeStyleToContext(tp,T,k),tu.translate(-th.scale*U,-td.scale*j),tp.transform(0,th.scale,0,0,td.scale,0,0),tu.save(),tp.dependencyTracker?.save(),this.clipBbox(tp,U,j,$,V),tp.baseTransform=Jt(tp.ctx),tp.executeOperatorList(C),tp.endDrawing(),tp.dependencyTracker?.restore(),tu.restore(),tt||ta){let A=tc.canvas;tt&&(Q=N),ta&&(Z=O);let E=this.getSizeAndScale(Q,this.ctx.canvas.width,K),C=this.getSizeAndScale(Z,this.ctx.canvas.height,J),T=E.size,M=C.size,k=c.cachedCanvases.getCanvas("pattern-workaround",T,M),I=k.context,$=tt?Math.floor(G/N):0,V=ta?Math.floor(W/O):0;for(let c=0;c<=$;c++)for(let E=0;E<=V;E++)I.drawImage(A,T*c,M*E,T,M,0,0,T,M);return{canvas:k.canvas,scaleX:E.scale,scaleY:C.scale,offsetX:U,offsetY:j}}return{canvas:tc.canvas,scaleX:th.scale,scaleY:td.scale,offsetX:U,offsetY:j}}getSizeAndScale(c,A,E){let C=Math.max($i.MAX_PATTERN_SIZE,A),T=Math.ceil(c*E);return T>=C?T=C:E=T/c,{scale:E,size:T}}clipBbox(c,A,E,C,T){let M=C-A,k=T-E;c.ctx.rect(A,E,M,k),Ct.axialAlignedBoundingBox([A,E,C,T],Jt(c.ctx),c.current.minMax),c.clip(),c.endPath()}setFillAndStrokeStyleToContext(c,A,E){let C=c.ctx,T=c.current;switch(A){case 1:let{fillStyle:M,strokeStyle:k}=this.ctx;C.fillStyle=T.fillColor=M,C.strokeStyle=T.strokeColor=k;break;case 2:C.fillStyle=C.strokeStyle=E,T.fillColor=T.strokeColor=E;break;default:throw new t_(`Unsupported paint type: ${A}`)}}isModifyingCurrentTransform(){return!1}getPattern(c,A,E,C,T){let M=E;C!==tW&&(M=Ct.transform(M,A.baseTransform),this.matrix&&(M=Ct.transform(M,this.matrix)));let k=this.createPatternCanvas(A,T),I=new DOMMatrix(M);I=(I=I.translate(k.offsetX,k.offsetY)).scale(1/k.scaleX,1/k.scaleY);let N=c.createPattern(k.canvas,"repeat");return N.setTransform(I),N}};function Vi({src:c,srcPos:A=0,dest:E,width:C,height:T,nonBlackColor:M=4294967295,inverseDecode:k=!1}){let I=St.isLittleEndian?4278190080:255,[N,O]=k?[M,I]:[I,M],U=C>>3,j=7&C,$=c.length;E=new Uint32Array(E.buffer);let V=0;for(let C=0;C<T;C++){for(let C=A+U;A<C;A++){let C=A<$?c[A]:255;E[V++]=128&C?O:N,E[V++]=64&C?O:N,E[V++]=32&C?O:N,E[V++]=16&C?O:N,E[V++]=8&C?O:N,E[V++]=4&C?O:N,E[V++]=2&C?O:N,E[V++]=1&C?O:N}if(0===j)continue;let C=A<$?c[A++]:255;for(let c=0;c<j;c++)E[V++]=C&1<<7-c?O:N}return{srcPos:A,destPos:V}}let tq=new DOMMatrix,tX=new Float32Array(2),tY=new Float32Array([1/0,1/0,-1/0,-1/0]);let Yi=class Yi{constructor(c){this.canvasFactory=c,this.cache=Object.create(null)}getCanvas(c,A,E){let C;return void 0!==this.cache[c]?(C=this.cache[c],this.canvasFactory.reset(C,A,E)):(C=this.canvasFactory.create(A,E),this.cache[c]=C),C}delete(c){delete this.cache[c]}clear(){for(let c in this.cache){let A=this.cache[c];this.canvasFactory.destroy(A),delete this.cache[c]}}};function Ki(c,A,E,C,T,M,k,I,N,O){let[U,j,$,V,G,W]=Jt(c);if(0===j&&0===$){let q=k*U+G,X=Math.round(q),Y=I*V+W,K=Math.round(Y),J=(k+N)*U+G,Q=Math.abs(Math.round(J)-X)||1,Z=(I+O)*V+W,tt=Math.abs(Math.round(Z)-K)||1;return c.setTransform(Math.sign(U),0,0,Math.sign(V),X,K),c.drawImage(A,E,C,T,M,0,0,Q,tt),c.setTransform(U,j,$,V,G,W),[Q,tt]}if(0===U&&0===V){let q=I*$+G,X=Math.round(q),Y=k*j+W,K=Math.round(Y),J=(I+O)*$+G,Q=Math.abs(Math.round(J)-X)||1,Z=(k+N)*j+W,tt=Math.abs(Math.round(Z)-K)||1;return c.setTransform(0,Math.sign(j),Math.sign($),0,X,K),c.drawImage(A,E,C,T,M,0,0,tt,Q),c.setTransform(U,j,$,V,G,W),[tt,Q]}return c.drawImage(A,E,C,T,M,k,I,N,O),[Math.hypot(U,j)*N,Math.hypot($,V)*O]}let Qi=class Qi{constructor(c,A,E){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=null,this.textMatrixScale=1,this.fontMatrix=tt,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=0,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",E?.(this),this.clipBox=new Float32Array([0,0,c,A]),this.minMax=tY.slice()}clone(){let c=Object.create(this);return c.clipBox=this.clipBox.slice(),c.minMax=this.minMax.slice(),c}getPathBoundingBox(c=tV,A=null){let E=this.minMax.slice();if(c===tG){A||ct("Stroke bounding box must include transform."),Ct.singularValueDecompose2dScale(A,tX);let c=tX[0]*this.lineWidth/2,C=tX[1]*this.lineWidth/2;E[0]-=c,E[1]-=C,E[2]+=c,E[3]+=C}return E}updateClipFromPath(){let c=Ct.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(c||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(c){this.clipBox.set(c,0),this.minMax.set(tY,0)}getClippedPathBoundingBox(c=tV,A=null){return Ct.intersect(this.clipBox,this.getPathBoundingBox(c,A))}};function Ji(c,A){let E,C,T,M;if(A instanceof ImageData)return void c.putImageData(A,0,0);let k=A.height,I=A.width,N=k%16,O=(k-N)/16,U=0===N?O:O+1,j=c.createImageData(I,16),$,V=0,G=A.data,W=j.data;if(A.kind===tc.GRAYSCALE_1BPP){let A=G.byteLength,M=new Uint32Array(W.buffer,0,W.byteLength>>2),k=M.length,q=I+7>>3,X=St.isLittleEndian?4278190080:255;for(E=0;E<U;E++){for(T=E<O?16:N,$=0,C=0;C<T;C++){let c=A-V,E=0,C=c>q?I:8*c-7,T=-8&C,k=0,N=0;for(;E<T;E+=8)N=G[V++],M[$++]=128&N?4294967295:X,M[$++]=64&N?4294967295:X,M[$++]=32&N?4294967295:X,M[$++]=16&N?4294967295:X,M[$++]=8&N?4294967295:X,M[$++]=4&N?4294967295:X,M[$++]=2&N?4294967295:X,M[$++]=1&N?4294967295:X;for(;E<C;E++)0===k&&(N=G[V++],k=128),M[$++]=N&k?4294967295:X,k>>=1}for(;$<k;)M[$++]=0;c.putImageData(j,0,16*E)}}else if(A.kind===tc.RGBA_32BPP){for(C=0,M=64*I,E=0;E<O;E++)W.set(G.subarray(V,V+M)),V+=M,c.putImageData(j,0,C),C+=16;E<U&&(M=I*N*4,W.set(G.subarray(V,V+M)),c.putImageData(j,0,C))}else{if(A.kind!==tc.RGB_24BPP)throw Error(`bad image kind: ${A.kind}`);for(M=I*(T=16),E=0;E<U;E++){for(E>=O&&(M=I*(T=N)),$=0,C=M;C--;)W[$++]=G[V++],W[$++]=G[V++],W[$++]=G[V++],W[$++]=255;c.putImageData(j,0,16*E)}}}function Zi(c,A){if(A.bitmap)return void c.drawImage(A.bitmap,0,0);let E=A.height,C=A.width,T=E%16,M=(E-T)/16,k=0===T?M:M+1,I=c.createImageData(C,16),N=0,O=A.data,U=I.data;for(let A=0;A<k;A++){let E=A<M?16:T;({srcPos:N}=Vi({src:O,srcPos:N,dest:U,width:C,height:E,nonBlackColor:0})),c.putImageData(I,0,16*A)}}function ts(c,A){for(let E of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==c[E]&&(A[E]=c[E]);void 0!==c.setLineDash&&(A.setLineDash(c.getLineDash()),A.lineDashOffset=c.lineDashOffset)}function es(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",void 0!==c.setLineDash&&(c.setLineDash([]),c.lineDashOffset=0);let{filter:A}=c;"none"!==A&&""!==A&&(c.filter="none")}function is(c,A){if(A)return!0;Ct.singularValueDecompose2dScale(c,tX);let E=Math.fround(ee.pixelRatio*Ot.PDF_TO_CSS_UNITS);return tX[0]<=E&&tX[1]<=E}let tK=["butt","round","square"],tJ=["miter","round","bevel"],tQ={},tZ={};let os=class os{constructor(c,A,E,C,T,{optionalContentConfig:M,markedContentStack:k=null},I,N,O){this.ctx=c,this.current=new Qi(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=A,this.objs=E,this.canvasFactory=C,this.filterFactory=T,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=k||[],this.optionalContentConfig=M,this.cachedCanvases=new Yi(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=I,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=N,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=O??null}getObject(c,A,E=null){return"string"==typeof A?(this.dependencyTracker?.recordNamedDependency(c,A),A.startsWith("g_")?this.commonObjs.get(A):this.objs.get(A)):E}beginDrawing({transform:c,viewport:A,transparency:E=!1,background:C=null}){let T=this.ctx.canvas.width,M=this.ctx.canvas.height,k=this.ctx.fillStyle;if(this.ctx.fillStyle=C||"#ffffff",this.ctx.fillRect(0,0,T,M),this.ctx.fillStyle=k,E){let c=this.cachedCanvases.getCanvas("transparent",T,M);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Jt(this.compositeCtx))}this.ctx.save(),es(this.ctx),c&&(this.ctx.transform(...c),this.outputScaleX=c[0],this.outputScaleY=c[0]),this.ctx.transform(...A.transform),this.viewportScale=A.scale,this.baseTransform=Jt(this.ctx)}executeOperatorList(c,A,E,C,T){let M,k;let I=c.argsArray,N=c.fnArray,O=A||0,U=I.length;if(U===O)return O;let j=U-O>10&&"function"==typeof E,$=j?Date.now()+15:0,V=0,G=this.commonObjs,W=this.objs;for(;;){if(void 0!==C&&O===C.nextBreakPoint)return C.breakIt(O,E),O;if(!T||T(O)){if(M=N[O],k=I[O]??null,M!==tg.dependency)null===k?this[M](O):this[M](O,...k);else for(let c of k){this.dependencyTracker?.recordNamedData(c,O);let A=c.startsWith("g_")?G:W;if(!A.has(c))return A.get(c,E),O}}if(++O===U)return O;if(j&&++V>10){if(Date.now()>$)return E(),O;V=0}}}#i1(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){for(let c of(this.#i1(),this.cachedCanvases.clear(),this.cachedPatterns.clear(),this._cachedBitmapsMap.values())){for(let A of c.values())"undefined"!=typeof HTMLCanvasElement&&A instanceof HTMLCanvasElement&&(A.width=A.height=0);c.clear()}this._cachedBitmapsMap.clear(),this.#i2()}#i2(){if(this.pageColors){let c=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==c){let A=this.ctx.filter;this.ctx.filter=c,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=A}}}_scaleImage(c,A){let E=c.width??c.displayWidth,C=c.height??c.displayHeight,T,M,k=Math.max(Math.hypot(A[0],A[1]),1),I=Math.max(Math.hypot(A[2],A[3]),1),N=E,O=C,U="prescale1";for(;k>2&&N>1||I>2&&O>1;){let A=N,E=O;k>2&&N>1&&(A=N>=16384?Math.floor(N/2)-1||1:Math.ceil(N/2),k/=N/A),I>2&&O>1&&(E=O>=16384?Math.floor(O/2)-1||1:Math.ceil(O)/2,I/=O/E),(M=(T=this.cachedCanvases.getCanvas(U,A,E)).context).clearRect(0,0,A,E),M.drawImage(c,0,0,N,O,0,0,A,E),c=T.canvas,N=A,O=E,U="prescale1"===U?"prescale2":"prescale1"}return{img:c,paintWidth:N,paintHeight:O}}_createMaskCanvas(c,A){let E,C,T,M;let k=this.ctx,{width:I,height:N}=A,O=this.current.fillColor,U=this.current.patternFill,j=Jt(k);if((A.bitmap||A.data)&&A.count>1){let M=A.bitmap||A.data.buffer;C=JSON.stringify(U?j:[j.slice(0,4),O]),(E=this._cachedBitmapsMap.get(M))||(E=new Map,this._cachedBitmapsMap.set(M,E));let k=E.get(C);if(k&&!U){let A=Math.round(Math.min(j[0],j[2])+j[4]),E=Math.round(Math.min(j[1],j[3])+j[5]);return this.dependencyTracker?.recordDependencies(c,t$),{canvas:k,offsetX:A,offsetY:E}}T=k}T||Zi((M=this.cachedCanvases.getCanvas("maskCanvas",I,N)).context,A);let $=Ct.transform(j,[1/I,0,0,-1/N,0,0]);$=Ct.transform($,[1,0,0,1,0,-N]);let V=tY.slice();Ct.axialAlignedBoundingBox([0,0,I,N],$,V);let[G,W,q,X]=V,Y=Math.round(q-G)||1,K=Math.round(X-W)||1,J=this.cachedCanvases.getCanvas("fillCanvas",Y,K),Q=J.context;Q.translate(-G,-W),Q.transform(...$),T||(T=(T=this._scaleImage(M.canvas,Zt(Q))).img,E&&U&&E.set(C,T)),Q.imageSmoothingEnabled=is(Jt(Q),A.interpolate),Ki(Q,T,0,0,T.width,T.height,0,0,I,N),Q.globalCompositeOperation="source-in";let Z=Ct.transform(Zt(Q),[1,0,0,1,-G,-W]);return Q.fillStyle=U?O.getPattern(k,this,Z,tV,c):O,Q.fillRect(0,0,I,N),E&&!U&&(this.cachedCanvases.delete("fillCanvas"),E.set(C,J.canvas)),this.dependencyTracker?.recordDependencies(c,t$),{canvas:J.canvas,offsetX:Math.round(G),offsetY:Math.round(W)}}setLineWidth(c,A){this.dependencyTracker?.recordSimpleData("lineWidth",c),A!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=A,this.ctx.lineWidth=A}setLineCap(c,A){this.dependencyTracker?.recordSimpleData("lineCap",c),this.ctx.lineCap=tK[A]}setLineJoin(c,A){this.dependencyTracker?.recordSimpleData("lineJoin",c),this.ctx.lineJoin=tJ[A]}setMiterLimit(c,A){this.dependencyTracker?.recordSimpleData("miterLimit",c),this.ctx.miterLimit=A}setDash(c,A,E){this.dependencyTracker?.recordSimpleData("dash",c);let C=this.ctx;void 0!==C.setLineDash&&(C.setLineDash(A),C.lineDashOffset=E)}setRenderingIntent(c,A){}setFlatness(c,A){}setGState(c,A){for(let[E,C]of A)switch(E){case"LW":this.setLineWidth(c,C);break;case"LC":this.setLineCap(c,C);break;case"LJ":this.setLineJoin(c,C);break;case"ML":this.setMiterLimit(c,C);break;case"D":this.setDash(c,C[0],C[1]);break;case"RI":this.setRenderingIntent(c,C);break;case"FL":this.setFlatness(c,C);break;case"Font":this.setFont(c,C[0],C[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",c),this.current.strokeAlpha=C;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",c),this.ctx.globalAlpha=this.current.fillAlpha=C;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",c),this.ctx.globalCompositeOperation=C;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",c),this.current.activeSMask=C?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",c),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(C)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let c=this.inSMaskMode;this.current.activeSMask&&!c?this.beginSMaskMode():!this.current.activeSMask&&c&&this.endSMaskMode()}beginSMaskMode(c){if(this.inSMaskMode)throw Error("beginSMaskMode called while already in smask mode");let A=this.ctx.canvas.width,E=this.ctx.canvas.height,C="smaskGroupAt"+this.groupLevel,T=this.cachedCanvases.getCanvas(C,A,E);this.suspendedCtx=this.ctx;let M=this.ctx=T.context;M.setTransform(this.suspendedCtx.getTransform()),ts(this.suspendedCtx,M),function(c,A){if(c._removeMirroring)throw Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){A.save(),this.__originalSave()},c.restore=function(){A.restore(),this.__originalRestore()},c.translate=function(c,E){A.translate(c,E),this.__originalTranslate(c,E)},c.scale=function(c,E){A.scale(c,E),this.__originalScale(c,E)},c.transform=function(c,E,C,T,M,k){A.transform(c,E,C,T,M,k),this.__originalTransform(c,E,C,T,M,k)},c.setTransform=function(c,E,C,T,M,k){A.setTransform(c,E,C,T,M,k),this.__originalSetTransform(c,E,C,T,M,k)},c.resetTransform=function(){A.resetTransform(),this.__originalResetTransform()},c.rotate=function(c){A.rotate(c),this.__originalRotate(c)},c.clip=function(c){A.clip(c),this.__originalClip(c)},c.moveTo=function(c,E){A.moveTo(c,E),this.__originalMoveTo(c,E)},c.lineTo=function(c,E){A.lineTo(c,E),this.__originalLineTo(c,E)},c.bezierCurveTo=function(c,E,C,T,M,k){A.bezierCurveTo(c,E,C,T,M,k),this.__originalBezierCurveTo(c,E,C,T,M,k)},c.rect=function(c,E,C,T){A.rect(c,E,C,T),this.__originalRect(c,E,C,T)},c.closePath=function(){A.closePath(),this.__originalClosePath()},c.beginPath=function(){A.beginPath(),this.__originalBeginPath()}}(M,this.suspendedCtx),this.setGState(c,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ts(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(c){if(!this.current.activeSMask)return;c?(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.ceil(c[2]),c[3]=Math.ceil(c[3])):c=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let A=this.current.activeSMask,E=this.suspendedCtx;this.composeSMask(E,A,this.ctx,c),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(c,A,E,C){let T=C[0],M=C[1],k=C[2]-T,I=C[3]-M;0!==k&&0!==I&&(this.genericComposeSMask(A.context,E,k,I,A.subtype,A.backdrop,A.transferMap,T,M,A.offsetX,A.offsetY),c.save(),c.globalAlpha=1,c.globalCompositeOperation="source-over",c.setTransform(1,0,0,1,0,0),c.drawImage(E.canvas,0,0),c.restore())}genericComposeSMask(c,A,E,C,T,M,k,I,N,O,U){let j=c.canvas,$=I-O,V=N-U;if(M){if($<0||V<0||$+E>j.width||V+C>j.height){let c=this.cachedCanvases.getCanvas("maskExtension",E,C),A=c.context;A.drawImage(j,-$,-V),A.globalCompositeOperation="destination-atop",A.fillStyle=M,A.fillRect(0,0,E,C),A.globalCompositeOperation="source-over",j=c.canvas,$=V=0}else{c.save(),c.globalAlpha=1,c.setTransform(1,0,0,1,0,0);let A=new Path2D;A.rect($,V,E,C),c.clip(A),c.globalCompositeOperation="destination-atop",c.fillStyle=M,c.fillRect($,V,E,C),c.restore()}}A.save(),A.globalAlpha=1,A.setTransform(1,0,0,1,0,0),"Alpha"===T&&k?A.filter=this.filterFactory.addAlphaFilter(k):"Luminosity"===T&&(A.filter=this.filterFactory.addLuminosityFilter(k));let G=new Path2D;G.rect(I,N,E,C),A.clip(G),A.globalCompositeOperation="destination-in",A.drawImage(j,$,V,E,C,I,N,E,C),A.restore()}save(c){this.inSMaskMode&&ts(this.ctx,this.suspendedCtx),this.ctx.save();let A=this.current;this.stateStack.push(A),this.current=A.clone(),this.dependencyTracker?.save(c)}restore(c){this.dependencyTracker?.restore(c),0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ts(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}transform(c,A,E,C,T,M,k){this.dependencyTracker?.recordIncrementalData("transform",c),this.ctx.transform(A,E,C,T,M,k),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(c,A,E,C){let[T]=E;if(!C)return T||=E[0]=new Path2D,void this[A](c,T);if(null!==this.dependencyTracker){let E=A===tg.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(c).recordBBox(c,this.ctx,C[0]-E,C[2]+E,C[1]-E,C[3]+E).recordDependencies(c,["transform"])}if(!(T instanceof Path2D)){let c=E[0]=new Path2D;for(let A=0,E=T.length;A<E;)switch(T[A++]){case 0:c.moveTo(T[A++],T[A++]);break;case 1:c.lineTo(T[A++],T[A++]);break;case 2:c.bezierCurveTo(T[A++],T[A++],T[A++],T[A++],T[A++],T[A++]);break;case 3:c.closePath();break;default:ht(`Unrecognized drawing path operator: ${T[A-1]}`)}T=c}Ct.axialAlignedBoundingBox(C,Jt(this.ctx),this.current.minMax),this[A](c,T),this._pathStartIdx=c}closePath(c){this.ctx.closePath()}stroke(c,A,E=!0){let C=this.ctx,T=this.current.strokeColor;if(C.globalAlpha=this.current.strokeAlpha,this.contentVisible){if("object"==typeof T&&T?.getPattern){let E=T.isModifyingCurrentTransform()?C.getTransform():null;if(C.save(),C.strokeStyle=T.getPattern(C,this,Zt(C),tG,c),E){let c=new Path2D;c.addPath(A,C.getTransform().invertSelf().multiplySelf(E)),A=c}this.rescaleAndStroke(A,!1),C.restore()}else this.rescaleAndStroke(A,!0)}this.dependencyTracker?.recordDependencies(c,tO),E&&this.consumePath(c,A,this.current.getClippedPathBoundingBox(tG,Jt(this.ctx))),C.globalAlpha=this.current.fillAlpha}closeStroke(c,A){this.stroke(c,A)}fill(c,A,E=!0){let C=this.ctx,T=this.current.fillColor,M=!1;if(this.current.patternFill){let E=T.isModifyingCurrentTransform()?C.getTransform():null;if(this.dependencyTracker?.save(c),C.save(),C.fillStyle=T.getPattern(C,this,Zt(C),tV,c),E){let c=new Path2D;c.addPath(A,C.getTransform().invertSelf().multiplySelf(E)),A=c}M=!0}let k=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==k&&(this.pendingEOFill?(C.fill(A,"evenodd"),this.pendingEOFill=!1):C.fill(A)),this.dependencyTracker?.recordDependencies(c,tB),M&&(C.restore(),this.dependencyTracker?.restore(c)),E&&this.consumePath(c,A,k)}eoFill(c,A){this.pendingEOFill=!0,this.fill(c,A)}fillStroke(c,A){this.fill(c,A,!1),this.stroke(c,A,!1),this.consumePath(c,A)}eoFillStroke(c,A){this.pendingEOFill=!0,this.fillStroke(c,A)}closeFillStroke(c,A){this.fillStroke(c,A)}closeEOFillStroke(c,A){this.pendingEOFill=!0,this.fillStroke(c,A)}endPath(c,A){this.consumePath(c,A)}rawFillPath(c,A){this.ctx.fill(A),this.dependencyTracker?.recordDependencies(c,tz).recordOperation(c)}clip(c){this.dependencyTracker?.recordFutureForcedDependency("clipMode",c),this.pendingClip=tQ}eoClip(c){this.dependencyTracker?.recordFutureForcedDependency("clipMode",c),this.pendingClip=tZ}beginText(c){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(c).resetIncrementalData("sameLineText").resetIncrementalData("moveText",c)}endText(c){let A=this.pendingTextPaths,E=this.ctx;if(this.dependencyTracker){let{dependencyTracker:E}=this;void 0!==A&&E.recordFutureForcedDependency("textClip",E.getOpenMarker()).recordFutureForcedDependency("textClip",c),E.recordCloseMarker(c)}if(void 0!==A){let c=new Path2D,C=E.getTransform().invertSelf();for(let{transform:E,x:T,y:M,fontSize:k,path:I}of A)I&&c.addPath(I,new DOMMatrix(E).preMultiplySelf(C).translate(T,M).scale(k,-k));E.clip(c)}delete this.pendingTextPaths}setCharSpacing(c,A){this.dependencyTracker?.recordSimpleData("charSpacing",c),this.current.charSpacing=A}setWordSpacing(c,A){this.dependencyTracker?.recordSimpleData("wordSpacing",c),this.current.wordSpacing=A}setHScale(c,A){this.dependencyTracker?.recordSimpleData("hScale",c),this.current.textHScale=A/100}setLeading(c,A){this.dependencyTracker?.recordSimpleData("leading",c),this.current.leading=-A}setFont(c,A,E){this.dependencyTracker?.recordSimpleData("font",c).recordSimpleDataFromNamed("fontObj",A,c);let C=this.commonObjs.get(A),T=this.current;if(!C)throw Error(`Can't find font for ${A}`);if(T.fontMatrix=C.fontMatrix||tt,0!==T.fontMatrix[0]&&0!==T.fontMatrix[3]||ht("Invalid font matrix for font "+A),E<0?(E=-E,T.fontDirection=-1):T.fontDirection=1,this.current.font=C,this.current.fontSize=E,C.isType3Font)return;let M=C.loadedName||"sans-serif",k=C.systemFontInfo?.css||`"${M}", ${C.fallbackName}`,I="normal";C.black?I="900":C.bold&&(I="bold");let N=C.italic?"italic":"normal",O=E;E<16?O=16:E>100&&(O=100),this.current.fontSizeScale=E/O,this.ctx.font=`${N} ${I} ${O}px ${k}`}setTextRenderingMode(c,A){this.dependencyTracker?.recordSimpleData("textRenderingMode",c),this.current.textRenderingMode=A}setTextRise(c,A){this.dependencyTracker?.recordSimpleData("textRise",c),this.current.textRise=A}moveText(c,A,E){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",c),this.current.x=this.current.lineX+=A,this.current.y=this.current.lineY+=E}setLeadingMoveText(c,A,E){this.setLeading(c,-E),this.moveText(c,A,E)}setTextMatrix(c,A){this.dependencyTracker?.recordSimpleData("textMatrix",c);let{current:E}=this;E.textMatrix=A,E.textMatrixScale=Math.hypot(A[0],A[1]),E.x=E.lineX=0,E.y=E.lineY=0}nextLine(c){this.moveText(c,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??c)}#i5(c,A,E){let C=new Path2D;return C.addPath(c,new DOMMatrix(E).invertSelf().multiplySelf(A)),C}paintChar(c,A,E,C,T,M){let k;let I=this.ctx,N=this.current,O=N.font,U=N.textRenderingMode,j=N.fontSize/N.fontSizeScale,$=3&U,V=!!(4&U),G=N.patternFill&&!O.missingFile,W=N.patternStroke&&!O.missingFile;if((O.disableFontFace||V||G||W)&&!O.missingFile&&(k=O.getPathGenerator(this.commonObjs,A)),k&&(O.disableFontFace||G||W)){let A;if(I.save(),I.translate(E,C),I.scale(j,-j),this.dependencyTracker?.recordCharacterBBox(c,I,O),0===$||2===$){if(T){A=I.getTransform(),I.setTransform(...T);let c=this.#i5(k,A,T);I.fill(c)}else I.fill(k)}if(1===$||2===$){if(M){A||=I.getTransform(),I.setTransform(...M);let{a:c,b:E,c:C,d:T}=A,N=Ct.inverseTransform(M),O=Ct.transform([c,E,C,T,0,0],N);Ct.singularValueDecompose2dScale(O,tX),I.lineWidth*=Math.max(tX[0],tX[1])/j,I.stroke(this.#i5(k,A,M))}else I.lineWidth/=j,I.stroke(k)}I.restore()}else 0!==$&&2!==$||(I.fillText(A,E,C),this.dependencyTracker?.recordCharacterBBox(c,I,O,j,E,C,()=>I.measureText(A))),1!==$&&2!==$||(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(c,I,O,j,E,C,()=>I.measureText(A)).recordDependencies(c,tO),I.strokeText(A,E,C));V&&((this.pendingTextPaths||=[]).push({transform:Jt(I),x:E,y:C,fontSize:j,path:k}),this.dependencyTracker?.recordCharacterBBox(c,I,O,j,E,C))}get isFontSubpixelAAEnabled(){let{context:c}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);c.scale(1.5,1),c.fillText("I",0,10);let A=c.getImageData(0,0,10,10).data,E=!1;for(let c=3;c<A.length;c+=4)if(A[c]>0&&A[c]<255){E=!0;break}return gt(this,"isFontSubpixelAAEnabled",E)}showText(c,A){let E,C;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(c,tj).resetBBox(c),4&this.current.textRenderingMode&&this.dependencyTracker.recordFutureForcedDependency("textClip",c).inheritPendingDependenciesAsFutureForcedDependencies());let T=this.current,M=T.font;if(M.isType3Font)return this.showType3Text(c,A),void this.dependencyTracker?.recordShowTextOperation(c);let k=T.fontSize;if(0===k)return void this.dependencyTracker?.recordOperation(c);let I=this.ctx,N=T.fontSizeScale,O=T.charSpacing,U=T.wordSpacing,j=T.fontDirection,$=T.textHScale*j,V=A.length,G=M.vertical,W=G?1:-1,q=M.defaultVMetrics,X=k*T.fontMatrix[0],Y=0===T.textRenderingMode&&!M.disableFontFace&&!T.patternFill;if(I.save(),T.textMatrix&&I.transform(...T.textMatrix),I.translate(T.x,T.y+T.textRise),j>0?I.scale($,-1):I.scale($,1),T.patternFill){I.save();let A=T.fillColor.getPattern(I,this,Zt(I),tV,c);E=Jt(I),I.restore(),I.fillStyle=A}if(T.patternStroke){I.save();let A=T.strokeColor.getPattern(I,this,Zt(I),tG,c);C=Jt(I),I.restore(),I.strokeStyle=A}let K=T.lineWidth,J=T.textMatrixScale;if(0===J||0===K){let c=3&T.textRenderingMode;1!==c&&2!==c||(K=this.getSinglePixelWidth())}else K/=J;if(1!==N&&(I.scale(N,N),K/=N),I.lineWidth=K,M.isInvalidPDFjsFont){let E=[],C=0;for(let c of A)E.push(c.unicode),C+=c.width;let M=E.join("");if(I.fillText(M,0,0),null!==this.dependencyTracker){let A=I.measureText(M);this.dependencyTracker.recordBBox(c,this.ctx,-A.actualBoundingBoxLeft,A.actualBoundingBoxRight,-A.actualBoundingBoxAscent,A.actualBoundingBoxDescent).recordShowTextOperation(c)}return T.x+=C*X*$,I.restore(),void this.compose()}let Q,Z=0;for(Q=0;Q<V;++Q){let T=A[Q];if("number"==typeof T){Z+=W*T*k/1e3;continue}let $=!1,V=(T.isSpace?U:0)+O,K=T.fontChar,J=T.accent,tt,ta,to,tl=T.width;if(G){let c=T.vmetric||q,A=-(T.vmetric?c[1]:.5*tl)*X,E=c[2]*X;tl=c?-c[0]:tl,tt=A/N,ta=(Z+E)/N}else tt=Z/N,ta=0;if(M.remeasure&&tl>0){to=I.measureText(K);let c=1e3*to.width/k*N;if(tl<c&&this.isFontSubpixelAAEnabled){let A=tl/c;$=!0,I.save(),I.scale(A,1),tt/=A}else tl!==c&&(tt+=(tl-c)/2e3*k/N)}if(this.contentVisible&&(T.isInFont||M.missingFile)){if(Y&&!J)I.fillText(K,tt,ta),this.dependencyTracker?.recordCharacterBBox(c,I,to?{bbox:null}:M,k/N,tt,ta,()=>to??I.measureText(K));else if(this.paintChar(c,K,tt,ta,E,C),J){let A=tt+k*J.offset.x/N,T=ta-k*J.offset.y/N;this.paintChar(c,J.fontChar,A,T,E,C)}}Z+=G?tl*X-V*j:tl*X+V*j,$&&I.restore()}G?T.y-=Z:T.x+=Z*$,I.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(c)}showType3Text(c,A){let E,C,T,M;let k=this.ctx,I=this.current,N=I.font,O=I.fontSize,U=I.fontDirection,j=N.vertical?1:-1,$=I.charSpacing,V=I.wordSpacing,G=I.textHScale*U,W=I.fontMatrix||tt,q=A.length;if(3===I.textRenderingMode||0===O)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,k.save(),I.textMatrix&&k.transform(...I.textMatrix),k.translate(I.x,I.y+I.textRise),k.scale(G,U);let X=this.dependencyTracker;for(this.dependencyTracker=X?new _i(X,c):null,E=0;E<q;++E){if("number"==typeof(C=A[E])){M=j*C*O/1e3,this.ctx.translate(M,0),I.x+=M*G;continue}let c=(C.isSpace?V:0)+$,U=N.charProcOperatorList[C.operatorListId];U?this.contentVisible&&(this.save(),k.scale(O,O),k.transform(...W),this.executeOperatorList(U),this.restore()):ht(`Type3 character "${C.operatorListId}" is not available.`);let q=[C.width,0];Ct.applyTransform(q,W),T=q[0]*O+c,k.translate(T,0),I.x+=T*G}k.restore(),X&&(this.dependencyTracker=X)}setCharWidth(c,A,E){}setCharWidthAndBounds(c,A,E,C,T,M,k){let I=new Path2D;I.rect(C,T,M-C,k-T),this.ctx.clip(I),this.dependencyTracker?.recordBBox(c,this.ctx,C,M,T,k).recordClipBox(c,this.ctx,C,M,T,k),this.endPath(c)}getColorN_Pattern(c,A){let E;if("TilingPattern"===A[0]){let c=this.baseTransform||Jt(this.ctx);E=new $i(A,this.ctx,{createCanvasGraphics:(c,A)=>new os(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new _i(this.dependencyTracker,A,!0):null)},c)}else E=this._getPattern(c,A[1],A[2]);return E}setStrokeColorN(c,...A){this.dependencyTracker?.recordSimpleData("strokeColor",c),this.current.strokeColor=this.getColorN_Pattern(c,A),this.current.patternStroke=!0}setFillColorN(c,...A){this.dependencyTracker?.recordSimpleData("fillColor",c),this.current.fillColor=this.getColorN_Pattern(c,A),this.current.patternFill=!0}setStrokeRGBColor(c,A){this.dependencyTracker?.recordSimpleData("strokeColor",c),this.ctx.strokeStyle=this.current.strokeColor=A,this.current.patternStroke=!1}setStrokeTransparent(c){this.dependencyTracker?.recordSimpleData("strokeColor",c),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(c,A){this.dependencyTracker?.recordSimpleData("fillColor",c),this.ctx.fillStyle=this.current.fillColor=A,this.current.patternFill=!1}setFillTransparent(c){this.dependencyTracker?.recordSimpleData("fillColor",c),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(c,A,E=null){let C;return this.cachedPatterns.has(A)?C=this.cachedPatterns.get(A):(C=function(c){switch(c[0]){case"RadialAxial":return new Fi(c);case"Mesh":return new Ui(c);case"Dummy":return new zi}throw Error(`Unknown IR type: ${c[0]}`)}(this.getObject(c,A)),this.cachedPatterns.set(A,C)),E&&(C.matrix=E),C}shadingFill(c,A){if(!this.contentVisible)return;let E=this.ctx;this.save(c);let C=this._getPattern(c,A);E.fillStyle=C.getPattern(E,this,Zt(E),tW,c);let T=Zt(E);if(T){let{width:c,height:A}=E.canvas,C=tY.slice();Ct.axialAlignedBoundingBox([0,0,c,A],T,C);let[M,k,I,N]=C;this.ctx.fillRect(M,k,I-M,N-k)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(c).recordFullPageBBox(c).recordDependencies(c,tH).recordDependencies(c,tB).recordOperation(c),this.compose(this.current.getClippedPathBoundingBox()),this.restore(c)}beginInlineImage(){ct("Should not call beginInlineImage")}beginImageData(){ct("Should not call beginImageData")}paintFormXObjectBegin(c,A,E){if(this.contentVisible&&(this.save(c),this.baseTransformStack.push(this.baseTransform),A&&this.transform(c,...A),this.baseTransform=Jt(this.ctx),E)){Ct.axialAlignedBoundingBox(E,this.baseTransform,this.current.minMax);let[A,C,T,M]=E,k=new Path2D;k.rect(A,C,T-A,M-C),this.ctx.clip(k),this.dependencyTracker?.recordClipBox(c,this.ctx,A,T,C,M),this.endPath(c)}}paintFormXObjectEnd(c){this.contentVisible&&(this.restore(c),this.baseTransform=this.baseTransformStack.pop())}beginGroup(c,A){if(!this.contentVisible)return;this.save(c),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let E=this.ctx;A.isolated||lt("TODO: Support non-isolated groups."),A.knockout&&ht("Knockout groups not supported.");let C=Jt(E);if(A.matrix&&E.transform(...A.matrix),!A.bbox)throw Error("Bounding box is required.");let T=tY.slice();Ct.axialAlignedBoundingBox(A.bbox,Jt(E),T);let M=[0,0,E.canvas.width,E.canvas.height];T=Ct.intersect(T,M)||[0,0,0,0];let k=Math.floor(T[0]),I=Math.floor(T[1]),N=Math.max(Math.ceil(T[2])-k,1),O=Math.max(Math.ceil(T[3])-I,1);this.current.startNewPathAndClipBox([0,0,N,O]);let U="groupAt"+this.groupLevel;A.smask&&(U+="_smask_"+this.smaskCounter++%2);let j=this.cachedCanvases.getCanvas(U,N,O),$=j.context;$.translate(-k,-I),$.transform(...C);let V=new Path2D,[G,W,q,X]=A.bbox;if(V.rect(G,W,q-G,X-W),A.matrix){let c=new Path2D;c.addPath(V,new DOMMatrix(A.matrix)),V=c}$.clip(V),A.smask&&this.smaskStack.push({canvas:j.canvas,context:$,offsetX:k,offsetY:I,subtype:A.smask.subtype,backdrop:A.smask.backdrop,transferMap:A.smask.transferMap||null,startTransformInverse:null}),A.smask&&!this.dependencyTracker||(E.setTransform(1,0,0,1,0,0),E.translate(k,I),E.save()),ts(E,$),this.ctx=$,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(E),this.setGState(c,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(E),this.groupLevel++}endGroup(c,A){if(!this.contentVisible)return;this.groupLevel--;let E=this.ctx,C=this.groupStack.pop();if(this.ctx=C,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),A.smask)this.tempSMask=this.smaskStack.pop(),this.restore(c),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();let A=Jt(this.ctx);this.restore(c),this.ctx.save(),this.ctx.setTransform(...A);let C=tY.slice();Ct.axialAlignedBoundingBox([0,0,E.canvas.width,E.canvas.height],A,C),this.ctx.drawImage(E.canvas,0,0),this.ctx.restore(),this.compose(C)}}beginAnnotation(c,A,E,C,T,M){if(this.#i1(),es(this.ctx),this.ctx.save(),this.save(c),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),E){let T=E[2]-E[0],k=E[3]-E[1];if(M&&this.annotationCanvasMap){(C=C.slice())[4]-=E[0],C[5]-=E[1],(E=E.slice())[0]=E[1]=0,E[2]=T,E[3]=k,Ct.singularValueDecompose2dScale(Jt(this.ctx),tX);let{viewportScale:c}=this,M=Math.ceil(T*this.outputScaleX*c),I=Math.ceil(k*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(M,I);let{canvas:N,context:O}=this.annotationCanvas;this.annotationCanvasMap.set(A,N),this.annotationCanvas.savedCtx=this.ctx,this.ctx=O,this.ctx.save(),this.ctx.setTransform(tX[0],0,0,-tX[1],0,k*tX[1]),es(this.ctx)}else{es(this.ctx),this.endPath(c);let A=new Path2D;A.rect(E[0],E[1],T,k),this.ctx.clip(A)}}this.current=new Qi(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(c,...C),this.transform(c,...T)}endAnnotation(c){this.annotationCanvas&&(this.ctx.restore(),this.#i2(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(c,A){if(!this.contentVisible)return;let E=A.count;(A=this.getObject(c,A.data,A)).count=E;let C=this.ctx,T=this._createMaskCanvas(c,A),M=T.canvas;C.save(),C.setTransform(1,0,0,1,0,0),C.drawImage(M,T.offsetX,T.offsetY),this.dependencyTracker?.resetBBox(c).recordBBox(c,this.ctx,T.offsetX,T.offsetX+M.width,T.offsetY,T.offsetY+M.height).recordOperation(c),C.restore(),this.compose()}paintImageMaskXObjectRepeat(c,A,E,C=0,T=0,M,k){if(!this.contentVisible)return;A=this.getObject(c,A.data,A);let I=this.ctx;I.save();let N=Jt(I);I.transform(E,C,T,M,0,0);let O=this._createMaskCanvas(c,A);I.setTransform(1,0,0,1,O.offsetX-N[4],O.offsetY-N[5]),this.dependencyTracker?.resetBBox(c);for(let A=0,U=k.length;A<U;A+=2){let U=Ct.transform(N,[E,C,T,M,k[A],k[A+1]]);I.drawImage(O.canvas,U[4],U[5]),this.dependencyTracker?.recordBBox(c,this.ctx,U[4],U[4]+O.canvas.width,U[5],U[5]+O.canvas.height)}I.restore(),this.compose(),this.dependencyTracker?.recordOperation(c)}paintImageMaskXObjectGroup(c,A){if(!this.contentVisible)return;let E=this.ctx,C=this.current.fillColor,T=this.current.patternFill;for(let M of(this.dependencyTracker?.resetBBox(c).recordDependencies(c,t$),A)){let{data:A,width:k,height:I,transform:N}=M,O=this.cachedCanvases.getCanvas("maskCanvas",k,I),U=O.context;U.save(),Zi(U,this.getObject(c,A,M)),U.globalCompositeOperation="source-in",U.fillStyle=T?C.getPattern(U,this,Zt(E),tV,c):C,U.fillRect(0,0,k,I),U.restore(),E.save(),E.transform(...N),E.scale(1,-1),Ki(E,O.canvas,0,0,k,I,0,-1,1,1),this.dependencyTracker?.recordBBox(c,E,0,k,0,I),E.restore()}this.compose(),this.dependencyTracker?.recordOperation(c)}paintImageXObject(c,A){if(!this.contentVisible)return;let E=this.getObject(c,A);E?this.paintInlineImageXObject(c,E):ht("Dependent image isn't ready yet")}paintImageXObjectRepeat(c,A,E,C,T){if(!this.contentVisible)return;let M=this.getObject(c,A);if(!M)return void ht("Dependent image isn't ready yet");let k=M.width,I=M.height,N=[];for(let c=0,A=T.length;c<A;c+=2)N.push({transform:[E,0,0,C,T[c],T[c+1]],x:0,y:0,w:k,h:I});this.paintInlineImageXObjectGroup(c,M,N)}applyTransferMapsToCanvas(c){return"none"!==this.current.transferMaps&&(c.filter=this.current.transferMaps,c.drawImage(c.canvas,0,0),c.filter="none"),c.canvas}applyTransferMapsToBitmap(c){if("none"===this.current.transferMaps)return c.bitmap;let{bitmap:A,width:E,height:C}=c,T=this.cachedCanvases.getCanvas("inlineImage",E,C),M=T.context;return M.filter=this.current.transferMaps,M.drawImage(A,0,0),M.filter="none",T.canvas}paintInlineImageXObject(c,A){let E;if(!this.contentVisible)return;let C=A.width,T=A.height,M=this.ctx;this.save(c);let{filter:k}=M;if("none"!==k&&""!==k&&(M.filter="none"),M.scale(1/C,-1/T),A.bitmap)E=this.applyTransferMapsToBitmap(A);else if("function"==typeof HTMLElement&&A instanceof HTMLElement||!A.data)E=A;else{let c=this.cachedCanvases.getCanvas("inlineImage",C,T).context;Ji(c,A),E=this.applyTransferMapsToCanvas(c)}let I=this._scaleImage(E,Zt(M));M.imageSmoothingEnabled=is(Jt(M),A.interpolate),this.dependencyTracker?.resetBBox(c).recordBBox(c,M,0,C,-T,0).recordDependencies(c,tU).recordOperation(c),Ki(M,I.img,0,0,I.paintWidth,I.paintHeight,0,-T,C,T),this.compose(),this.restore(c)}paintInlineImageXObjectGroup(c,A,E){let C;if(!this.contentVisible)return;let T=this.ctx;if(A.bitmap)C=A.bitmap;else{let c=A.width,E=A.height,T=this.cachedCanvases.getCanvas("inlineImage",c,E).context;Ji(T,A),C=this.applyTransferMapsToCanvas(T)}for(let A of(this.dependencyTracker?.resetBBox(c),E))T.save(),T.transform(...A.transform),T.scale(1,-1),Ki(T,C,A.x,A.y,A.w,A.h,0,-1,1,1),this.dependencyTracker?.recordBBox(c,T,0,1,-1,0),T.restore();this.dependencyTracker?.recordOperation(c),this.compose()}paintSolidColorImageMask(c){this.contentVisible&&(this.dependencyTracker?.resetBBox(c).recordBBox(c,this.ctx,0,1,0,1).recordDependencies(c,tB).recordOperation(c),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(c,A){}markPointProps(c,A,E){}beginMarkedContent(c,A){this.dependencyTracker?.beginMarkedContent(c),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(c,A,E){this.dependencyTracker?.beginMarkedContent(c),"OC"===A?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(E)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(c){this.dependencyTracker?.endMarkedContent(c),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(c){}endCompat(c){}consumePath(c,A,E){let C=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(E);let T=this.ctx;this.pendingClip?(C||(this.pendingClip===tZ?T.clip(A,"evenodd"):T.clip(A)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(c).recordFutureForcedDependency("clipPath",c)):this.dependencyTracker?.recordOperation(c),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let c=Jt(this.ctx);if(0===c[1]&&0===c[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(c[0]),Math.abs(c[3]));else{let A=Math.abs(c[0]*c[3]-c[2]*c[1]),E=Math.hypot(c[0],c[2]),C=Math.hypot(c[1],c[3]);this._cachedGetSinglePixelWidth=Math.max(E,C)/A}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let c,A;let{lineWidth:E}=this.current,{a:C,b:T,c:M,d:k}=this.ctx.getTransform();if(0===T&&0===M){let T=Math.abs(C),M=Math.abs(k);if(T===M){if(0===E)c=A=1/T;else{let C=T*E;c=A=C<1?1/C:1}}else if(0===E)c=1/T,A=1/M;else{let C=T*E,k=M*E;c=C<1?1/C:1,A=k<1?1/k:1}}else{let I=Math.abs(C*k-T*M),N=Math.hypot(C,T),O=Math.hypot(M,k);if(0===E)c=O/I,A=N/I;else{let C=E*I;c=O>C?O/C:1,A=N>C?N/C:1}}this._cachedScaleForStroking[0]=c,this._cachedScaleForStroking[1]=A}return this._cachedScaleForStroking}rescaleAndStroke(c,A){let{ctx:E,current:{lineWidth:C}}=this,[T,M]=this.getScaleForStroking();if(T===M)return E.lineWidth=(C||1)*T,void E.stroke(c);let k=E.getLineDash();A&&E.save(),E.scale(T,M),tq.a=1/T,tq.d=1/M;let I=new Path2D;if(I.addPath(c,tq),k.length>0){let c=Math.max(T,M);E.setLineDash(k.map(A=>A/c)),E.lineDashOffset/=c}E.lineWidth=C||1,E.stroke(I),A&&E.restore()}isContentVisible(){for(let c=this.markedContentStack.length-1;c>=0;c--)if(!this.markedContentStack[c].visible)return!1;return!0}};for(let c in tg)void 0!==os.prototype[c]&&(os.prototype[tg[c]]=os.prototype[c]);let ls=class ls{#i4;#i3;#i6;static{this.strings=["fontFamily","fontWeight","italicAngle"]}static write(c){let A=new TextEncoder,E={},C=0;for(let T of ls.strings){let M=A.encode(c[T]);E[T]=M,C+=4+M.length}let T=new ArrayBuffer(C),M=new Uint8Array(T),k=new DataView(T),I=0;for(let c of ls.strings){let A=E[c],C=A.length;k.setUint32(I,C),M.set(A,I+4),I+=4+C}return dt(I===T.byteLength,"CssFontInfo.write: Buffer overflow"),T}constructor(c){this.#i4=c,this.#i3=new DataView(this.#i4),this.#i6=new TextDecoder}#i9(c){dt(c<ls.strings.length,"Invalid string index");let A=0;for(let E=0;E<c;E++)A+=this.#i3.getUint32(A)+4;let E=this.#i3.getUint32(A);return this.#i6.decode(new Uint8Array(this.#i4,A+4,E))}get fontFamily(){return this.#i9(0)}get fontWeight(){return this.#i9(1)}get italicAngle(){return this.#i9(2)}};let hs=class hs{#i4;#i3;#i6;static{this.strings=["css","loadedName","baseFontName","src"]}static write(c){let A=new TextEncoder,E={},C=0;for(let T of hs.strings){let M=A.encode(c[T]);E[T]=M,C+=4+M.length}let T,M,k=1+(C+=4);c.style&&(T=A.encode(c.style.style),M=A.encode(c.style.weight),k+=4+T.length+4+M.length);let I=new ArrayBuffer(k),N=new Uint8Array(I),O=new DataView(I),U=0;for(let A of(O.setUint8(U++,c.guessFallback?1:0),O.setUint32(U,0),U+=4,C=0,hs.strings)){let c=E[A],T=c.length;C+=4+T,O.setUint32(U,T),N.set(c,U+4),U+=4+T}return O.setUint32(U-C-4,C),c.style&&(O.setUint32(U,T.length),N.set(T,U+4),U+=4+T.length,O.setUint32(U,M.length),N.set(M,U+4),U+=4+M.length),dt(U<=I.byteLength,"SubstitionInfo.write: Buffer overflow"),I.transferToFixedLength(U)}constructor(c){this.#i4=c,this.#i3=new DataView(this.#i4),this.#i6=new TextDecoder}get guessFallback(){return 0!==this.#i3.getUint8(0)}#i9(c){dt(c<hs.strings.length,"Invalid string index");let A=5;for(let E=0;E<c;E++)A+=this.#i3.getUint32(A)+4;let E=this.#i3.getUint32(A);return this.#i6.decode(new Uint8Array(this.#i4,A+4,E))}get css(){return this.#i9(0)}get loadedName(){return this.#i9(1)}get baseFontName(){return this.#i9(2)}get src(){return this.#i9(3)}get style(){let c=1;c+=4+this.#i3.getUint32(c);let A=this.#i3.getUint32(c),E=this.#i6.decode(new Uint8Array(this.#i4,c+4,A));c+=4+A;let C=this.#i3.getUint32(c);return{style:E,weight:this.#i6.decode(new Uint8Array(this.#i4,c+4,C))}}};let cs=class cs{static{this.bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]}static{this.numbers=["ascent","defaultWidth","descent"]}static{this.strings=["fallbackName","loadedName","mimetype","name"]}static #i8=Math.ceil(2*this.bools.length/8);static #i7=this.#i8+8*this.numbers.length;static #st=this.#i7+1+8;static #se=this.#st+1+48;static #si=this.#se+1+6;#i4;#i6;#i3;constructor({data:c,extra:A}){this.#i4=c,this.#i6=new TextDecoder,this.#i3=new DataView(this.#i4),A&&Object.assign(this,A)}#ss(c){dt(c<cs.bools.length,"Invalid boolean index");let A=Math.floor(c/4),E=2*c%8,C=this.#i3.getUint8(A)>>E&3;return 0===C?void 0:2===C}get black(){return this.#ss(0)}get bold(){return this.#ss(1)}get disableFontFace(){return this.#ss(2)}get fontExtraProperties(){return this.#ss(3)}get isInvalidPDFjsFont(){return this.#ss(4)}get isType3Font(){return this.#ss(5)}get italic(){return this.#ss(6)}get missingFile(){return this.#ss(7)}get remeasure(){return this.#ss(8)}get vertical(){return this.#ss(9)}#sr(c){return dt(c<cs.numbers.length,"Invalid number index"),this.#i3.getFloat64(cs.#i8+8*c)}get ascent(){return this.#sr(0)}get defaultWidth(){return this.#sr(1)}get descent(){return this.#sr(2)}get bbox(){let c=cs.#i7;if(0===this.#i3.getUint8(c))return;c+=1;let A=[];for(let E=0;E<4;E++)A.push(this.#i3.getInt16(c,!0)),c+=2;return A}get fontMatrix(){let c=cs.#st;if(0===this.#i3.getUint8(c))return;c+=1;let A=[];for(let E=0;E<6;E++)A.push(this.#i3.getFloat64(c,!0)),c+=8;return A}get defaultVMetrics(){let c=cs.#se;if(0===this.#i3.getUint8(c))return;c+=1;let A=[];for(let E=0;E<3;E++)A.push(this.#i3.getInt16(c,!0)),c+=2;return A}#i9(c){dt(c<cs.strings.length,"Invalid string index");let A=cs.#si+4;for(let E=0;E<c;E++)A+=this.#i3.getUint32(A)+4;let E=this.#i3.getUint32(A),C=new Uint8Array(E);return C.set(new Uint8Array(this.#i4,A+4,E)),this.#i6.decode(C)}get fallbackName(){return this.#i9(0)}get loadedName(){return this.#i9(1)}get mimetype(){return this.#i9(2)}get name(){return this.#i9(3)}get data(){let c=cs.#si;c+=4+this.#i3.getUint32(c),c+=4+this.#i3.getUint32(c),c+=4+this.#i3.getUint32(c);let A=this.#i3.getUint32(c);if(0!==A)return new Uint8Array(this.#i4,c+4,A)}clearData(){let c=cs.#si;c+=4+this.#i3.getUint32(c),c+=4+this.#i3.getUint32(c),c+=4+this.#i3.getUint32(c);let A=this.#i3.getUint32(c);new Uint8Array(this.#i4,c+4,A).fill(0),this.#i3.setUint32(c,0)}get cssFontInfo(){let c=cs.#si;c+=4+this.#i3.getUint32(c),c+=4+this.#i3.getUint32(c);let A=this.#i3.getUint32(c);if(0===A)return null;let E=new Uint8Array(A);return E.set(new Uint8Array(this.#i4,c+4,A)),new ls(E.buffer)}get systemFontInfo(){let c=cs.#si;c+=4+this.#i3.getUint32(c);let A=this.#i3.getUint32(c);if(0===A)return null;let E=new Uint8Array(A);return E.set(new Uint8Array(this.#i4,c+4,A)),new hs(E.buffer)}static write(c){let A=c.systemFontInfo?hs.write(c.systemFontInfo):null,E=c.cssFontInfo?ls.write(c.cssFontInfo):null,C=new TextEncoder,T={},M=0;for(let A of cs.strings)T[A]=C.encode(c[A]),M+=4+T[A].length;let k=cs.#si+4+M+4+(A?A.byteLength:0)+4+(E?E.byteLength:0)+4+(c.data?c.data.length:0),I=new ArrayBuffer(k),N=new Uint8Array(I),O=new DataView(I),U=0,j=cs.bools.length,$=0,V=0;for(let A=0;A<j;A++){let E=c[cs.bools[A]];$|=(void 0===E?0:E?2:1)<<V,8!==(V+=2)&&A!==j-1||(O.setUint8(U++,$),$=0,V=0)}for(let A of(dt(U===cs.#i8,"FontInfo.write: Boolean properties offset mismatch"),cs.numbers))O.setFloat64(U,c[A]),U+=8;if(dt(U===cs.#i7,"FontInfo.write: Number properties offset mismatch"),c.bbox)for(let A of(O.setUint8(U++,4),c.bbox))O.setInt16(U,A,!0),U+=2;else O.setUint8(U++,0),U+=8;if(dt(U===cs.#st,"FontInfo.write: BBox properties offset mismatch"),c.fontMatrix)for(let A of(O.setUint8(U++,6),c.fontMatrix))O.setFloat64(U,A,!0),U+=8;else O.setUint8(U++,0),U+=48;if(dt(U===cs.#se,"FontInfo.write: FontMatrix properties offset mismatch"),c.defaultVMetrics)for(let A of(O.setUint8(U++,1),c.defaultVMetrics))O.setInt16(U,A,!0),U+=2;else O.setUint8(U++,0),U+=6;for(let c of(dt(U===cs.#si,"FontInfo.write: DefaultVMetrics properties offset mismatch"),O.setUint32(cs.#si,0),U+=4,cs.strings)){let A=T[c],E=A.length;O.setUint32(U,E),N.set(A,U+4),U+=4+E}if(O.setUint32(cs.#si,U-cs.#si-4),A){let c=A.byteLength;O.setUint32(U,c),dt(U+4+c<=I.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),N.set(new Uint8Array(A),U+4),U+=4+c}else O.setUint32(U,0),U+=4;if(E){let c=E.byteLength;O.setUint32(U,c),dt(U+4+c<=I.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),N.set(new Uint8Array(E),U+4),U+=4+c}else O.setUint32(U,0),U+=4;return void 0===c.data?(O.setUint32(U,0),U+=4):(O.setUint32(U,c.data.length),N.set(c.data,U+4),U+=4+c.data.length),dt(U<=I.byteLength,"FontInfo.write: Buffer overflow"),I.transferToFixedLength(U)}};let ds=class ds{static #sn=null;static #sa="";static get workerPort(){return this.#sn}static set workerPort(c){if(!("undefined"!=typeof Worker&&c instanceof Worker)&&null!==c)throw Error("Invalid `workerPort` type.");this.#sn=c}static get workerSrc(){return this.#sa}static set workerSrc(c){if("string"!=typeof c)throw Error("Invalid `workerSrc` type.");this.#sa=c}};let us=class us{#so;#sl;constructor({parsedData:c,rawData:A}){this.#so=c,this.#sl=A}getRaw(){return this.#sl}get(c){return this.#so.get(c)??null}[Symbol.iterator](){return this.#so.entries()}};let t0=Symbol("INTERNAL");let gs=class gs{#sh;#sd;#sc;#su;constructor(c,{name:A,intent:E,usage:C,rbGroups:T}){this.#sh=!1,this.#sd=!1,this.#sc=!1,this.#su=!0,this.#sh=!!(2&c),this.#sd=!!(4&c),this.name=A,this.intent=E,this.usage=C,this.rbGroups=T}get visible(){if(this.#sc)return this.#su;if(!this.#su)return!1;let{print:c,view:A}=this.usage;return this.#sh?"OFF"!==A?.viewState:!this.#sd||"OFF"!==c?.printState}_setVisible(c,A,E=!1){c!==t0&&ct("Internal method `_setVisible` called."),this.#sc=E,this.#su=A}};let ms=class ms{#sp;#sg;#sf;#sm;constructor(c,A=2){if(this.#sp=null,this.#sg=new Map,this.#sf=null,this.#sm=null,this.renderingIntent=A,this.name=null,this.creator=null,null!==c){for(let E of(this.name=c.name,this.creator=c.creator,this.#sm=c.order,c.groups))this.#sg.set(E.id,new gs(A,E));if("OFF"===c.baseState)for(let c of this.#sg.values())c._setVisible(t0,!1);for(let A of c.on)this.#sg.get(A)._setVisible(t0,!0);for(let A of c.off)this.#sg.get(A)._setVisible(t0,!1);this.#sf=this.getHash()}}#sb(c){let A=c.length;if(A<2)return!0;let E=c[0];for(let C=1;C<A;C++){let A;let T=c[C];if(Array.isArray(T))A=this.#sb(T);else{if(!this.#sg.has(T))return ht(`Optional content group not found: ${T}`),!0;A=this.#sg.get(T).visible}switch(E){case"And":if(!A)return!1;break;case"Or":if(A)return!0;break;case"Not":return!A;default:return!0}}return"And"===E}isVisible(c){if(0===this.#sg.size)return!0;if(!c)return lt("Optional content group not defined."),!0;if("OCG"===c.type)return this.#sg.has(c.id)?this.#sg.get(c.id).visible:(ht(`Optional content group not found: ${c.id}`),!0);if("OCMD"===c.type){if(c.expression)return this.#sb(c.expression);if(!c.policy||"AnyOn"===c.policy){for(let A of c.ids){if(!this.#sg.has(A))return ht(`Optional content group not found: ${A}`),!0;if(this.#sg.get(A).visible)return!0}return!1}if("AllOn"===c.policy){for(let A of c.ids){if(!this.#sg.has(A))return ht(`Optional content group not found: ${A}`),!0;if(!this.#sg.get(A).visible)return!1}return!0}if("AnyOff"===c.policy){for(let A of c.ids){if(!this.#sg.has(A))return ht(`Optional content group not found: ${A}`),!0;if(!this.#sg.get(A).visible)return!0}return!1}if("AllOff"===c.policy){for(let A of c.ids){if(!this.#sg.has(A))return ht(`Optional content group not found: ${A}`),!0;if(this.#sg.get(A).visible)return!1}return!0}return ht(`Unknown optional content policy ${c.policy}.`),!0}return ht(`Unknown group type ${c.type}.`),!0}setVisibility(c,A=!0,E=!0){let C=this.#sg.get(c);if(C){if(E&&A&&C.rbGroups.length)for(let A of C.rbGroups)for(let E of A)E!==c&&this.#sg.get(E)?._setVisible(t0,!1,!0);C._setVisible(t0,!!A,!0),this.#sp=null}else ht(`Optional content group not found: ${c}`)}setOCGState({state:c,preserveRB:A}){let E;for(let C of c){switch(C){case"ON":case"OFF":case"Toggle":E=C;continue}let c=this.#sg.get(C);if(c)switch(E){case"ON":this.setVisibility(C,!0,A);break;case"OFF":this.setVisibility(C,!1,A);break;case"Toggle":this.setVisibility(C,!c.visible,A)}}this.#sp=null}get hasInitialVisibility(){return null===this.#sf||this.getHash()===this.#sf}getOrder(){return this.#sg.size?this.#sm?this.#sm.slice():[...this.#sg.keys()]:null}getGroup(c){return this.#sg.get(c)||null}getHash(){if(null!==this.#sp)return this.#sp;let c=new Pe;for(let[A,E]of this.#sg)c.update(`${A}:${E.visible}`);return this.#sp=c.hexdigest()}[Symbol.iterator](){return this.#sg.entries()}};let fs=class fs{constructor(c,{disableRange:A=!1,disableStream:E=!1}){dt(c,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:C,initialData:T,progressiveDone:M,contentDispositionFilename:k}=c;if(this._queuedChunks=[],this._progressiveDone=M,this._contentDispositionFilename=k,T?.length>0){let c=T instanceof Uint8Array&&T.byteLength===T.buffer.byteLength?T.buffer:new Uint8Array(T).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=c,this._isStreamingSupported=!E,this._isRangeSupported=!A,this._contentLength=C,this._fullRequestReader=null,this._rangeReaders=[],c.addRangeListener((c,A)=>{this._onReceiveData({begin:c,chunk:A})}),c.addProgressListener((c,A)=>{this._onProgress({loaded:c,total:A})}),c.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),c.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),c.transportReady()}_onReceiveData({begin:c,chunk:A}){let E=A instanceof Uint8Array&&A.byteLength===A.buffer.byteLength?A.buffer:new Uint8Array(A).buffer;void 0===c?this._fullRequestReader?this._fullRequestReader._enqueue(E):this._queuedChunks.push(E):dt(this._rangeReaders.some(function(A){return A._begin===c&&(A._enqueue(E),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(c){void 0===c.total?this._rangeReaders[0]?.onProgress?.({loaded:c.loaded}):this._fullRequestReader?.onProgress?.({loaded:c.loaded,total:c.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(c){let A=this._rangeReaders.indexOf(c);A>=0&&this._rangeReaders.splice(A,1)}getFullReader(){dt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let c=this._queuedChunks;return this._queuedChunks=null,new bs(this,c,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(c,A){if(A<=this._progressiveDataLength)return null;let E=new vs(this,c,A);return this._pdfDataRangeTransport.requestDataRange(c,A),this._rangeReaders.push(E),E}cancelAllRequests(c){for(let A of(this._fullRequestReader?.cancel(c),this._rangeReaders.slice(0)))A.cancel(c);this._pdfDataRangeTransport.abort()}};let bs=class bs{constructor(c,A,E=!1,C=null){for(let T of(this._stream=c,this._done=E||!1,this._filename=jt(C)?C:null,this._queuedChunks=A||[],this._loaded=0,this._queuedChunks))this._loaded+=T.byteLength;this._requests=[],this._headersReady=Promise.resolve(),c._fullRequestReader=this,this.onProgress=null}_enqueue(c){this._done||(this._requests.length>0?this._requests.shift().resolve({value:c,done:!1}):this._queuedChunks.push(c),this._loaded+=c.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let c=Promise.withResolvers();return this._requests.push(c),c.promise}cancel(c){for(let c of(this._done=!0,this._requests))c.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}};let vs=class vs{constructor(c,A,E){this._stream=c,this._begin=A,this._end=E,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(c){if(!this._done){if(0===this._requests.length)this._queuedChunk=c;else{for(let A of(this._requests.shift().resolve({value:c,done:!1}),this._requests))A.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let c=this._queuedChunk;return this._queuedChunk=null,{value:c,done:!1}}if(this._done)return{value:void 0,done:!0};let c=Promise.withResolvers();return this._requests.push(c),c.promise}cancel(c){for(let c of(this._done=!0,this._requests))c.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function ys(c,A){let E=new Headers;if(!c||!A||"object"!=typeof A)return E;for(let c in A){let C=A[c];void 0!==C&&E.append(c,C)}return E}function ws(c){return URL.parse(c)?.origin??null}function xs({responseHeaders:c,isHttp:A,rangeChunkSize:E,disableRange:C}){let T={allowRangeRequests:!1,suggestedLength:void 0},M=parseInt(c.get("Content-Length"),10);return!Number.isInteger(M)||(T.suggestedLength=M,M<=2*E)||C||!A||"bytes"!==c.get("Accept-Ranges")||"identity"!==(c.get("Content-Encoding")||"identity")||(T.allowRangeRequests=!0),T}function As(c){let A=c.get("Content-Disposition");if(A){let c=function(c){let A=!0,E=s("filename\\*","i").exec(c);if(E){let c=a(E=E[1]);return r(c=l(c=o(c=unescape(c))))}if(E=function(c){let A;let E=[],C=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(A=C.exec(c));){let[,c,C,T]=A;if((c=parseInt(c,10))in E){if(0===c)break}else E[c]=[C,T]}let T=[];for(let c=0;c<E.length&&(c in E);++c){let[A,C]=E[c];C=a(C),A&&(C=unescape(C),0===c&&(C=o(C))),T.push(C)}return T.join("")}(c))return r(l(E));if(E=s("filename","i").exec(c)){let c=a(E=E[1]);return r(c=l(c))}function s(c,A){return RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',A)}function n(c,E){if(c){if(!/^[\x00-\xFF]+$/.test(E))return E;try{let C=new TextDecoder(c,{fatal:!0}),T=_t(E);E=C.decode(T),A=!1}catch{}}return E}function r(c){return A&&/[\x80-\xff]/.test(c)&&(c=n("utf-8",c),A&&(c=n("iso-8859-1",c))),c}function a(c){if(c.startsWith('"')){let A=c.slice(1).split('\\"');for(let c=0;c<A.length;++c){let E=A[c].indexOf('"');-1!==E&&(A[c]=A[c].slice(0,E),A.length=c+1),A[c]=A[c].replaceAll(/\\(.)/g,"$1")}c=A.join('"')}return c}function o(c){let A=c.indexOf("'");return -1===A?c:n(c.slice(0,A),c.slice(A+1).replace(/^[^']*'/,""))}function l(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(c,A,E,C){if("q"===E||"Q"===E)return n(A,C=(C=C.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(c,A){return String.fromCharCode(parseInt(A,16))}));try{C=atob(C)}catch{}return n(A,C)})}return""}(A);if(c.includes("%"))try{c=decodeURIComponent(c)}catch{}if(jt(c))return c}return null}function _s(c,A){return new tA(`Unexpected server response (${c}) while retrieving PDF "${A}".`,c,404===c||0===c&&A.startsWith("file:"))}function Ss(c){return 200===c||206===c}function Es(c,A,E){return{method:"GET",headers:c,signal:E.signal,mode:"cors",credentials:A?"include":"same-origin",redirect:"follow"}}function Cs(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(ht(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}let Ts=class Ts{constructor(c){this._responseOrigin=null,this.source=c,this.isHttp=/^https?:/i.test(c.url),this.headers=ys(this.isHttp,c.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return dt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Ms(this),this._fullRequestReader}getRangeReader(c,A){if(A<=this._progressiveDataLength)return null;let E=new Ds(this,c,A);return this._rangeRequestReaders.push(E),E}cancelAllRequests(c){for(let A of(this._fullRequestReader?.cancel(c),this._rangeRequestReaders.slice(0)))A.cancel(c)}};let Ms=class Ms{constructor(c){this._stream=c,this._reader=null,this._loaded=0,this._filename=null;let A=c.source;this._withCredentials=A.withCredentials||!1,this._contentLength=A.length,this._headersCapability=Promise.withResolvers(),this._disableRange=A.disableRange||!1,this._rangeChunkSize=A.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!A.disableStream,this._isRangeSupported=!A.disableRange;let E=new Headers(c.headers),C=A.url;fetch(C,Es(E,this._withCredentials,this._abortController)).then(A=>{if(c._responseOrigin=ws(A.url),!Ss(A.status))throw _s(A.status,C);this._reader=A.body.getReader(),this._headersCapability.resolve();let E=A.headers,{allowRangeRequests:T,suggestedLength:M}=xs({responseHeaders:E,isHttp:c.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=T,this._contentLength=M||this._contentLength,this._filename=As(E),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new tx("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:c,done:A}=await this._reader.read();return A?{value:c,done:A}:(this._loaded+=c.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Cs(c),done:!1})}cancel(c){this._reader?.cancel(c),this._abortController.abort()}};let Ds=class Ds{constructor(c,A,E){this._stream=c,this._reader=null,this._loaded=0;let C=c.source;this._withCredentials=C.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!C.disableStream,this._abortController=new AbortController;let T=new Headers(c.headers);T.append("Range",`bytes=${A}-${E-1}`);let M=C.url;fetch(M,Es(T,this._withCredentials,this._abortController)).then(A=>{let E=ws(A.url);if(E!==c._responseOrigin)throw Error(`Expected range response-origin "${E}" to match "${c._responseOrigin}".`);if(!Ss(A.status))throw _s(A.status,M);this._readCapability.resolve(),this._reader=A.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:c,done:A}=await this._reader.read();return A?{value:c,done:A}:(this._loaded+=c.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Cs(c),done:!1})}cancel(c){this._reader?.cancel(c),this._abortController.abort()}};let Ps=class Ps{constructor({url:c,httpHeaders:A,withCredentials:E}){this._responseOrigin=null,this.url=c,this.isHttp=/^https?:/i.test(c),this.headers=ys(this.isHttp,A),this.withCredentials=E||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(c){let A=new XMLHttpRequest,E=this.currXhrId++,C=this.pendingRequests[E]={xhr:A};for(let[c,E]of(A.open("GET",this.url),A.withCredentials=this.withCredentials,this.headers))A.setRequestHeader(c,E);return this.isHttp&&"begin"in c&&"end"in c?(A.setRequestHeader("Range",`bytes=${c.begin}-${c.end-1}`),C.expectedStatus=206):C.expectedStatus=200,A.responseType="arraybuffer",dt(c.onError,"Expected `onError` callback to be provided."),A.onerror=()=>{c.onError(A.status)},A.onreadystatechange=this.onStateChange.bind(this,E),A.onprogress=this.onProgress.bind(this,E),C.onHeadersReceived=c.onHeadersReceived,C.onDone=c.onDone,C.onError=c.onError,C.onProgress=c.onProgress,A.send(null),E}onProgress(c,A){let E=this.pendingRequests[c];E&&E.onProgress?.(A)}onStateChange(c,A){let E=this.pendingRequests[c];if(!E)return;let C=E.xhr;if(C.readyState>=2&&E.onHeadersReceived&&(E.onHeadersReceived(),delete E.onHeadersReceived),4!==C.readyState||!(c in this.pendingRequests))return;if(delete this.pendingRequests[c],0===C.status&&this.isHttp)return void E.onError(C.status);let T=C.status||200;if(!(200===T&&206===E.expectedStatus)&&T!==E.expectedStatus)return void E.onError(C.status);let M=function(c){let A=c.response;return"string"!=typeof A?A:_t(A).buffer}(C);if(206===T){let c=C.getResponseHeader("Content-Range"),A=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);A?E.onDone({begin:parseInt(A[1],10),chunk:M}):(ht('Missing or invalid "Content-Range" header.'),E.onError(0))}else M?E.onDone({begin:0,chunk:M}):E.onError(C.status)}getRequestXhr(c){return this.pendingRequests[c].xhr}isPendingRequest(c){return c in this.pendingRequests}abortRequest(c){let A=this.pendingRequests[c].xhr;delete this.pendingRequests[c],A.abort()}};let ks=class ks{constructor(c){this._source=c,this._manager=new Ps(c),this._rangeChunkSize=c.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(c){let A=this._rangeRequestReaders.indexOf(c);A>=0&&this._rangeRequestReaders.splice(A,1)}getFullReader(){return dt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Is(this._manager,this._source),this._fullRequestReader}getRangeReader(c,A){let E=new Rs(this._manager,c,A);return E.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(E),E}cancelAllRequests(c){for(let A of(this._fullRequestReader?.cancel(c),this._rangeRequestReaders.slice(0)))A.cancel(c)}};let Is=class Is{constructor(c,A){this._manager=c,this._url=A.url,this._fullRequestId=c.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=A.disableRange||!1,this._contentLength=A.length,this._rangeChunkSize=A.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let c=this._fullRequestId,A=this._manager.getRequestXhr(c);this._manager._responseOrigin=ws(A.responseURL);let E=A.getAllResponseHeaders(),C=new Headers(E?E.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{let[A,...E]=c.split(": ");return[A,E.join(": ")]}):[]),{allowRangeRequests:T,suggestedLength:M}=xs({responseHeaders:C,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});T&&(this._isRangeSupported=!0),this._contentLength=M||this._contentLength,this._filename=As(C),this._isRangeSupported&&this._manager.abortRequest(c),this._headersCapability.resolve()}_onDone(c){if(c&&(this._requests.length>0?this._requests.shift().resolve({value:c.chunk,done:!1}):this._cachedChunks.push(c.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let c of this._requests)c.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(c){for(let A of(this._storedError=_s(c,this._url),this._headersCapability.reject(this._storedError),this._requests))A.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(c){this.onProgress?.({loaded:c.loaded,total:c.lengthComputable?c.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let c=Promise.withResolvers();return this._requests.push(c),c.promise}cancel(c){for(let A of(this._done=!0,this._headersCapability.reject(c),this._requests))A.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}};let Rs=class Rs{constructor(c,A,E){this._manager=c,this._url=c.url,this._requestId=c.request({begin:A,end:E,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let c=ws(this._manager.getRequestXhr(this._requestId)?.responseURL);c!==this._manager._responseOrigin&&(this._storedError=Error(`Expected range response-origin "${c}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(c){let A=c.chunk;for(let c of(this._requests.length>0?this._requests.shift().resolve({value:A,done:!1}):this._queuedChunk=A,this._done=!0,this._requests))c.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(c){for(let A of(this._storedError??=_s(c,this._url),this._requests))A.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(c){this.isStreamingSupported||this.onProgress?.({loaded:c.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let c=this._queuedChunk;return this._queuedChunk=null,{value:c,done:!1}}if(this._done)return{value:void 0,done:!0};let c=Promise.withResolvers();return this._requests.push(c),c.promise}cancel(c){for(let c of(this._done=!0,this._requests))c.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}};let t2=/^[a-z][a-z0-9\-+.]+:/i;let Bs=class Bs{constructor(c){this.source=c,this.url=function(c){if(t2.test(c))return new URL(c);let A=process.getBuiltinModule("url");return new URL(A.pathToFileURL(c))}(c.url),dt("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return dt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Fs(this),this._fullRequestReader}getRangeReader(c,A){if(A<=this._progressiveDataLength)return null;let E=new Os(this,c,A);return this._rangeRequestReaders.push(E),E}cancelAllRequests(c){for(let A of(this._fullRequestReader?.cancel(c),this._rangeRequestReaders.slice(0)))A.cancel(c)}};let Fs=class Fs{constructor(c){this._url=c.url,this._done=!1,this._storedError=null,this.onProgress=null;let A=c.source;this._contentLength=A.length,this._loaded=0,this._filename=null,this._disableRange=A.disableRange||!1,this._rangeChunkSize=A.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!A.disableStream,this._isRangeSupported=!A.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let E=process.getBuiltinModule("fs");E.promises.lstat(this._url).then(c=>{this._contentLength=c.size,this._setReadableStream(E.createReadStream(this._url)),this._headersCapability.resolve()},c=>{"ENOENT"===c.code&&(c=_s(0,this._url.href)),this._storedError=c,this._headersCapability.reject(c)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let c=this._readableStream.read();return null===c?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=c.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(c).buffer,done:!1})}cancel(c){this._readableStream?this._readableStream.destroy(c):this._error(c)}_error(c){this._storedError=c,this._readCapability.resolve()}_setReadableStream(c){this._readableStream=c,c.on("readable",()=>{this._readCapability.resolve()}),c.on("end",()=>{c.destroy(),this._done=!0,this._readCapability.resolve()}),c.on("error",c=>{this._error(c)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new tx("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}};let Os=class Os{constructor(c,A,E){this._url=c.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let C=c.source;this._isStreamingSupported=!C.disableStream;let T=process.getBuiltinModule("fs");this._setReadableStream(T.createReadStream(this._url,{start:A,end:E-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let c=this._readableStream.read();return null===c?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=c.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(c).buffer,done:!1})}cancel(c){this._readableStream?this._readableStream.destroy(c):this._error(c)}_error(c){this._storedError=c,this._readCapability.resolve()}_setReadableStream(c){this._readableStream=c,c.on("readable",()=>{this._readCapability.resolve()}),c.on("end",()=>{c.destroy(),this._done=!0,this._readCapability.resolve()}),c.on("error",c=>{this._error(c)}),this._storedError&&this._readableStream.destroy(this._storedError)}};let t5=Symbol("INITIAL_DATA");let Us=class Us{#sv;#sy(c){return this.#sv[c]||={...Promise.withResolvers(),data:t5}}get(c,A=null){if(A){let E=this.#sy(c);return E.promise.then(()=>A(E.data)),null}let E=this.#sv[c];if(!E||E.data===t5)throw Error(`Requesting object that isn't resolved yet ${c}.`);return E.data}has(c){let A=this.#sv[c];return!!A&&A.data!==t5}delete(c){let A=this.#sv[c];return!(!A||A.data===t5)&&(delete this.#sv[c],!0)}resolve(c,A=null){let E=this.#sy(c);E.data=A,E.resolve()}clear(){for(let c in this.#sv){let{data:A}=this.#sv[c];A?.bitmap?.close()}this.#sv=Object.create(null)}*[Symbol.iterator](){for(let c in this.#sv){let{data:A}=this.#sv[c];A!==t5&&(yield[c,A])}}constructor(){this.#sv=Object.create(null)}};let zs=class zs{#sw;#tA;#sA;#s_;#sx;#sE;#sS;#sC;#sT;#sM;#sk;#sP;#sR;#sD;#sI;#sL;#sF;#sN;static #sO=new Map;static #sB=new Map;static #sU=new WeakMap;static #sz=null;static #sj=new Set;constructor({textContentSource:c,container:A,viewport:E}){if(this.#sw=Promise.withResolvers(),this.#tA=null,this.#sA=!1,this.#s_=!!globalThis.FontInspector?.enabled,this.#sx=null,this.#sE=null,this.#sS=0,this.#sC=0,this.#sT=null,this.#sM=null,this.#sk=0,this.#sP=0,this.#sR=Object.create(null),this.#sD=[],this.#sI=null,this.#sL=[],this.#sF=new WeakMap,this.#sN=null,c instanceof ReadableStream)this.#sI=c;else{if("object"!=typeof c)throw Error('No "textContentSource" parameter specified.');this.#sI=new ReadableStream({start(A){A.enqueue(c),A.close()}})}this.#tA=this.#sM=A,this.#sP=E.scale*ee.pixelRatio,this.#sk=E.rotation,this.#sE={div:null,properties:null,ctx:null};let{pageWidth:C,pageHeight:T,pageX:M,pageY:k}=E.rawDims;this.#sN=[1,0,0,-1,-M,k+T],this.#sC=C,this.#sS=T,zs.#sH(),te(A,E),this.#sw.promise.finally(()=>{zs.#sj.delete(this),this.#sE=null,this.#sR=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:c,isFirefox:A}=St.platform;return gt(this,"fontFamilyMap",new Map([["sans-serif",(c&&A?"Calibri, ":"")+"sans-serif"],["monospace",(c&&A?"Lucida Console, ":"")+"monospace"]]))}render(){let t1=()=>{this.#sT.read().then(({value:c,done:A})=>{A?this.#sw.resolve():(this.#sx??=c.lang,Object.assign(this.#sR,c.styles),this.#s$(c.items),t1())},this.#sw.reject)};return this.#sT=this.#sI.getReader(),zs.#sj.add(this),t1(),this.#sw.promise}update({viewport:c,onBefore:A=null}){let E=c.scale*ee.pixelRatio,C=c.rotation;if(C!==this.#sk&&(A?.(),this.#sk=C,te(this.#sM,{rotation:C})),E!==this.#sP){A?.(),this.#sP=E;let c={div:null,properties:null,ctx:zs.#sV(this.#sx)};for(let A of this.#sL)c.properties=this.#sF.get(A),c.div=A,this.#sG(c)}}cancel(){let c=new tx("TextLayer task cancelled.");this.#sT?.cancel(c).catch(()=>{}),this.#sT=null,this.#sw.reject(c)}get textDivs(){return this.#sL}get textContentItemsStr(){return this.#sD}#s$(c){if(this.#sA)return;this.#sE.ctx??=zs.#sV(this.#sx);let A=this.#sL,E=this.#sD;for(let C of c){if(A.length>1e5)return ht("Ignoring additional textDivs for performance reasons."),void(this.#sA=!0);if(void 0!==C.str)E.push(C.str),this.#sW(C);else if("beginMarkedContentProps"===C.type||"beginMarkedContent"===C.type){let c=this.#tA;this.#tA=document.createElement("span"),this.#tA.classList.add("markedContent"),C.id&&this.#tA.setAttribute("id",`${C.id}`),c.append(this.#tA)}else"endMarkedContent"===C.type&&(this.#tA=this.#tA.parentNode)}}#sW(c){let A,E;let C=document.createElement("span"),T={angle:0,canvasWidth:0,hasText:""!==c.str,hasEOL:c.hasEOL,fontSize:0};this.#sL.push(C);let M=Ct.transform(this.#sN,c.transform),k=Math.atan2(M[1],M[0]),I=this.#sR[c.fontName];I.vertical&&(k+=Math.PI/2);let N=this.#s_&&I.fontSubstitution||I.fontFamily;N=zs.fontFamilyMap.get(N)||N;let O=Math.hypot(M[2],M[3]),U=O*zs.#sq(N,I,this.#sx);0===k?(A=M[4],E=M[5]-U):(A=M[4]+U*Math.sin(k),E=M[5]-U*Math.cos(k));let j="calc(var(--total-scale-factor) *",$=C.style;this.#tA===this.#sM?($.left=`${(100*A/this.#sC).toFixed(2)}%`,$.top=`${(100*E/this.#sS).toFixed(2)}%`):($.left=`${j}${A.toFixed(2)}px)`,$.top=`${j}${E.toFixed(2)}px)`),$.fontSize=`${j}${(zs.#sz*O).toFixed(2)}px)`,$.fontFamily=N,T.fontSize=O,C.setAttribute("role","presentation"),C.textContent=c.str,C.dir=c.dir,this.#s_&&(C.dataset.fontName=I.fontSubstitutionLoadedName||c.fontName),0!==k&&(T.angle=k*(180/Math.PI));let V=!1;if(c.str.length>1)V=!0;else if(" "!==c.str&&c.transform[0]!==c.transform[3]){let A=Math.abs(c.transform[0]),E=Math.abs(c.transform[3]);A!==E&&Math.max(A,E)/Math.min(A,E)>1.5&&(V=!0)}if(V&&(T.canvasWidth=I.vertical?c.height:c.width),this.#sF.set(C,T),this.#sE.div=C,this.#sE.properties=T,this.#sG(this.#sE),T.hasText&&this.#tA.append(C),T.hasEOL){let c=document.createElement("br");c.setAttribute("role","presentation"),this.#tA.append(c)}}#sG(c){let{div:A,properties:E,ctx:C}=c,{style:T}=A,M="";if(zs.#sz>1&&(M=`scale(${1/zs.#sz})`),0!==E.canvasWidth&&E.hasText){let{fontFamily:c}=T,{canvasWidth:k,fontSize:I}=E;zs.#sX(C,I*this.#sP,c);let{width:N}=C.measureText(A.textContent);N>0&&(M=`scaleX(${k*this.#sP/N}) ${M}`)}0!==E.angle&&(M=`rotate(${E.angle}deg) ${M}`),M.length>0&&(T.transform=M)}static cleanup(){if(!(this.#sj.size>0)){for(let{canvas:c}of(this.#sO.clear(),this.#sB.values()))c.remove();this.#sB.clear()}}static #sV(c=null){let A=this.#sB.get(c||="");if(!A){let E=document.createElement("canvas");E.className="hiddenCanvasElement",E.lang=c,document.body.append(E),A=E.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#sB.set(c,A),this.#sU.set(A,{size:0,family:""})}return A}static #sX(c,A,E){let C=this.#sU.get(c);A===C.size&&E===C.family||(c.font=`${A}px ${E}`,C.size=A,C.family=E)}static #sH(){if(null!==this.#sz)return;let c=document.createElement("div");c.style.opacity=0,c.style.lineHeight=1,c.style.fontSize="1px",c.style.position="absolute",c.textContent="X",document.body.append(c),this.#sz=c.getBoundingClientRect().height,c.remove()}static #sq(c,A,E){let C=this.#sO.get(c);if(C)return C;let T=this.#sV(E);T.canvas.width=T.canvas.height=30,this.#sX(T,30,c);let M=T.measureText(""),k=M.fontBoundingBoxAscent,I=Math.abs(M.fontBoundingBoxDescent);T.canvas.width=T.canvas.height=0;let N=.8;return k?N=k/(k+I):(St.platform.isFirefox&&ht("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),A.ascent?N=A.ascent:A.descent&&(N=1+A.descent)),this.#sO.set(c,N),N}};function Hs(c={}){"string"==typeof c||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});let A=new js,{docId:E}=A,C=c.url?function(c){if(c instanceof URL)return c.href;if("string"==typeof c){if(Z)return c;let A=URL.parse(c,window.location);if(A)return A.href}throw Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(c.url):null,T=c.data?function(c){if(Z&&"undefined"!=typeof Buffer&&c instanceof Buffer)throw Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if("string"==typeof c)return _t(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||"object"==typeof c&&!isNaN(c?.length))return new Uint8Array(c);throw Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(c.data):null,M=c.httpHeaders||null,k=!0===c.withCredentials,I=c.password??null,N=c.range instanceof $s?c.range:null,O=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:65536,U=c.worker instanceof t3?c.worker:null,j=c.verbosity,$="string"!=typeof c.docBaseUrl||Ht(c.docBaseUrl)?null:c.docBaseUrl,V=Fe(c.cMapUrl),G=!1!==c.cMapPacked,W=c.CMapReaderFactory||(Z?ui:ii),q=Fe(c.iccUrl),X=Fe(c.standardFontDataUrl),Y=c.StandardFontDataFactory||(Z?pi:ai),K=Fe(c.wasmUrl),J=c.WasmFactory||(Z?gi:li),Q=!0!==c.stopAtErrors,tt=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,ta=!1!==c.isEvalSupported,to="boolean"==typeof c.isOffscreenCanvasSupported?c.isOffscreenCanvasSupported:!Z,tl="boolean"==typeof c.isImageDecoderSupported?c.isImageDecoderSupported:!Z&&(St.platform.isFirefox||!globalThis.chrome),th=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,td="boolean"==typeof c.disableFontFace?c.disableFontFace:Z,tc=!0===c.fontExtraProperties,tu=!0===c.enableXfa,tp=c.ownerDocument||globalThis.document,tg=!0===c.disableRange,tf=!0===c.disableStream,tb=!0===c.disableAutoFetch,tv=!0===c.pdfBug,ty=c.CanvasFactory||(Z?di:ti),tw=c.FilterFactory||(Z?ci:ni),tA=!0===c.enableHWA,t_=!1!==c.useWasm,tx=N?N.length:c.length??NaN,tE="boolean"==typeof c.useSystemFonts?c.useSystemFonts:!Z&&!td,tS="boolean"==typeof c.useWorkerFetch?c.useWorkerFetch:!!(W===ii&&Y===ai&&J===li&&V&&X&&K&&Wt(V,document.baseURI)&&Wt(X,document.baseURI)&&Wt(K,document.baseURI));Number.isInteger(j)&&(tm=j);let tC={canvasFactory:new ty({ownerDocument:tp,enableHWA:tA}),filterFactory:new tw({docId:E,ownerDocument:tp}),cMapReaderFactory:tS?null:new W({baseUrl:V,isCompressed:G}),standardFontDataFactory:tS?null:new Y({baseUrl:X}),wasmFactory:tS?null:new J({baseUrl:K})};U||(U=t3.create({verbosity:j,port:ds.workerPort}),A._worker=U);let tT={docId:E,apiVersion:"5.4.296",data:T,password:I,disableAutoFetch:tb,rangeChunkSize:O,length:tx,docBaseUrl:$,enableXfa:tu,evaluatorOptions:{maxImageSize:tt,disableFontFace:td,ignoreErrors:Q,isEvalSupported:ta,isOffscreenCanvasSupported:to,isImageDecoderSupported:tl,canvasMaxAreaInBytes:th,fontExtraProperties:tc,useSystemFonts:tE,useWasm:t_,useWorkerFetch:tS,cMapUrl:V,iccUrl:q,standardFontDataUrl:X,wasmUrl:K}},tM={ownerDocument:tp,pdfBug:tv,styleElement:null,loadingParams:{disableAutoFetch:tb,enableXfa:tu}};return U.promise.then(function(){let c;if(A.destroyed)throw Error("Loading aborted");if(U.destroyed)throw Error("Worker was destroyed");let I=U.messageHandler.sendWithPromise("GetDocRequest",tT,T?[T.buffer]:null);if(N)c=new fs(N,{disableRange:tg,disableStream:tf});else if(!T){if(!C)throw Error("getDocument - no `url` parameter provided.");let A=Wt(C)?Ts:Z?Bs:ks;c=new A({url:C,length:tx,httpHeaders:M,withCredentials:k,rangeChunkSize:O,disableRange:tg,disableStream:tf})}return I.then(C=>{if(A.destroyed)throw Error("Loading aborted");if(U.destroyed)throw Error("Worker was destroyed");let T=new Je(E,C,U.port),M=new Xs(T,A,c,tM,tC,tA);A._transport=M,T.send("Ready",null)})}).catch(A._capability.reject),A}let js=class js{static #ib=0;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(c){throw this._worker?.port&&delete this._worker._pendingDestroy,c}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d"+js.#ib++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}};let $s=class $s{#sw;#sY;#sK;#sJ;#sQ;constructor(c,A,E=!1,C=null){this.#sw=Promise.withResolvers(),this.#sY=[],this.#sK=[],this.#sJ=[],this.#sQ=[],this.length=c,this.initialData=A,this.progressiveDone=E,this.contentDispositionFilename=C}addRangeListener(c){this.#sQ.push(c)}addProgressListener(c){this.#sJ.push(c)}addProgressiveReadListener(c){this.#sK.push(c)}addProgressiveDoneListener(c){this.#sY.push(c)}onDataRange(c,A){for(let E of this.#sQ)E(c,A)}onDataProgress(c,A){this.#sw.promise.then(()=>{for(let E of this.#sJ)E(c,A)})}onDataProgressiveRead(c){this.#sw.promise.then(()=>{for(let A of this.#sK)A(c)})}onDataProgressiveDone(){this.#sw.promise.then(()=>{for(let c of this.#sY)c()})}transportReady(){this.#sw.resolve()}requestDataRange(c,A){ct("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};let Vs=class Vs{constructor(c,A){this._pdfInfo=c,this._transport=A}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return gt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(c){return this._transport.getPage(c)}getPageIndex(c){return this._transport.getPageIndex(c)}getDestinations(){return this._transport.getDestinations()}getDestination(c){return this._transport.getDestination(c)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(c,A){return this._transport.getAnnotationsByType(c,A)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:c="display"}={}){let{renderingIntent:A}=this._transport.getRenderingIntent(c);return this._transport.getOptionalContentConfig(A)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(c=!1){return this._transport.startCleanup(c||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(c){return this._transport.cachedPageNumber(c)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}};let Gs=class Gs{#sZ;constructor(c,A,E,C=!1){this.#sZ=!1,this._pageIndex=c,this._pageInfo=A,this._transport=E,this._stats=C?new Gt:null,this._pdfBug=C,this.commonObjs=E.commonObjs,this.objs=new Us,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:c,rotation:A=this.rotate,offsetX:E=0,offsetY:C=0,dontFlip:T=!1}={}){return new Ut({viewBox:this.view,userUnit:this.userUnit,scale:c,rotation:A,offsetX:E,offsetY:C,dontFlip:T})}getAnnotations({intent:c="display"}={}){let{renderingIntent:A}=this._transport.getRenderingIntent(c);return this._transport.getAnnotations(this._pageIndex,A)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return gt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:c,canvas:A=c.canvas,viewport:E,intent:C="display",annotationMode:T=ta.ENABLE,transform:M=null,background:k=null,optionalContentConfigPromise:I=null,annotationCanvasMap:N=null,pageColors:O=null,printAnnotationStorage:U=null,isEditing:j=!1,recordOperations:$=!1,operationsFilter:V=null}){this._stats?.time("Overall");let G=this._transport.getRenderingIntent(C,T,U,j),{renderingIntent:W,cacheKey:q}=G;this.#sZ=!1,I||=this._transport.getOptionalContentConfig(W);let X=this._intentStates.get(q);X||(X=Object.create(null),this._intentStates.set(q,X)),X.streamReaderCancelTimeout&&(clearTimeout(X.streamReaderCancelTimeout),X.streamReaderCancelTimeout=null);let Y=!!(4&W);X.displayReadyCapability||(X.displayReadyCapability=Promise.withResolvers(),X.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(G));let K=!!(this._pdfBug&&globalThis.StepperManager?.enabled),J=!this.recordedBBoxes&&($||K),x=c=>{if(X.renderTasks.delete(Q),J){let c=Q.gfx?.dependencyTracker.take();c&&(Q.stepper&&Q.stepper.setOperatorBBoxes(c,Q.gfx.dependencyTracker.takeDebugMetadata()),$&&(this.recordedBBoxes=c))}Y&&(this.#sZ=!0),this.#s0(),c?(Q.capability.reject(c),this._abortOperatorList({intentState:X,reason:c instanceof Error?c:Error(c)})):Q.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},Q=new Ks({callback:x,params:{canvas:A,canvasContext:c,dependencyTracker:J?new Ai(A,X.operatorList.length,K):null,viewport:E,transform:M,background:k},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:N,operatorList:X.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Y,pdfBug:this._pdfBug,pageColors:O,enableHWA:this._transport.enableHWA,operationsFilter:V});(X.renderTasks||=new Set).add(Q);let Z=Q.task;return Promise.all([X.displayReadyCapability.promise,I]).then(([c,A])=>{if(this.destroyed)x();else{if(this._stats?.time("Rendering"),!(A.renderingIntent&W))throw Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");Q.initializeGraphics({transparency:c,optionalContentConfig:A}),Q.operatorListChanged()}}).catch(x),Z}getOperatorList({intent:c="display",annotationMode:A=ta.ENABLE,printAnnotationStorage:E=null,isEditing:C=!1}={}){let T=this._transport.getRenderingIntent(c,A,E,C,!0),M,k=this._intentStates.get(T.cacheKey);return k||(k=Object.create(null),this._intentStates.set(T.cacheKey,k)),k.opListReadCapability||((M=Object.create(null)).operatorListChanged=function(){k.operatorList.lastChunk&&(k.opListReadCapability.resolve(k.operatorList),k.renderTasks.delete(M))},k.opListReadCapability=Promise.withResolvers(),(k.renderTasks||=new Set).add(M),k.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(T)),k.opListReadCapability.promise}streamTextContent({includeMarkedContent:c=!1,disableNormalization:A=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===c,disableNormalization:!0===A},{highWaterMark:100,size:c=>c.items.length})}getTextContent(c={}){if(this._transport._htmlForXfa)return this.getXfa().then(c=>Lt.textContent(c));let A=this.streamTextContent(c);return new Promise(function(c,E){let C=A.getReader(),T={items:[],styles:Object.create(null),lang:null};!function e(){C.read().then(function({value:A,done:E}){E?c(T):(T.lang??=A.lang,Object.assign(T.styles,A.styles),T.items.push(...A.items),e())},E)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let c=[];for(let A of this._intentStates.values())if(this._abortOperatorList({intentState:A,reason:Error("Page was destroyed."),force:!0}),!A.opListReadCapability)for(let E of A.renderTasks)c.push(E.completed),E.cancel();return this.objs.clear(),this.#sZ=!1,Promise.all(c)}cleanup(c=!1){this.#sZ=!0;let A=this.#s0();return c&&A&&(this._stats&&=new Gt),A}#s0(){if(!this.#sZ||this.destroyed)return!1;for(let{renderTasks:c,operatorList:A}of this._intentStates.values())if(c.size>0||!A.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#sZ=!1,!0}_startRenderPage(c,A){let E=this._intentStates.get(A);E&&(this._stats?.timeEnd("Page Request"),E.displayReadyCapability?.resolve(c))}_renderPageChunk(c,A){for(let E=0,C=c.length;E<C;E++)A.operatorList.fnArray.push(c.fnArray[E]),A.operatorList.argsArray.push(c.argsArray[E]);for(let E of(A.operatorList.lastChunk=c.lastChunk,A.operatorList.separateAnnots=c.separateAnnots,A.renderTasks))E.operatorListChanged();c.lastChunk&&this.#s0()}_pumpOperatorList({renderingIntent:c,cacheKey:A,annotationStorageSerializable:E,modifiedIds:C}){let{map:T,transfer:M}=E,k=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:c,cacheKey:A,annotationStorage:T,modifiedIds:C},M).getReader(),I=this._intentStates.get(A);I.streamReader=k;let l=()=>{k.read().then(({value:c,done:A})=>{A?I.streamReader=null:this._transport.destroyed||(this._renderPageChunk(c,I),l())},c=>{if(I.streamReader=null,!this._transport.destroyed){if(I.operatorList){for(let c of(I.operatorList.lastChunk=!0,I.renderTasks))c.operatorListChanged();this.#s0()}if(I.displayReadyCapability)I.displayReadyCapability.reject(c);else{if(!I.opListReadCapability)throw c;I.opListReadCapability.reject(c)}}})};l()}_abortOperatorList({intentState:c,reason:A,force:E=!1}){if(c.streamReader){if(c.streamReaderCancelTimeout&&(clearTimeout(c.streamReaderCancelTimeout),c.streamReaderCancelTimeout=null),!E){if(c.renderTasks.size>0)return;if(A instanceof zt){let E=100;return A.extraDelay>0&&A.extraDelay<1e3&&(E+=A.extraDelay),void(c.streamReaderCancelTimeout=setTimeout(()=>{c.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:c,reason:A,force:!0})},E))}}if(c.streamReader.cancel(new tx(A.message)).catch(()=>{}),c.streamReader=null,!this._transport.destroyed){for(let[A,E]of this._intentStates)if(E===c){this._intentStates.delete(A);break}this.cleanup()}}}get stats(){return this._stats}};let t4=class n{constructor({name:c=null,port:A=null,verbosity:E=ot()}={}){if(b(this,$),b(this,M,Promise.withResolvers()),b(this,k,null),b(this,I,null),b(this,N,null),this.name=c,this.destroyed=!1,this.verbosity=E,A){if(f(n,j).has(A))throw Error("Cannot use more than one PDFWorker per port.");f(n,j).set(A,this),y(this,$,G).call(this,A)}else y(this,$,W).call(this)}get promise(){return f(this,M).promise}get port(){return f(this,I)}get messageHandler(){return f(this,k)}destroy(){this.destroyed=!0,f(this,N)?.terminate(),v(this,N,null),f(n,j).delete(f(this,I)),v(this,I,null),f(this,k)?.destroy(),v(this,k,null)}static create(c){let A=f(this,j).get(c?.port);if(A){if(A._pendingDestroy)throw Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return A}return new n(c)}static get workerSrc(){if(ds.workerSrc)return ds.workerSrc;throw Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return gt(this,"_setupFakeWorkerGlobal",(async()=>f(this,X,Y)?f(this,X,Y):(await E(6840)(this.workerSrc)).WorkerMessageHandler)())}};M=new WeakMap,k=new WeakMap,I=new WeakMap,N=new WeakMap,O=new WeakMap,U=new WeakMap,j=new WeakMap,$=new WeakSet,V=function(){f(this,M).resolve(),f(this,k).send("configure",{verbosity:this.verbosity})},G=function(c){v(this,I,c),v(this,k,new Je("main","worker",c)),f(this,k).on("ready",()=>{}),y(this,$,V).call(this)},W=function(){if(f(t4,U)||f(t4,X,Y))return void y(this,$,q).call(this);let{workerSrc:c}=t4;try{t4._isSameOrigin(window.location,c)||(c=t4._createCDNWrapper(new URL(c,window.location).href));let A=new Worker(c,{type:"module"}),E=new Je("main","worker",A),h=()=>{C.abort(),E.destroy(),A.terminate(),this.destroyed?f(this,M).reject(Error("Worker was destroyed")):y(this,$,q).call(this)},C=new AbortController;A.addEventListener("error",()=>{f(this,N)||h()},{signal:C.signal}),E.on("test",c=>{C.abort(),!this.destroyed&&c?(v(this,k,E),v(this,I,A),v(this,N,A),y(this,$,V).call(this)):h()}),E.on("ready",c=>{if(C.abort(),this.destroyed)h();else try{u()}catch{y(this,$,q).call(this)}});let u=()=>{let c=new Uint8Array;E.send("test",c,[c.buffer])};return void u()}catch{lt("The worker has been disabled.")}y(this,$,q).call(this)},q=function(){f(t4,U)||(ht("Setting up fake worker."),v(t4,U,!0)),t4._setupFakeWorkerGlobal.then(c=>{var A,E;if(this.destroyed)return void f(this,M).reject(Error("Worker was destroyed"));let C=new Ue;v(this,I,C);let T="fake"+({set _(t){v(t4,O,t,A)},get _(){return f(t4,O,E)}})._++,N=new Je(T+"_worker",T,C);c.setup(N,C),v(this,k,new Je(T,T+"_worker",C)),y(this,$,V).call(this)}).catch(c=>{f(this,M).reject(Error(`Setting up fake worker failed: "${c.message}".`))})},X=new WeakSet,Y=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},b(t4,X),b(t4,O,0),b(t4,U,!1),b(t4,j,new WeakMap),Z&&(v(t4,U,!0),ds.workerSrc||="./pdf.worker.mjs"),t4._isSameOrigin=(c,A)=>{let E=URL.parse(c);if(!E?.origin||"null"===E.origin)return!1;let C=new URL(A,E);return E.origin===C.origin},t4._createCDNWrapper=c=>{let A=`await import("${c}");`;return URL.createObjectURL(new Blob([A],{type:"text/javascript"}))},t4.fromPort=c=>{if(console.log("Deprecated API usage: `PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!c?.port)throw Error("PDFWorker.fromPort - invalid method signature.");return t4.create(c)};let t3=t4;let Xs=class Xs{#s1;#s2;#s5;#s4;#s3;constructor(c,A,E,C,T,M){this.#s1=new Map,this.#s2=new Map,this.#s5=new Map,this.#s4=new Map,this.#s3=null,this.messageHandler=c,this.loadingTask=A,this.commonObjs=new Us,this.fontLoader=new Le({ownerDocument:C.ownerDocument,styleElement:C.styleElement}),this.loadingParams=C.loadingParams,this._params=C,this.canvasFactory=T.canvasFactory,this.filterFactory=T.filterFactory,this.cMapReaderFactory=T.cMapReaderFactory,this.standardFontDataFactory=T.standardFontDataFactory,this.wasmFactory=T.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=E,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=M,this.setupMessageHandler()}#s6(c,A=null){let E=this.#s1.get(c);if(E)return E;let C=this.messageHandler.sendWithPromise(c,A);return this.#s1.set(c,C),C}get annotationStorage(){return gt(this,"annotationStorage",new Ie)}getRenderingIntent(c,A=ta.ENABLE,E=null,C=!1,T=!1){let M=2,k=tR;switch(c){case"any":M=1;break;case"display":break;case"print":M=4;break;default:ht(`getRenderingIntent - invalid intent: ${c}`)}let I=4&M&&E instanceof Re?E:this.annotationStorage;switch(A){case ta.DISABLE:M+=64;break;case ta.ENABLE:break;case ta.ENABLE_FORMS:M+=16;break;case ta.ENABLE_STORAGE:M+=32,k=I.serializable;break;default:ht(`getRenderingIntent - invalid annotationMode: ${A}`)}C&&(M+=128),T&&(M+=256);let{ids:N,hash:O}=I.modifiedIds;return{renderingIntent:M,cacheKey:[M,k.hash,O].join("_"),annotationStorageSerializable:k,modifiedIds:N}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#s3?.reject(Error("Worker was destroyed during onPassword callback"));let c=[];for(let A of this.#s2.values())c.push(A._destroy());this.#s2.clear(),this.#s5.clear(),this.#s4.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let A=this.messageHandler.sendWithPromise("Terminate",null);return c.push(A),Promise.all(c).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#s1.clear(),this.filterFactory.destroy(),zs.cleanup(),this._networkStream?.cancelAllRequests(new tx("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:c,loadingTask:A}=this;c.on("GetReader",(c,A)=>{dt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=c=>{this._lastProgress={loaded:c.loaded,total:c.total}},A.onPull=()=>{this._fullReader.read().then(function({value:c,done:E}){E?A.close():(dt(c instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),A.enqueue(new Uint8Array(c),1,[c]))}).catch(c=>{A.error(c)})},A.onCancel=c=>{this._fullReader.cancel(c),A.ready.catch(c=>{if(!this.destroyed)throw c})}}),c.on("ReaderHeadersReady",async c=>{await this._fullReader.headersReady;let{isStreamingSupported:E,isRangeSupported:C,contentLength:T}=this._fullReader;return E&&C||(this._lastProgress&&A.onProgress?.(this._lastProgress),this._fullReader.onProgress=c=>{A.onProgress?.({loaded:c.loaded,total:c.total})}),{isStreamingSupported:E,isRangeSupported:C,contentLength:T}}),c.on("GetRangeReader",(c,A)=>{dt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let E=this._networkStream.getRangeReader(c.begin,c.end);E?(A.onPull=()=>{E.read().then(function({value:c,done:E}){E?A.close():(dt(c instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),A.enqueue(new Uint8Array(c),1,[c]))}).catch(c=>{A.error(c)})},A.onCancel=c=>{E.cancel(c),A.ready.catch(c=>{if(!this.destroyed)throw c})}):A.close()}),c.on("GetDoc",({pdfInfo:c})=>{this._numPages=c.numPages,this._htmlForXfa=c.htmlForXfa,delete c.htmlForXfa,A._capability.resolve(new Vs(c,this))}),c.on("DocException",c=>{A._capability.reject(Qe(c))}),c.on("PasswordRequest",c=>{this.#s3=Promise.withResolvers();try{if(!A.onPassword)throw Qe(c);A.onPassword(c=>{c instanceof Error?this.#s3.reject(c):this.#s3.resolve({password:c})},c.code)}catch(c){this.#s3.reject(c)}return this.#s3.promise}),c.on("DataLoaded",c=>{A.onProgress?.({loaded:c.length,total:c.length}),this.downloadInfoCapability.resolve(c)}),c.on("StartRenderPage",c=>{this.destroyed||this.#s2.get(c.pageIndex)._startRenderPage(c.transparency,c.cacheKey)}),c.on("commonobj",([A,E,C])=>{if(this.destroyed||this.commonObjs.has(A))return null;switch(E){case"Font":if("error"in C){let c=C.error;ht(`Error during font loading: ${c}`),this.commonObjs.resolve(A,c);break}let T=new cs(C),M=this._params.pdfBug&&globalThis.FontInspector?.enabled?(c,A)=>globalThis.FontInspector.fontAdded(c,A):null,k=new Be(T,M,C.extra,C.charProcOperatorList);this.fontLoader.bind(k).catch(()=>c.sendWithPromise("FontFallback",{id:A})).finally(()=>{!k.fontExtraProperties&&k.data&&k.clearData(),this.commonObjs.resolve(A,k)});break;case"CopyLocalImage":let{imageRef:I}=C;for(let c of(dt(I,"The imageRef must be defined."),this.#s2.values()))for(let[,E]of c.objs)if(E?.ref===I)return E.dataLen?(this.commonObjs.resolve(A,structuredClone(E)),E.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(A,C);break;default:throw Error(`Got unknown common object type ${E}`)}return null}),c.on("obj",([c,A,E,C])=>{if(this.destroyed)return;let T=this.#s2.get(A);if(!T.objs.has(c)){if(0!==T._intentStates.size)switch(E){case"Image":case"Pattern":T.objs.resolve(c,C);break;default:throw Error(`Got unknown object type ${E}`)}else C?.bitmap?.close()}}),c.on("DocProgress",c=>{this.destroyed||A.onProgress?.({loaded:c.loaded,total:c.total})}),c.on("FetchBinaryData",async c=>{if(this.destroyed)throw Error("Worker was destroyed.");let A=this[c.type];if(!A)throw Error(`${c.type} not initialized, see the \`useWorkerFetch\` parameter.`);return A.fetch(c)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&ht("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:c,transfer:A}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:c,filename:this._fullReader?.filename??null},A).finally(()=>{this.annotationStorage.resetModified()})}getPage(c){if(!Number.isInteger(c)||c<=0||c>this._numPages)return Promise.reject(Error("Invalid page request."));let A=c-1,E=this.#s5.get(A);if(E)return E;let C=this.messageHandler.sendWithPromise("GetPage",{pageIndex:A}).then(E=>{if(this.destroyed)throw Error("Transport destroyed");E.refStr&&this.#s4.set(E.refStr,c);let C=new Gs(A,E,this,this._params.pdfBug);return this.#s2.set(A,C),C});return this.#s5.set(A,C),C}getPageIndex(c){return Oe(c)?this.messageHandler.sendWithPromise("GetPageIndex",{num:c.num,gen:c.gen}):Promise.reject(Error("Invalid pageIndex request."))}getAnnotations(c,A){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:c,intent:A})}getFieldObjects(){return this.#s6("GetFieldObjects")}hasJSActions(){return this.#s6("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(c){return"string"!=typeof c?Promise.reject(Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:c})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(c,A){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:c,pageIndexesToSkip:A})}getDocJSActions(){return this.#s6("GetDocJSActions")}getPageJSActions(c){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:c})}getStructTree(c){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:c})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(c){return this.#s6("GetOptionalContentConfig").then(A=>new ms(A,c))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let c="GetMetadata",A=this.#s1.get(c);if(A)return A;let E=this.messageHandler.sendWithPromise(c,null).then(c=>({info:c[0],metadata:c[1]?new us(c[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#s1.set(c,E),E}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(c=!1){if(!this.destroyed){for(let c of(await this.messageHandler.sendWithPromise("Cleanup",null),this.#s2.values()))if(!c.cleanup())throw Error(`startCleanup: Page ${c.pageNumber} is currently rendering.`);this.commonObjs.clear(),c||this.fontLoader.clear(),this.#s1.clear(),this.filterFactory.destroy(!0),zs.cleanup()}}cachedPageNumber(c){if(!Oe(c))return null;let A=0===c.gen?`${c.num}R`:`${c.num}R${c.gen}`;return this.#s4.get(A)??null}};let Ys=class Ys{#s9;constructor(c){this.#s9=null,this.onContinue=null,this.onError=null,this.#s9=c}get promise(){return this.#s9.capability.promise}cancel(c=0){this.#s9.cancel(null,c)}get separateAnnots(){let{separateAnnots:c}=this.#s9.operatorList;if(!c)return!1;let{annotationCanvasMap:A}=this.#s9;return c.form||c.canvas&&A?.size>0}};let Ks=class Ks{#s8;static #s7=new WeakSet;constructor({callback:c,params:A,objs:E,commonObjs:C,annotationCanvasMap:T,operatorList:M,pageIndex:k,canvasFactory:I,filterFactory:N,useRequestAnimationFrame:O=!1,pdfBug:U=!1,pageColors:j=null,enableHWA:$=!1,operationsFilter:V=null}){this.#s8=null,this.callback=c,this.params=A,this.objs=E,this.commonObjs=C,this.annotationCanvasMap=T,this.operatorListIdx=null,this.operatorList=M,this._pageIndex=k,this.canvasFactory=I,this.filterFactory=N,this._pdfBug=U,this.pageColors=j,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===O&&!1,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ys(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=A.canvas,this._canvasContext=A.canvas?null:A.canvasContext,this._enableHWA=$,this._dependencyTracker=A.dependencyTracker,this._operationsFilter=V}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:c=!1,optionalContentConfig:A}){if(this.cancelled)return;if(this._canvas){if(Ks.#s7.has(this._canvas))throw Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ks.#s7.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{viewport:E,transform:C,background:T,dependencyTracker:M}=this.params,k=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new os(k,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:A},this.annotationCanvasMap,this.pageColors,M),this.gfx.beginDrawing({transform:C,viewport:E,transparency:c,background:T}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(c=null,A=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#s8&&(window.cancelAnimationFrame(this.#s8),this.#s8=null),Ks.#s7.delete(this._canvas),c||=new zt(`Rendering cancelled, page ${this._pageIndex+1}`,A),this.callback(c),this.task.onError?.(c)}operatorListChanged(){this.graphicsReady?(this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#s8=window.requestAnimationFrame(()=>{this.#s8=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ks.#s7.delete(this._canvas),this.callback())))}};let t6="5.4.296",t9="f56dc8601";let Zs=class Zs{#rt;#re;#ri;#rs;#rr;#rn;#n;#ra;#ro;#b;static #rl=null;static get _keyboardManager(){return gt(this,"_keyboardManager",new ye([[["Escape","mac+Escape"],Zs.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Zs.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Zs.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Zs.prototype._moveToPrevious],[["Home","mac+Home"],Zs.prototype._moveToBeginning],[["End","mac+End"],Zs.prototype._moveToEnd]]))}constructor({editor:c=null,uiManager:A=null}){this.#rt=null,this.#re=null,this.#rs=null,this.#rr=!1,this.#rn=!1,this.#n=null,this.#ro=null,this.#b=null,c?(this.#rn=!1,this.#n=c):this.#rn=!0,this.#b=c?._uiManager||A,this.#ra=this.#b._eventBus,this.#ri=c?.color?.toUpperCase()||this.#b?.highlightColors.values().next().value||"#FFFF98",Zs.#rl||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let c=this.#rt=document.createElement("button");c.className="colorPicker",c.tabIndex="0",c.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),c.ariaHasPopup="true",this.#n&&(c.ariaControls=`${this.#n.id}_colorpicker_dropdown`);let A=this.#b._signal;c.addEventListener("click",this.#rh.bind(this),{signal:A}),c.addEventListener("keydown",this.#rd.bind(this),{signal:A});let E=this.#re=document.createElement("span");return E.className="swatch",E.ariaHidden="true",E.style.backgroundColor=this.#ri,c.append(E),c}renderMainDropdown(){let c=this.#rs=this.#rc();return c.ariaOrientation="horizontal",c.ariaLabelledBy="highlightColorPickerLabel",c}#rc(){let c=document.createElement("div"),A=this.#b._signal;for(let[E,C]of(c.addEventListener("contextmenu",qt,{signal:A}),c.className="dropdown",c.role="listbox",c.ariaMultiSelectable="false",c.ariaOrientation="vertical",c.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#n&&(c.id=`${this.#n.id}_colorpicker_dropdown`),this.#b.highlightColors)){let T=document.createElement("button");T.tabIndex="0",T.role="option",T.setAttribute("data-color",C),T.title=E,T.setAttribute("data-l10n-id",Zs.#rl[E]);let M=document.createElement("span");T.append(M),M.className="swatch",M.style.backgroundColor=C,T.ariaSelected=C===this.#ri,T.addEventListener("click",this.#ru.bind(this,C),{signal:A}),c.append(T)}return c.addEventListener("keydown",this.#rd.bind(this),{signal:A}),c}#ru(c,A){A.stopPropagation(),this.#ra.dispatch("switchannotationeditorparams",{source:this,type:th.HIGHLIGHT_COLOR,value:c}),this.updateColor(c)}_colorSelectFromKeyboard(c){if(c.target===this.#rt)return void this.#rh(c);let A=c.target.getAttribute("data-color");A&&this.#ru(A,c)}_moveToNext(c){this.#rp?c.target!==this.#rt?c.target.nextSibling?.focus():this.#rs.firstChild?.focus():this.#rh(c)}_moveToPrevious(c){c.target!==this.#rs?.firstChild&&c.target!==this.#rt?(this.#rp||this.#rh(c),c.target.previousSibling?.focus()):this.#rp&&this._hideDropdownFromKeyboard()}_moveToBeginning(c){this.#rp?this.#rs.firstChild?.focus():this.#rh(c)}_moveToEnd(c){this.#rp?this.#rs.lastChild?.focus():this.#rh(c)}#rd(c){Zs._keyboardManager.exec(this,c)}#rh(c){if(this.#rp)return void this.hideDropdown();if(this.#rr=0===c.detail,this.#ro||(this.#ro=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#b.combinedSignal(this.#ro)})),this.#rt.ariaExpanded="true",this.#rs)return void this.#rs.classList.remove("hidden");let A=this.#rs=this.#rc();this.#rt.append(A)}#u(c){this.#rs?.contains(c.target)||this.hideDropdown()}hideDropdown(){this.#rs?.classList.add("hidden"),this.#rt.ariaExpanded="false",this.#ro?.abort(),this.#ro=null}get #rp(){return this.#rs&&!this.#rs.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#rn||(this.#rp?(this.hideDropdown(),this.#rt.focus({preventScroll:!0,focusVisible:this.#rr})):this.#n?.unselect())}updateColor(c){if(this.#re&&(this.#re.style.backgroundColor=c),!this.#rs)return;let A=this.#b.highlightColors.values();for(let E of this.#rs.children)E.ariaSelected=A.next().value===c.toUpperCase()}destroy(){this.#rt?.remove(),this.#rt=null,this.#re=null,this.#rs?.remove(),this.#rs=null}};let tn=class tn{#rg;#n;#b;static #rl=null;constructor(c){this.#rg=null,this.#n=null,this.#b=null,this.#n=c,this.#b=c._uiManager,tn.#rl||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#rg)return this.#rg;let{editorType:c,colorType:A,colorValue:E}=this.#n,C=this.#rg=document.createElement("input");return C.type="color",C.value=E||"#000000",C.className="basicColorPicker",C.tabIndex=0,C.setAttribute("data-l10n-id",tn.#rl[c]),C.addEventListener("input",()=>{this.#b.updateParams(A,C.value)},{signal:this.#b._signal}),C}update(c){this.#rg&&(this.#rg.value=c)}destroy(){this.#rg?.remove(),this.#rg=null}hideDropdown(){}};function en(c){return Math.floor(255*Math.max(0,Math.min(1,c))).toString(16).padStart(2,"0")}function sn(c){return Math.max(0,Math.min(255,255*c))}_(116),_(531);let nn=class nn{static CMYK_G([c,A,E,C]){return["G",1-Math.min(1,.3*c+.59*E+.11*A+C)]}static G_CMYK([c]){return["CMYK",0,0,0,1-c]}static G_RGB([c]){return["RGB",c,c,c]}static G_rgb([c]){return[c=sn(c),c,c]}static G_HTML([c]){let A=en(c);return`#${A}${A}${A}`}static RGB_G([c,A,E]){return["G",.3*c+.59*A+.11*E]}static RGB_rgb(c){return c.map(sn)}static RGB_HTML(c){return`#${c.map(en).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([c,A,E,C]){return["RGB",1-Math.min(1,c+C),1-Math.min(1,E+C),1-Math.min(1,A+C)]}static CMYK_rgb([c,A,E,C]){return[sn(1-Math.min(1,c+C)),sn(1-Math.min(1,E+C)),sn(1-Math.min(1,A+C))]}static CMYK_HTML(c){let A=this.CMYK_RGB(c).slice(1);return this.RGB_HTML(A)}static RGB_CMYK([c,A,E]){let C=1-c,T=1-A,M=1-E;return["CMYK",C,T,M,Math.min(C,T,M)]}};let rn=class rn{create(c,A,E=!1){if(c<=0||A<=0)throw Error("Invalid SVG dimensions");let C=this._createSVG("svg:svg");return C.setAttribute("version","1.1"),E||(C.setAttribute("width",`${c}px`),C.setAttribute("height",`${A}px`)),C.setAttribute("preserveAspectRatio","none"),C.setAttribute("viewBox",`0 0 ${c} ${A}`),C}createElement(c){if("string"!=typeof c)throw Error("Invalid SVG element type");return this._createSVG(c)}_createSVG(c){ct("Abstract method `_createSVG` called.")}};let an=class an extends rn{_createSVG(c){return document.createElementNS(tM,c)}};let t8=new WeakSet,t7=60*(new Date).getTimezoneOffset()*1e3;let hn=class hn{static create(c){switch(c.data.annotationType){case tu.LINK:return new un(c);case tu.TEXT:return new pn(c);case tu.WIDGET:switch(c.data.fieldType){case"Tx":return new mn(c);case"Btn":return c.data.radioButton?new vn(c):c.data.checkBox?new bn(c):new yn(c);case"Ch":return new wn(c);case"Sig":return new fn(c)}return new gn(c);case tu.POPUP:return new xn(c);case tu.FREETEXT:return new _n(c);case tu.LINE:return new Sn(c);case tu.SQUARE:return new En(c);case tu.CIRCLE:return new Cn(c);case tu.POLYLINE:return new Tn(c);case tu.CARET:return new Dn(c);case tu.INK:return new Pn(c);case tu.POLYGON:return new Mn(c);case tu.HIGHLIGHT:return new kn(c);case tu.UNDERLINE:return new In(c);case tu.SQUIGGLY:return new Rn(c);case tu.STRIKEOUT:return new Ln(c);case tu.STAMP:return new Bn(c);case tu.FILEATTACHMENT:return new Fn(c);default:return new cn(c)}}};let cn=class cn{#rf;#rm;#rb;constructor(c,{isRenderable:A=!1,ignoreBorder:E=!1,createQuadrilaterals:C=!1}={}){this.#rf=null,this.#rm=!1,this.#rb=null,this.isRenderable=A,this.data=c.data,this.layer=c.layer,this.linkService=c.linkService,this.downloadManager=c.downloadManager,this.imageResourcesPath=c.imageResourcesPath,this.renderForms=c.renderForms,this.svgFactory=c.svgFactory,this.annotationStorage=c.annotationStorage,this.enableComment=c.enableComment,this.enableScripting=c.enableScripting,this.hasJSActions=c.hasJSActions,this._fieldObjects=c.fieldObjects,this.parent=c.parent,A&&(this.container=this._createContainer(E)),C&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:c,richText:A}){return!(!c?.str&&!A?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return cn._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){let{data:c}=this,A=this.annotationStorage?.getEditor(c.id);return A?A.getData():c}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){let c=this.annotationStorage?.getEditor(this.data.id);if(c)return c.commentButtonPositionInPage;let{quadPoints:A,inkLists:E,rect:C}=this.data,T=-1/0,M=-1/0;if(A?.length>=8){for(let c=0;c<A.length;c+=8)A[c+1]>M?(M=A[c+1],T=A[c+2]):A[c+1]===M&&(T=Math.max(T,A[c+2]));return[T,M]}if(E?.length>=1){for(let c of E)for(let A=0,E=c.length;A<E;A+=2)c[A+1]>M?(M=c[A+1],T=c[A]):c[A+1]===M&&(T=Math.max(T,c[A]));if(T!==1/0)return[T,M]}return C?[C[2],C[3]]:null}_normalizePoint(c){let{page:{view:A},viewport:{rawDims:{pageWidth:E,pageHeight:C,pageX:T,pageY:M}}}=this.parent;return c[1]=A[3]-c[1]+A[1],c[0]=100*(c[0]-T)/E,c[1]=100*(c[1]-M)/C,c}get commentText(){let{data:c}=this;return this.annotationStorage.getRawValue(`${to}${c.id}`)?.popup?.contents||c.contentsObj?.str||""}set commentText(c){let{data:A}=this,E={deleted:!c,contents:c||""};this.annotationStorage.updateEditor(A.id,{popup:E})||this.annotationStorage.setValue(`${to}${A.id}`,{id:A.id,annotationType:A.annotationType,pageIndex:this.parent.page._pageIndex,popup:E,popupRef:A.popupRef,modificationDate:new Date}),c||this.removePopup()}removePopup(){(this.#rb?.popup||this.popup)?.remove(),this.#rb=this.popup=null}updateEdited(c){if(!this.container)return;c.rect&&(this.#rf||={rect:this.data.rect.slice(0)});let{rect:A,popup:E}=c;A&&this.#rv(A);let C=this.#rb?.popup||this.popup;!C&&E?.text&&(this._createPopup(E),C=this.#rb.popup),C&&(C.updateEdited(c),E?.deleted&&(C.remove(),this.#rb=null,this.popup=null))}resetEdited(){this.#rf&&(this.#rv(this.#rf.rect),this.#rb?.popup.resetEdited(),this.#rf=null)}#rv(c){let{container:{style:A},data:{rect:E,rotation:C},parent:{viewport:{rawDims:{pageWidth:T,pageHeight:M,pageX:k,pageY:I}}}}=this;E?.splice(0,4,...c),A.left=100*(c[0]-k)/T+"%",A.top=100*(M-c[3]+I)/M+"%",0===C?(A.width=100*(c[2]-c[0])/T+"%",A.height=100*(c[3]-c[1])/M+"%"):this.setRotation(C)}_createContainer(c){let{data:A,parent:{page:E,viewport:C}}=this,T=document.createElement("section");T.setAttribute("data-annotation-id",A.id),this instanceof gn||this instanceof un||(T.tabIndex=0);let{style:M}=T;if(M.zIndex=this.parent.zIndex,this.parent.zIndex+=2,A.alternativeText&&(T.title=A.alternativeText),A.noRotate&&T.classList.add("norotate"),!A.rect||this instanceof xn){let{rotation:c}=A;return A.hasOwnCanvas||0===c||this.setRotation(c,T),T}let{width:k,height:I}=this;if(!c&&A.borderStyle.width>0){M.borderWidth=`${A.borderStyle.width}px`;let c=A.borderStyle.horizontalCornerRadius,E=A.borderStyle.verticalCornerRadius;if(c>0||E>0){let A=`calc(${c}px * var(--total-scale-factor)) / calc(${E}px * var(--total-scale-factor))`;M.borderRadius=A}else if(this instanceof vn){let c=`calc(${k}px * var(--total-scale-factor)) / calc(${I}px * var(--total-scale-factor))`;M.borderRadius=c}switch(A.borderStyle.style){case 1:M.borderStyle="solid";break;case 2:M.borderStyle="dashed";break;case 3:ht("Unimplemented border style: beveled");break;case 4:ht("Unimplemented border style: inset");break;case 5:M.borderBottomStyle="solid"}let C=A.borderColor||null;C?(this.#rm=!0,M.borderColor=Ct.makeHexColor(0|C[0],0|C[1],0|C[2])):M.borderWidth=0}let N=Ct.normalizeRect([A.rect[0],E.view[3]-A.rect[1]+E.view[1],A.rect[2],E.view[3]-A.rect[3]+E.view[1]]),{pageWidth:O,pageHeight:U,pageX:j,pageY:$}=C.rawDims;M.left=100*(N[0]-j)/O+"%",M.top=100*(N[1]-$)/U+"%";let{rotation:V}=A;return A.hasOwnCanvas||0===V?(M.width=100*k/O+"%",M.height=100*I/U+"%"):this.setRotation(V,T),T}setRotation(c,A=this.container){if(!this.data.rect)return;let{pageWidth:E,pageHeight:C}=this.parent.viewport.rawDims,{width:T,height:M}=this;c%180!=0&&([T,M]=[M,T]),A.style.width=100*T/E+"%",A.style.height=100*M/C+"%",A.setAttribute("data-main-rotation",(360-c)%360)}get _commonActions(){let t1=(c,A,E)=>{let C=E.detail[c],T=C[0],M=C.slice(1);E.target.style[A]=nn[`${T}_HTML`](M),this.annotationStorage.setValue(this.data.id,{[A]:nn[`${T}_rgb`](M)})};return gt(this,"_commonActions",{display:c=>{let{display:A}=c.detail,E=A%2==1;this.container.style.visibility=E?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:E,noPrint:1===A||2===A})},print:c=>{this.annotationStorage.setValue(this.data.id,{noPrint:!c.detail.print})},hidden:c=>{let{hidden:A}=c.detail;this.container.style.visibility=A?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:A,noView:A})},focus:c=>{setTimeout(()=>c.target.focus({preventScroll:!1}),0)},userName:c=>{c.target.title=c.detail.userName},readonly:c=>{c.target.disabled=c.detail.readonly},required:c=>{this._setRequired(c.target,c.detail.required)},bgColor:c=>{t1("bgColor","backgroundColor",c)},fillColor:c=>{t1("fillColor","backgroundColor",c)},fgColor:c=>{t1("fgColor","color",c)},textColor:c=>{t1("textColor","color",c)},borderColor:c=>{t1("borderColor","borderColor",c)},strokeColor:c=>{t1("strokeColor","borderColor",c)},rotation:c=>{let A=c.detail.rotation;this.setRotation(A),this.annotationStorage.setValue(this.data.id,{rotation:A})}})}_dispatchEventFromSandbox(c,A){let E=this._commonActions;for(let C of Object.keys(A.detail)){let T=c[C]||E[C];T?.(A)}}_setDefaultPropertiesFromJS(c){if(!this.enableScripting)return;let A=this.annotationStorage.getRawValue(this.data.id);if(!A)return;let E=this._commonActions;for(let[C,T]of Object.entries(A)){let M=E[C];M&&(M({detail:{[C]:T},target:c}),delete A[C])}}_createQuadrilaterals(){let c;if(!this.container)return;let{quadPoints:A}=this.data;if(!A)return;let[E,C,T,M]=this.data.rect.map(c=>Math.fround(c));if(8===A.length){let[c,k,I,N]=A.subarray(2,6);if(T===c&&M===k&&E===I&&C===N)return}let{style:k}=this.container;if(this.#rm){let{borderColor:A,borderWidth:E}=k;k.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${A}" stroke-width="${E}">`],this.container.classList.add("hasBorder")}let I=T-E,N=M-C,{svgFactory:O}=this,U=O.createElement("svg");U.classList.add("quadrilateralsContainer"),U.setAttribute("width",0),U.setAttribute("height",0),U.role="none";let j=O.createElement("defs");U.append(j);let $=O.createElement("clipPath"),V=`clippath_${this.data.id}`;$.setAttribute("id",V),$.setAttribute("clipPathUnits","objectBoundingBox"),j.append($);for(let C=2,T=A.length;C<T;C+=8){let T=A[C],k=A[C+1],U=A[C+2],j=A[C+3],V=O.createElement("rect"),G=(U-E)/I,W=(M-k)/N,q=(T-U)/I,X=(k-j)/N;V.setAttribute("x",G),V.setAttribute("y",W),V.setAttribute("width",q),V.setAttribute("height",X),$.append(V),c?.push(`<rect vector-effect="non-scaling-stroke" x="${G}" y="${W}" width="${q}" height="${X}"/>`)}this.#rm&&(c.push("</g></svg>')"),k.backgroundImage=c.join("")),this.container.append(U),this.container.style.clipPath=`url(#${V})`}_createPopup(c=null){let A,E;let{data:C}=this;c?(A={str:c.text},E=c.date):(A=C.contentsObj,E=C.modificationDate);let T=this.#rb=new xn({data:{color:C.color,titleObj:C.titleObj,modificationDate:E,contentsObj:A,richText:C.richText,parentRect:C.rect,borderStyle:0,id:`popup_${C.id}`,rotation:C.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(T.render())}get hasPopupElement(){return!!(this.#rb||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#rb}render(){ct("Abstract method `AnnotationElement.render` called")}_getElementsByName(c,A=null){let E=[];if(this._fieldObjects){let C=this._fieldObjects[c];if(C)for(let{page:c,id:T,exportValues:M}of C){if(-1===c||T===A)continue;let C="string"==typeof M?M:null,k=document.querySelector(`[data-element-id="${T}"]`);!k||t8.has(k)?E.push({id:T,exportValue:C,domElement:k}):ht(`_getElementsByName - element not allowed: ${T}`)}return E}for(let C of document.getElementsByName(c)){let{exportValue:c}=C,T=C.getAttribute("data-element-id");T!==A&&t8.has(C)&&E.push({id:T,exportValue:c,domElement:C})}return E}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let c=this.getElementsToTriggerPopup();if(Array.isArray(c))for(let A of c)A.classList.add("highlightArea");else c.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:c,data:{id:A}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:c,editId:A,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};let dn=class dn extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.editor=c.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){let{editor:c}=this;c.hasComment&&(this._createPopup(c.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(c){this.editor.comment=c,c||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}};let un=class un extends cn{constructor(c,A=null){super(c,{isRenderable:!0,ignoreBorder:!!A?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=c.data.isTooltipOnly}render(){let{data:c,linkService:A}=this,E=document.createElement("a");E.setAttribute("data-element-id",c.id);let C=!1;return c.url?(A.addLinkAttributes(E,c.url,c.newWindow),C=!0):c.action?(this._bindNamedAction(E,c.action,c.overlaidText),C=!0):c.attachment?(this.#ry(E,c.attachment,c.overlaidText,c.attachmentDest),C=!0):c.setOCGState?(this.#rw(E,c.setOCGState,c.overlaidText),C=!0):c.dest?(this._bindLink(E,c.dest,c.overlaidText),C=!0):(c.actions&&(c.actions.Action||c.actions["Mouse Up"]||c.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(E,c),C=!0),c.resetForm?(this._bindResetFormAction(E,c.resetForm),C=!0):this.isTooltipOnly&&!C&&(this._bindLink(E,""),C=!0)),this.container.classList.add("linkAnnotation"),C&&this.container.append(E),this.container}#rA(){this.container.setAttribute("data-internal-link","")}_bindLink(c,A,E=""){c.href=this.linkService.getDestinationHash(A),c.onclick=()=>(A&&this.linkService.goToDestination(A),!1),(A||""===A)&&this.#rA(),E&&(c.title=E)}_bindNamedAction(c,A,E=""){c.href=this.linkService.getAnchorUrl(""),c.onclick=()=>(this.linkService.executeNamedAction(A),!1),E&&(c.title=E),this.#rA()}#ry(c,A,E="",C=null){c.href=this.linkService.getAnchorUrl(""),A.description?c.title=A.description:E&&(c.title=E),c.onclick=()=>(this.downloadManager?.openOrDownloadData(A.content,A.filename,C),!1),this.#rA()}#rw(c,A,E=""){c.href=this.linkService.getAnchorUrl(""),c.onclick=()=>(this.linkService.executeSetOCGState(A),!1),E&&(c.title=E),this.#rA()}_bindJSAction(c,A){c.href=this.linkService.getAnchorUrl("");let E=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let C of Object.keys(A.actions)){let T=E.get(C);T&&(c[T]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:A.id,name:C}}),!1))}A.overlaidText&&(c.title=A.overlaidText),c.onclick||(c.onclick=()=>!1),this.#rA()}_bindResetFormAction(c,A){let E=c.onclick;if(E||(c.href=this.linkService.getAnchorUrl("")),this.#rA(),!this._fieldObjects)return ht('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(E||(c.onclick=()=>!1));c.onclick=()=>{E?.();let{fields:c,refs:C,include:T}=A,M=[];if(0!==c.length||0!==C.length){let A=new Set(C);for(let E of c){let c=this._fieldObjects[E]||[];for(let{id:E}of c)A.add(E)}for(let c of Object.values(this._fieldObjects))for(let E of c)A.has(E.id)===T&&M.push(E)}else for(let c of Object.values(this._fieldObjects))M.push(...c);let k=this.annotationStorage,I=[];for(let c of M){let{id:A}=c;switch(I.push(A),c.type){case"text":{let E=c.defaultValue||"";k.setValue(A,{value:E});break}case"checkbox":case"radiobutton":{let E=c.defaultValue===c.exportValues;k.setValue(A,{value:E});break}case"combobox":case"listbox":{let E=c.defaultValue||"";k.setValue(A,{value:E});break}default:continue}let E=document.querySelector(`[data-element-id="${A}"]`);E&&(t8.has(E)?E.dispatchEvent(new Event("resetform")):ht(`_bindResetFormAction - element not allowed: ${A}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:I,name:"ResetForm"}}),!1}}};let pn=class pn extends cn{constructor(c){super(c,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let c=document.createElement("img");return c.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",c.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),c.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(c),this.container}};let gn=class gn extends cn{render(){return this.container}showElementAndHideCanvas(c){this.data.hasOwnCanvas&&("CANVAS"===c.previousSibling?.nodeName&&(c.previousSibling.hidden=!0),c.hidden=!1)}_getKeyModifier(c){return St.platform.isMac?c.metaKey:c.ctrlKey}_setEventListener(c,A,E,C,T){E.includes("mouse")?c.addEventListener(E,c=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:C,value:T(c),shift:c.shiftKey,modifier:this._getKeyModifier(c)}})}):c.addEventListener(E,c=>{if("blur"===E){if(!A.focused||!c.relatedTarget)return;A.focused=!1}else if("focus"===E){if(A.focused)return;A.focused=!0}T&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:C,value:T(c)}})})}_setEventListeners(c,A,E,C){for(let[T,M]of E)("Action"===M||this.data.actions?.[M])&&("Focus"!==M&&"Blur"!==M||(A||={focused:!1}),this._setEventListener(c,A,T,M,C),"Focus"!==M||this.data.actions?.Blur?"Blur"!==M||this.data.actions?.Focus||this._setEventListener(c,A,"focus","Focus",null):this._setEventListener(c,A,"blur","Blur",null))}_setBackgroundColor(c){let A=this.data.backgroundColor||null;c.style.backgroundColor=null===A?"transparent":Ct.makeHexColor(A[0],A[1],A[2])}_setTextStyle(c){let A;let{fontColor:E}=this.data.defaultAppearanceData,C=this.data.defaultAppearanceData.fontSize||9,T=c.style,a=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-2),E=c/(Math.round(c/(1.35*C))||1);A=Math.min(C,a(E/1.35))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-2);A=Math.min(C,a(c/1.35))}T.fontSize=`calc(${A}px * var(--total-scale-factor))`,T.color=Ct.makeHexColor(E[0],E[1],E[2]),null!==this.data.textAlignment&&(T.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(c,A){A?c.setAttribute("required",!0):c.removeAttribute("required"),c.setAttribute("aria-required",A)}};let mn=class mn extends gn{constructor(c){super(c,{isRenderable:c.renderForms||c.data.hasOwnCanvas||!c.data.hasAppearance&&!!c.data.fieldValue})}setPropertyOnSiblings(c,A,E,C){let T=this.annotationStorage;for(let M of this._getElementsByName(c.name,c.id))M.domElement&&(M.domElement[A]=E),T.setValue(M.id,{[C]:E})}render(){let c=this.annotationStorage,A=this.data.id;this.container.classList.add("textWidgetAnnotation");let E=null;if(this.renderForms){let C=c.getValue(A,{value:this.data.fieldValue}),T=C.value||"",M=c.getValue(A,{charLimit:this.data.maxLen}).charLimit;M&&T.length>M&&(T=T.slice(0,M));let k=C.formattedValue||this.data.textContent?.join("\n")||null;k&&this.data.comb&&(k=k.replaceAll(/\s+/g,""));let I={userValue:T,formattedValue:k,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((E=document.createElement("textarea")).textContent=k??T,this.data.doNotScroll&&(E.style.overflowY="hidden")):((E=document.createElement("input")).type=this.data.password?"password":"text",E.setAttribute("value",k??T),this.data.doNotScroll&&(E.style.overflowX="hidden")),this.data.hasOwnCanvas&&(E.hidden=!0),t8.add(E),E.setAttribute("data-element-id",A),E.disabled=this.data.readOnly,E.name=this.data.fieldName,E.tabIndex=0;let{datetimeFormat:N,datetimeType:O,timeStep:U}=this.data,j=!!O&&this.enableScripting;N&&(E.title=N),this._setRequired(E,this.data.required),M&&(E.maxLength=M),E.addEventListener("input",C=>{c.setValue(A,{value:C.target.value}),this.setPropertyOnSiblings(E,"value",C.target.value,"value"),I.formattedValue=null}),E.addEventListener("resetform",c=>{let A=this.data.defaultFieldValue??"";E.value=I.userValue=A,I.formattedValue=null});let u=c=>{let{formattedValue:A}=I;null!=A&&(c.target.value=A),c.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){E.addEventListener("focus",c=>{if(I.focused)return;let{target:A}=c;if(j&&(A.type=O,U&&(A.step=U)),I.userValue){let c=I.userValue;if(j){if("time"===O){let E=new Date(c),C=[E.getHours(),E.getMinutes(),E.getSeconds()];A.value=C.map(c=>c.toString().padStart(2,"0")).join(":")}else A.value=new Date(c-t7).toISOString().split("date"===O?"T":".",1)[0]}else A.value=c}I.lastCommittedValue=A.value,I.commitKey=1,this.data.actions?.Focus||(I.focused=!0)}),E.addEventListener("updatefromsandbox",E=>{this.showElementAndHideCanvas(E.target),this._dispatchEventFromSandbox({value(E){I.userValue=E.detail.value??"",j||c.setValue(A,{value:I.userValue.toString()}),E.target.value=I.userValue},formattedValue(E){let{formattedValue:C}=E.detail;I.formattedValue=C,null!=C&&E.target!==document.activeElement&&(E.target.value=C);let T={formattedValue:C};j&&(T.value=C),c.setValue(A,T)},selRange(c){c.target.setSelectionRange(...c.detail.selRange)},charLimit:E=>{let{charLimit:C}=E.detail,{target:T}=E;if(0===C)return void T.removeAttribute("maxLength");T.setAttribute("maxLength",C);let M=I.userValue;!M||M.length<=C||(M=M.slice(0,C),T.value=I.userValue=M,c.setValue(A,{value:M}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:A,name:"Keystroke",value:M,willCommit:!0,commitKey:1,selStart:T.selectionStart,selEnd:T.selectionEnd}}))}},E)}),E.addEventListener("keydown",c=>{I.commitKey=1;let E=-1;if("Escape"===c.key?E=0:"Enter"!==c.key||this.data.multiLine?"Tab"===c.key&&(I.commitKey=3):E=2,-1===E)return;let{value:C}=c.target;I.lastCommittedValue!==C&&(I.lastCommittedValue=C,I.userValue=C,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:A,name:"Keystroke",value:C,willCommit:!0,commitKey:E,selStart:c.target.selectionStart,selEnd:c.target.selectionEnd}}))});let C=u;u=null,E.addEventListener("blur",c=>{if(!I.focused||!c.relatedTarget)return;this.data.actions?.Blur||(I.focused=!1);let{target:E}=c,{value:T}=E;if(j){if(T&&"time"===O){let c=T.split(":").map(c=>parseInt(c,10));T=new Date(2e3,0,1,c[0],c[1],c[2]||0).valueOf(),E.step=""}else T.includes("T")||(T=`${T}T00:00`),T=new Date(T).valueOf();E.type="text"}I.userValue=T,I.lastCommittedValue!==T&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:A,name:"Keystroke",value:T,willCommit:!0,commitKey:I.commitKey,selStart:c.target.selectionStart,selEnd:c.target.selectionEnd}}),C(c)}),this.data.actions?.Keystroke&&E.addEventListener("beforeinput",c=>{I.lastCommittedValue=null;let{data:E,target:C}=c,{value:T,selectionStart:M,selectionEnd:k}=C,N=M,O=k;switch(c.inputType){case"deleteWordBackward":{let c=T.substring(0,M).match(/\w*[^\w]*$/);c&&(N-=c[0].length);break}case"deleteWordForward":{let c=T.substring(M).match(/^[^\w]*\w*/);c&&(O+=c[0].length);break}case"deleteContentBackward":M===k&&(N-=1);break;case"deleteContentForward":M===k&&(O+=1)}c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:A,name:"Keystroke",value:T,change:E||"",willCommit:!1,selStart:N,selEnd:O}})}),this._setEventListeners(E,I,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.value)}if(u&&E.addEventListener("blur",u),this.data.comb){let c=(this.data.rect[2]-this.data.rect[0])/M;E.classList.add("comb"),E.style.letterSpacing=`calc(${c}px * var(--total-scale-factor) - 1ch)`}}else(E=document.createElement("div")).textContent=this.data.fieldValue,E.style.verticalAlign="middle",E.style.display="table-cell",this.data.hasOwnCanvas&&(E.hidden=!0);return this._setTextStyle(E),this._setBackgroundColor(E),this._setDefaultPropertiesFromJS(E),this.container.append(E),this.container}};let fn=class fn extends gn{constructor(c){super(c,{isRenderable:!!c.data.hasOwnCanvas})}};let bn=class bn extends gn{constructor(c){super(c,{isRenderable:c.renderForms})}render(){let c=this.annotationStorage,A=this.data,E=A.id,C=c.getValue(E,{value:A.exportValue===A.fieldValue}).value;"string"==typeof C&&(C="Off"!==C,c.setValue(E,{value:C})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let T=document.createElement("input");return t8.add(T),T.setAttribute("data-element-id",E),T.disabled=A.readOnly,this._setRequired(T,this.data.required),T.type="checkbox",T.name=A.fieldName,C&&T.setAttribute("checked",!0),T.setAttribute("exportValue",A.exportValue),T.tabIndex=0,T.addEventListener("change",C=>{let{name:T,checked:M}=C.target;for(let C of this._getElementsByName(T,E)){let E=M&&C.exportValue===A.exportValue;C.domElement&&(C.domElement.checked=E),c.setValue(C.id,{value:E})}c.setValue(E,{value:M})}),T.addEventListener("resetform",c=>{let E=A.defaultFieldValue||"Off";c.target.checked=E===A.exportValue}),this.enableScripting&&this.hasJSActions&&(T.addEventListener("updatefromsandbox",A=>{this._dispatchEventFromSandbox({value(A){A.target.checked="Off"!==A.detail.value,c.setValue(E,{value:A.target.checked})}},A)}),this._setEventListeners(T,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)),this._setBackgroundColor(T),this._setDefaultPropertiesFromJS(T),this.container.append(T),this.container}};let vn=class vn extends gn{constructor(c){super(c,{isRenderable:c.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let c=this.annotationStorage,A=this.data,E=A.id,C=c.getValue(E,{value:A.fieldValue===A.buttonValue}).value;if("string"==typeof C&&(C=C!==A.buttonValue,c.setValue(E,{value:C})),C)for(let C of this._getElementsByName(A.fieldName,E))c.setValue(C.id,{value:!1});let T=document.createElement("input");if(t8.add(T),T.setAttribute("data-element-id",E),T.disabled=A.readOnly,this._setRequired(T,this.data.required),T.type="radio",T.name=A.fieldName,C&&T.setAttribute("checked",!0),T.tabIndex=0,T.addEventListener("change",A=>{let{name:C,checked:T}=A.target;for(let A of this._getElementsByName(C,E))c.setValue(A.id,{value:!1});c.setValue(E,{value:T})}),T.addEventListener("resetform",c=>{let E=A.defaultFieldValue;c.target.checked=null!=E&&E===A.buttonValue}),this.enableScripting&&this.hasJSActions){let C=A.buttonValue;T.addEventListener("updatefromsandbox",A=>{this._dispatchEventFromSandbox({value:A=>{let T=C===A.detail.value;for(let C of this._getElementsByName(A.target.name)){let A=T&&C.id===E;C.domElement&&(C.domElement.checked=A),c.setValue(C.id,{value:A})}}},A)}),this._setEventListeners(T,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(T),this._setDefaultPropertiesFromJS(T),this.container.append(T),this.container}};let yn=class yn extends un{constructor(c){super(c,{ignoreBorder:c.data.hasAppearance})}render(){let c=super.render();c.classList.add("buttonWidgetAnnotation","pushButton");let A=c.lastChild;return this.enableScripting&&this.hasJSActions&&A&&(this._setDefaultPropertiesFromJS(A),A.addEventListener("updatefromsandbox",c=>{this._dispatchEventFromSandbox({},c)})),c}};let wn=class wn extends gn{constructor(c){super(c,{isRenderable:c.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let c=this.annotationStorage,A=this.data.id,E=c.getValue(A,{value:this.data.fieldValue}),C=document.createElement("select");t8.add(C),C.setAttribute("data-element-id",A),C.disabled=this.data.readOnly,this._setRequired(C,this.data.required),C.name=this.data.fieldName,C.tabIndex=0;let T=this.data.combo&&this.data.options.length>0;for(let c of(this.data.combo||(C.size=this.data.options.length,this.data.multiSelect&&(C.multiple=!0)),C.addEventListener("resetform",c=>{let A=this.data.defaultFieldValue;for(let c of C.options)c.selected=c.value===A}),this.data.options)){let A=document.createElement("option");A.textContent=c.displayValue,A.value=c.exportValue,E.value.includes(c.exportValue)&&(A.setAttribute("selected",!0),T=!1),C.append(A)}let M=null;if(T){let c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),C.prepend(c),M=()=>{c.remove(),C.removeEventListener("input",M),M=null},C.addEventListener("input",M)}let a=c=>{let A=c?"value":"textContent",{options:E,multiple:T}=C;return T?Array.prototype.filter.call(E,c=>c.selected).map(c=>c[A]):-1===E.selectedIndex?null:E[E.selectedIndex][A]},k=a(!1),l=c=>{let A=c.target.options;return Array.prototype.map.call(A,c=>({displayValue:c.textContent,exportValue:c.value}))};return this.enableScripting&&this.hasJSActions?(C.addEventListener("updatefromsandbox",E=>{this._dispatchEventFromSandbox({value(E){M?.();let T=E.detail.value,I=new Set(Array.isArray(T)?T:[T]);for(let c of C.options)c.selected=I.has(c.value);c.setValue(A,{value:a(!0)}),k=a(!1)},multipleSelection(c){C.multiple=!0},remove(E){let T=C.options,M=E.detail.remove;T[M].selected=!1,C.remove(M),T.length>0&&-1===Array.prototype.findIndex.call(T,c=>c.selected)&&(T[0].selected=!0),c.setValue(A,{value:a(!0),items:l(E)}),k=a(!1)},clear(E){for(;0!==C.length;)C.remove(0);c.setValue(A,{value:null,items:[]}),k=a(!1)},insert(E){let{index:T,displayValue:M,exportValue:I}=E.detail.insert,N=C.children[T],O=document.createElement("option");O.textContent=M,O.value=I,N?N.before(O):C.append(O),c.setValue(A,{value:a(!0),items:l(E)}),k=a(!1)},items(E){let{items:T}=E.detail;for(;0!==C.length;)C.remove(0);for(let c of T){let{displayValue:A,exportValue:E}=c,T=document.createElement("option");T.textContent=A,T.value=E,C.append(T)}C.options.length>0&&(C.options[0].selected=!0),c.setValue(A,{value:a(!0),items:l(E)}),k=a(!1)},indices(E){let C=new Set(E.detail.indices);for(let c of E.target.options)c.selected=C.has(c.index);c.setValue(A,{value:a(!0)}),k=a(!1)},editable(c){c.target.disabled=!c.detail.editable}},E)}),C.addEventListener("input",E=>{let C=a(!0),T=a(!1);c.setValue(A,{value:C}),E.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:A,name:"Keystroke",value:k,change:T,changeEx:C,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(C,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):C.addEventListener("input",function(E){c.setValue(A,{value:a(!0)})}),this.data.combo&&this._setTextStyle(C),this._setBackgroundColor(C),this._setDefaultPropertiesFromJS(C),this.container.append(C),this.container}};let xn=class xn extends cn{constructor(c){let{data:A,elements:E,parent:C}=c,T=!!C._commentManager;if(super(c,{isRenderable:!T&&cn._hasPopupData(A)}),this.elements=E,T&&cn._hasPopupData(A)){let c=this.popup=this.#r_();for(let A of E)A.popup=c}else this.popup=null}#r_(){return new An({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){let{container:c}=this;c.classList.add("popupAnnotation"),c.role="comment";let A=this.popup=this.#r_(),E=[];for(let c of this.elements)c.popup=A,c.container.ariaHasPopup="dialog",E.push(c.data.id),c.addHighlightArea();return this.container.setAttribute("aria-controls",E.map(c=>`${tT}${c}`).join(",")),this.container}};let An=class An{#U;#rx;#rE;#rS;#rC;#rT;#tA;#rM;#rk;#rP;#rR;#rD;#rI;#rL;#rF;#M;#rN;#rO;#es;#rB;#t7;#rU;#rf;#rz;#rj;#rH;constructor({container:c,color:A,elements:E,titleObj:C,modificationDate:T,contentsObj:M,richText:k,parent:I,rect:N,parentRect:O,open:U,commentManager:j=null}){this.#U=null,this.#rx=this.#rd.bind(this),this.#rE=this.#r$.bind(this),this.#rS=this.#rV.bind(this),this.#rC=this.#rG.bind(this),this.#rT=null,this.#tA=null,this.#rM=null,this.#rk=null,this.#rP=null,this.#rR=null,this.#rD=null,this.#rI=!1,this.#rL=null,this.#rF=null,this.#M=null,this.#rN=null,this.#rO=null,this.#es=null,this.#rB=null,this.#t7=null,this.#rU=null,this.#rf=null,this.#rz=!1,this.#rj=null,this.#rH=null,this.#tA=c,this.#rU=C,this.#rM=M,this.#t7=k,this.#rR=I,this.#rT=A,this.#rB=N,this.#rD=O,this.#rP=E,this.#U=j,this.#rj=E[0],this.#rk=Yt.toDateObject(T),this.trigger=E.flatMap(c=>c.getElementsToTriggerPopup()),j?this.renderCommentButton():(this.#rW(),this.#tA.hidden=!0,U&&this.#rG())}#rW(){if(this.#rF)return;this.#rF=new AbortController;let{signal:c}=this.#rF;for(let A of this.trigger)A.addEventListener("click",this.#rC,{signal:c}),A.addEventListener("pointerenter",this.#rS,{signal:c}),A.addEventListener("pointerleave",this.#rE,{signal:c}),A.classList.add("popupTriggerArea");for(let A of this.#rP)A.container?.addEventListener("keydown",this.#rx,{signal:c})}#rq(){let c=this.#rP.find(c=>c.hasCommentButton);c&&(this.#rO=c._normalizePoint(c.commentButtonPosition))}renderCommentButton(){if(this.#rN||(this.#rO||this.#rq(),!this.#rO))return;let{signal:c}=this.#rF=new AbortController,A=!!this.#rj.extraPopupElement,i=()=>{this.#U.toggleCommentPopup(this,!0,void 0,!A)},s=()=>{this.#U.toggleCommentPopup(this,!1,!0,!A)},n=()=>{this.#U.toggleCommentPopup(this,!1,!1)};if(A)for(let A of(this.#rN=this.#rj.container,this.trigger))A.ariaHasPopup="dialog",A.ariaControls="commentPopup",A.addEventListener("keydown",this.#rx,{signal:c}),A.addEventListener("click",i,{signal:c}),A.addEventListener("pointerenter",s,{signal:c}),A.addEventListener("pointerleave",n,{signal:c}),A.classList.add("popupTriggerArea");else{let A=this.#rN=document.createElement("button");A.className="annotationCommentButton";let E=this.#rj.container;A.style.zIndex=E.style.zIndex+1,A.tabIndex=0,A.ariaHasPopup="dialog",A.ariaControls="commentPopup",A.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#rX(),this.#rY(),A.addEventListener("keydown",this.#rx,{signal:c}),A.addEventListener("click",i,{signal:c}),A.addEventListener("pointerenter",s,{signal:c}),A.addEventListener("pointerleave",n,{signal:c}),E.after(A)}}#rY(){if(this.#rj.extraPopupElement&&!this.#rj.editor)return;this.renderCommentButton();let[c,A]=this.#rO,{style:E}=this.#rN;E.left=`calc(${c}%)`,E.top=`calc(${A}% - var(--comment-button-dim))`}#rX(){this.#rj.extraPopupElement||(this.renderCommentButton(),this.#rN.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){let{color:c,opacity:A}=this.#rj.commentData;return c?this.#rR._commentManager.makeCommentColor(c,A):null}focusCommentButton(){setTimeout(()=>{this.#rN?.focus()},0)}getData(){let{richText:c,color:A,opacity:E,creationDate:C,modificationDate:T}=this.#rj.commentData;return{contentsObj:{str:this.comment},richText:c,color:A,opacity:E,creationDate:C,modificationDate:T}}get elementBeforePopup(){return this.#rN}get comment(){return this.#rH||=this.#rj.commentText,this.#rH}set comment(c){c!==this.comment&&(this.#rj.commentText=this.#rH=c)}get parentBoundingClientRect(){return this.#rj.layer.getBoundingClientRect()}setCommentButtonStates({selected:c,hasPopup:A}){this.#rN&&(this.#rN.classList.toggle("selected",c),this.#rN.ariaExpanded=A)}setSelectedCommentButton(c){this.#rN.classList.toggle("selected",c)}get commentPopupPosition(){if(this.#es)return this.#es;let{x:c,y:A,height:E}=this.#rN.getBoundingClientRect(),{x:C,y:T,width:M,height:k}=this.#rj.layer.getBoundingClientRect();return[(c-C)/M,(A+E-T)/k]}set commentPopupPosition(c){this.#es=c}hasDefaultPopupPosition(){return null===this.#es}get commentButtonPosition(){return this.#rO}get commentButtonWidth(){return this.#rN.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(c){let[A,E]=this.#es||this.commentButtonPosition.map(c=>c/100),C=this.parentBoundingClientRect,{x:T,y:M,width:k,height:I}=C;this.#U.showDialog(null,this,T+A*k,M+E*I,{...c,parentDimensions:C})}render(){if(this.#rL)return;let c=this.#rL=document.createElement("div");if(c.className="popup",this.#rT){let A=c.style.outlineColor=Ct.makeHexColor(...this.#rT);c.style.backgroundColor=`color-mix(in srgb, ${A} 30%, white)`}let A=document.createElement("span");if(A.className="header",this.#rU?.str){let c=document.createElement("span");c.className="title",A.append(c),{dir:c.dir,str:c.textContent}=this.#rU}if(c.append(A),this.#rk){let c=document.createElement("time");c.className="popupDate",c.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),c.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#rk.valueOf()})),c.dateTime=this.#rk.toISOString(),A.append(c)}ue({html:this.#rK||this.#rM.str,dir:this.#rM?.dir,className:"popupContent"},c),this.#tA.append(c)}get #rK(){let c=this.#t7,A=this.#rM;return!c?.str||A?.str&&A.str!==c.str?null:this.#t7.html||null}get #rJ(){return this.#rK?.attributes?.style?.fontSize||0}get #rQ(){return this.#rK?.attributes?.style?.color||null}#rZ(c){let A=[],E={style:{color:this.#rQ,fontSize:this.#rJ?`calc(${this.#rJ}px * var(--total-scale-factor))`:""}};for(let C of c.split("\n"))A.push({name:"span",value:C,attributes:E});return{str:c,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:A}]}}}#rd(c){c.altKey||c.shiftKey||c.ctrlKey||c.metaKey||("Enter"===c.key||"Escape"===c.key&&this.#rI)&&this.#rG()}updateEdited({rect:c,popup:A,deleted:E}){if(this.#U)return E?(this.remove(),this.#rH=null):A&&(A.deleted?this.remove():(this.#rX(),this.#rH=A.text)),void(c&&(this.#rO=null,this.#rq(),this.#rY()));E||A?.deleted?this.remove():(this.#rW(),this.#rf||={contentsObj:this.#rM,richText:this.#t7},c&&(this.#M=null),A&&A.text&&(this.#t7=this.#rZ(A.text),this.#rk=Yt.toDateObject(A.date),this.#rM=null),this.#rL?.remove(),this.#rL=null)}resetEdited(){this.#rf&&({contentsObj:this.#rM,richText:this.#t7}=this.#rf,this.#rf=null,this.#rL?.remove(),this.#rL=null,this.#M=null)}remove(){if(this.#rF?.abort(),this.#rF=null,this.#rL?.remove(),this.#rL=null,this.#rz=!1,this.#rI=!1,this.#rN?.remove(),this.#rN=null,this.trigger)for(let c of this.trigger)c.classList.remove("popupTriggerArea")}#r0(){if(null!==this.#M)return;let{page:{view:c},viewport:{rawDims:{pageWidth:A,pageHeight:E,pageX:C,pageY:T}}}=this.#rR,M=!!this.#rD,k=M?this.#rD:this.#rB;for(let c of this.#rP)if(!k||null!==Ct.intersect(c.data.rect,k)){k=c.data.rect,M=!0;break}let I=Ct.normalizeRect([k[0],c[3]-k[1]+c[1],k[2],c[3]-k[3]+c[1]]),N=M?k[2]-k[0]+5:0,O=I[0]+N,U=I[1];this.#M=[100*(O-C)/A,100*(U-T)/E];let{style:j}=this.#tA;j.left=`${this.#M[0]}%`,j.top=`${this.#M[1]}%`}#rG(){this.#U?this.#U.toggleCommentPopup(this,!1):(this.#rI=!this.#rI,this.#rI?(this.#rV(),this.#tA.addEventListener("click",this.#rC),this.#tA.addEventListener("keydown",this.#rx)):(this.#r$(),this.#tA.removeEventListener("click",this.#rC),this.#tA.removeEventListener("keydown",this.#rx)))}#rV(){this.#rL||this.render(),this.isVisible?this.#rI&&this.#tA.classList.add("focused"):(this.#r0(),this.#tA.hidden=!1,this.#tA.style.zIndex=parseInt(this.#tA.style.zIndex)+1e3)}#r$(){this.#tA.classList.remove("focused"),!this.#rI&&this.isVisible&&(this.#tA.hidden=!0,this.#tA.style.zIndex=parseInt(this.#tA.style.zIndex)-1e3)}forceHide(){this.#rz=this.isVisible,this.#rz&&(this.#tA.hidden=!0)}maybeShow(){this.#U||(this.#rW(),this.#rz&&(this.#rL||this.#rV(),this.#rz=!1,this.#tA.hidden=!1))}get isVisible(){return!this.#U&&!1===this.#tA.hidden}};let _n=class _n extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.textContent=c.data.textContent,this.textPosition=c.data.textPosition,this.annotationEditorType=tl.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let c=document.createElement("div");for(let A of(c.classList.add("annotationTextContent"),c.setAttribute("role","comment"),this.textContent)){let E=document.createElement("span");E.textContent=A,c.append(E)}this.container.append(c)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}};let Sn=class Sn extends cn{#r1;constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.#r1=null}render(){this.container.classList.add("lineAnnotation");let{data:c,width:A,height:E}=this,C=this.svgFactory.create(A,E,!0),T=this.#r1=this.svgFactory.createElement("svg:line");return T.setAttribute("x1",c.rect[2]-c.lineCoordinates[0]),T.setAttribute("y1",c.rect[3]-c.lineCoordinates[1]),T.setAttribute("x2",c.rect[2]-c.lineCoordinates[2]),T.setAttribute("y2",c.rect[3]-c.lineCoordinates[3]),T.setAttribute("stroke-width",c.borderStyle.width||1),T.setAttribute("stroke","transparent"),T.setAttribute("fill","transparent"),C.append(T),this.container.append(C),!c.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#r1}addHighlightArea(){this.container.classList.add("highlightArea")}};let En=class En extends cn{#r2;constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.#r2=null}render(){this.container.classList.add("squareAnnotation");let{data:c,width:A,height:E}=this,C=this.svgFactory.create(A,E,!0),T=c.borderStyle.width,M=this.#r2=this.svgFactory.createElement("svg:rect");return M.setAttribute("x",T/2),M.setAttribute("y",T/2),M.setAttribute("width",A-T),M.setAttribute("height",E-T),M.setAttribute("stroke-width",T||1),M.setAttribute("stroke","transparent"),M.setAttribute("fill","transparent"),C.append(M),this.container.append(C),!c.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#r2}addHighlightArea(){this.container.classList.add("highlightArea")}};let Cn=class Cn extends cn{#r5;constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.#r5=null}render(){this.container.classList.add("circleAnnotation");let{data:c,width:A,height:E}=this,C=this.svgFactory.create(A,E,!0),T=c.borderStyle.width,M=this.#r5=this.svgFactory.createElement("svg:ellipse");return M.setAttribute("cx",A/2),M.setAttribute("cy",E/2),M.setAttribute("rx",A/2-T/2),M.setAttribute("ry",E/2-T/2),M.setAttribute("stroke-width",T||1),M.setAttribute("stroke","transparent"),M.setAttribute("fill","transparent"),C.append(M),this.container.append(C),!c.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#r5}addHighlightArea(){this.container.classList.add("highlightArea")}};let Tn=class Tn extends cn{#r4;constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.#r4=null,this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:c,vertices:A,borderStyle:E,popupRef:C},width:T,height:M}=this;if(!A)return this.container;let k=this.svgFactory.create(T,M,!0),I=[];for(let E=0,C=A.length;E<C;E+=2){let C=A[E]-c[0],T=c[3]-A[E+1];I.push(`${C},${T}`)}I=I.join(" ");let N=this.#r4=this.svgFactory.createElement(this.svgElementName);return N.setAttribute("points",I),N.setAttribute("stroke-width",E.width||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),k.append(N),this.container.append(k),!C&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#r4}addHighlightArea(){this.container.classList.add("highlightArea")}};let Mn=class Mn extends Tn{constructor(c){super(c),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}};let Dn=class Dn extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}};let Pn=class Pn extends cn{#r3;#r6;constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.#r3=null,this.#r6=[],this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?tl.HIGHLIGHT:tl.INK}#r9(c,A){switch(c){case 90:return{transform:`rotate(90) translate(${-A[0]},${A[1]}) scale(1,-1)`,width:A[3]-A[1],height:A[2]-A[0]};case 180:return{transform:`rotate(180) translate(${-A[2]},${A[1]}) scale(1,-1)`,width:A[2]-A[0],height:A[3]-A[1]};case 270:return{transform:`rotate(270) translate(${-A[2]},${A[3]}) scale(1,-1)`,width:A[3]-A[1],height:A[2]-A[0]};default:return{transform:`translate(${-A[0]},${A[3]}) scale(1,-1)`,width:A[2]-A[0],height:A[3]-A[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:c,rotation:A,inkLists:E,borderStyle:C,popupRef:T}}=this,{transform:M,width:k,height:I}=this.#r9(A,c),N=this.svgFactory.create(k,I,!0),O=this.#r3=this.svgFactory.createElement("svg:g");N.append(O),O.setAttribute("stroke-width",C.width||1),O.setAttribute("stroke-linecap","round"),O.setAttribute("stroke-linejoin","round"),O.setAttribute("stroke-miterlimit",10),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),O.setAttribute("transform",M);for(let c=0,A=E.length;c<A;c++){let A=this.svgFactory.createElement(this.svgElementName);this.#r6.push(A),A.setAttribute("points",E[c].join(",")),O.append(A)}return!T&&this.hasPopupData&&this._createPopup(),this.container.append(N),this._editOnDoubleClick(),this.container}updateEdited(c){super.updateEdited(c);let{thickness:A,points:E,rect:C}=c,T=this.#r3;if(A>=0&&T.setAttribute("stroke-width",A||1),E)for(let c=0,A=this.#r6.length;c<A;c++)this.#r6[c].setAttribute("points",E[c].join(","));if(C){let{transform:c,width:A,height:E}=this.#r9(this.data.rotation,C);T.parentElement.setAttribute("viewBox",`0 0 ${A} ${E}`),T.setAttribute("transform",c)}}getElementsToTriggerPopup(){return this.#r6}addHighlightArea(){this.container.classList.add("highlightArea")}};let kn=class kn extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=tl.HIGHLIGHT}render(){let{data:{overlaidText:c,popupRef:A}}=this;if(!A&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),c){let A=document.createElement("mark");A.classList.add("overlaidText"),A.textContent=c,this.container.append(A)}return this.container}};let In=class In extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:c,popupRef:A}}=this;if(!A&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),c){let A=document.createElement("u");A.classList.add("overlaidText"),A.textContent=c,this.container.append(A)}return this.container}};let Rn=class Rn extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:c,popupRef:A}}=this;if(!A&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),c){let A=document.createElement("u");A.classList.add("overlaidText"),A.textContent=c,this.container.append(A)}return this.container}};let Ln=class Ln extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:c,popupRef:A}}=this;if(!A&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),c){let A=document.createElement("s");A.classList.add("overlaidText"),A.textContent=c,this.container.append(A)}return this.container}};let Bn=class Bn extends cn{constructor(c){super(c,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=tl.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}};let Fn=class Fn extends cn{#r8;constructor(c){super(c,{isRenderable:!0}),this.#r8=null;let{file:A}=this.data;this.filename=A.filename,this.content=A.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...A})}render(){let c;this.container.classList.add("fileAttachmentAnnotation");let{container:A,data:E}=this;E.hasAppearance||0===E.fillAlpha?c=document.createElement("div"):((c=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(E.name)?"paperclip":"pushpin"}.svg`,E.fillAlpha&&E.fillAlpha<1&&(c.style=`filter: opacity(${Math.round(100*E.fillAlpha)}%);`)),c.addEventListener("dblclick",this.#r7.bind(this)),this.#r8=c;let{isMac:C}=St.platform;return A.addEventListener("keydown",c=>{"Enter"===c.key&&(C?c.metaKey:c.ctrlKey)&&this.#r7()}),!E.popupRef&&this.hasPopupData?this._createPopup():c.classList.add("popupTriggerArea"),A.append(c),A}getElementsToTriggerPopup(){return this.#r8}addHighlightArea(){this.container.classList.add("highlightArea")}#r7(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}};let On=class On{#nt;#ne;#N;#ni;#ns;#nr;constructor({div:c,accessibilityManager:A,annotationCanvasMap:E,annotationEditorUIManager:C,page:T,viewport:M,structTreeLayer:k,commentManager:I,linkService:N,annotationStorage:O}){this.#nt=null,this.#ne=null,this.#N=null,this.#ni=new Map,this.#ns=null,this.#nr=null,this.div=c,this.#nt=A,this.#ne=E,this.#ns=k||null,this.#nr=N||null,this.#N=O||new Ie,this.page=T,this.viewport=M,this.zIndex=0,this._annotationEditorUIManager=C,this._commentManager=I||null}hasEditableAnnotations(){return this.#ni.size>0}async #nn(c,A,E){let C=c.firstChild||c,T=C.id=`${tT}${A}`,M=await this.#ns?.getAriaAttributes(T);if(M)for(let[c,A]of M)C.setAttribute(c,A);E?E.at(-1).container.after(c):(this.div.append(c),this.#nt?.moveElementInDOM(this.div,c,C,!1))}async render(c){let{annotations:A}=c,E=this.div;te(E,this.viewport);let C=new Map,T={data:null,layer:E,linkService:this.#nr,downloadManager:c.downloadManager,imageResourcesPath:c.imageResourcesPath||"",renderForms:!1!==c.renderForms,svgFactory:new an,annotationStorage:this.#N,enableComment:!0===c.enableComment,enableScripting:!0===c.enableScripting,hasJSActions:c.hasJSActions,fieldObjects:c.fieldObjects,parent:this,elements:null};for(let c of A){if(c.noHTML)continue;let A=c.annotationType===tu.POPUP;if(A){let A=C.get(c.id);if(!A)continue;T.elements=A}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;T.data=c;let E=hn.create(T);if(!E.isRenderable)continue;if(!A&&c.popupRef){let A=C.get(c.popupRef);A?A.push(E):C.set(c.popupRef,[E])}let M=E.render();c.hidden&&(M.style.visibility="hidden"),await this.#nn(M,c.id,T.elements),E.extraPopupElement?.popup?.renderCommentButton(),E._isEditable&&(this.#ni.set(E.data.id,E),this._annotationEditorUIManager?.renderAnnotationElement(E))}this.#na()}async addLinkAnnotations(c){let A={data:null,layer:this.div,linkService:this.#nr,svgFactory:new an,parent:this};for(let E of c){E.borderStyle||=On._defaultBorderStyle,A.data=E;let c=hn.create(A);if(!c.isRenderable)continue;let C=c.render();await this.#nn(C,E.id,null)}}update({viewport:c}){let A=this.div;this.viewport=c,te(A,{rotation:c.rotation}),this.#na(),A.hidden=!1}#na(){if(!this.#ne)return;let c=this.div;for(let[A,E]of this.#ne){let C=c.querySelector(`[data-annotation-id="${A}"]`);if(!C)continue;E.className="annotationContent";let{firstChild:T}=C;T?"CANVAS"===T.nodeName?T.replaceWith(E):T.classList.contains("annotationContent")?T.after(E):T.before(E):C.append(E);let M=this.#ni.get(A);M&&(M._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(A,C.id,E),M._hasNoCanvas=!1):M.canvas=E)}this.#ne.clear()}getEditableAnnotations(){return Array.from(this.#ni.values())}getEditableAnnotation(c){return this.#ni.get(c)}addFakeAnnotation(c){let{div:A}=this,{id:E,rotation:C}=c,T=new dn({data:{id:E,rect:c.getPDFRect(),rotation:C},editor:c,layer:A,parent:this,enableComment:!!this._commentManager,linkService:this.#nr,annotationStorage:this.#N}),M=T.render();return A.append(M),this.#nt?.moveElementInDOM(A,M,M,!1),T.createOrUpdatePopup(),T}static get _defaultBorderStyle(){return gt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:1,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};let et=/\r\n?|\n/g;let Un=class Un extends Ee{#no;#nl;#nh;#rJ;static{this._freeTextDefaultContent=""}static{this._internalPadding=0}static{this._defaultColor=null}static{this._defaultFontSize=10}static get _keyboardManager(){let c=Un.prototype,e=c=>c.isEmpty(),A=xe.TRANSLATE_SMALL,E=xe.TRANSLATE_BIG;return gt(this,"_keyboardManager",new ye([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],c.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],c.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],c._translateEmpty,{args:[-A,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],c._translateEmpty,{args:[-E,0],checker:e}],[["ArrowRight","mac+ArrowRight"],c._translateEmpty,{args:[A,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],c._translateEmpty,{args:[E,0],checker:e}],[["ArrowUp","mac+ArrowUp"],c._translateEmpty,{args:[0,-A],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],c._translateEmpty,{args:[0,-E],checker:e}],[["ArrowDown","mac+ArrowDown"],c._translateEmpty,{args:[0,A],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],c._translateEmpty,{args:[0,E],checker:e}]]))}static{this._type="freetext"}static{this._editorType=tl.FREETEXT}constructor(c){super({...c,name:"freeTextEditor"}),this.#no="",this.#nl=`${this.id}-editor`,this.#nh=null,this._colorPicker=null,this.color=c.color||Un._defaultColor||Ee._defaultLineColor,this.#rJ=c.fontSize||Un._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(c,A){Ee.initialize(c,A);let E=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(E.getPropertyValue("--freetext-padding"))}static updateDefaultParams(c,A){switch(c){case th.FREETEXT_SIZE:Un._defaultFontSize=A;break;case th.FREETEXT_COLOR:Un._defaultColor=A}}updateParams(c,A){switch(c){case th.FREETEXT_SIZE:this.#nd(A);break;case th.FREETEXT_COLOR:this.#rX(A)}}static get defaultPropertiesToUpdate(){return[[th.FREETEXT_SIZE,Un._defaultFontSize],[th.FREETEXT_COLOR,Un._defaultColor||Ee._defaultLineColor]]}get propertiesToUpdate(){return[[th.FREETEXT_SIZE,this.#rJ],[th.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new tn(this),[["colorPicker",this._colorPicker]]}get colorType(){return th.FREETEXT_COLOR}#nd(c){let e=c=>{this.editorDiv.style.fontSize=`calc(${c}px * var(--total-scale-factor))`,this.translate(0,-(c-this.#rJ)*this.parentScale),this.#rJ=c,this.#nc()},A=this.#rJ;this.addCommands({cmd:e.bind(this,c),undo:e.bind(this,A),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:th.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#rX(c){let e=c=>{this.color=c,this.onUpdatedColor()},A=this.color;this.addCommands({cmd:e.bind(this,c),undo:e.bind(this,A),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:th.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(c,A){this._uiManager.translateSelectedEditors(c,A,!0)}getInitialTranslation(){let c=this.parentScale;return[-Un._internalPadding*c,-(Un._internalPadding+this.#rJ)*c]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#nh=new AbortController;let c=this._uiManager.combinedSignal(this.#nh);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:c}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:c}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:c}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:c}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:c}),!0}disableEditMode(){return!!super.disableEditMode()&&(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#nl),this._isDraggable=!0,this.#nh?.abort(),this.#nh=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0)}focusin(c){this._focusEventsAllowed&&(super.focusin(c),c.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(c){this.width||(this.enableEditMode(),c&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#nu(){let c=[];this.editorDiv.normalize();let A=null;for(let E of this.editorDiv.childNodes)A?.nodeType===Node.TEXT_NODE&&"BR"===E.nodeName||(c.push(Un.#np(E)),A=E);return c.join("\n")}#nc(){let c;let[A,E]=this.parentDimensions;if(this.isAttachedToDOM)c=this.div.getBoundingClientRect();else{let{currentLayer:A,div:E}=this,C=E.style.display,T=E.classList.contains("hidden");E.classList.remove("hidden"),E.style.display="hidden",A.div.append(this.div),c=E.getBoundingClientRect(),E.remove(),E.style.display=C,E.classList.toggle("hidden",T)}this.rotation%180==this.parentRotation%180?(this.width=c.width/A,this.height=c.height/E):(this.width=c.height/A,this.height=c.width/E),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let c=this.#no,A=this.#no=this.#nu().trimEnd();if(c===A)return;let i=c=>{this.#no=c,c?(this.#ng(),this._uiManager.rebuild(this),this.#nc()):this.remove()};this.addCommands({cmd:()=>{i(A)},undo:()=>{i(c)},mustExec:!1}),this.#nc()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(c){c.target===this.div&&"Enter"===c.key&&(this.enterInEditMode(),c.preventDefault())}editorDivKeydown(c){Un._keyboardManager.exec(this,c)}editorDivFocus(c){this.isEditing=!0}editorDivBlur(c){this.isEditing=!1}editorDivInput(c){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){let c,A;if(this.div)return this.div;(this._isCopy||this.annotationElementId)&&(c=this.x,A=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#nl),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:E}=this.editorDiv;if(E.fontSize=`calc(${this.#rJ}px * var(--total-scale-factor))`,E.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){let[E,C]=this.parentDimensions;if(this.annotationElementId){let T,M;let{position:k}=this._initialData,[I,N]=this.getInitialTranslation();[I,N]=this.pageTranslationToScreen(I,N);let[O,U]=this.pageDimensions,[j,$]=this.pageTranslation;switch(this.rotation){case 0:T=c+(k[0]-j)/O,M=A+this.height-(k[1]-$)/U;break;case 90:T=c+(k[0]-j)/O,M=A-(k[1]-$)/U,[I,N]=[N,-I];break;case 180:T=c-this.width+(k[0]-j)/O,M=A-(k[1]-$)/U,[I,N]=[-I,-N];break;case 270:T=c+(k[0]-j-this.height*U)/O,M=A+(k[1]-$-this.width*O)/U,[I,N]=[-N,I]}this.setAt(T*E,M*C,I,N)}else this._moveAfterPaste(c,A);this.#ng(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static #np(c){return(c.nodeType===Node.TEXT_NODE?c.nodeValue:c.innerText).replaceAll(et,"")}editorDivPaste(c){let A=c.clipboardData||window.clipboardData,{types:E}=A;if(1===E.length&&"text/plain"===E[0])return;c.preventDefault();let C=Un.#nf(A.getData("text")||"").replaceAll(et,"\n");if(!C)return;let T=window.getSelection();if(!T.rangeCount)return;this.editorDiv.normalize(),T.deleteFromDocument();let M=T.getRangeAt(0);if(!C.includes("\n"))return M.insertNode(document.createTextNode(C)),this.editorDiv.normalize(),void T.collapseToStart();let{startContainer:k,startOffset:I}=M,N=[],O=[];if(k.nodeType===Node.TEXT_NODE){let c=k.parentElement;if(O.push(k.nodeValue.slice(I).replaceAll(et,"")),c!==this.editorDiv){let A=N;for(let E of this.editorDiv.childNodes)E!==c?A.push(Un.#np(E)):A=O}N.push(k.nodeValue.slice(0,I).replaceAll(et,""))}else if(k===this.editorDiv){let c=N,A=0;for(let E of this.editorDiv.childNodes)A++===I&&(c=O),c.push(Un.#np(E))}this.#no=`${N.join("\n")}${C}${O.join("\n")}`,this.#ng();let U=new Range,j=Math.sumPrecise(N.map(c=>c.length));for(let{firstChild:c}of this.editorDiv.childNodes)if(c.nodeType===Node.TEXT_NODE){let A=c.nodeValue.length;if(j<=A){U.setStart(c,j),U.setEnd(c,j);break}j-=A}T.removeAllRanges(),T.addRange(U)}#ng(){if(this.editorDiv.replaceChildren(),this.#no)for(let c of this.#no.split("\n")){let A=document.createElement("div");A.append(c?document.createTextNode(c):document.createElement("br")),this.editorDiv.append(A)}}#nm(){return this.#no.replaceAll("\xa0"," ")}static #nf(c){return c.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}getPDFRect(){let c=Un._internalPadding*this.parentScale;return this.getRect(c,c)}static async deserialize(c,A,E){let C=null;if(c instanceof _n){let{data:{defaultAppearanceData:{fontSize:A,fontColor:E},rect:T,rotation:M,id:k,popupRef:I,richText:N,contentsObj:O,creationDate:U,modificationDate:j},textContent:$,textPosition:V,parent:{page:{pageNumber:G}}}=c;if(!$||0===$.length)return null;C=c={annotationType:tl.FREETEXT,color:Array.from(E),fontSize:A,value:$.join("\n"),position:V,pageIndex:G-1,rect:T.slice(0),rotation:M,annotationElementId:k,id:k,deleted:!1,popupRef:I,comment:O?.str||null,richText:N,creationDate:U,modificationDate:j}}let T=await super.deserialize(c,A,E);return T.#rJ=c.fontSize,T.color=Ct.makeHexColor(...c.color),T.#no=Un.#nf(c.value),T._initialData=C,c.comment&&T.setCommentData(c),T}serialize(c=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let A=Ee._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),E=Object.assign(super.serialize(c),{color:A,fontSize:this.#rJ,value:this.#nm()});return this.addComment(E),c?(E.isCopy=!0,E):this.annotationElementId&&!this.#nb(E)?null:(E.id=this.annotationElementId,E)}#nb(c){let{value:A,fontSize:E,color:C,pageIndex:T}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||c.value!==A||c.fontSize!==E||c.color.some((c,A)=>c!==C[A])||c.pageIndex!==T}renderAnnotationElement(c){let A=super.renderAnnotationElement(c);if(!A)return null;let{style:E}=A;for(let c of(E.fontSize=`calc(${this.#rJ}px * var(--total-scale-factor))`,E.color=this.color,A.replaceChildren(),this.#no.split("\n"))){let E=document.createElement("div");E.append(c?document.createTextNode(c):document.createElement("br")),A.append(E)}return c.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#no}}),A}resetAnnotationElement(c){super.resetAnnotationElement(c),c.resetEdited()}};let zn=class zn{static{this.PRECISION=1e-4}toSVGPath(){ct("Abstract method `toSVGPath` must be implemented.")}get box(){ct("Abstract getter `box` must be implemented.")}serialize(c,A){ct("Abstract method `serialize` must be implemented.")}static _rescale(c,A,E,C,T,M){M||=new Float32Array(c.length);for(let k=0,I=c.length;k<I;k+=2)M[k]=A+c[k]*C,M[k+1]=E+c[k+1]*T;return M}static _rescaleAndSwap(c,A,E,C,T,M){M||=new Float32Array(c.length);for(let k=0,I=c.length;k<I;k+=2)M[k]=A+c[k+1]*C,M[k+1]=E+c[k]*T;return M}static _translate(c,A,E,C){C||=new Float32Array(c.length);for(let T=0,M=c.length;T<M;T+=2)C[T]=A+c[T],C[T+1]=E+c[T+1];return C}static svgRound(c){return Math.round(1e4*c)}static _normalizePoint(c,A,E,C,T){switch(T){case 90:return[1-A/E,c/C];case 180:return[1-c/E,1-A/C];case 270:return[A/E,1-c/C];default:return[c/E,A/C]}}static _normalizePagePoint(c,A,E){switch(E){case 90:return[1-A,c];case 180:return[1-c,1-A];case 270:return[A,1-c];default:return[c,A]}}static createBezierPoints(c,A,E,C,T,M){return[(c+5*E)/6,(A+5*C)/6,(5*E+T)/6,(5*C+M)/6,(E+T)/2,(C+M)/2]}};let Hn=class Hn{#nv;#ny;#nw;#nA;#n_;#nx;#nE;#nS;#nC;#nT;#nM;#nk;#nP;static #nR=8;static #nD=2;static #nI=Hn.#nR+Hn.#nD;constructor({x:c,y:A},E,C,T,M,k=0){this.#ny=[],this.#n_=[],this.#nx=new Float32Array(18),this.#nP=[],this.#nv=E,this.#nk=T*C,this.#nA=M,this.#nx.set([NaN,NaN,NaN,NaN,c,A],6),this.#nw=k,this.#nT=Hn.#nR*C,this.#nC=Hn.#nI*C,this.#nM=C,this.#nP.push(c,A)}isEmpty(){return isNaN(this.#nx[8])}#nL(){let c=this.#nx.subarray(4,6),A=this.#nx.subarray(16,18),[E,C,T,M]=this.#nv;return[(this.#nE+(c[0]-A[0])/2-E)/T,(this.#nS+(c[1]-A[1])/2-C)/M,(this.#nE+(A[0]-c[0])/2-E)/T,(this.#nS+(A[1]-c[1])/2-C)/M]}add({x:c,y:A}){this.#nE=c,this.#nS=A;let[E,C,T,M]=this.#nv,[k,I,N,O]=this.#nx.subarray(8,12),U=c-N,j=A-O,$=Math.hypot(U,j);if($<this.#nC)return!1;let V=$-this.#nT,G=V/$,W=G*U,q=G*j,X=k,Y=I;k=N,I=O,N+=W,O+=q,this.#nP?.push(c,A);let K=-q/V*this.#nk,J=W/V*this.#nk;return(this.#nx.set(this.#nx.subarray(2,8),0),this.#nx.set([N+K,O+J],4),this.#nx.set(this.#nx.subarray(14,18),12),this.#nx.set([N-K,O-J],16),isNaN(this.#nx[6]))?(0===this.#n_.length&&(this.#nx.set([k+K,I+J],2),this.#n_.push(NaN,NaN,NaN,NaN,(k+K-E)/T,(I+J-C)/M),this.#nx.set([k-K,I-J],14),this.#ny.push(NaN,NaN,NaN,NaN,(k-K-E)/T,(I-J-C)/M)),this.#nx.set([X,Y,k,I,N,O],6),!this.isEmpty()):(this.#nx.set([X,Y,k,I,N,O],6),Math.abs(Math.atan2(Y-I,X-k)-Math.atan2(q,W))<Math.PI/2?([k,I,N,O]=this.#nx.subarray(2,6),this.#n_.push(NaN,NaN,NaN,NaN,((k+N)/2-E)/T,((I+O)/2-C)/M),[k,I,X,Y]=this.#nx.subarray(14,18),this.#ny.push(NaN,NaN,NaN,NaN,((X+k)/2-E)/T,((Y+I)/2-C)/M)):([X,Y,k,I,N,O]=this.#nx.subarray(0,6),this.#n_.push(((X+5*k)/6-E)/T,((Y+5*I)/6-C)/M,((5*k+N)/6-E)/T,((5*I+O)/6-C)/M,((k+N)/2-E)/T,((I+O)/2-C)/M),[N,O,k,I,X,Y]=this.#nx.subarray(12,18),this.#ny.push(((X+5*k)/6-E)/T,((Y+5*I)/6-C)/M,((5*k+N)/6-E)/T,((5*I+O)/6-C)/M,((k+N)/2-E)/T,((I+O)/2-C)/M)),!0)}toSVGPath(){if(this.isEmpty())return"";let c=this.#n_,A=this.#ny;if(isNaN(this.#nx[6])&&!this.isEmpty())return this.#nF();let E=[];E.push(`M${c[4]} ${c[5]}`);for(let A=6;A<c.length;A+=6)isNaN(c[A])?E.push(`L${c[A+4]} ${c[A+5]}`):E.push(`C${c[A]} ${c[A+1]} ${c[A+2]} ${c[A+3]} ${c[A+4]} ${c[A+5]}`);this.#nN(E);for(let c=A.length-6;c>=6;c-=6)isNaN(A[c])?E.push(`L${A[c+4]} ${A[c+5]}`):E.push(`C${A[c]} ${A[c+1]} ${A[c+2]} ${A[c+3]} ${A[c+4]} ${A[c+5]}`);return this.#nO(E),E.join(" ")}#nF(){let[c,A,E,C]=this.#nv,[T,M,k,I]=this.#nL();return`M${(this.#nx[2]-c)/E} ${(this.#nx[3]-A)/C} L${(this.#nx[4]-c)/E} ${(this.#nx[5]-A)/C} L${T} ${M} L${k} ${I} L${(this.#nx[16]-c)/E} ${(this.#nx[17]-A)/C} L${(this.#nx[14]-c)/E} ${(this.#nx[15]-A)/C} Z`}#nO(c){let A=this.#ny;c.push(`L${A[4]} ${A[5]} Z`)}#nN(c){let[A,E,C,T]=this.#nv,M=this.#nx.subarray(4,6),k=this.#nx.subarray(16,18),[I,N,O,U]=this.#nL();c.push(`L${(M[0]-A)/C} ${(M[1]-E)/T} L${I} ${N} L${O} ${U} L${(k[0]-A)/C} ${(k[1]-E)/T}`)}newFreeDrawOutline(c,A,E,C,T,M){return new jn(c,A,E,C,T,M)}getOutlines(){let c=this.#n_,A=this.#ny,E=this.#nx,[C,T,M,k]=this.#nv,I=new Float32Array((this.#nP?.length??0)+2);for(let c=0,A=I.length-2;c<A;c+=2)I[c]=(this.#nP[c]-C)/M,I[c+1]=(this.#nP[c+1]-T)/k;if(I[I.length-2]=(this.#nE-C)/M,I[I.length-1]=(this.#nS-T)/k,isNaN(E[6])&&!this.isEmpty())return this.#nB(I);let N=new Float32Array(this.#n_.length+24+this.#ny.length),O=c.length;for(let A=0;A<O;A+=2)isNaN(c[A])?N[A]=N[A+1]=NaN:(N[A]=c[A],N[A+1]=c[A+1]);O=this.#nU(N,O);for(let c=A.length-6;c>=6;c-=6)for(let E=0;E<6;E+=2)isNaN(A[c+E])?N[O]=N[O+1]=NaN:(N[O]=A[c+E],N[O+1]=A[c+E+1]),O+=2;return this.#nz(N,O),this.newFreeDrawOutline(N,I,this.#nv,this.#nM,this.#nw,this.#nA)}#nB(c){let A=this.#nx,[E,C,T,M]=this.#nv,[k,I,N,O]=this.#nL(),U=new Float32Array(36);return U.set([NaN,NaN,NaN,NaN,(A[2]-E)/T,(A[3]-C)/M,NaN,NaN,NaN,NaN,(A[4]-E)/T,(A[5]-C)/M,NaN,NaN,NaN,NaN,k,I,NaN,NaN,NaN,NaN,N,O,NaN,NaN,NaN,NaN,(A[16]-E)/T,(A[17]-C)/M,NaN,NaN,NaN,NaN,(A[14]-E)/T,(A[15]-C)/M],0),this.newFreeDrawOutline(U,c,this.#nv,this.#nM,this.#nw,this.#nA)}#nz(c,A){let E=this.#ny;return c.set([NaN,NaN,NaN,NaN,E[4],E[5]],A),A+6}#nU(c,A){let E=this.#nx.subarray(4,6),C=this.#nx.subarray(16,18),[T,M,k,I]=this.#nv,[N,O,U,j]=this.#nL();return c.set([NaN,NaN,NaN,NaN,(E[0]-T)/k,(E[1]-M)/I,NaN,NaN,NaN,NaN,N,O,NaN,NaN,NaN,NaN,U,j,NaN,NaN,NaN,NaN,(C[0]-T)/k,(C[1]-M)/I],A),A+24}};let jn=class jn extends zn{#nv;#nj;#nw;#nA;#nP;#nM;#nH;constructor(c,A,E,C,T,M){super(),this.#nj=new Float32Array(4),this.#nH=c,this.#nP=A,this.#nv=E,this.#nM=C,this.#nw=T,this.#nA=M,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#n$(M);let[k,I,N,O]=this.#nj;for(let A=0,E=c.length;A<E;A+=2)c[A]=(c[A]-k)/N,c[A+1]=(c[A+1]-I)/O;for(let c=0,E=A.length;c<E;c+=2)A[c]=(A[c]-k)/N,A[c+1]=(A[c+1]-I)/O}toSVGPath(){let c=[`M${this.#nH[4]} ${this.#nH[5]}`];for(let A=6,E=this.#nH.length;A<E;A+=6)isNaN(this.#nH[A])?c.push(`L${this.#nH[A+4]} ${this.#nH[A+5]}`):c.push(`C${this.#nH[A]} ${this.#nH[A+1]} ${this.#nH[A+2]} ${this.#nH[A+3]} ${this.#nH[A+4]} ${this.#nH[A+5]}`);return c.push("Z"),c.join(" ")}serialize([c,A,E,C],T){let M,k;let I=E-c,N=C-A;switch(T){case 0:M=zn._rescale(this.#nH,c,C,I,-N),k=zn._rescale(this.#nP,c,C,I,-N);break;case 90:M=zn._rescaleAndSwap(this.#nH,c,A,I,N),k=zn._rescaleAndSwap(this.#nP,c,A,I,N);break;case 180:M=zn._rescale(this.#nH,E,A,-I,N),k=zn._rescale(this.#nP,E,A,-I,N);break;case 270:M=zn._rescaleAndSwap(this.#nH,E,C,-I,-N),k=zn._rescaleAndSwap(this.#nP,E,C,-I,-N)}return{outline:Array.from(M),points:[Array.from(k)]}}#n$(c){let A=this.#nH,E=A[4],C=A[5],T=[E,C,E,C],M=E,k=C,I=E,N=C,O=c?Math.max:Math.min,U=new Float32Array(4);for(let c=6,j=A.length;c<j;c+=6){let j=A[c+4],$=A[c+5];isNaN(A[c])?(Ct.pointBoundingBox(j,$,T),k>$?(M=j,k=$):k===$&&(M=O(M,j)),N<$?(I=j,N=$):N===$&&(I=O(I,j))):(U[0]=U[1]=1/0,U[2]=U[3]=-1/0,Ct.bezierBoundingBox(E,C,...A.slice(c,c+6),U),Ct.rectBoundingBox(U[0],U[1],U[2],U[3],T),k>U[1]?(M=U[0],k=U[1]):k===U[1]&&(M=O(M,U[0])),N<U[3]?(I=U[2],N=U[3]):N===U[3]&&(I=O(I,U[2]))),E=j,C=$}let j=this.#nj;j[0]=T[0]-this.#nw,j[1]=T[1]-this.#nw,j[2]=T[2]-T[0]+2*this.#nw,j[3]=T[3]-T[1]+2*this.#nw,this.firstPoint=[M,k],this.lastPoint=[I,N]}get box(){return this.#nj}newOutliner(c,A,E,C,T,M=0){return new Hn(c,A,E,C,T,M)}getNewOutline(c,A){let[E,C,T,M]=this.#nj,[k,I,N,O]=this.#nv,U=T*N,j=M*O,$=E*N+k,V=C*O+I,G=this.newOutliner({x:this.#nP[0]*U+$,y:this.#nP[1]*j+V},this.#nv,this.#nM,c,this.#nA,A??this.#nw);for(let c=2;c<this.#nP.length;c+=2)G.add({x:this.#nP[c]*U+$,y:this.#nP[c+1]*j+V});return G.getOutlines()}};let $n=class $n{#nv;#nV;#nG;#nW;#nq;constructor(c,A=0,E=0,C=!0){this.#nW=[],this.#nq=[];let T=[1/0,1/0,-1/0,-1/0];for(let{x:E,y:C,width:M,height:k}of c){let c=1e-4*Math.floor((E-A)/1e-4),I=1e-4*Math.ceil((E+M+A)/1e-4),N=1e-4*Math.floor((C-A)/1e-4),O=1e-4*Math.ceil((C+k+A)/1e-4),U=[c,N,O,!0],j=[I,N,O,!1];this.#nW.push(U,j),Ct.rectBoundingBox(c,N,I,O,T)}let M=T[2]-T[0]+2*E,k=T[3]-T[1]+2*E,I=T[0]-E,N=T[1]-E,O=C?-1/0:1/0,U=1/0,j=this.#nW.at(C?-1:-2),$=[j[0],j[2]];for(let c of this.#nW){let[A,E,T,j]=c;!j&&C?E<U?(U=E,O=A):E===U&&(O=Math.max(O,A)):j&&!C&&(E<U?(U=E,O=A):E===U&&(O=Math.min(O,A))),c[0]=(A-I)/M,c[1]=(E-N)/k,c[2]=(T-N)/k}this.#nv=new Float32Array([I,N,M,k]),this.#nV=[O,U],this.#nG=$}getOutlines(){this.#nW.sort((c,A)=>c[0]-A[0]||c[1]-A[1]||c[2]-A[2]);let c=[];for(let A of this.#nW)A[3]?(c.push(...this.#nX(A)),this.#nY(A)):(this.#nK(A),c.push(...this.#nX(A)));return this.#nJ(c)}#nJ(c){let A;let E=[],C=new Set;for(let A of c){let[c,C,T]=A;E.push([c,C,A],[c,T,A])}E.sort((c,A)=>c[1]-A[1]||c[0]-A[0]);for(let c=0,A=E.length;c<A;c+=2){let A=E[c][2],T=E[c+1][2];A.push(T),T.push(A),C.add(A),C.add(T)}let T=[];for(;C.size>0;){let c=C.values().next().value,[E,M,k,I,N]=c;C.delete(c);let O=E,U=M;for(A=[E,k],T.push(A);;){let c;if(C.has(I))c=I;else{if(!C.has(N))break;c=N}C.delete(c),[E,M,k,I,N]=c,O!==E&&(A.push(O,U,E,U===M?M:k),O=E),U=U===M?k:M}A.push(O,U)}return new Vn(T,this.#nv,this.#nV,this.#nG)}#nQ(c){let A=this.#nq,E=0,C=A.length-1;for(;E<=C;){let T=E+C>>1,M=A[T][0];if(M===c)return T;M<c?E=T+1:C=T-1}return C+1}#nY([,c,A]){let E=this.#nQ(c);this.#nq.splice(E,0,[c,A])}#nK([,c,A]){let E=this.#nQ(c);for(let C=E;C<this.#nq.length;C++){let[E,T]=this.#nq[C];if(E!==c)break;if(E===c&&T===A)return void this.#nq.splice(C,1)}for(let C=E-1;C>=0;C--){let[E,T]=this.#nq[C];if(E!==c)break;if(E===c&&T===A)return void this.#nq.splice(C,1)}}#nX(c){let[A,E,C]=c,T=[[A,E,C]],M=this.#nQ(C);for(let c=0;c<M;c++){let[E,C]=this.#nq[c];for(let c=0,M=T.length;c<M;c++){let[,k,I]=T[c];if(!(C<=k||I<=E)){if(k>=E){if(I>C)T[c][1]=C;else{if(1===M)return[];T.splice(c,1),c--,M--}}else T[c][2]=E,I>C&&T.push([A,C,I])}}}return T}};let Vn=class Vn extends zn{#nv;#nZ;constructor(c,A,E,C){super(),this.#nZ=c,this.#nv=A,this.firstPoint=E,this.lastPoint=C}toSVGPath(){let c=[];for(let A of this.#nZ){let[E,C]=A;c.push(`M${E} ${C}`);for(let T=2;T<A.length;T+=2){let M=A[T],k=A[T+1];M===E?(c.push(`V${k}`),C=k):k===C&&(c.push(`H${M}`),E=M)}c.push("Z")}return c.join(" ")}serialize([c,A,E,C],T){let M=[],k=E-c,I=C-A;for(let A of this.#nZ){let E=Array(A.length);for(let T=0;T<A.length;T+=2)E[T]=c+A[T]*k,E[T+1]=C-A[T+1]*I;M.push(E)}return M}get box(){return this.#nv}get classNamesForOutlining(){return["highlightOutline"]}};let Gn=class Gn extends Hn{newFreeDrawOutline(c,A,E,C,T,M){return new Wn(c,A,E,C,T,M)}};let Wn=class Wn extends jn{newOutliner(c,A,E,C,T,M=0){return new Gn(c,A,E,C,T,M)}};let qn=class qn extends Ee{#n0;#n1;#n2;#n5;#r;#n4;#n3;#n6;#n9;#n8;#A;#n7;#nV;#nG;#at;#et;#nk;#ae;static{this._defaultColor=null}static{this._defaultOpacity=1}static{this._defaultThickness=12}static{this._type="highlight"}static{this._editorType=tl.HIGHLIGHT}static{this._freeHighlightId=-1}static{this._freeHighlight=null}static{this._freeHighlightClipId=""}static get _keyboardManager(){let c=qn.prototype;return gt(this,"_keyboardManager",new ye([[["ArrowLeft","mac+ArrowLeft"],c._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],c._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],c._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],c._moveCaret,{args:[3]}]]))}constructor(c){super({...c,name:"highlightEditor"}),this.#n0=null,this.#n1=0,this.#n5=null,this.#r=null,this.#n4=null,this.#n3=null,this.#n6=0,this.#n9=null,this.#n8=null,this.#A=null,this.#n7=!1,this.#nV=null,this.#nG=null,this.#at=null,this.#et="",this.#ae="",this.color=c.color||qn._defaultColor,this.#nk=c.thickness||qn._defaultThickness,this.opacity=c.opacity||qn._defaultOpacity,this.#n2=c.boxes||null,this.#ae=c.methodOfCreation||"",this.#et=c.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",c.highlightId>-1?(this.#n7=!0,this.#ai(c),this.#as()):this.#n2&&(this.#n0=c.anchorNode,this.#n1=c.anchorOffset,this.#n3=c.focusNode,this.#n6=c.focusOffset,this.#ar(),this.#as(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#n7?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#nk,methodOfCreation:this.#ae}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(c){return{numberOfColors:c.get("color").size}}#ar(){let c=new $n(this.#n2,.001);this.#n8=c.getOutlines(),[this.x,this.y,this.width,this.height]=this.#n8.box;let A=new $n(this.#n2,.0025,.001,"ltr"===this._uiManager.direction);this.#n4=A.getOutlines();let{firstPoint:E}=this.#n8;this.#nV=[(E[0]-this.x)/this.width,(E[1]-this.y)/this.height];let{lastPoint:C}=this.#n4;this.#nG=[(C[0]-this.x)/this.width,(C[1]-this.y)/this.height]}#ai({highlightOutlines:c,highlightId:A,clipPathId:E}){if(this.#n8=c,this.#n4=c.getNewOutline(this.#nk/2+1.5,.0025),A>=0)this.#A=A,this.#n5=E,this.parent.drawLayer.finalizeDraw(A,{bbox:c.box,path:{d:c.toSVGPath()}}),this.#at=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n4.box,path:{d:this.#n4.toSVGPath()}},!0);else if(this.parent){let A=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#A,{bbox:qn.#an(this.#n8.box,(A-this.rotation+360)%360),path:{d:c.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#at,{bbox:qn.#an(this.#n4.box,A),path:{d:this.#n4.toSVGPath()}})}let[C,T,M,k]=c.box;switch(this.rotation){case 0:this.x=C,this.y=T,this.width=M,this.height=k;break;case 90:{let[c,A]=this.parentDimensions;this.x=T,this.y=1-C,this.width=M*A/c,this.height=k*c/A;break}case 180:this.x=1-C,this.y=1-T,this.width=M,this.height=k;break;case 270:{let[c,A]=this.parentDimensions;this.x=1-T,this.y=C,this.width=M*A/c,this.height=k*c/A}}let{firstPoint:I}=c;this.#nV=[(I[0]-C)/M,(I[1]-T)/k];let{lastPoint:N}=this.#n4;this.#nG=[(N[0]-C)/M,(N[1]-T)/k]}static initialize(c,A){Ee.initialize(c,A),qn._defaultColor||=A.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(c,A){switch(c){case th.HIGHLIGHT_COLOR:qn._defaultColor=A;break;case th.HIGHLIGHT_THICKNESS:qn._defaultThickness=A}}translateInPage(c,A){}get toolbarPosition(){return this.#nG}get commentButtonPosition(){return this.#nV}updateParams(c,A){switch(c){case th.HIGHLIGHT_COLOR:this.#rX(A);break;case th.HIGHLIGHT_THICKNESS:this.#aa(A)}}static get defaultPropertiesToUpdate(){return[[th.HIGHLIGHT_COLOR,qn._defaultColor],[th.HIGHLIGHT_THICKNESS,qn._defaultThickness]]}get propertiesToUpdate(){return[[th.HIGHLIGHT_COLOR,this.color||qn._defaultColor],[th.HIGHLIGHT_THICKNESS,this.#nk||qn._defaultThickness],[th.HIGHLIGHT_FREE,this.#n7]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#A,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#r?.updateColor(this.color),super.onUpdatedColor()}#rX(c){let e=(c,A)=>{this.color=c,this.opacity=A,this.onUpdatedColor()},A=this.color,E=this.opacity;this.addCommands({cmd:e.bind(this,c,qn._defaultOpacity),undo:e.bind(this,A,E),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:th.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(c)},!0)}#aa(c){let A=this.#nk,i=c=>{this.#nk=c,this.#ao(c)};this.addCommands({cmd:i.bind(this,c),undo:i.bind(this,A),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:th.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:c},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new Zs({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#al())}getBaseTranslation(){return[0,0]}getRect(c,A){return super.getRect(c,A,this.#al())}onceAdded(c){this.annotationElementId||this.parent.addUndoableEditor(this),c&&this.div.focus()}remove(){this.#ah(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#as(),this.isAttachedToDOM||this.parent.add(this)))}setParent(c){let A=!1;this.parent&&!c?this.#ah():c&&(this.#as(c),A=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(c),this.show(this._isVisible),A&&this.select()}#ao(c){this.#n7&&(this.#ai({highlightOutlines:this.#n8.getNewOutline(c/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#ah(){null!==this.#A&&this.parent&&(this.parent.drawLayer.remove(this.#A),this.#A=null,this.parent.drawLayer.remove(this.#at),this.#at=null)}#as(c=this.parent){null===this.#A&&({id:this.#A,clipPathId:this.#n5}=c.drawLayer.draw({bbox:this.#n8.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#n7},path:{d:this.#n8.toSVGPath()}},!1,!0),this.#at=c.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#n7},bbox:this.#n4.box,path:{d:this.#n4.toSVGPath()}},this.#n7),this.#n9&&(this.#n9.style.clipPath=this.#n5))}static #an([c,A,E,C],T){switch(T){case 90:return[1-A-C,c,C,E];case 180:return[1-c-E,1-A-C,E,C];case 270:return[A,1-c-E,C,E]}return[c,A,E,C]}rotate(c){let A;let{drawLayer:E}=this.parent;this.#n7?(c=(c-this.rotation+360)%360,A=qn.#an(this.#n8.box,c)):A=qn.#an([this.x,this.y,this.width,this.height],c),E.updateProperties(this.#A,{bbox:A,root:{"data-main-rotation":c}}),E.updateProperties(this.#at,{bbox:qn.#an(this.#n4.box,c),root:{"data-main-rotation":c}})}render(){if(this.div)return this.div;let c=super.render();this.#et&&(c.setAttribute("aria-label",this.#et),c.setAttribute("role","mark")),this.#n7?c.classList.add("free"):this.div.addEventListener("keydown",this.#ad.bind(this),{signal:this._uiManager._signal});let A=this.#n9=document.createElement("div");return c.append(A),A.setAttribute("aria-hidden","true"),A.className="internal",A.style.clipPath=this.#n5,this.setDims(this.width,this.height),me(this,this.#n9,["pointerover","pointerleave"]),this.enableEditing(),c}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{hovered:!1}})}#ad(c){qn._keyboardManager.exec(this,c)}_moveCaret(c){switch(this.parent.unselect(this),c){case 0:case 2:this.#ac(!0);break;case 1:case 3:this.#ac(!1)}}#ac(c){if(!this.#n0)return;let A=window.getSelection();c?A.setPosition(this.#n0,this.#n1):A.setPosition(this.#n3,this.#n6)}select(){super.select(),this.#at&&this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#at&&(this.parent?.drawLayer.updateProperties(this.#at,{rootClass:{selected:!1}}),this.#n7||this.#ac(!1))}get _mustFixPosition(){return!this.#n7}show(c=this._isVisible){super.show(c),this.parent&&(this.parent.drawLayer.updateProperties(this.#A,{rootClass:{hidden:!c}}),this.parent.drawLayer.updateProperties(this.#at,{rootClass:{hidden:!c}}))}#al(){return this.#n7?this.rotation:0}#au(){if(this.#n7)return null;let[c,A]=this.pageDimensions,[E,C]=this.pageTranslation,T=this.#n2,M=new Float32Array(8*T.length),k=0;for(let{x:I,y:N,width:O,height:U}of T){let T=I*c+E,j=(1-N)*A+C;M[k]=M[k+4]=T,M[k+1]=M[k+3]=j,M[k+2]=M[k+6]=T+O*c,M[k+5]=M[k+7]=j-U*A,k+=8}return M}#ap(c){return this.#n8.serialize(c,this.#al())}static startHighlighting(c,A,{target:E,x:C,y:T}){let{x:M,y:k,width:I,height:N}=E.getBoundingClientRect(),O=new AbortController,U=c.combinedSignal(O),d=A=>{O.abort(),this.#ag(c,A)};window.addEventListener("blur",d,{signal:U}),window.addEventListener("pointerup",d,{signal:U}),window.addEventListener("pointerdown",Xt,{capture:!0,passive:!1,signal:U}),window.addEventListener("contextmenu",qt,{signal:U}),E.addEventListener("pointermove",this.#af.bind(this,c),{signal:U}),this._freeHighlight=new Gn({x:C,y:T},[M,k,I,N],c.scale,this._defaultThickness/2,A,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=c.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static #af(c,A){this._freeHighlight.add(A)&&c.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static #ag(c,A){this._freeHighlight.isEmpty()?c.drawLayer.remove(this._freeHighlightId):c.createAndAddNewEditor(A,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(c,A,E){let C=null;if(c instanceof kn){let{data:{quadPoints:A,rect:E,rotation:T,id:M,color:k,opacity:I,popupRef:N,richText:O,contentsObj:U,creationDate:j,modificationDate:$},parent:{page:{pageNumber:V}}}=c;C=c={annotationType:tl.HIGHLIGHT,color:Array.from(k),opacity:I,quadPoints:A,boxes:null,pageIndex:V-1,rect:E.slice(0),rotation:T,annotationElementId:M,id:M,deleted:!1,popupRef:N,richText:O,comment:U?.str||null,creationDate:j,modificationDate:$}}else if(c instanceof Pn){let{data:{inkLists:A,rect:E,rotation:T,id:M,color:k,borderStyle:{rawWidth:I},popupRef:N,richText:O,contentsObj:U,creationDate:j,modificationDate:$},parent:{page:{pageNumber:V}}}=c;C=c={annotationType:tl.HIGHLIGHT,color:Array.from(k),thickness:I,inkLists:A,boxes:null,pageIndex:V-1,rect:E.slice(0),rotation:T,annotationElementId:M,id:M,deleted:!1,popupRef:N,richText:O,comment:U?.str||null,creationDate:j,modificationDate:$}}let{color:T,quadPoints:M,inkLists:k,opacity:I}=c,N=await super.deserialize(c,A,E);N.color=Ct.makeHexColor(...T),N.opacity=I||1,k&&(N.#nk=c.thickness),N._initialData=C,c.comment&&N.setCommentData(c);let[O,U]=N.pageDimensions,[j,$]=N.pageTranslation;if(M){let c=N.#n2=[];for(let A=0;A<M.length;A+=8)c.push({x:(M[A]-j)/O,y:1-(M[A+1]-$)/U,width:(M[A+2]-M[A])/O,height:(M[A+1]-M[A+5])/U});N.#ar(),N.#as(),N.rotate(N.rotation)}else if(k){N.#n7=!0;let c=k[0],E={x:c[0]-j,y:U-(c[1]-$)},C=new Gn(E,[0,0,O,U],1,N.#nk/2,!0,.001);for(let A=0,T=c.length;A<T;A+=2)E.x=c[A]-j,E.y=U-(c[A+1]-$),C.add(E);let{id:T,clipPathId:M}=A.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:N.color,"fill-opacity":N._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);N.#ai({highlightOutlines:C.getOutlines(),highlightId:T,clipPathId:M}),N.#as(),N.rotate(N.parentRotation)}return N}serialize(c=!1){if(this.isEmpty()||c)return null;if(this.deleted)return this.serializeDeleted();let A=Ee._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),E=super.serialize(c);return Object.assign(E,{color:A,opacity:this.opacity,thickness:this.#nk,quadPoints:this.#au(),outlines:this.#ap(E.rect)}),this.addComment(E),this.annotationElementId&&!this.#nb(E)?null:(E.id=this.annotationElementId,E)}#nb(c){let{color:A}=this._initialData;return this.hasEditedComment||c.color.some((c,E)=>c!==A[E])}renderAnnotationElement(c){return this.deleted?c.hide():c.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null}static canCreateNewEmptyEditor(){return!1}};let Xn=class Xn{#am;updateProperty(c,A){this[c]=A,this.updateSVGProperty(c,A)}updateProperties(c){if(c)for(let[A,E]of Object.entries(c))A.startsWith("_")||this.updateProperty(A,E)}updateSVGProperty(c,A){this.#am[c]=A}toSVGProperties(){let c=this.#am;return this.#am=Object.create(null),{root:c}}reset(){this.#am=Object.create(null)}updateAll(c=this){this.updateProperties(c)}clone(){ct("Not implemented")}constructor(){this.#am=Object.create(null)}};let Yn=class Yn extends Ee{#ab;#av;static{this._currentDrawId=-1}static{this._currentParent=null}static #ay=null;static #aw=null;static #aA=null;static #a_=NaN;static #ax=null;static #aE=null;static #aS=NaN;static{this._INNER_MARGIN=3}constructor(c){super(c),this.#ab=null,this._colorPicker=null,this._drawId=null,this.#av=c.mustBeCommitted||!1,this._addOutlines(c)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(c){c.drawOutlines&&(this.#aC(c),this.#as())}#aC({drawOutlines:c,drawId:A,drawingOptions:E}){this.#ab=c,this._drawingOptions||=E,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),A>=0?(this._drawId=A,this.parent.drawLayer.finalizeDraw(A,c.defaultProperties)):this._drawId=this.#aT(c,this.parent),this.#aM(c.box)}#aT(c,A){let{id:E}=A.drawLayer.draw(Yn._mergeSVGProperties(this._drawingOptions.toSVGProperties(),c.defaultSVGProperties),!1,!1);return E}static _mergeSVGProperties(c,A){let E=new Set(Object.keys(c));for(let[C,T]of Object.entries(A))E.has(C)?Object.assign(c[C],T):c[C]=T;return c}static getDefaultDrawingOptions(c){ct("Not implemented")}static get typesMap(){ct("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(c,A){let E=this.typesMap.get(c);E&&this._defaultDrawingOptions.updateProperty(E,A),this._currentParent&&(Yn.#ay.updateProperty(E,A),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(c,A){let E=this.constructor.typesMap.get(c);E&&this._updateProperty(c,E,A)}static get defaultPropertiesToUpdate(){let c=[],A=this._defaultDrawingOptions;for(let[E,C]of this.typesMap)c.push([E,A[C]]);return c}get propertiesToUpdate(){let c=[],{_drawingOptions:A}=this;for(let[E,C]of this.constructor.typesMap)c.push([E,A[C]]);return c}_updateProperty(c,A,E){let C=this._drawingOptions,T=C[A],r=E=>{C.updateProperty(A,E);let T=this.#ab.updateProperty(A,E);T&&this.#aM(T),this.parent?.drawLayer.updateProperties(this._drawId,C.toSVGProperties()),c===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,E),undo:r.bind(this,T),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:c,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Yn._mergeSVGProperties(this.#ab.getPathResizingSVGProperties(this.#ak()),{bbox:this.#aP()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Yn._mergeSVGProperties(this.#ab.getPathResizedSVGProperties(this.#ak()),{bbox:this.#aP()}))}_onTranslating(c,A){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#aP()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Yn._mergeSVGProperties(this.#ab.getPathTranslatedSVGProperties(this.#ak(),this.parentDimensions),{bbox:this.#aP()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(c){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#av&&(this.#av=!1,this.commit(),this.parent.setSelected(this),c&&this.isOnScreen&&this.div.focus())}remove(){this.#ah(),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#as(),this.#aM(this.#ab.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(c){let A=!1;this.parent&&!c?(this._uiManager.removeShouldRescale(this),this.#ah()):c&&(this._uiManager.addShouldRescale(this),this.#as(c),A=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(c),A&&this.select()}#ah(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#as(c=this.parent){null!==this._drawId&&this.parent===c||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=this.#aT(this.#ab,c)):this.parent.drawLayer.updateParent(this._drawId,c.drawLayer))}#aR([c,A,E,C]){let{parentDimensions:[T,M],rotation:k}=this;switch(k){case 90:return[A,1-c,E*(M/T),C*(T/M)];case 180:return[1-c,1-A,E,C];case 270:return[1-A,c,E*(M/T),C*(T/M)];default:return[c,A,E,C]}}#ak(){let{x:c,y:A,width:E,height:C,parentDimensions:[T,M],rotation:k}=this;switch(k){case 90:return[1-A,c,E*(T/M),C*(M/T)];case 180:return[1-c,1-A,E,C];case 270:return[A,1-c,E*(T/M),C*(M/T)];default:return[c,A,E,C]}}#aM(c){[this.x,this.y,this.width,this.height]=this.#aR(c),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#aP(){let{x:c,y:A,width:E,height:C,rotation:T,parentRotation:M,parentDimensions:[k,I]}=this;switch((4*T+M)/90){case 1:return[1-A-C,c,C,E];case 2:return[1-c-E,1-A-C,E,C];case 3:return[A,1-c-E,C,E];case 4:return[c,A-E*(k/I),C*(I/k),E*(k/I)];case 5:return[1-A,c,E*(k/I),C*(I/k)];case 6:return[1-c-C*(I/k),1-A,C*(I/k),E*(k/I)];case 7:return[A-E*(k/I),1-c-C*(I/k),E*(k/I),C*(I/k)];case 8:return[c-E,A-C,E,C];case 9:return[1-A,c-E,C,E];case 10:return[1-c,1-A,E,C];case 11:return[A-C,1-c,C,E];case 12:return[c-C*(I/k),A,C*(I/k),E*(k/I)];case 13:return[1-A-E*(k/I),c-C*(I/k),E*(k/I),C*(I/k)];case 14:return[1-c,1-A-E*(k/I),C*(I/k),E*(k/I)];case 15:return[A,1-c,E*(k/I),C*(I/k)];default:return[c,A,E,C]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Yn._mergeSVGProperties({bbox:this.#aP()},this.#ab.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#aM(this.#ab.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){let c,A;if(this.div)return this.div;this._isCopy&&(c=this.x,A=this.y);let E=super.render();E.classList.add("draw");let C=document.createElement("div");return E.append(C),C.setAttribute("aria-hidden","true"),C.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(c,A),E}static createDrawerInstance(c,A,E,C,T){ct("Not implemented")}static startDrawing(c,A,E,C){let{target:T,offsetX:M,offsetY:k,pointerId:I,pointerType:N}=C;if(Yn.#ax&&Yn.#ax!==N)return;let{viewport:{rotation:O}}=c,{width:U,height:j}=T.getBoundingClientRect(),$=Yn.#aw=new AbortController,V=c.combinedSignal($);Yn.#a_||=I,Yn.#ax??=N,window.addEventListener("pointerup",c=>{Yn.#a_===c.pointerId?this._endDraw(c):Yn.#aE?.delete(c.pointerId)},{signal:V}),window.addEventListener("pointercancel",c=>{Yn.#a_===c.pointerId?this._currentParent.endDrawingSession():Yn.#aE?.delete(c.pointerId)},{signal:V}),window.addEventListener("pointerdown",c=>{Yn.#ax===c.pointerType&&((Yn.#aE||=new Set).add(c.pointerId),Yn.#ay.isCancellable()&&(Yn.#ay.removeLastElement(),Yn.#ay.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:V}),window.addEventListener("contextmenu",qt,{signal:V}),T.addEventListener("pointermove",this._drawMove.bind(this),{signal:V}),T.addEventListener("touchmove",c=>{c.timeStamp===Yn.#aS&&Xt(c)},{signal:V}),c.toggleDrawing(),A._editorUndoBar?.hide(),Yn.#ay?c.drawLayer.updateProperties(this._currentDrawId,Yn.#ay.startNew(M,k,U,j,O)):(A.updateUIForDefaultProperties(this),Yn.#ay=this.createDrawerInstance(M,k,U,j,O),Yn.#aA=this.getDefaultDrawingOptions(),this._currentParent=c,{id:this._currentDrawId}=c.drawLayer.draw(this._mergeSVGProperties(Yn.#aA.toSVGProperties(),Yn.#ay.defaultSVGProperties),!0,!1))}static _drawMove(c){if(Yn.#aS=-1,!Yn.#ay)return;let{offsetX:A,offsetY:E,pointerId:C}=c;Yn.#a_===C&&(Yn.#aE?.size>=1?this._endDraw(c):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,Yn.#ay.add(A,E)),Yn.#aS=c.timeStamp,Xt(c)))}static _cleanup(c){c&&(this._currentDrawId=-1,this._currentParent=null,Yn.#ay=null,Yn.#aA=null,Yn.#ax=null,Yn.#aS=NaN),Yn.#aw&&(Yn.#aw.abort(),Yn.#aw=null,Yn.#a_=NaN,Yn.#aE=null)}static _endDraw(c){let A=this._currentParent;if(A){if(A.toggleDrawing(!0),this._cleanup(!1),c?.target===A.div&&A.drawLayer.updateProperties(this._currentDrawId,Yn.#ay.end(c.offsetX,c.offsetY)),this.supportMultipleDrawings){let c=Yn.#ay,E=this._currentDrawId,C=c.getLastElement();return void A.addCommands({cmd:()=>{A.drawLayer.updateProperties(E,c.setLastElement(C))},undo:()=>{A.drawLayer.updateProperties(E,c.removeLastElement())},mustExec:!1,type:th.DRAW_STEP})}this.endDrawing(!1)}}static endDrawing(c){let A=this._currentParent;if(!A)return null;if(A.toggleDrawing(!0),A.cleanUndoStack(th.DRAW_STEP),!Yn.#ay.isEmpty()){let{pageDimensions:[E,C],scale:T}=A,M=A.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Yn.#ay.getOutlines(E*T,C*T,T,this._INNER_MARGIN),drawingOptions:Yn.#aA,mustBeCommitted:!c});return this._cleanup(!0),M}return A.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(c){}static deserializeDraw(c,A,E,C,T,M){ct("Not implemented")}static async deserialize(c,A,E){let{rawDims:{pageWidth:C,pageHeight:T,pageX:M,pageY:k}}=A.viewport,I=this.deserializeDraw(M,k,C,T,this._INNER_MARGIN,c),N=await super.deserialize(c,A,E);return N.createDrawingOptions(c),N.#aC({drawOutlines:I}),N.#as(),N.onScaleChanging(),N.rotate(),N}serializeDraw(c){let[A,E]=this.pageTranslation,[C,T]=this.pageDimensions;return this.#ab.serialize([A,E,C,T],c)}renderAnnotationElement(c){return c.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};let Kn=class Kn{#nx;#r1;#aD;#sk;#nk;#nP;#aI;#aL;#nZ;#aF;#aN;constructor(c,A,E,C,T,M){this.#nx=new Float64Array(6),this.#aI="",this.#aL=0,this.#nZ=new Qn,this.#aF=E,this.#aN=C,this.#sk=T,this.#nk=M,[c,A]=this.#aO(c,A);let k=this.#r1=[NaN,NaN,NaN,NaN,c,A];this.#nP=[c,A],this.#aD=[{line:k,points:this.#nP}],this.#nx.set(k,0)}updateProperty(c,A){"stroke-width"===c&&(this.#nk=A)}#aO(c,A){return zn._normalizePoint(c,A,this.#aF,this.#aN,this.#sk)}isEmpty(){return!this.#aD||0===this.#aD.length}isCancellable(){return this.#nP.length<=10}add(c,A){[c,A]=this.#aO(c,A);let[E,C,T,M]=this.#nx.subarray(2,6),k=c-T,I=A-M;return 2>=Math.hypot(this.#aF*k,this.#aN*I)?null:(this.#nP.push(c,A),isNaN(E)?(this.#nx.set([T,M,c,A],2),this.#r1.push(NaN,NaN,NaN,NaN,c,A)):(isNaN(this.#nx[0])&&this.#r1.splice(6,6),this.#nx.set([E,C,T,M,c,A],0),this.#r1.push(...zn.createBezierPoints(E,C,T,M,c,A))),{path:{d:this.toSVGPath()}})}end(c,A){let E=this.add(c,A);return E||(2===this.#nP.length?{path:{d:this.toSVGPath()}}:null)}startNew(c,A,E,C,T){this.#aF=E,this.#aN=C,this.#sk=T,[c,A]=this.#aO(c,A);let M=this.#r1=[NaN,NaN,NaN,NaN,c,A];this.#nP=[c,A];let k=this.#aD.at(-1);return k&&(k.line=new Float32Array(k.line),k.points=new Float32Array(k.points)),this.#aD.push({line:M,points:this.#nP}),this.#nx.set(M,0),this.#aL=0,this.toSVGPath(),null}getLastElement(){return this.#aD.at(-1)}setLastElement(c){return this.#aD?(this.#aD.push(c),this.#r1=c.line,this.#nP=c.points,this.#aL=0,{path:{d:this.toSVGPath()}}):this.#nZ.setLastElement(c)}removeLastElement(){if(!this.#aD)return this.#nZ.removeLastElement();this.#aD.pop(),this.#aI="";for(let c=0,A=this.#aD.length;c<A;c++){let{line:A,points:E}=this.#aD[c];this.#r1=A,this.#nP=E,this.#aL=0,this.toSVGPath()}return{path:{d:this.#aI}}}toSVGPath(){let c=zn.svgRound(this.#r1[4]),A=zn.svgRound(this.#r1[5]);if(2===this.#nP.length)return this.#aI=`${this.#aI} M ${c} ${A} Z`,this.#aI;if(this.#nP.length<=6){let E=this.#aI.lastIndexOf("M");this.#aI=`${this.#aI.slice(0,E)} M ${c} ${A}`,this.#aL=6}if(4===this.#nP.length){let c=zn.svgRound(this.#r1[10]),A=zn.svgRound(this.#r1[11]);return this.#aI=`${this.#aI} L ${c} ${A}`,this.#aL=12,this.#aI}let E=[];0===this.#aL&&(E.push(`M ${c} ${A}`),this.#aL=6);for(let c=this.#aL,A=this.#r1.length;c<A;c+=6){let[A,C,T,M,k,I]=this.#r1.slice(c,c+6).map(zn.svgRound);E.push(`C${A} ${C} ${T} ${M} ${k} ${I}`)}return this.#aI+=E.join(" "),this.#aL=this.#r1.length,this.#aI}getOutlines(c,A,E,C){let T=this.#aD.at(-1);return T.line=new Float32Array(T.line),T.points=new Float32Array(T.points),this.#nZ.build(this.#aD,c,A,E,this.#sk,this.#nk,C),this.#nx=null,this.#r1=null,this.#aD=null,this.#aI=null,this.#nZ}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}};let Qn=class Qn extends zn{#nj;#aB;#nw;#aD;#aF;#aN;#aU;#sk;#nk;build(c,A,E,C,T,M,k){this.#aF=A,this.#aN=E,this.#aU=C,this.#sk=T,this.#nk=M,this.#nw=k??0,this.#aD=c,this.#az()}get thickness(){return this.#nk}setLastElement(c){return this.#aD.push(c),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#aD.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let c=[];for(let{line:A}of this.#aD)if(c.push(`M${zn.svgRound(A[4])} ${zn.svgRound(A[5])}`),6!==A.length){if(12===A.length&&isNaN(A[6]))c.push(`L${zn.svgRound(A[10])} ${zn.svgRound(A[11])}`);else for(let E=6,C=A.length;E<C;E+=6){let[C,T,M,k,I,N]=A.subarray(E,E+6).map(zn.svgRound);c.push(`C${C} ${T} ${M} ${k} ${I} ${N}`)}}else c.push("Z");return c.join("")}serialize([c,A,E,C],T){let M,k,I,N,O,U,j,$,V;let G=[],W=[],[q,X,Y,K]=this.#aj();switch(this.#sk){case 0:V=zn._rescale,M=c,k=A+C,I=E,N=-C,O=c+q*E,U=A+(1-X-K)*C,j=c+(q+Y)*E,$=A+(1-X)*C;break;case 90:V=zn._rescaleAndSwap,M=c,k=A,I=E,N=C,O=c+X*E,U=A+q*C,j=c+(X+K)*E,$=A+(q+Y)*C;break;case 180:V=zn._rescale,M=c+E,k=A,I=-E,N=C,O=c+(1-q-Y)*E,U=A+X*C,j=c+(1-q)*E,$=A+(X+K)*C;break;case 270:V=zn._rescaleAndSwap,M=c+E,k=A+C,I=-E,N=-C,O=c+(1-X-K)*E,U=A+(1-q-Y)*C,j=c+(1-X)*E,$=A+(1-q)*C}for(let{line:c,points:A}of this.#aD)G.push(V(c,M,k,I,N,T?Array(c.length):null)),W.push(V(A,M,k,I,N,T?Array(A.length):null));return{lines:G,points:W,rect:[O,U,j,$]}}static deserialize(c,A,E,C,T,{paths:{lines:M,points:k},rotation:I,thickness:N}){let O,U,j,$,V;let G=[];switch(I){case 0:V=zn._rescale,O=-c/E,U=A/C+1,j=1/E,$=-1/C;break;case 90:V=zn._rescaleAndSwap,O=-A/C,U=-c/E,j=1/C,$=1/E;break;case 180:V=zn._rescale,O=c/E+1,U=-A/C,j=-1/E,$=1/C;break;case 270:V=zn._rescaleAndSwap,O=A/C+1,U=c/E+1,j=-1/C,$=-1/E}if(!M)for(let c of(M=[],k)){let A=c.length;if(2===A){M.push(new Float32Array([NaN,NaN,NaN,NaN,c[0],c[1]]));continue}if(4===A){M.push(new Float32Array([NaN,NaN,NaN,NaN,c[0],c[1],NaN,NaN,NaN,NaN,c[2],c[3]]));continue}let E=new Float32Array(3*(A-2));M.push(E);let[C,T,k,I]=c.subarray(0,4);E.set([NaN,NaN,NaN,NaN,C,T],0);for(let M=4;M<A;M+=2){let A=c[M],N=c[M+1];E.set(zn.createBezierPoints(C,T,k,I,A,N),3*(M-2)),[C,T,k,I]=[k,I,A,N]}}for(let c=0,A=M.length;c<A;c++)G.push({line:V(M[c].map(c=>c??NaN),O,U,j,$),points:V(k[c].map(c=>c??NaN),O,U,j,$)});let W=new this.prototype.constructor;return W.build(G,E,C,1,I,N,T),W}#aH(c=this.#nk){let A=this.#nw+c/2*this.#aU;return this.#sk%180==0?[A/this.#aF,A/this.#aN]:[A/this.#aN,A/this.#aF]}#aj(){let[c,A,E,C]=this.#nj,[T,M]=this.#aH(0);return[c+T,A+M,E-2*T,C-2*M]}#az(){let c=this.#nj=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:A}of this.#aD){if(A.length<=12){for(let E=4,C=A.length;E<C;E+=6)Ct.pointBoundingBox(A[E],A[E+1],c);continue}let E=A[4],C=A[5];for(let T=6,M=A.length;T<M;T+=6){let[M,k,I,N,O,U]=A.subarray(T,T+6);Ct.bezierBoundingBox(E,C,M,k,I,N,O,U,c),E=O,C=U}}let[A,E]=this.#aH();c[0]=It(c[0]-A,0,1),c[1]=It(c[1]-E,0,1),c[2]=It(c[2]+A,0,1),c[3]=It(c[3]+E,0,1),c[2]-=c[0],c[3]-=c[1]}get box(){return this.#nj}updateProperty(c,A){return"stroke-width"===c?this.#aa(A):null}#aa(c){let[A,E]=this.#aH();this.#nk=c;let[C,T]=this.#aH(),[M,k]=[C-A,T-E],I=this.#nj;return I[0]-=M,I[1]-=k,I[2]+=2*M,I[3]+=2*k,I}updateParentDimensions([c,A],E){let[C,T]=this.#aH();this.#aF=c,this.#aN=A,this.#aU=E;let[M,k]=this.#aH(),I=M-C,N=k-T,O=this.#nj;return O[0]-=I,O[1]-=N,O[2]+=2*I,O[3]+=2*N,O}updateRotation(c){return this.#aB=c,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#nj.map(zn.svgRound).join(" ")}get defaultProperties(){let[c,A]=this.#nj;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${zn.svgRound(c)} ${zn.svgRound(A)}`}}}get rotationTransform(){let[,,c,A]=this.#nj,E=0,C=0,T=0,M=0,k=0,I=0;switch(this.#aB){case 90:C=A/c,T=-c/A,k=c;break;case 180:E=-1,M=-1,k=c,I=A;break;case 270:C=-A/c,T=c/A,I=A;break;default:return""}return`matrix(${E} ${C} ${T} ${M} ${zn.svgRound(k)} ${zn.svgRound(I)})`}getPathResizingSVGProperties([c,A,E,C]){let[T,M]=this.#aH(),[k,I,N,O]=this.#nj;if(Math.abs(N-T)<=zn.PRECISION||Math.abs(O-M)<=zn.PRECISION){let T=c+E/2-(k+N/2),M=A+C/2-(I+O/2);return{path:{"transform-origin":`${zn.svgRound(c)} ${zn.svgRound(A)}`,transform:`${this.rotationTransform} translate(${T} ${M})`}}}let U=(E-2*T)/(N-2*T),j=(C-2*M)/(O-2*M);return{path:{"transform-origin":`${zn.svgRound(k)} ${zn.svgRound(I)}`,transform:`${this.rotationTransform} scale(${N/E} ${O/C}) translate(${zn.svgRound(T)} ${zn.svgRound(M)}) scale(${U} ${j}) translate(${zn.svgRound(-T)} ${zn.svgRound(-M)})`}}}getPathResizedSVGProperties([c,A,E,C]){let[T,M]=this.#aH(),k=this.#nj,[I,N,O,U]=k;if(k[0]=c,k[1]=A,k[2]=E,k[3]=C,Math.abs(O-T)<=zn.PRECISION||Math.abs(U-M)<=zn.PRECISION){let T=c+E/2-(I+O/2),M=A+C/2-(N+U/2);for(let{line:c,points:A}of this.#aD)zn._translate(c,T,M,c),zn._translate(A,T,M,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${zn.svgRound(c)} ${zn.svgRound(A)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let j=(E-2*T)/(O-2*T),$=(C-2*M)/(U-2*M),V=-j*(I+T)+c+T,G=-$*(N+M)+A+M;if(1!==j||1!==$||0!==V||0!==G)for(let{line:c,points:A}of this.#aD)zn._rescale(c,V,G,j,$,c),zn._rescale(A,V,G,j,$,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${zn.svgRound(c)} ${zn.svgRound(A)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([c,A],E){let[C,T]=E,M=this.#nj,k=c-M[0],I=A-M[1];if(this.#aF===C&&this.#aN===T)for(let{line:c,points:A}of this.#aD)zn._translate(c,k,I,c),zn._translate(A,k,I,A);else{let c=this.#aF/C,A=this.#aN/T;for(let{line:E,points:M}of(this.#aF=C,this.#aN=T,this.#aD))zn._rescale(E,k,I,c,A,E),zn._rescale(M,k,I,c,A,M);M[2]*=c,M[3]*=A}return M[0]=c,M[1]=A,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${zn.svgRound(c)} ${zn.svgRound(A)}`}}}get defaultSVGProperties(){let c=this.#nj;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${zn.svgRound(c[0])} ${zn.svgRound(c[1])}`,transform:this.rotationTransform||null},bbox:c}}constructor(...c){super(...c),this.#aB=0}};let Jn=class Jn extends Xn{constructor(c){super(),this._viewParameters=c,super.updateProperties({fill:"none",stroke:Ee._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(c,A){"stroke-width"===c&&(A??=this["stroke-width"],A*=this._viewParameters.realScale),super.updateSVGProperty(c,A)}clone(){let c=new Jn(this._viewParameters);return c.updateAll(this),c}};let Zn=class Zn extends Yn{static{this._type="ink"}static{this._editorType=tl.INK}static{this._defaultDrawingOptions=null}constructor(c){super({...c,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(c,A){Ee.initialize(c,A),this._defaultDrawingOptions=new Jn(A.viewParameters)}static getDefaultDrawingOptions(c){let A=this._defaultDrawingOptions.clone();return A.updateProperties(c),A}static get supportMultipleDrawings(){return!0}static get typesMap(){return gt(this,"typesMap",new Map([[th.INK_THICKNESS,"stroke-width"],[th.INK_COLOR,"stroke"],[th.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(c,A,E,C,T){return new Kn(c,A,E,C,T,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(c,A,E,C,T,M){return Qn.deserialize(c,A,E,C,T,M)}static async deserialize(c,A,E){let C=null;if(c instanceof Pn){let{data:{inkLists:A,rect:E,rotation:T,id:M,color:k,opacity:I,borderStyle:{rawWidth:N},popupRef:O,richText:U,contentsObj:j,creationDate:$,modificationDate:V},parent:{page:{pageNumber:G}}}=c;C=c={annotationType:tl.INK,color:Array.from(k),thickness:N,opacity:I,paths:{points:A},boxes:null,pageIndex:G-1,rect:E.slice(0),rotation:T,annotationElementId:M,id:M,deleted:!1,popupRef:O,richText:U,comment:j?.str||null,creationDate:$,modificationDate:V}}let T=await super.deserialize(c,A,E);return T._initialData=C,c.comment&&T.setCommentData(c),T}get toolbarButtons(){return this._colorPicker||=new tn(this),[["colorPicker",this._colorPicker]]}get colorType(){return th.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:c,_drawingOptions:A,parent:E}=this;A.updateSVGProperty("stroke-width"),E.drawLayer.updateProperties(c,A.toSVGProperties())}static onScaleChangingWhenDrawing(){let c=this._currentParent;c&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),c.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:c,thickness:A,opacity:E}){this._drawingOptions=Zn.getDefaultDrawingOptions({stroke:Ct.makeHexColor(...c),"stroke-width":A,"stroke-opacity":E})}serialize(c=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:A,points:E}=this.serializeDraw(c),{_drawingOptions:{stroke:C,"stroke-opacity":T,"stroke-width":M}}=this,k=Object.assign(super.serialize(c),{color:Ee._colorManager.convert(C),opacity:T,thickness:M,paths:{lines:A,points:E}});return this.addComment(k),c?(k.isCopy=!0,k):this.annotationElementId&&!this.#nb(k)?null:(k.id=this.annotationElementId,k)}#nb(c){let{color:A,thickness:E,opacity:C,pageIndex:T}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||c.color.some((c,E)=>c!==A[E])||c.thickness!==E||c.opacity!==C||c.pageIndex!==T}renderAnnotationElement(c){if(this.deleted)return c.hide(),null;let{points:A,rect:E}=this.serializeDraw(!1);return c.updateEdited({rect:E,thickness:this._drawingOptions["stroke-width"],points:A,popup:this.comment}),null}};let tr=class tr extends Qn{toSVGPath(){let c=super.toSVGPath();return c.endsWith("Z")||(c+="Z"),c}};let er=class er{static #a$={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static #aV(c,A,E,C){return C-=A,0==(E-=c)?C>0?0:4:1===E?C+6:2-C}static #aG=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static #aW(c,A,E,C,T,M,k){let I=this.#aV(E,C,T,M);for(let T=0;T<8;T++){let M=(-T+I-k+16)%8;if(0!==c[(E+this.#aG[2*M])*A+(C+this.#aG[2*M+1])])return M}return -1}static #aq(c,A,E,C,T,M,k){let I=this.#aV(E,C,T,M);for(let T=0;T<8;T++){let M=(T+I+k+16)%8;if(0!==c[(E+this.#aG[2*M])*A+(C+this.#aG[2*M+1])])return M}return -1}static #aX(c,A,E,C){let T=c.length,M=new Int32Array(T);for(let A=0;A<T;A++)M[A]=c[A]<=C?1:0;for(let c=1;c<E-1;c++)M[c*A]=M[c*A+A-1]=0;for(let c=0;c<A;c++)M[c]=M[A*E-1-c]=0;let k,I=1,N=[];for(let c=1;c<E-1;c++){k=1;for(let E=1;E<A-1;E++){let C;let T=c*A+E,O=M[T];if(0===O)continue;let U=c,j=E;if(1===O&&0===M[T-1])I+=1,j-=1;else{if(!(O>=1&&0===M[T+1])){1!==O&&(k=Math.abs(O));continue}I+=1,j+=1,O>1&&(k=O)}let $=[E,c],V=j===E+1,G={isHole:V,points:$,id:I,parent:0};for(let c of(N.push(G),N))if(c.id===k){C=c;break}C?C.isHole?G.parent=V?C.parent:k:G.parent=V?k:C.parent:G.parent=V?k:0;let W=this.#aW(M,A,c,E,U,j,0);if(-1===W){M[T]=-I,1!==M[T]&&(k=Math.abs(M[T]));continue}let q=this.#aG[2*W],X=this.#aG[2*W+1],Y=c+q,K=E+X;U=Y,j=K;let J=c,Q=E;for(;;){let C=this.#aq(M,A,J,Q,U,j,1);q=this.#aG[2*C],X=this.#aG[2*C+1];let N=J+q,O=Q+X;$.push(O,N);let V=J*A+Q;if(0===M[V+1]?M[V]=-I:1===M[V]&&(M[V]=I),N===c&&O===E&&J===Y&&Q===K){1!==M[T]&&(k=Math.abs(M[T]));break}U=J,j=Q,J=N,Q=O}}}return N}static #aY(c,A,E,C){if(E-A<=4){for(let T=A;T<E-2;T+=2)C.push(c[T],c[T+1]);return}let T=c[A],M=c[A+1],k=c[E-4]-T,I=c[E-3]-M,N=Math.hypot(k,I),O=k/N,U=I/N,j=O*M-U*T,$=1/N,V=Math.atan(I/k),G=Math.cos(V),W=Math.sin(V),q=$*(Math.abs(G)+Math.abs(W)),X=$*(1-q+q**2),Y=Math.max(Math.atan(Math.abs(W+G)*X),Math.atan(Math.abs(W-G)*X)),K=0,J=A;for(let C=A+2;C<E-2;C+=2){let A=Math.abs(j-O*c[C+1]+U*c[C]);A>K&&(J=C,K=A)}K>(N*Y)**2?(this.#aY(c,A,J+2,C),this.#aY(c,J,E,C)):C.push(T,M)}static #aK(c){let A=[],E=c.length;return this.#aY(c,0,E,A),A.push(c[E-2],c[E-1]),A.length<=4?null:A}static #aJ(c,A,E,C,T,M){let k=new Float32Array(M**2),I=-2*C**2,N=M>>1;for(let c=0;c<M;c++){let A=(c-N)**2;for(let E=0;E<M;E++)k[c*M+E]=Math.exp((A+(E-N)**2)/I)}let O=new Float32Array(256),U=-2*T**2;for(let c=0;c<256;c++)O[c]=Math.exp(c**2/U);let j=c.length,$=new Uint8Array(j),V=new Uint32Array(256);for(let C=0;C<E;C++)for(let T=0;T<A;T++){let I=C*A+T,U=c[I],j=0,G=0;for(let I=0;I<M;I++){let $=C+I-N;if(!($<0||$>=E))for(let E=0;E<M;E++){let C=T+E-N;if(C<0||C>=A)continue;let V=c[$*A+C],W=k[I*M+E]*O[Math.abs(V-U)];j+=V*W,G+=W}}V[$[I]=Math.round(j/G)]++}return[$,V]}static #aQ(c){let A=new Uint32Array(256);for(let E of c)A[E]++;return A}static #aZ(c){let A=c.length,E=new Uint8ClampedArray(A>>2),C=-1/0,T=1/0;for(let A=0,M=E.length;A<M;A++){let M=E[A]=c[A<<2];C=Math.max(C,M),T=Math.min(T,M)}let M=255/(C-T);for(let c=0,A=E.length;c<A;c++)E[c]=(E[c]-T)*M;return E}static #a0(c){let A,E=-1/0,C=-1/0,T=c.findIndex(c=>0!==c),M=T,k=T;for(A=T;A<256;A++){let T=c[A];T>E&&(A-M>C&&(C=A-M,k=A-1),E=T,M=A)}for(A=k-1;A>=0&&!(c[A]>c[A+1]);A--);return A}static #a1(c){let A=c,{width:E,height:C}=c,{maxDim:T}=this.#a$,M=E,k=C;if(E>T||C>T){let I=E,N=C,O=Math.log2(Math.max(E,C)/T),U=Math.floor(O);O=O===U?U-1:U;for(let E=0;E<O;E++){M=Math.ceil(I/2),k=Math.ceil(N/2);let E=new OffscreenCanvas(M,k);E.getContext("2d").drawImage(c,0,0,I,N,0,0,M,k),I=M,N=k,c!==A&&c.close(),c=E.transferToImageBitmap()}let j=Math.min(T/M,T/k);M=Math.round(M*j),k=Math.round(k*j)}let I=new OffscreenCanvas(M,k).getContext("2d",{willReadFrequently:!0});I.fillStyle="white",I.fillRect(0,0,M,k),I.filter="grayscale(1)",I.drawImage(c,0,0,c.width,c.height,0,0,M,k);let N=I.getImageData(0,0,M,k).data;return[this.#aZ(N),M,k]}static extractContoursFromText(c,{fontFamily:A,fontStyle:E,fontWeight:C},T,M,k,I){let N=new OffscreenCanvas(1,1),O=N.getContext("2d",{alpha:!1}),U=O.font=`${E} ${C} 200px ${A}`,{actualBoundingBoxLeft:j,actualBoundingBoxRight:$,actualBoundingBoxAscent:V,actualBoundingBoxDescent:G,fontBoundingBoxAscent:W,fontBoundingBoxDescent:q,width:X}=O.measureText(c),Y=Math.ceil(1.5*Math.max(Math.abs(j)+Math.abs($)||0,X)),K=Math.ceil(1.5*Math.max(Math.abs(V)+Math.abs(G)||200,Math.abs(W)+Math.abs(q)||200));(O=(N=new OffscreenCanvas(Y,K)).getContext("2d",{alpha:!0,willReadFrequently:!0})).font=U,O.filter="grayscale(1)",O.fillStyle="white",O.fillRect(0,0,Y,K),O.fillStyle="black",O.fillText(c,.5*Y/2,1.5*K/2);let J=this.#aZ(O.getImageData(0,0,Y,K).data),Q=this.#aQ(J),Z=this.#a0(Q),tt=this.#aX(J,Y,K,Z);return this.processDrawnLines({lines:{curves:tt,width:Y,height:K},pageWidth:T,pageHeight:M,rotation:k,innerMargin:I,mustSmooth:!0,areContours:!0})}static process(c,A,E,C,T){let[M,k,I]=this.#a1(c),[N,O]=this.#aJ(M,k,I,Math.hypot(k,I)*this.#a$.sigmaSFactor,this.#a$.sigmaR,this.#a$.kernelSize),U=this.#a0(O),j=this.#aX(N,k,I,U);return this.processDrawnLines({lines:{curves:j,width:k,height:I},pageWidth:A,pageHeight:E,rotation:C,innerMargin:T,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:c,pageWidth:A,pageHeight:E,rotation:C,innerMargin:T,mustSmooth:M,areContours:k}){C%180!=0&&([A,E]=[E,A]);let{curves:I,width:N,height:O}=c,U=c.thickness??0,j=[],$=Math.min(A/N,E/O),V=$/A,G=$/E,W=[];for(let{points:c}of I){let A=M?this.#aK(c):c;if(!A)continue;W.push(A);let E=A.length,C=new Float32Array(E),T=new Float32Array(3*(2===E?2:E-2));if(j.push({line:T,points:C}),2===E){C[0]=A[0]*V,C[1]=A[1]*G,T.set([NaN,NaN,NaN,NaN,C[0],C[1]],0);continue}let[k,I,N,O]=A;k*=V,I*=G,N*=V,O*=G,C.set([k,I,N,O],0),T.set([NaN,NaN,NaN,NaN,k,I],0);for(let c=4;c<E;c+=2){let E=C[c]=A[c]*V,M=C[c+1]=A[c+1]*G;T.set(zn.createBezierPoints(k,I,N,O,E,M),3*(c-2)),[k,I,N,O]=[N,O,E,M]}}if(0===j.length)return null;let q=k?new tr:new Qn;return q.build(j,A,E,1,C,k?0:U,T),{outline:q,newCurves:W,areContours:k,thickness:U,width:N,height:O}}static async compressSignature({outlines:c,areContours:A,thickness:E,width:C,height:T}){let M,k=1/0,I=-1/0,N=0;for(let A of c){N+=A.length;for(let c=2,E=A.length;c<E;c++){let E=A[c]-A[c-2];k=Math.min(k,E),I=Math.max(I,E)}}M=k>=-128&&I<=127?Int8Array:k>=-32768&&I<=32767?Int16Array:Int32Array;let O=c.length,U=8+3*O,j=new Uint32Array(U),$=0;for(let k of(j[$++]=U*Uint32Array.BYTES_PER_ELEMENT+(N-2*O)*M.BYTES_PER_ELEMENT,j[$++]=0,j[$++]=C,j[$++]=T,j[$++]=A?0:1,j[$++]=Math.max(0,Math.floor(E??0)),j[$++]=O,j[$++]=M.BYTES_PER_ELEMENT,c))j[$++]=k.length-2,j[$++]=k[0],j[$++]=k[1];let V=new CompressionStream("deflate-raw"),G=V.writable.getWriter();await G.ready,G.write(j);let W=M.prototype.constructor;for(let A of c){let c=new W(A.length-2);for(let E=2,C=A.length;E<C;E++)c[E-2]=A[E]-A[E-2];G.write(c)}G.close();let q=await new Response(V.readable).arrayBuffer();return Rt(new Uint8Array(q))}static async decompressSignature(c){try{let A;let E=Uint8Array.fromBase64?Uint8Array.fromBase64(c):_t(atob(c)),{readable:C,writable:T}=new DecompressionStream("deflate-raw"),M=T.getWriter();await M.ready,M.write(E).then(async()=>{await M.ready,await M.close()}).catch(()=>{});let k=null,I=0;for await(let c of C)(k||=new Uint8Array(new Uint32Array(c.buffer,0,4)[0])).set(c,I),I+=c.length;let N=new Uint32Array(k.buffer,0,k.length>>2),O=N[1];if(0!==O)throw Error(`Invalid version: ${O}`);let U=N[2],j=N[3],$=0===N[4],V=N[5],G=N[6],W=N[7],q=[],X=(8+3*G)*Uint32Array.BYTES_PER_ELEMENT;switch(W){case Int8Array.BYTES_PER_ELEMENT:A=new Int8Array(k.buffer,X);break;case Int16Array.BYTES_PER_ELEMENT:A=new Int16Array(k.buffer,X);break;case Int32Array.BYTES_PER_ELEMENT:A=new Int32Array(k.buffer,X)}I=0;for(let c=0;c<G;c++){let E=N[3*c+8],C=new Float32Array(E+2);q.push(C);for(let A=0;A<2;A++)C[A]=N[3*c+8+A+1];for(let c=0;c<E;c++)C[c+2]=C[c]+A[I++]}return{areContours:$,thickness:V,outlines:q,width:U,height:j}}catch(c){return ht(`decompressSignature: ${c}`),null}}};let ir=class ir extends Xn{constructor(){super(),super.updateProperties({fill:Ee._defaultLineColor,"stroke-width":0})}clone(){let c=new ir;return c.updateAll(this),c}};let sr=class sr extends Jn{constructor(c){super(c),super.updateProperties({stroke:Ee._defaultLineColor,"stroke-width":1})}clone(){let c=new sr(this._viewParameters);return c.updateAll(this),c}};let nr=class nr extends Yn{#a2;#a5;#a4;#a3;static{this._type="signature"}static{this._editorType=tl.SIGNATURE}static{this._defaultDrawingOptions=null}constructor(c){super({...c,mustBeCommitted:!0,name:"signatureEditor"}),this.#a2=!1,this.#a5=null,this.#a4=null,this.#a3=null,this._willKeepAspectRatio=!0,this.#a4=c.signatureData||null,this.#a5=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(c,A){Ee.initialize(c,A),this._defaultDrawingOptions=new ir,this._defaultDrawnSignatureOptions=new sr(A.viewParameters)}static getDefaultDrawingOptions(c){let A=this._defaultDrawingOptions.clone();return A.updateProperties(c),A}static get supportMultipleDrawings(){return!1}static get typesMap(){return gt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#a5}}static computeTelemetryFinalData(c){let A=c.get("hasDescription");return{hasAltText:A.get(!0)??0,hasNoAltText:A.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){let c,A;if(this.div)return this.div;let{_isCopy:E}=this;if(E&&(this._isCopy=!1,c=this.x,A=this.y),super.render(),null===this._drawId){if(this.#a4){let{lines:c,mustSmooth:A,areContours:E,description:C,uuid:T,heightInPage:M}=this.#a4,{rawDims:{pageWidth:k,pageHeight:I},rotation:N}=this.parent.viewport,O=er.processDrawnLines({lines:c,pageWidth:k,pageHeight:I,rotation:N,innerMargin:nr._INNER_MARGIN,mustSmooth:A,areContours:E});this.addSignature(O,M,C,T)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#a5||""}));return E&&(this._isCopy=!0,this._moveAfterPaste(c,A)),this.div}setUuid(c){this.#a3=c,this.addEditToolbar()}getUuid(){return this.#a3}get description(){return this.#a5}set description(c){this.#a5=c,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:c})),super.addEditToolbar().then(A=>{A?.updateEditSignatureButton(c)}))}getSignaturePreview(){let{newCurves:c,areContours:A,thickness:E,width:C,height:T}=this.#a4,M=Math.max(C,T);return{areContours:A,outline:er.processDrawnLines({lines:{curves:c.map(c=>({points:c})),thickness:E,width:C,height:T},pageWidth:M,pageHeight:M,rotation:0,innerMargin:0,mustSmooth:!1,areContours:A}).outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(c,A,E,C){let T;let{x:M,y:k}=this,{outline:I}=this.#a4=c;this.#a2=I instanceof tr,this.description=E,this.#a2?T=nr.getDefaultDrawingOptions():(T=nr._defaultDrawnSignatureOptions.clone()).updateProperties({"stroke-width":I.thickness}),this._addOutlines({drawOutlines:I,drawingOptions:T});let[,N]=this.pageDimensions,O=A/N;O=O>=1?.5:O,this.width*=O/this.height,this.width>=1&&(O*=.9/this.width,this.width=.9),this.height=O,this.setDims(),this.x=M,this.y=k,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(C),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!C,hasDescription:!!E}}),this.div.hidden=!1}getFromImage(c){let{rawDims:{pageWidth:A,pageHeight:E},rotation:C}=this.parent.viewport;return er.process(c,A,E,C,nr._INNER_MARGIN)}getFromText(c,A){let{rawDims:{pageWidth:E,pageHeight:C},rotation:T}=this.parent.viewport;return er.extractContoursFromText(c,A,E,C,T,nr._INNER_MARGIN)}getDrawnSignature(c){let{rawDims:{pageWidth:A,pageHeight:E},rotation:C}=this.parent.viewport;return er.processDrawnLines({lines:c,pageWidth:A,pageHeight:E,rotation:C,innerMargin:nr._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:c,thickness:A}){c?this._drawingOptions=nr.getDefaultDrawingOptions():(this._drawingOptions=nr._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":A}))}serialize(c=!1){if(this.isEmpty())return null;let{lines:A,points:E}=this.serializeDraw(c),{_drawingOptions:{"stroke-width":C}}=this,T=Object.assign(super.serialize(c),{isSignature:!0,areContours:this.#a2,color:[0,0,0],thickness:this.#a2?0:C});return this.addComment(T),c?(T.paths={lines:A,points:E},T.uuid=this.#a3,T.isCopy=!0):T.lines=A,this.#a5&&(T.accessibilityData={type:"Figure",alt:this.#a5}),T}static deserializeDraw(c,A,E,C,T,M){return M.areContours?tr.deserialize(c,A,E,C,T,M):Qn.deserialize(c,A,E,C,T,M)}static async deserialize(c,A,E){let C=await super.deserialize(c,A,E);return C.#a2=c.areContours,C.description=c.accessibilityData?.alt||"",C.#a3=c.uuid,C}};let rr=class rr extends Ee{#a6;#a9;#a8;#a7;#ot;#oe;#oi;#os;#or;#on;#oa;static{this._type="stamp"}static{this._editorType=tl.STAMP}constructor(c){super({...c,name:"stampEditor"}),this.#a6=null,this.#a9=null,this.#a8=null,this.#a7=null,this.#ot=null,this.#oe="",this.#oi=null,this.#os=!1,this.#or=null,this.#on=!1,this.#oa=!1,this.#a7=c.bitmapUrl,this.#ot=c.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(c,A){Ee.initialize(c,A)}static isHandlingMimeForPasting(c){return tk.includes(c)}static paste(c,A){A.pasteEditor({mode:tl.STAMP},{bitmapFile:c.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(c){let A=c.get("hasAltText");return{hasAltText:A.get(!0)??0,hasNoAltText:A.get(!1)??0}}#oo(c,A=!1){c?(this.#a6=c.bitmap,A||(this.#a9=c.id,this.#on=c.isSvg),c.file&&(this.#oe=c.file.name),this.#ol()):this.remove()}#oh(){if(this.#a8=null,this._uiManager.enableWaiting(!1),this.#oi){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#a6)this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});else{if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#a6){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}}async mlGuessAltText(c=null,A=!0){if(this.hasAltTextData())return null;let{mlManager:E}=this._uiManager;if(!E)throw Error("No ML.");if(!await E.isEnabledFor("altText"))throw Error("ML isn't enabled for alt text.");let{data:C,width:T,height:M}=c||this.copyCanvas(null,null,!0).imageData,k=await E.guess({name:"altText",request:{data:C,width:T,height:M,channels:C.length/(T*M)}});if(!k)throw Error("No response from the AI service.");if(k.error)throw Error("Error from the AI service.");if(k.cancel)return null;if(!k.output)throw Error("No valid response from the AI service.");let I=k.output;return await this.setGuessedAltText(I),A&&!this.hasAltTextData()&&(this.altTextData={alt:I,decorative:!1}),I}#od(){if(this.#a9)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#a9).then(c=>this.#oo(c,!0)).finally(()=>this.#oh());if(this.#a7){let c=this.#a7;return this.#a7=null,this._uiManager.enableWaiting(!0),void(this.#a8=this._uiManager.imageManager.getFromUrl(c).then(c=>this.#oo(c)).finally(()=>this.#oh()))}if(this.#ot){let c=this.#ot;return this.#ot=null,this._uiManager.enableWaiting(!0),void(this.#a8=this._uiManager.imageManager.getFromFile(c).then(c=>this.#oo(c)).finally(()=>this.#oh()))}let c=document.createElement("input");c.type="file",c.accept=tk.join(",");let A=this._uiManager._signal;this.#a8=new Promise(E=>{c.addEventListener("change",async()=>{if(c.files&&0!==c.files.length){this._uiManager.enableWaiting(!0);let A=await this._uiManager.imageManager.getFromFile(c.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#oo(A)}else this.remove();E()},{signal:A}),c.addEventListener("cancel",()=>{this.remove(),E()},{signal:A})}).finally(()=>this.#oh()),c.click()}remove(){this.#a9&&(this.#a6=null,this._uiManager.imageManager.deleteId(this.#a9),this.#oi?.remove(),this.#oi=null,this.#or&&(clearTimeout(this.#or),this.#or=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#a9&&null===this.#oi&&this.#od(),this.isAttachedToDOM||this.parent.add(this))):this.#a9&&this.#od()}onceAdded(c){this._isDraggable=!0,c&&this.div.focus()}isEmpty(){return!(this.#a8||this.#a6||this.#a7||this.#ot||this.#a9||this.#os)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){let c,A;return this.div||(this._isCopy&&(c=this.x,A=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#os||(this.#a6?this.#ol():this.#od()),this._isCopy&&this._moveAfterPaste(c,A),this._uiManager.addShouldRescale(this)),this.div}setCanvas(c,A){let{id:E,bitmap:C}=this._uiManager.imageManager.getFromCanvas(c,A);A.remove(),E&&this._uiManager.imageManager.isValidId(E)&&(this.#a9=E,C&&(this.#a6=C),this.#os=!1,this.#ol())}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(null!==this.#or&&clearTimeout(this.#or),this.#or=setTimeout(()=>{this.#or=null,this.#oc()},200))}#ol(){let{div:c}=this,{width:A,height:E}=this.#a6,[C,T]=this.pageDimensions;if(this.width)A=this.width*C,E=this.height*T;else if(A>.75*C||E>.75*T){let c=Math.min(.75*C/A,.75*T/E);A*=c,E*=c}this._uiManager.enableWaiting(!1);let M=this.#oi=document.createElement("canvas");M.setAttribute("role","img"),this.addContainer(M),this.width=A/C,this.height=E/T,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(c.hidden=!1),this.#oc(),this.#oa||(this.parent.addUndoableEditor(this),this.#oa=!0),this._reportTelemetry({action:"inserted_image"}),this.#oe&&this.div.setAttribute("aria-description",this.#oe),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(c,A,E=!1){c||(c=224);let{width:C,height:T}=this.#a6,M=new ee,k=this.#a6,I=C,N=T,O=null;if(A){if(C>A||T>A){let c=Math.min(A/C,A/T);I=Math.floor(C*c),N=Math.floor(T*c)}O=document.createElement("canvas");let c=O.width=Math.ceil(I*M.sx),E=O.height=Math.ceil(N*M.sy);this.#on||(k=this.#ou(c,E));let U=O.getContext("2d");U.filter=this._uiManager.hcmFilter;let j="white",$="#cfcfd8";"none"!==this._uiManager.hcmFilter?$="black":se.isDarkMode&&(j="#8f8f9d",$="#42414d");let V=15*M.sx,G=15*M.sy,W=new OffscreenCanvas(2*V,2*G),q=W.getContext("2d");q.fillStyle=j,q.fillRect(0,0,2*V,2*G),q.fillStyle=$,q.fillRect(0,0,V,G),q.fillRect(V,G,V,G),U.fillStyle=U.createPattern(W,"repeat"),U.fillRect(0,0,c,E),U.drawImage(k,0,0,k.width,k.height,0,0,c,E)}let U=null;if(E){let A,E;if(M.symmetric&&k.width<c&&k.height<c)A=k.width,E=k.height;else if(k=this.#a6,C>c||T>c){let M=Math.min(c/C,c/T);A=Math.floor(C*M),E=Math.floor(T*M),this.#on||(k=this.#ou(A,E))}let I=new OffscreenCanvas(A,E).getContext("2d",{willReadFrequently:!0});I.drawImage(k,0,0,k.width,k.height,0,0,A,E),U={width:A,height:E,data:I.getImageData(0,0,A,E).data}}return{canvas:O,width:I,height:N,imageData:U}}#ou(c,A){let{width:E,height:C}=this.#a6,T=E,M=C,k=this.#a6;for(;T>2*c||M>2*A;){let E=T,C=M;T>2*c&&(T=T>=16384?Math.floor(T/2)-1:Math.ceil(T/2)),M>2*A&&(M=M>=16384?Math.floor(M/2)-1:Math.ceil(M/2));let I=new OffscreenCanvas(T,M);I.getContext("2d").drawImage(k,0,0,E,C,0,0,T,M),k=I.transferToImageBitmap()}return k}#oc(){let[c,A]=this.parentDimensions,{width:E,height:C}=this,T=new ee,M=Math.ceil(E*c*T.sx),k=Math.ceil(C*A*T.sy),I=this.#oi;if(!I||I.width===M&&I.height===k)return;I.width=M,I.height=k;let N=this.#on?this.#a6:this.#ou(M,k),O=I.getContext("2d");O.filter=this._uiManager.hcmFilter,O.drawImage(N,0,0,N.width,N.height,0,0,M,k)}#op(c){if(c){if(this.#on){let c=this._uiManager.imageManager.getSvgUrl(this.#a9);if(c)return c}let c=document.createElement("canvas");return{width:c.width,height:c.height}=this.#a6,c.getContext("2d").drawImage(this.#a6,0,0),c.toDataURL()}if(this.#on){let[c,A]=this.pageDimensions,E=Math.round(this.width*c*Ot.PDF_TO_CSS_UNITS),C=Math.round(this.height*A*Ot.PDF_TO_CSS_UNITS),T=new OffscreenCanvas(E,C);return T.getContext("2d").drawImage(this.#a6,0,0,this.#a6.width,this.#a6.height,0,0,E,C),T.transferToImageBitmap()}return structuredClone(this.#a6)}static async deserialize(c,A,E){let C=null,T=!1;if(c instanceof Bn){let M,k;let{data:{rect:I,rotation:N,id:O,structParent:U,popupRef:j,richText:$,contentsObj:V,creationDate:G,modificationDate:W},container:q,parent:{page:{pageNumber:X}},canvas:Y}=c;Y?(delete c.canvas,{id:M,bitmap:k}=E.imageManager.getFromCanvas(q.id,Y),Y.remove()):(T=!0,c._hasNoCanvas=!0);let K=(await A._structTree.getAriaAttributes(`${tT}${O}`))?.get("aria-label")||"";C=c={annotationType:tl.STAMP,bitmapId:M,bitmap:k,pageIndex:X-1,rect:I.slice(0),rotation:N,annotationElementId:O,id:O,deleted:!1,accessibilityData:{decorative:!1,altText:K},isSvg:!1,structParent:U,popupRef:j,richText:$,comment:V?.str||null,creationDate:G,modificationDate:W}}let M=await super.deserialize(c,A,E),{rect:k,bitmap:I,bitmapUrl:N,bitmapId:O,isSvg:U,accessibilityData:j}=c;T?(E.addMissingCanvas(c.id,M),M.#os=!0):O&&E.imageManager.isValidId(O)?(M.#a9=O,I&&(M.#a6=I)):M.#a7=N,M.#on=U;let[$,V]=M.pageDimensions;return M.width=(k[2]-k[0])/$,M.height=(k[3]-k[1])/V,j&&(M.altTextData=j),M._initialData=C,c.comment&&M.setCommentData(c),M.#oa=!!C,M}serialize(c=!1,A=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let E=Object.assign(super.serialize(c),{bitmapId:this.#a9,isSvg:this.#on});if(this.addComment(E),c)return E.bitmapUrl=this.#op(!0),E.accessibilityData=this.serializeAltText(!0),E.isCopy=!0,E;let{decorative:C,altText:T}=this.serializeAltText(!1);if(!C&&T&&(E.accessibilityData={type:"Figure",alt:T}),this.annotationElementId){let c=this.#nb(E);return c.isSame?null:(c.isSameAltText?delete E.accessibilityData:E.accessibilityData.structParent=this._initialData.structParent??-1,E.id=this.annotationElementId,delete E.bitmapId,E)}if(null===A)return E;A.stamps||=new Map;let M=this.#on?(E.rect[2]-E.rect[0])*(E.rect[3]-E.rect[1]):null;if(A.stamps.has(this.#a9)){if(this.#on){let c=A.stamps.get(this.#a9);M>c.area&&(c.area=M,c.serialized.bitmap.close(),c.serialized.bitmap=this.#op(!1))}}else A.stamps.set(this.#a9,{area:M,serialized:E}),E.bitmap=this.#op(!1);return E}#nb(c){let{pageIndex:A,accessibilityData:{altText:E}}=this._initialData,C=c.pageIndex===A,T=(c.accessibilityData?.alt||"")===E;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&C&&T,isSameAltText:T}}renderAnnotationElement(c){return this.deleted?c.hide():c.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null}};let ar=class ar{#nt;#og;#of;#om;#ob;#ov;#oy;#ow;#oA;#o_;#ox;#oE;#oS;#oC;#oT;#b;static{this._initialized=!1}static #G=new Map([Un,Zn,rr,qn,nr].map(c=>[c._editorType,c]));constructor({uiManager:c,pageIndex:A,div:E,structTreeLayer:C,accessibilityManager:T,annotationLayer:M,drawLayer:k,textLayer:I,viewport:N,l10n:O}){this.#og=!1,this.#of=null,this.#om=null,this.#ob=null,this.#ov=new Map,this.#oy=!1,this.#ow=!1,this.#oA=!1,this.#o_=null,this.#ox=null,this.#oE=null,this.#oS=null,this.#oC=null,this.#oT=-1;let U=[...ar.#G.values()];if(!ar._initialized)for(let A of(ar._initialized=!0,U))A.initialize(O,c);c.registerEditorTypes(U),this.#b=c,this.pageIndex=A,this.div=E,this.#nt=T,this.#of=M,this.viewport=N,this.#oE=I,this.drawLayer=k,this._structTree=C,this.#b.addLayer(this)}get isEmpty(){return 0===this.#ov.size}get isInvisible(){return this.isEmpty&&this.#b.getMode()===tl.NONE}updateToolbar(c){this.#b.updateToolbar(c)}updateMode(c=this.#b.getMode()){switch(this.#oM(),c){case tl.NONE:return this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case tl.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case tl.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:A}=this.div;if(A.toggle("nonEditing",!1),c===tl.POPUP)A.toggle("commentEditing",!0);else for(let E of(A.toggle("commentEditing",!1),ar.#G.values()))A.toggle(`${E._type}Editing`,c===E._editorType);this.div.hidden=!1}hasTextLayer(c){return c===this.#oE?.div}setEditingState(c){this.#b.setEditingState(c)}addCommands(c){this.#b.addCommands(c)}cleanUndoStack(c){this.#b.cleanUndoStack(c)}toggleDrawing(c=!1){this.div.classList.toggle("drawing",!c)}togglePointerEvents(c=!1){this.div.classList.toggle("disabled",!c)}toggleAnnotationLayerPointerEvents(c=!1){this.#of?.div.classList.toggle("disabled",!c)}get #ok(){return 0!==this.#ov.size?this.#ov.values():this.#b.getEditors(this.pageIndex)}async enable(){this.#oA=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#oC?.abort(),this.#oC=null;let c=new Set;for(let A of this.#ok)A.enableEditing(),A.show(!0),A.annotationElementId&&(this.#b.removeChangedExistingAnnotation(A),c.add(A.annotationElementId));let A=this.#of;if(A)for(let E of A.getEditableAnnotations()){if(E.hide(),this.#b.isDeletedAnnotationElement(E.data.id)||c.has(E.data.id))continue;let A=await this.deserialize(E);A&&(this.addOrRebuild(A),A.enableEditing())}this.#oA=!1,this.#b._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#ow=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#oE&&!this.#oC){this.#oC=new AbortController;let c=this.#b.combinedSignal(this.#oC);this.#oE.div.addEventListener("pointerdown",c=>{let A;let{clientX:E,clientY:C,timeStamp:T}=c;if(T-this.#oT>500)return void(this.#oT=T);this.#oT=-1;let{classList:M}=this.div;M.toggle("getElements",!0);let k=document.elementsFromPoint(E,C);if(M.toggle("getElements",!1),!this.div.contains(k[0]))return;let I=RegExp(`^${to}[0-9]+$`);for(let c of k)if(I.test(c.id)){A=c.id;break}if(!A)return;let N=this.#ov.get(A);null===N?.annotationElementId&&(c.stopPropagation(),c.preventDefault(),N.dblclick(c))},{signal:c,capture:!0})}let c=this.#of;if(c){let A=new Map,E=new Map;for(let C of this.#ok)C.disableEditing(),C.annotationElementId?null===C.serialize()?(E.set(C.annotationElementId,C),this.getEditableAnnotation(C.annotationElementId)?.show(),C.remove()):A.set(C.annotationElementId,C):C.updateFakeAnnotationElement(c);let C=c.getEditableAnnotations();for(let c of C){let{id:C}=c.data;if(this.#b.isDeletedAnnotationElement(C)){c.updateEdited({deleted:!0});continue}let T=E.get(C);T?(T.resetAnnotationElement(c),T.show(!1)):(T=A.get(C))&&(this.#b.addChangedExistingAnnotation(T),T.renderAnnotationElement(c)&&T.show(!1)),c.show()}}this.#oM(),this.isEmpty&&(this.div.hidden=!0);let{classList:A}=this.div;for(let c of ar.#G.values())A.remove(`${c._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#ow=!1}getEditableAnnotation(c){return this.#of?.getEditableAnnotation(c)||null}setActiveEditor(c){this.#b.getActive()!==c&&this.#b.setActiveEditor(c)}enableTextSelection(){if(this.div.tabIndex=-1,this.#oE?.div&&!this.#oS){this.#oS=new AbortController;let c=this.#b.combinedSignal(this.#oS);this.#oE.div.addEventListener("pointerdown",this.#oP.bind(this),{signal:c}),this.#oE.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#oE?.div&&this.#oS&&(this.#oS.abort(),this.#oS=null,this.#oE.div.classList.remove("highlighting"))}#oP(c){this.#b.unselectAll();let{target:A}=c;if(A===this.#oE.div||("img"===A.getAttribute("role")||A.classList.contains("endOfContent"))&&this.#oE.div.contains(A)){let{isMac:A}=St.platform;if(0!==c.button||c.ctrlKey&&A)return;this.#b.showAllEditors("highlight",!0,!0),this.#oE.div.classList.add("free"),this.toggleDrawing(),qn.startHighlighting(this,"ltr"===this.#b.direction,{target:this.#oE.div,x:c.x,y:c.y}),this.#oE.div.addEventListener("pointerup",()=>{this.#oE.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#b._signal}),c.preventDefault()}}enableClick(){if(this.#om)return;this.#om=new AbortController;let c=this.#b.combinedSignal(this.#om);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:c});let A=this.pointerup.bind(this);this.div.addEventListener("pointerup",A,{signal:c}),this.div.addEventListener("pointercancel",A,{signal:c})}disableClick(){this.#om?.abort(),this.#om=null}attach(c){this.#ov.set(c.id,c);let{annotationElementId:A}=c;A&&this.#b.isDeletedAnnotationElement(A)&&this.#b.removeDeletedAnnotationElement(c)}detach(c){this.#ov.delete(c.id),this.#nt?.removePointerInTextLayer(c.contentDiv),!this.#ow&&c.annotationElementId&&this.#b.addDeletedAnnotationElement(c)}remove(c){this.detach(c),this.#b.removeEditor(c),c.div.remove(),c.isAttachedToDOM=!1}changeParent(c){c.parent!==this&&(c.parent&&c.annotationElementId&&(this.#b.addDeletedAnnotationElement(c.annotationElementId),Ee.deleteAnnotationElement(c),c.annotationElementId=null),this.attach(c),c.parent?.detach(c),c.setParent(this),c.div&&c.isAttachedToDOM&&(c.div.remove(),this.div.append(c.div)))}add(c){if(c.parent!==this||!c.isAttachedToDOM){if(this.changeParent(c),this.#b.addEditor(c),this.attach(c),!c.isAttachedToDOM){let A=c.render();this.div.append(A),c.isAttachedToDOM=!0}c.fixAndSetPosition(),c.onceAdded(!this.#oA),this.#b.addToAnnotationStorage(c),c._reportTelemetry(c.telemetryInitialData)}}moveEditorInDOM(c){if(!c.isAttachedToDOM)return;let{activeElement:A}=document;c.div.contains(A)&&!this.#ob&&(c._focusEventsAllowed=!1,this.#ob=setTimeout(()=>{this.#ob=null,c.div.contains(document.activeElement)?c._focusEventsAllowed=!0:(c.div.addEventListener("focusin",()=>{c._focusEventsAllowed=!0},{once:!0,signal:this.#b._signal}),A.focus())},0)),c._structTreeParentId=this.#nt?.moveElementInDOM(this.div,c.div,c.contentDiv,!0)}addOrRebuild(c){c.needsToBeRebuilt()?(c.parent||=this,c.rebuild(),c.show()):this.add(c)}addUndoableEditor(c){this.addCommands({cmd:()=>c._uiManager.rebuild(c),undo:()=>{c.remove()},mustExec:!1})}getEditorByUID(c){for(let A of this.#ov.values())if(A.uid===c)return A;return null}getNextId(){return this.#b.getId()}get #oR(){return ar.#G.get(this.#b.getMode())}combinedSignal(c){return this.#b.combinedSignal(c)}#oD(c){let A=this.#oR;return A?new A.prototype.constructor(c):null}canCreateNewEmptyEditor(){return this.#oR?.canCreateNewEmptyEditor()}async pasteEditor(c,A){this.updateToolbar(c),await this.#b.updateMode(c.mode);let{offsetX:E,offsetY:C}=this.#oI(),T=this.getNextId(),M=this.#oD({parent:this,id:T,x:E,y:C,uiManager:this.#b,isCentered:!0,...A});M&&this.add(M)}async deserialize(c){return await ar.#G.get(c.annotationType??c.annotationEditorType)?.deserialize(c,this,this.#b)||null}createAndAddNewEditor(c,A,E={}){let C=this.getNextId(),T=this.#oD({parent:this,id:C,x:c.offsetX,y:c.offsetY,uiManager:this.#b,isCentered:A,...E});return T&&this.add(T),T}get boundingClientRect(){return this.div.getBoundingClientRect()}#oI(){let{x:c,y:A,width:E,height:C}=this.boundingClientRect,T=Math.max(0,c),M=Math.max(0,A),k=(T+Math.min(window.innerWidth,c+E))/2-c,I=(M+Math.min(window.innerHeight,A+C))/2-A,[N,O]=this.viewport.rotation%180==0?[k,I]:[I,k];return{offsetX:N,offsetY:O}}addNewEditor(c={}){this.createAndAddNewEditor(this.#oI(),!0,c)}setSelected(c){this.#b.setSelected(c)}toggleSelected(c){this.#b.toggleSelected(c)}unselect(c){this.#b.unselect(c)}pointerup(c){let{isMac:A}=St.platform;if(0!==c.button||c.ctrlKey&&A||c.target!==this.div||!this.#oy||(this.#oy=!1,this.#oR?.isDrawer&&this.#oR.supportMultipleDrawings))return;if(!this.#og)return void(this.#og=!0);let E=this.#b.getMode();E!==tl.STAMP&&E!==tl.SIGNATURE?this.createAndAddNewEditor(c,!1):this.#b.unselectAll()}pointerdown(c){if(this.#b.getMode()===tl.HIGHLIGHT&&this.enableTextSelection(),this.#oy)return void(this.#oy=!1);let{isMac:A}=St.platform;if(0!==c.button||c.ctrlKey&&A||c.target!==this.div)return;if(this.#oy=!0,this.#oR?.isDrawer)return void this.startDrawingSession(c);let E=this.#b.getActive();this.#og=!E||E.isEmpty()}startDrawingSession(c){if(this.div.focus({preventScroll:!0}),this.#o_)return void this.#oR.startDrawing(this,this.#b,!1,c);this.#b.setCurrentDrawingSession(this),this.#o_=new AbortController;let A=this.#b.combinedSignal(this.#o_);this.div.addEventListener("blur",({relatedTarget:c})=>{c&&!this.div.contains(c)&&(this.#ox=null,this.commitOrRemove())},{signal:A}),this.#oR.startDrawing(this,this.#b,!1,c)}pause(c){if(c){let{activeElement:c}=document;return void(this.div.contains(c)&&(this.#ox=c))}this.#ox&&setTimeout(()=>{this.#ox?.focus(),this.#ox=null},0)}endDrawingSession(c=!1){return this.#o_?(this.#b.setCurrentDrawingSession(null),this.#o_.abort(),this.#o_=null,this.#ox=null,this.#oR.endDrawing(c)):null}findNewParent(c,A,E){let C=this.#b.findParent(A,E);return null!==C&&C!==this&&(C.changeParent(c),!0)}commitOrRemove(){return!!this.#o_&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#o_&&this.#oR.onScaleChangingWhenDrawing(this)}destroy(){for(let c of(this.commitOrRemove(),this.#b.getActive()?.parent===this&&(this.#b.commitOrRemove(),this.#b.setActiveEditor(null)),this.#ob&&(clearTimeout(this.#ob),this.#ob=null),this.#ov.values()))this.#nt?.removePointerInTextLayer(c.contentDiv),c.setParent(null),c.isAttachedToDOM=!1,c.div.remove();this.div=null,this.#ov.clear(),this.#b.removeLayer(this)}#oM(){for(let c of this.#ov.values())c.isEmpty()&&c.remove()}render({viewport:c}){for(let A of(this.viewport=c,te(this.div,c),this.#b.getEditors(this.pageIndex)))this.add(A),A.rebuild();this.updateMode()}update({viewport:c}){this.#b.commitOrRemove(),this.#oM();let A=this.viewport.rotation,E=c.rotation;if(this.viewport=c,te(this.div,{rotation:E}),A!==E)for(let c of this.#ov.values())c.rotate(E)}get pageDimensions(){let{pageWidth:c,pageHeight:A}=this.viewport.rawDims;return[c,A]}get scale(){return this.#b.viewParameters.realScale}};let or=class or{#rR;#oL;#oF;static #A=0;constructor({pageIndex:c}){this.#rR=null,this.#oL=new Map,this.#oF=new Map,this.pageIndex=c}setParent(c){if(this.#rR){if(this.#rR!==c){if(this.#oL.size>0)for(let A of this.#oL.values())A.remove(),c.append(A);this.#rR=c}}else this.#rR=c}static get _svgFactory(){return gt(this,"_svgFactory",new an)}static #oN(c,[A,E,C,T]){let{style:M}=c;M.top=100*E+"%",M.left=100*A+"%",M.width=100*C+"%",M.height=100*T+"%"}#oO(){let c=or._svgFactory.create(1,1,!0);return this.#rR.append(c),c.setAttribute("aria-hidden",!0),c}#oB(c,A){let E=or._svgFactory.createElement("clipPath");c.append(E);let C=`clip_${A}`;E.setAttribute("id",C),E.setAttribute("clipPathUnits","objectBoundingBox");let T=or._svgFactory.createElement("use");return E.append(T),T.setAttribute("href",`#${A}`),T.classList.add("clip"),C}#oU(c,A){for(let[E,C]of Object.entries(A))null===C?c.removeAttribute(E):c.setAttribute(E,C)}draw(c,A=!1,E=!1){let C=or.#A++,T=this.#oO(),M=or._svgFactory.createElement("defs");T.append(M);let k=or._svgFactory.createElement("path");M.append(k);let I=`path_p${this.pageIndex}_${C}`;k.setAttribute("id",I),k.setAttribute("vector-effect","non-scaling-stroke"),A&&this.#oF.set(C,k);let N=E?this.#oB(M,I):null,O=or._svgFactory.createElement("use");return T.append(O),O.setAttribute("href",`#${I}`),this.updateProperties(T,c),this.#oL.set(C,T),{id:C,clipPathId:`url(#${N})`}}drawOutline(c,A){let E;let C=or.#A++,T=this.#oO(),M=or._svgFactory.createElement("defs");T.append(M);let k=or._svgFactory.createElement("path");M.append(k);let I=`path_p${this.pageIndex}_${C}`;if(k.setAttribute("id",I),k.setAttribute("vector-effect","non-scaling-stroke"),A){let c=or._svgFactory.createElement("mask");M.append(c),E=`mask_p${this.pageIndex}_${C}`,c.setAttribute("id",E),c.setAttribute("maskUnits","objectBoundingBox");let A=or._svgFactory.createElement("rect");c.append(A),A.setAttribute("width","1"),A.setAttribute("height","1"),A.setAttribute("fill","white");let T=or._svgFactory.createElement("use");c.append(T),T.setAttribute("href",`#${I}`),T.setAttribute("stroke","none"),T.setAttribute("fill","black"),T.setAttribute("fill-rule","nonzero"),T.classList.add("mask")}let N=or._svgFactory.createElement("use");T.append(N),N.setAttribute("href",`#${I}`),E&&N.setAttribute("mask",`url(#${E})`);let O=N.cloneNode();return T.append(O),N.classList.add("mainOutline"),O.classList.add("secondaryOutline"),this.updateProperties(T,c),this.#oL.set(C,T),C}finalizeDraw(c,A){this.#oF.delete(c),this.updateProperties(c,A)}updateProperties(c,A){if(!A)return;let{root:E,bbox:C,rootClass:T,path:M}=A,k="number"==typeof c?this.#oL.get(c):c;if(k){if(E&&this.#oU(k,E),C&&or.#oN(k,C),T){let{classList:c}=k;for(let[A,E]of Object.entries(T))c.toggle(A,E)}if(M){let c=k.firstChild.firstChild;this.#oU(c,M)}}}updateParent(c,A){if(A===this)return;let E=this.#oL.get(c);E&&(A.#rR.append(E),this.#oL.delete(c),A.#oL.set(c,E))}remove(c){this.#oF.delete(c),null!==this.#rR&&(this.#oL.get(c).remove(),this.#oL.delete(c))}destroy(){for(let c of(this.#rR=null,this.#oL.values()))c.remove();this.#oL.clear(),this.#oF.clear()}};globalThis._pdfjsTestingUtils={HighlightOutliner:$n},globalThis.pdfjsLib={AbortException:tx,AnnotationEditorLayer:ar,AnnotationEditorParamsType:th,AnnotationEditorType:tl,AnnotationEditorUIManager:xe,AnnotationLayer:On,AnnotationMode:ta,AnnotationType:tu,applyOpacity:re,build:t9,ColorPicker:Zs,createValidAbsoluteUrl:ut,CSSConstants:ne,DOMSVGFactory:an,DrawLayer:or,FeatureTest:St,fetchData:Nt,findContrastColor:de,getDocument:Hs,getFilenameFromUrl:$t,getPdfFilenameFromUrl:Vt,getRGB:Qt,getUuid:Pt,getXfaPageViewport:Kt,GlobalWorkerOptions:ds,ImageKind:tc,InvalidPDFException:tw,isDataScheme:Ht,isPdfFile:jt,isValidExplicitDest:tD,MathClamp:It,noContextMenu:qt,normalizeUnicode:Dt,OPS:tg,OutputScale:ee,PasswordResponses:tf,PDFDataRangeTransport:$s,PDFDateString:Yt,PDFWorker:t3,PermissionFlag:td,PixelsPerInch:Ot,RenderingCancelledException:zt,renderRichText:ue,ResponseException:tA,setLayerDimensions:te,shadow:gt,SignatureExtractor:er,stopEvent:Xt,SupportedImageMimeTypes:tk,TextLayer:zs,TouchManager:Se,updateUrlHash:pt,Util:Ct,VerbosityLevel:tp,version:t6,XfaLayer:Bt};let ea=Object.freeze(Object.defineProperty({__proto__:null,AbortException:tx,AnnotationEditorLayer:ar,AnnotationEditorParamsType:th,AnnotationEditorType:tl,AnnotationEditorUIManager:xe,AnnotationLayer:On,AnnotationMode:ta,AnnotationType:tu,CSSConstants:ne,ColorPicker:Zs,DOMSVGFactory:an,DrawLayer:or,FeatureTest:St,GlobalWorkerOptions:ds,ImageKind:tc,InvalidPDFException:tw,MathClamp:It,OPS:tg,OutputScale:ee,PDFDataRangeTransport:$s,PDFDateString:Yt,PDFWorker:t3,PasswordResponses:tf,PermissionFlag:td,PixelsPerInch:Ot,RenderingCancelledException:zt,ResponseException:tA,SignatureExtractor:er,SupportedImageMimeTypes:tk,TextLayer:zs,TouchManager:Se,Util:Ct,VerbosityLevel:tp,XfaLayer:Bt,applyOpacity:re,build:t9,createValidAbsoluteUrl:ut,fetchData:Nt,findContrastColor:de,getDocument:Hs,getFilenameFromUrl:$t,getPdfFilenameFromUrl:Vt,getRGB:Qt,getUuid:Pt,getXfaPageViewport:Kt,isDataScheme:Ht,isPdfFile:jt,isValidExplicitDest:tD,noContextMenu:qt,normalizeUnicode:Dt,renderRichText:ue,setLayerDimensions:te,shadow:gt,stopEvent:Xt,updateUrlHash:pt,version:t6},Symbol.toStringTag,{value:"Module"}));let hr=class hr extends Error{constructor(c,A){void 0!==A?super(c??"Invalid PDF",{cause:A}):super(c??"Invalid PDF"),this.name="InvalidPDFException",Object.setPrototypeOf(this,hr.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,hr)}};let cr=class cr extends Error{constructor(c,A){void 0!==A?super(c??"Password required or incorrect",{cause:A}):super(c??"Password required or incorrect"),this.name="PasswordException",Object.setPrototypeOf(this,cr.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,cr)}};let dr=class dr extends Error{constructor(c,A){void 0!==A?super(c??"PDF format error",{cause:A}):super(c??"PDF format error"),this.name="FormatError",Object.setPrototypeOf(this,dr.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,dr)}};let ur=class ur extends Error{constructor(c,A,E){void 0!==E?super(c??"Unknown error",{cause:E}):super(c??"Unknown error"),this.name="UnknownErrorException",Object.setPrototypeOf(this,ur.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ur),this.details=A}};let pr=class pr extends Error{constructor(c,A,E,C){void 0!==C?super(c??"Response error",{cause:C}):super(c??"Response error"),this.name="ResponseException",Object.setPrototypeOf(this,pr.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,pr),this.status=A,this.missing=E}};let gr=class gr extends Error{constructor(c,A){void 0!==A?super(c??"Operation aborted",{cause:A}):super(c??"Operation aborted"),this.name="AbortException",Object.setPrototypeOf(this,gr.prototype),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,gr)}};function mr(c){if(c instanceof Error)switch(c.name){case"InvalidPDFException":return new hr(c.message,c);case"PasswordException":return new cr(c.message,c);case"FormatError":return new dr(c.message,c);case"UnknownErrorException":return new ur(c.message,c.details,c);case"ResponseException":return new pr(c.message,c.status,c.missing,c);case"AbortException":return new gr(c.message,c);default:return c}return Error(String(c))}let fr=class fr{static{this.tolerance=2}static applyTransform(c,A){return[c[0]*A[0]+c[1]*A[2]+A[4],c[0]*A[1]+c[1]*A[3]+A[5]]}};let br=class br extends fr{constructor(c,A){super(),this.x=c,this.y=A}equal(c){return c.x===this.x&&c.y===this.y}transform(c){let A=fr.applyTransform([this.x,this.y],c);return this.x=A[0],this.y=A[1],this}};var eo=((C=eo||{})[C.None=0]="None",C[C.Horizontal=1]="Horizontal",C[C.Vertical=2]="Vertical",C);let yr=class yr extends fr{constructor(c,A){super(),this.direction=0,this.length=0,this.intersections=[],this.gaps=[],this._valid=void 0,this.from=c,this.to=A,this.init()}init(){let c=this.from,A=this.to;if(Math.abs(c.y-A.y)<fr.tolerance){if(this.direction=1,A.y=c.y,c.x>A.x){let E=c;c=A,A=E}this.length=A.x-c.x}else if(Math.abs(c.x-A.x)<fr.tolerance){if(this.direction=2,A.x=c.x,c.y>A.y){let E=c;c=A,A=E}this.length=A.y-c.y}this.from=c,this.to=A}get valid(){return void 0===this._valid&&(this._valid=0!==this.direction&&this.length>fr.tolerance),this._valid}get normalized(){return 1===this.direction?new yr(new br(this.from.x-fr.tolerance,this.from.y),new br(this.to.x+fr.tolerance,this.from.y)):2===this.direction?new yr(new br(this.from.x,this.from.y-fr.tolerance),new br(this.from.x,this.to.y+fr.tolerance)):this}addGap(c){this.gaps.push(c)}containsPoint(c){return 2===this.direction?this.from.x===c.x&&c.y>=this.from.y&&c.y<=this.to.y:1===this.direction&&this.from.y===c.y&&c.x>=this.from.x&&c.x<=this.to.x}addIntersectionPoint(c){for(let A of this.intersections)if(A.equal(c))return;this.intersections.push(c)}intersection(c){let A;if(!this.valid||!c.valid)return A;let E=this.normalized,C=c.normalized;if(1===this.direction&&2===c.direction){let T=C.from.x,M=E.from.y;if(T>E.from.x&&T<E.to.x&&M>C.from.y&&M<C.to.y){let E=new br(T,M);this.addIntersectionPoint(E),c.addIntersectionPoint(E),A=E}}else if(2===this.direction&&1===c.direction){let T=E.from.x,M=C.from.y;if(T>C.from.x&&T<C.to.x&&M>E.from.y&&M<E.to.y){let E=new br(T,M);this.addIntersectionPoint(E),c.addIntersectionPoint(E),A=E}}return A}transform(c){let A=this.from.transform(c),E=this.to.transform(c),C=Math.min(A.x,E.x),T=Math.min(A.y,E.y),M=Math.abs(A.x-E.x),k=Math.abs(A.y-E.y);return this.from=new br(C,T),this.to=new br(C+M,T+k),this.init(),this}};let wr=class wr{constructor(c,A,E,C){this.minXY=c,this.maxXY=A,this.rows=[],this.rowPivots=E,this.colPivots=C}findCell(c,A){if(c>=this.minXY.x&&A>=this.minXY.y&&c<=this.maxXY.x&&A<=this.maxXY.y){for(let E of this.rows)for(let C of E)if(C.minXY.x<=c&&C.minXY.y<=A&&C.maxXY.x>=c&&C.maxXY.y>=A)return C}}get cellCount(){return this.rows.reduce((c,A)=>c+A.length,0)}get rowCount(){return this.rows.length}check(){let c=(this.colPivots.length-1)*(this.rowPivots.length-1),A=0;for(let c of this.rows)for(let E of c)A+=(E.colspan||1)*(E.rowspan||1);return c===A}toArray(){let c=[];for(let A of this.rows){let E=[];for(let c of A){let A=c.text.join("");A=(A=A.replace(/^[\s]+|[\s]+$/g,"")).trim(),E.push(A)}c.push(E)}return c}};let xr=class xr{constructor(c){this.hLines=[],this.vLines=[],c.direction===eo.Horizontal?this.hLines.push(c):c.direction===eo.Vertical&&this.vLines.push(c)}get isValid(){return this.hLines.length+this.vLines.length>4}get rowPivots(){let c=new Set;for(let A of this.hLines)c.add(A.from.y);return[...c].sort((c,A)=>c-A)}get colPivots(){let c=new Set;for(let A of this.vLines)c.add(A.from.x);return[...c].sort((c,A)=>c-A)}add(c){if(this.intersection(c)){if(c.direction===eo.Horizontal)return this.hLines.push(c),!0;if(c.direction===eo.Vertical)return this.vLines.push(c),!0}return!1}intersection(c){let A=!1;if(!c.valid)return A;if(c.direction===eo.Horizontal)for(let E of this.vLines)c.intersection(E)&&(A=!0);else if(c.direction===eo.Vertical)for(let E of this.hLines)c.intersection(E)&&(A=!0);return A}getSameHorizontal(c){let A=[c],E=[];for(;this.hLines.length>0;){let C=this.hLines.shift();C&&(C.from.y===c.from.y?A.push(C):E.push(C))}return this.hLines=E,A}getSameVertical(c){let A=[c],E=[];for(;this.vLines.length>0;){let C=this.vLines.shift();C&&(C.from.x===c.from.x?A.push(C):E.push(C))}return this.vLines=E,A}mergeHorizontalLines(c){c.sort((c,A)=>c.from.x-A.from.x);let A=c[0].from.x,E=c[c.length-1].to.x,C=new yr(new br(A,c[0].from.y),new br(E,c[0].from.y));for(let A=1;A<c.length;A++){let E=c[A-1],T=c[A];if(Math.abs(E.to.x-T.from.x)>fr.tolerance){let c=new yr(new br(E.to.x,E.from.y),new br(T.from.x,T.from.y));C.addGap(c)}}return C}mergeVerticalLines(c){c.sort((c,A)=>c.from.y-A.from.y);let A=c[0].from.y,E=c[c.length-1].to.y,C=new yr(new br(c[0].from.x,A),new br(c[0].from.x,E));for(let A=1;A<c.length;A++){let E=c[A-1],T=c[A];if(Math.abs(E.to.y-T.from.y)>fr.tolerance){let c=new yr(new br(E.to.x,E.to.y),new br(E.to.x,T.from.y));C.addGap(c)}}return C}normalize(){this.hLines=this.hLines.filter(c=>c.intersections.length>1),this.vLines=this.vLines.filter(c=>c.intersections.length>1),this.hLines.sort((c,A)=>c.from.y-A.from.y),this.vLines.sort((c,A)=>c.from.x-A.from.x);let c=[];for(;this.hLines.length>0;){let A=this.hLines.shift();if(!A)continue;let E=this.getSameHorizontal(A),C=this.mergeHorizontalLines(E);c.push(C)}this.hLines=c;let A=[];for(;this.vLines.length>0;){let c=this.vLines.shift();if(!c)continue;let E=this.getSameVertical(c),C=this.mergeVerticalLines(E);A.push(C)}this.vLines=A}verticalExists(c,A,E){if(c.direction!==eo.Vertical)throw Error("Line is not vertical");if(A>=E)throw Error("y1 must be less than y2");if(c.from.y<=A&&c.to.y>=E){for(let C of c.gaps)if(C.from.y<=A&&C.to.y>=E)return!1;return!0}return!1}horizontalExists(c,A,E){if(c.direction!==eo.Horizontal)throw Error("Line is not horizontal");if(A>=E)throw Error("x1 must be less than x2");if(c.from.x<=A&&c.to.x>=E){for(let C of c.gaps)if(C.from.x<=A&&C.to.x>=E)return!1;return!0}return!1}findBottomLineIndex(c,A){for(let E=c;E<this.hLines.length;E++){let c=this.hLines[E];if(c.from.x<=A&&c.to.x>=A)return E}return -1}findVerticalLineIndexs(c,A){let E=[];for(let C=0;C<this.vLines.length;C++){let T=this.vLines[C];T.from.y<=A&&T.to.y>=A&&c.intersection(T)&&E.push(C)}return E}getRow(c,A,E){let C=[],T=this.hLines[c],M=this.findVerticalLineIndexs(T,E);for(let E=1;E<M.length;E++){let k=this.vLines[M[E-1]],I=this.vLines[M[E]],N=(k.from.x+I.from.x)/2,O=this.findBottomLineIndex(A,N),U=this.hLines[O],j={minXY:new br(k.from.x,T.from.y),maxXY:new br(I.from.x,U.from.y),width:I.from.x-k.from.x,height:U.from.y-T.from.y,text:[]},$=M[E]-M[E-1],V=O-c;$>1&&(j.colspan=$),V>1&&(j.rowspan=V),C.push(j)}return C}toData(){let c=this.rowPivots,A=this.colPivots,E=new br(A[0],c[0]),C=new br(A[A.length-1],c[c.length-1]),T=new wr(E,C,c,A);for(let c=1;c<this.hLines.length;c++){let A=this.hLines[c-1],E=this.hLines[c],C=(A.from.y+E.from.y)/2,M=this.getRow(c-1,c,C);T.rows.push(M)}return T}};let Ar=class Ar{add(c){c.valid&&(c.direction===eo.Horizontal?this.hLines.push(c):c.direction===eo.Vertical&&this.vLines.push(c))}addRectangle(c){for(let A of c.getLines())this.add(A)}getTableData(){let c=[],A=this.getTables();for(let E of A){let A=E.toData();A&&c.push(A)}return c}getTables(){let c=[];for(;0!==this.hLines.length;){let A=this.hLines.shift();if(!A||this.tryFill(c,A))continue;let E=new xr(A);this.fillTable(E),c.push(E)}for(;0!==this.vLines.length;){let A=this.vLines.shift();if(!A||this.tryFill(c,A))continue;let E=new xr(A);this.fillTable(E),c.push(E)}let A=c.filter(c=>c.isValid);for(let c of A)c.normalize();return A}normalize(){this.normalizeHorizontal(),this.normalizeVertical()}normalizeHorizontal(){this.hLines.sort((c,A)=>c.from.y-A.from.y);let c=[],A=[];for(let E of this.hLines)if(0===A.length)A.push(E);else if(Math.abs(A[0]?.from.y-E.from.y)<fr.tolerance)A.push(E);else{let C=this.margeHorizontalLines(A);c.push(...C),A=[E]}if(A.length>0){let E=this.margeHorizontalLines(A);c.push(...E)}this.hLines=c}normalizeVertical(){this.vLines.sort((c,A)=>c.from.x-A.from.x);let c=[],A=[];for(let E of this.vLines)if(0===A.length)A.push(E);else if(Math.abs(A[0]?.from.x-E.from.x)<fr.tolerance)A.push(E);else{let C=this.margeVerticalLines(A);c.push(...C),A=[E]}if(A.length>0){let E=this.margeVerticalLines(A);c.push(...E)}this.vLines=c}fillTable(c){let A=[],E=[];for(let E of this.vLines)c.add(E)||A.push(E);for(let A of this.hLines)c.add(A)||E.push(A);this.hLines=E,this.vLines=A}tryFill(c,A){for(let E of c)if(E.add(A))return this.fillTable(E),!0;return!1}margeHorizontalLines(c){let A=[];c.sort((c,A)=>c.from.x-A.from.x);let E=c[0]?.from.y;if(void 0===E)return A;let C=Number.MAX_SAFE_INTEGER,T=Number.MIN_SAFE_INTEGER;for(let M of c)M.from.x-T<fr.tolerance?(M.from.x<C&&(C=M.from.x),M.to.x>T&&(T=M.to.x)):(T>C&&A.push(new yr(new br(C,E),new br(T,E))),C=M.from.x,T=M.to.x);let M=A[A.length-1];return M?M.from.x!==C&&M.to.x!==T&&A.push(new yr(new br(C,E),new br(T,E))):A.push(new yr(new br(C,E),new br(T,E))),A}margeVerticalLines(c){let A=[];c.sort((c,A)=>c.from.y-A.from.y);let E=c[0]?.from.x;if(void 0===E)return A;let C=Number.MAX_SAFE_INTEGER,T=Number.MIN_SAFE_INTEGER;for(let M of c)M.from.y-T<fr.tolerance?(M.from.y<C&&(C=M.from.y),M.to.y>T&&(T=M.to.y)):(T>C&&A.push(new yr(new br(E,C),new br(E,T))),C=M.from.y,T=M.to.y);let M=A[A.length-1];return M?M.from.y!==C&&M.to.y!==T&&A.push(new yr(new br(E,C),new br(E,T))):A.push(new yr(new br(E,C),new br(E,T))),A}constructor(){this.hLines=[],this.vLines=[]}};let _r=class _r extends fr{constructor(c,A,E){super(),this.from=c,this.width=A,this.height=E}get to(){return new br(this.from.x+this.width,this.from.y+this.height)}getLines(){let c=this.to;return[new yr(this.from,new br(c.x,this.from.y)),new yr(this.from,new br(this.from.x,c.y)),new yr(new br(c.x,this.from.y),c),new yr(new br(this.from.x,c.y),c)].filter(c=>c.valid)}transform(c){let A=fr.applyTransform([this.from.x,this.from.y],c),E=fr.applyTransform([this.from.x+this.width,this.from.y+this.height],c),C=Math.min(A[0],E[0]),T=Math.min(A[1],E[1]),M=Math.abs(A[0]-E[0]),k=Math.abs(A[1]-E[1]);return this.from=new br(C,T),this.width=M,this.height=k,this}};let Sr=class Sr{getPageImage(c,A){for(let E of this.pages)if(E.pageNumber===c){for(let c of E.images)if(c.name===A)return c}return null}constructor(c){this.pages=[],this.total=0,this.total=c}};let el=["xmp:createdate","xmp:modifydate","xmp:metadatadate","xap:createdate","xap:modifydate","xap:metadatadate"];let Cr=class Cr{getDateNode(){let c={},A=this.info?.CreationDate;A&&(c.CreationDate=Yt.toDateObject(A));let E=this.info?.ModDate;if(E&&(c.ModDate=Yt.toDateObject(E)),!this.metadata)return c;for(let A of el){let E=this.metadata?.get(A),C=this.parseISODateString(E);switch(A){case"xmp:createdate":c.XmpCreateDate=C;break;case"xmp:modifydate":c.XmpModifyDate=C;break;case"xmp:metadatadate":c.XmpMetadataDate=C;break;case"xap:createdate":c.XapCreateDate=C;break;case"xap:modifydate":c.XapModifyDate=C;break;case"xap:metadatadate":c.XapMetadataDate=C}}return c}parseISODateString(c){if(!c)return;let A=Date.parse(c);return Number.isNaN(A)?void 0:new Date(A)}constructor(c){this.pages=[],this.total=c}};function Tr(c){return c.lineThreshold=c?.lineThreshold??4.6,c.cellThreshold=c?.cellThreshold??7,c.cellSeparator=c?.cellSeparator??"	",c.lineEnforce=c?.lineEnforce??!0,c.pageJoiner=c?.pageJoiner??"\n-- page_number of total_number --",c.imageThreshold=c?.imageThreshold??80,c.imageDataUrl=c?.imageDataUrl??!0,c.imageBuffer=c?.imageBuffer??!0,c.scale=c?.scale??1,c}var eh=((T=eh||{})[T[void 0]=0]="undefined",T[T.hline=1]="hline",T[T.vline=2]="vline",T[T.rectangle=3]="rectangle",T);let Dr=class Dr{constructor(c){this.pages=[],this.total=0,this.total=c}};let Pr=class Pr{constructor(c){this.pages=[],this.mergedTables=[],this.total=0,this.total=c}};let kr=class kr{getPageText(c){for(let A of this.pages)if(A.num===c)return A.text;return""}constructor(c){this.pages=[],this.text="",this.total=0,this.total=c}};A.AbortException=gr,A.FormatError=dr,A.InvalidPDFException=hr,A.Line=yr,A.LineDirection=eo,A.LineStore=Ar,A.PDFParse=class{constructor(c){this.progress={loaded:-1,total:0},void 0===c.verbosity&&(c.verbosity=tp.ERRORS),"undefined"!=typeof Buffer&&c.data instanceof Buffer&&(c.data=new Uint8Array(c.data)),this.options=c}async destroy(){this.doc&&(await this.doc.destroy(),this.doc=void 0)}static get isNodeJS(){return!("object"!=typeof process||"[object process]"!=`${process}`||process.versions.nw||process.versions.electron&&void 0!==process.type&&"browser"!==process.type)}static setWorker(c){return void 0===globalThis.pdfjs&&(globalThis.pdfjs=ea),null===ds?"":(void 0!==c&&(ds.workerSrc=c),ds.workerSrc)}async getInfo(c={}){let A=await this.load(),E=new Cr(A.numPages),{info:C,metadata:T}=await A.getMetadata();E.info=C,E.metadata=T,E.fingerprints=A.fingerprints,E.outline=await A.getOutline(),E.permission=await A.getPermissions();let M=await A.getPageLabels();if(c.parsePageInfo){for(let C=1;C<=E.total;C++)if(this.shouldParse(C,E.total,c)){let c=await A.getPage(C),T=await this.getPageLinks(c);T.pageLabel=M?.[c.pageNumber],E.pages.push(T),c.cleanup()}}return E}async getPageLinks(c){let A=c.getViewport({scale:1}),E={pageNumber:c.pageNumber,links:[],width:A.width,height:A.height},C=await c.getAnnotations({intent:"display"})||[];for(let c of C){if("Link"!==c.subtype)continue;let A=c.url??c.unsafeUrl;if(!A)continue;let C=c.overlaidText||"";E.links.push({url:A,text:C})}return E}async getText(c={}){let A=await this.load(),E=new kr(A.numPages);for(let C=1;C<=E.total;C++)if(this.shouldParse(C,E.total,c)){let T=await A.getPage(C),M=await this.getPageText(T,c,E.total);E.pages.push({text:M,num:C}),T.cleanup()}for(let A of E.pages)if(c.pageJoiner){let C=c.pageJoiner.replace("page_number",`${A.num}`);C=C.replace("total_number",`${E.total}`),E.text+=`${A.text}
${C}

`}else E.text+=`${A.text}

`;return E}async load(){try{if(void 0===this.doc){let c=Hs(this.options);c.onProgress=c=>{this.progress=c},this.doc=await c.promise}return this.doc}catch(c){throw mr(c)}}shouldParse(c,A,E){return E.partial=E?.partial??[],E.first=E?.first??0,E.last=E?.last??0,E.partial.length>0?!!E.partial.includes(c):E.first>0&&E.last>0?c>=E.first&&c<=E.last:E.first>0?c<=E.first:!(E.last>0)||c>A-E.last}async getPageText(c,A,E){let C=c.getViewport({scale:1}),T=Tr(A),M=await c.getTextContent({includeMarkedContent:!!T.includeMarkedContent,disableNormalization:!!T.disableNormalization}),k=new Map;T.parseHyperlinks&&(k=await this.getHyperlinks(c,C));let I=[],N,O,U=0;for(let c of M.items){if(!("str"in c))continue;let A=c.transform??c.transform,[E,M]=C.convertToViewportPoint(A[4],A[5]);if(T.parseHyperlinks){let A=(k.get(c.str)||[]).find(c=>E>=c.rect.left&&E<=c.rect.right&&M>=c.rect.top&&M<=c.rect.bottom);A&&(c.str=`[${c.str}](${A.url})`)}if(T.lineEnforce&&void 0!==O&&Math.abs(O-M)>T.lineThreshold){let A=I.length?I[I.length-1]:void 0,E=c.str.startsWith("\n")||""===c.str.trim()&&c.hasEOL;!1===A?.endsWith("\n")&&!E&&Math.abs(O-M)-1>U&&(I.push("\n"),U=0)}T.cellSeparator&&void 0!==O&&Math.abs(O-M)<T.lineThreshold&&void 0!==N&&Math.abs(N-E)>T.cellThreshold&&(c.str=`${T.cellSeparator}${c.str}`),I.push(c.str),N=E+c.width,O=M,U=Math.max(U,c.height),c.hasEOL&&I.push("\n"),(c.hasEOL||c.str.endsWith("\n"))&&(U=0)}return T.itemJoiner?I.join(T.itemJoiner):I.join("")}async getHyperlinks(c,A){let E=new Map,C=await c.getAnnotations({intent:"display"})||[];for(let c of C){if("Link"!==c.subtype)continue;let C=c.url??c.unsafeUrl;if(!C)continue;let T=c.overlaidText;if(!T)continue;let M=A.convertToViewportRectangle(c.rect),k={rect:{left:Math.min(M[0],M[2])-.5,top:Math.min(M[1],M[3])-.5,right:Math.max(M[0],M[2])+.5,bottom:Math.max(M[1],M[3])+.5},url:C,text:T,used:!1},I=E.get(T);I?I.push(k):E.set(T,[k])}return E}async getImage(c={}){let A=await this.load(),E=new Sr(A.numPages);Tr(c);for(let C=1;C<=E.total;C++)if(this.shouldParse(C,E.total,c)){let T=await A.getPage(C),M=await T.getOperatorList(),k={pageNumber:C,images:[]};E.pages.push(k);for(let E=0;E<M.fnArray.length;E++)if(M.fnArray[E]===tg.paintInlineImageXObject||M.fnArray[E]===tg.paintImageXObject){let C=M.argsArray[E][0],I=T.commonObjs.has(C)?this.resolveEmbeddedImage(T.commonObjs,C):this.resolveEmbeddedImage(T.objs,C),{width:N,height:O,kind:U,data:j}=await I;if(c.imageThreshold&&(c.imageThreshold>=N||c.imageThreshold>=O))continue;let $=A.canvasFactory.create(N,O),V=$.context,G=null;U===tc.RGBA_32BPP?(G=V.createImageData(N,O)).data.set(j):(G=V.createImageData(N,O),this.convertToRGBA({src:j,dest:new Uint32Array(G.data.buffer),width:N,height:O,kind:U})),V.putImageData(G,0,0);let W=new Uint8Array,q="";if("function"==typeof $.canvas.toBuffer){let A;c.imageBuffer&&(A=$.canvas.toBuffer("image/png"),W=new Uint8Array(A)),c.imageDataUrl&&(A||(A=$.canvas.toBuffer("image/png"),W=new Uint8Array(A)),q=`data:image/png;base64,${A.toString("base64")}`)}else{if(c.imageBuffer){let c=$.context.getImageData(0,0,$.canvas.width,$.canvas.height);W=new Uint8Array(c.data)}c.imageDataUrl&&(q=$.canvas.toDataURL("image/png"))}k.images.push({data:W,dataUrl:q,name:C,height:O,width:N,kind:U})}}return E}convertToRGBA({src:c,dest:A,width:E,height:C,kind:T}){if(T===tc.RGB_24BPP)for(let E=0,C=0;E<c.length;E+=3,C++){let T=c[E],M=c[E+1],k=c[E+2];A[C]=-16777216|k<<16|M<<8|T}else if(T===tc.GRAYSCALE_1BPP){let T=0;for(let M=0;M<c.length;M++){let k=c[M];for(let c=7;c>=0&&!(T>=E*C);c--){let E=1==(k>>c&1)?255:0;A[T++]=-16777216|E<<16|E<<8|E}}}else{if(null!=T)throw Error(`convertToRGBA: Unsupported image kind: ${T}. Available kinds: GRAYSCALE_1BPP=${tc.GRAYSCALE_1BPP}, RGB_24BPP=${tc.RGB_24BPP}, RGBA_32BPP=${tc.RGBA_32BPP}`);{let M=c.length/(E*C);if(.1>Math.abs(M-3))for(let E=0,C=0;E<c.length;E+=3,C++){let T=c[E],M=c[E+1],k=c[E+2];A[C]=-16777216|k<<16|M<<8|T}else if(.1>Math.abs(M-4))for(let E=0,C=0;E<c.length;E+=4,C++){let T=c[E],M=c[E+1],k=c[E+2],I=c[E+3];A[C]=I<<24|k<<16|M<<8|T}else{if(!(.1>Math.abs(M-1)))throw Error(`convertToRGBA: Cannot infer image format. kind: ${T}, bytesPerPixel: ${M}, width: ${E}, height: ${C}, dataLength: ${c.length}`);for(let E=0;E<c.length;E++){let C=c[E];A[E]=-16777216|C<<16|C<<8|C}}}}}resolveEmbeddedImage(c,A){return new Promise((E,C)=>{c.get(A,c=>{if(c){let T;if(c.data instanceof Uint8Array)T=c.data;else if(c.data instanceof Uint8ClampedArray)T=new Uint8Array(c.data);else if(c.data?.buffer)T=new Uint8Array(c.data.buffer);else if(c.bitmap){let A=this.doc.canvasFactory.create(c.bitmap.width,c.bitmap.height);A.context.drawImage(c.bitmap,0,0);let E=A.context.getImageData(0,0,c.bitmap.width,c.bitmap.height);T=new Uint8Array(E.data.buffer)}else ArrayBuffer.isView(c.data)&&(T=new Uint8Array(c.data.buffer,c.data.byteOffset,c.data.byteLength));if(!T)return void C(Error(`Image object ${A}: data field is empty or invalid. Available fields: ${Object.keys(c).join(", ")}`));if(0===T.length)return void C(Error(`Image object ${A}: data buffer is empty (length: 0)`));E({width:c.width,height:c.height,kind:c.kind,data:T})}else C(Error(`Image object ${A} not found`))})})}async getScreenshot(c={}){let A=Tr(c),E=await this.load(),C=new Dr(E.numPages);if(void 0===this.doc)throw Error("PDF document not loaded");for(let c=1;c<=C.total;c++)if(this.shouldParse(c,C.total,A)){let E=await this.doc.getPage(c),T=E.getViewport({scale:A.scale});if(A.desiredWidth){T=E.getViewport({scale:1});let c=A.desiredWidth/T.width;T=E.getViewport({scale:c})}let M=this.doc.canvasFactory.create(T.width,T.height),k={canvasContext:M.context,viewport:T,canvas:M.canvas},I=E.render(k);await I.promise;let N=new Uint8Array,O="";if("function"==typeof M.canvas.toBuffer){let c;A.imageBuffer&&(c=M.canvas.toBuffer("image/png"),N=new Uint8Array(c)),A.imageDataUrl&&(c||(c=M.canvas.toBuffer("image/png"),N=new Uint8Array(c)),O=`data:image/png;base64,${c.toString("base64")}`)}else{if(A.imageBuffer){let c=M.context.getImageData(0,0,M.canvas.width,M.canvas.height);N=new Uint8Array(c.data)}A.imageDataUrl&&(O=M.canvas.toDataURL("image/png"))}C.pages.push({data:N,dataUrl:O,pageNumber:c,width:T.width,height:T.height,scale:T.scale}),E.cleanup()}return C}async getTable(c={}){let A=await this.load(),E=new Pr(A.numPages);if(void 0===this.doc)throw Error("PDF document not loaded");for(let A=1;A<=E.total;A++)if(this.shouldParse(A,E.total,c)){let c=await this.doc.getPage(A),C=await this.getPageTables(c);C.normalize();let T=C.getTableData();await this.fillPageTables(c,T);let M={num:A,tables:[]};for(let c of T)M.tables.push(c.toArray());E.pages.push(M),c.cleanup()}return E}getPathGeometry(c){let A=c[2]-c[0],E=c[3]-c[1];return c[0]===1/0?eh.undefined:A>5&&E>5?eh.rectangle:A>5&&0===E?eh.hline:0===A&&E>5?eh.vline:eh.undefined}async getPageTables(c){let A=new Ar,E=c.getViewport({scale:1}),C=[1,0,0,1,0,0],T=[],M=await c.getOperatorList();for(let c=0;c<M.fnArray.length;c++){let k=M.fnArray[c],I=M.argsArray[c],N=I?.[0]??0,O=I?.[2]??[1/0,1/0,-1/0,-1/0];if(k===tg.constructPath){if(N!==tg.stroke)continue;let c=this.getPathGeometry(O);if(c===eh.rectangle){let c=new _r(new br(O[0],O[1]),O[2]-O[0],O[3]-O[1]);c.transform(C),c.transform(E.transform),A.addRectangle(c)}else if(c===eh.hline||c===eh.vline){let c=new br(O[0],O[1]),T=new br(O[2],O[3]),M=new yr(c,T);M.transform(C),M.transform(E.transform),A.add(M)}}else if(k===tg.setLineWidth);else if(k===tg.save)T.push(C);else if(k===tg.restore){let c=T.pop();c&&(C=c)}else k===tg.transform&&(C=Ct.transform(C,I))}return A}async fillPageTables(c,A){let E=c.getViewport({scale:1}),C=await c.getTextContent({includeMarkedContent:!1,disableNormalization:!1});for(let c of C.items){if(!("str"in c))continue;let C=Ct.transform(Ct.transform(E.transform,c.transform),[1,0,0,-1,0,0]);for(let E of A){let A=E.findCell(C[4],C[5]);if(A){A.text.push(c.str),c.hasEOL&&A.text.push("\n");break}}}}},A.PasswordException=cr,A.Point=br,A.Rectangle=_r,A.ResponseException=pr,A.Shape=fr,A.Table=xr,A.UnknownErrorException=ur,A.VerbosityLevel=tp,A.getException=mr}};