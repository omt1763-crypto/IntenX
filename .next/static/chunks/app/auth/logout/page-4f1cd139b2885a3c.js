(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4323],{90007:function(e,t,o){Promise.resolve().then(o.bind(o,65718))},65718:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var s=o(57437),r=o(2265),n=o(99376),l=o(1233),a=o(78279),u=o(6606);function i(){let e=(0,n.useRouter)(),{logout:t}=(0,l.a)(),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{d(!0)},[]);let h=async()=>{i(!0);try{await t(),e.push("/auth/login")}catch(e){console.error("Logout error:",e),i(!1)}};return c?(0,s.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-slate-50 p-4",children:(0,s.jsx)("div",{className:"w-full max-w-md",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 border border-slate-200",children:[(0,s.jsx)("div",{className:"flex justify-center mb-6",children:(0,s.jsx)("div",{className:"p-4 bg-gradient-to-br from-red-100 to-red-200 rounded-full",children:(0,s.jsx)(a.Z,{className:"w-8 h-8 text-red-600"})})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-center text-slate-900 mb-2",children:"Sign Out?"}),(0,s.jsx)("p",{className:"text-center text-slate-600 mb-8",children:"Are you sure you want to log out? You'll need to sign in again to access your account."}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("button",{onClick:h,disabled:o,className:"w-full px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-md hover:shadow-lg",children:[(0,s.jsx)(u.Z,{className:"w-5 h-5"}),o?"Signing out...":"Yes, Sign Out"]}),(0,s.jsx)("button",{onClick:()=>{e.back()},disabled:o,className:"w-full px-6 py-3 bg-slate-100 text-slate-900 rounded-lg font-semibold hover:bg-slate-200 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]}),(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-slate-200",children:(0,s.jsx)("p",{className:"text-xs text-slate-500 text-center",children:"\xa9 2024 InterviewX. All rights reserved."})})]})})}):null}},1233:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return a},a:function(){return u}});var s=o(57437),r=o(2265),n=o(2141);let l=(0,r.createContext)();function a(e){let{children:t}=e,[o,a]=(0,r.useState)(null),[u,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[f,m]=(0,r.useState)(!1),[v,S]=(0,r.useState)(!1),p=(e,t,o)=>{let s={user:e,session:t,role:o,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(s)),console.log("[Auth] Auth state saved to localStorage")},w=()=>{try{let t=localStorage.getItem("authState");if(t){var e;let o=JSON.parse(t);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=o.user)||void 0===e?void 0:e.email),o}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},x=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,r.useEffect)(()=>{let e=w();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)?(console.log("[Auth] ✅ Restored session from localStorage:",e.user.email),a(e.user),i(e.session),d(e.role),m(!0),S(!0)):console.log("[Auth] ⏳ No cached session, verifying with Supabase...");let t=async()=>{try{let{data:{session:t}}=await n.OQ.auth.getSession();if(null==t?void 0:t.user){console.log("[Auth] ✅ Valid Supabase session found"),i(t),a(t.user),m(!0);let{data:e}=await n.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(d(e.role),p(t.user,t,e.role))}else(null==e?void 0:e.user)||(console.log("[Auth] ❌ No session found anywhere"),i(null),a(null),d(null),m(!1),x());S(!0)}catch(e){console.warn("[Auth] ⚠️ Session verification error:",e.message),S(!0)}};(null==e?void 0:e.user)?t().catch(e=>console.warn("[Auth] Background verification failed:",e)):t();let{data:{subscription:s}}=n.OQ.auth.onAuthStateChange(async(e,t)=>{if(console.log("[Auth] Auth state change event:",e),null==t?void 0:t.user){console.log("[Auth] Session valid, updating state"),i(t),a(t.user),m(!0);let{data:e}=await n.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(d(e.role),p(t.user,t,e.role))}else if("SIGNED_OUT"===e)console.log("[Auth] User signed out, clearing session"),i(null),a(null),d(null),m(!1),x();else{let e=w();if(null==e?void 0:e.user){var s;console.log("[Auth] Keeping cached session for:",null===(s=e.user)||void 0===s?void 0:s.email),o||(a(e.user),i(e.session),d(e.role),m(!0))}else console.log("[Auth] No current session and no cached session"),m(!1)}});return()=>null==s?void 0:s.unsubscribe()},[]);let y=async(e,t)=>{try{console.log("[Signup] Attempting signup for:",e.email);let o=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:t})});if(!o.ok){let e=await o.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let s=await o.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:s.user,needsLogin:!0,message:s.message}}catch(e){throw console.error("[Signup] Error:",e),e}},A=async(e,t,o)=>{try{var s,r;console.log("[AuthContext] Attempting login:",{email:e,role:o});let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,role:o})});if(console.log("[AuthContext] Login response status:",n.status),!n.ok){let e=await n.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let l=await n.json();console.log("[AuthContext] Login successful, setting session"),l.session&&(i(l.session),a(l.session.user||l.user));let u=(null===(s=l.user)||void 0===s?void 0:s.role)||o;return d(u),m(!0),p((null===(r=l.session)||void 0===r?void 0:r.user)||l.user,l.session,u),console.log("[AuthContext] Auth state saved to localStorage"),l.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},b=async()=>{try{await n.OQ.auth.signOut(),i(null),a(null),d(null),m(!1),x(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,s.jsx)(l.Provider,{value:{user:o,session:u,role:c,loading:h,isAuthenticated:f,isHydrated:v,signup:y,login:A,logout:b},children:t})}let u=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2141:function(e,t,o){"use strict";o.d(t,{OQ:function(){return u}});var s=o(69066),r=o(40257);let n=r.env.NEXT_PUBLIC_SUPABASE_URL,l=r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=r.env.SUPABASE_SERVICE_ROLE_KEY,u=null;n&&l&&(u=(0,s.eI)(n,l),(0,s.eI)(n,a||l))},99376:function(e,t,o){"use strict";var s=o(35475);o.o(s,"useParams")&&o.d(t,{useParams:function(){return s.useParams}}),o.o(s,"usePathname")&&o.d(t,{usePathname:function(){return s.usePathname}}),o.o(s,"useRouter")&&o.d(t,{useRouter:function(){return s.useRouter}}),o.o(s,"useSearchParams")&&o.d(t,{useSearchParams:function(){return s.useSearchParams}})},8301:function(e,t,o){"use strict";o.d(t,{Z:function(){return l}});var s=o(2265),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var l=(e,t)=>{let o=(0,s.forwardRef)((o,l)=>{let{color:a="currentColor",size:u=24,strokeWidth:i=2,absoluteStrokeWidth:c,children:d,...h}=o;return(0,s.createElement)("svg",{ref:l,...r,width:u,height:u,stroke:a,strokeWidth:c?24*Number(i)/Number(u):i,className:"lucide lucide-".concat(n(e)),...h},[...t.map(e=>{let[t,o]=e;return(0,s.createElement)(t,o)}),...(Array.isArray(d)?d:[d])||[]])});return o.displayName="".concat(e),o}},78279:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});let s=(0,o(8301).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6606:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});let s=(0,o(8301).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])}},function(e){e.O(0,[9066,2971,2117,1744],function(){return e(e.s=90007)}),_N_E=e.O()}]);