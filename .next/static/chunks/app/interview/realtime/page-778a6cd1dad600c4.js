(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7362],{3378:function(e,t,o){Promise.resolve().then(o.bind(o,8234))},8234:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return S}});var n=o(7437),s=o(2265),i=o(9376),a=o(8279),r=o(5795),l=o(7608),c=o(8301);let u=(0,c.Z)("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),d=(0,c.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),m=(0,c.Z)("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var p=o(9811);let g=(e,t)=>{let o=t||'You MUST speak ONLY in ENGLISH. Do NOT speak Spanish, French, German, or any other language.\n\nYou are a professional technical job interviewer conducting a formal interview in English.\n\n\uD83D\uDD12 LANGUAGE POLICY (CRITICAL - MUST FOLLOW):\n- SPEAK ONLY ENGLISH - Every single response must be in English, no exceptions\n- START IN ENGLISH - Greet in English: "Hello, thank you for joining me today..."\n- NEVER USE OTHER LANGUAGES - No Spanish "hola", no French, no German, nothing but English\n- DEFAULT LANGUAGE IS ENGLISH - If candidate asks to switch, acknowledge but continue in English\n- ENGLISH ONLY UNTIL EXPLICITLY INSTRUCTED OTHERWISE\n\nCORE DIRECTIVES:\n1. ENGLISH LANGUAGE ONLY - Respond ONLY in English. This is not negotiable.\n2. PROFESSIONAL TONE - no casual language, jokes, slang, or small talk\n3. ONE QUESTION AT A TIME - ask only one question per turn, wait for complete response\n4. TECHNICAL FOCUS - concentrate exclusively on job-related skills and experience\n5. NO PERSONAL QUESTIONS - never ask about age, gender, religion, location, family, or salary\n6. OPEN-ENDED QUESTIONS - avoid yes/no questions, encourage detailed explanations\n7. RESPECTFUL LISTENING - never interrupt the candidate\n8. REDIRECT IF OFF-TOPIC - if candidate goes off-topic, say "Let\'s keep our focus on the technical questions"\n\nINTERVIEW PHASES:\n1. INTRODUCTION - "Hello, thank you for joining me today. I\'m your technical interviewer. Could you please introduce yourself and share your background?"\n2. BACKGROUND - Ask about education, work experience, and current role\n3. TECHNICAL SKILLS - Deep dive into required skills with practical questions\n4. PROBLEM-SOLVING - Ask scenario-based questions relevant to the position\n5. CLOSING - Summarize discussion and ask if they have questions\n\nREMEMBER: YOU MUST SPEAK ONLY IN ENGLISH. NO OTHER LANGUAGES ALLOWED.';if(e&&e.length>0){let t=e.map(e=>"• ".concat(e.name).concat(e.reason?": ".concat(e.reason):"")).join("\n"),n=e.map(e=>({name:e.name,reason:e.reason||"Required skill for this position"}));o+="\n\n=== REQUIRED SKILLS TO EVALUATE (JSON FORMAT) ===\n".concat(JSON.stringify(n,null,2),"\n=== END SKILLS JSON ===\n\nREQUIRED SKILLS TO EVALUATE:\n").concat(t,"\n\nSKILL ASSESSMENT STRATEGY:\n- For each required skill listed above, ask 2-3 targeted technical questions\n- Probe for depth of understanding, not just familiarity\n- Ask for real-world examples of using each skill\n- Assess both theoretical knowledge and practical experience\n- Reference the specific skills from the JSON section above")}return o+"\n\nPROHIBITED BEHAVIORS:\n❌ Speaking in any language other than English\n❌ Asking personal or demographic questions\n❌ Making jokes or using casual language\n❌ Asking multiple questions in one turn\n❌ Interrupting the candidate\n❌ Going off-topic\n❌ Making assumptions about the candidate\n❌ Expressing personal opinions\n❌ Discussing salary before appropriate stage\n\nREMEMBER:\nYou are ONLY a technical job interviewer. Your role is to fairly assess the candidate's qualifications for the open position. Be respectful, professional, and focused on job-related competencies."},h=e=>{let t=[],o=e.toLowerCase();for(let e of["hola","buenos","d\xedas","noche","gracias","por favor","c\xf3mo","qu\xe9","d\xf3nde","cu\xe1ndo","s\xed","no"])o.includes(e)&&t.push('Possible non-English content detected: "'.concat(e,'"'));let n=(e.match(/\?/g)||[]).length;for(let e of(n>1&&t.push("Multiple questions detected (".concat(n,"). Should ask one question at a time.")),["hey","what's up","lol","btw","umm","uh","gonna","wanna","kinda","sorta"]))o.includes(e)&&t.push('Casual language detected: "'.concat(e,'". Use professional tone.'));for(let e of["age","married","children","religion","politics","salary","where do you live","personal life"])o.includes(e)&&t.push('Potential personal question detected: "'.concat(e,'". Focus on job-related topics.'));return{isValid:0===t.length,violations:t}},f=(e,t)=>({role:"technical_interviewer",interview_type:"structured_technical",position:t||"Technical Position",required_skills:e||[],assessment_criteria:["Technical knowledge and depth","Practical experience","Problem-solving ability","Communication skills","Job fit and relevant expertise"],interview_duration_minutes:45,question_count:5,language:"English (only)",professional_standards:"ISO 9001, EEOC compliant"});class x{createHannWindow(e){let t=new Float32Array(e);for(let o=0;o<e;o++)t[o]=.5*(1-Math.cos(2*Math.PI*o/(e-1)));return t}calculateRMS(e){let t=0;for(let o=0;o<e.length;o++)t+=e[o]*e[o];return Math.sqrt(t/e.length)}linearToDb(e){return 20*Math.log10(Math.max(e,1e-5))}dbToLinear(e){return Math.pow(10,e/20)}fft(e,t){let o=e.length;if(o<=1)return;let n=new Float32Array(o/2),s=new Float32Array(o/2),i=new Float32Array(o/2),a=new Float32Array(o/2);for(let r=0;r<o/2;r++)n[r]=e[2*r],s[r]=t[2*r],i[r]=e[2*r+1],a[r]=t[2*r+1];this.fft(n,s),this.fft(i,a);for(let r=0;r<o/2;r++){let l=-2*Math.PI*r/o,c=Math.cos(l),u=Math.sin(l),d=i[r]*c-a[r]*u,m=i[r]*u+a[r]*c;e[r]=n[r]+d,t[r]=s[r]+m,e[r+o/2]=n[r]-d,t[r+o/2]=s[r]-m}}processAudio(e){let t=new Float32Array(this.fftSize);for(let o=0;o<Math.min(e.length,this.fftSize);o++)t[o]=(e[o]||0)*this.window[o];let o=new Float32Array(this.fftSize),n=new Float32Array(this.fftSize);for(let e=0;e<this.fftSize;e++)o[e]=t[e];this.fft(o,n);let s=new Float32Array(this.fftSize/2);for(let e=0;e<this.fftSize/2;e++)s[e]=Math.sqrt(o[e]*o[e]+n[e]*n[e]);this.isCalibrated||this.calibrateNoiseProfile(s);let i=this.suppressNoise(s);for(let e=0;e<this.fftSize/2;e++){let t=Math.atan2(n[e],o[e]);o[e]=i[e]*Math.cos(t),n[e]=i[e]*Math.sin(t)}let a=this.ifft(o,n),r=new Float32Array(this.fftSize);for(let e=0;e<this.fftSize;e++)r[e]=a[e]*this.window[e];let l=this.calculateMetrics(e,i);return{audio:r.slice(0,e.length),metrics:l}}calibrateNoiseProfile(e){if(null===this.noiseFloor)this.noiseFloor=new Float32Array(e.length),this.spectralProfile=new Float32Array(e.length),this.noiseFloor.set(e),this.spectralProfile.set(e);else for(let t=0;t<e.length;t++)this.noiseFloor[t]=Math.min(this.noiseFloor[t],this.config.temporalSmoothing*this.noiseFloor[t]+(1-this.config.temporalSmoothing)*e[t]);this.calibrationFrameCount++,this.calibrationFrameCount>=this.calibrationTarget&&(this.isCalibrated=!0,console.log("[AdvancedAudioProcessor] ✅ Noise profile calibrated"))}suppressNoise(e){if(!this.noiseFloor||!this.isCalibrated)return e;let t=new Float32Array(e.length);for(let o=0;o<e.length;o++){let n=this.noiseFloor[o]*this.config.suppressionFactor,s=e[o]-n;s=Math.max(s,this.config.minimumMask*e[o]),o>0&&o<e.length-1?t[o]=.5*s+.25*t[o-1]+.25*(o<e.length-1?e[o+1]:e[o]):t[o]=s}return t}ifft(e,t){let o=e.length,n=new Float32Array(o);for(let s=0;s<o;s++){let i=0;for(let n=0;n<o;n++){let a=2*Math.PI*n*s/o,r=Math.cos(a),l=Math.sin(a);i+=e[n]*r-t[n]*l,e[n],t[n]}n[s]=i/o}return n}calculateMetrics(e,t){let o=this.calculateRMS(e),n=this.linearToDb(o),s=0;for(let t=0;t<e.length;t++)s=Math.max(s,Math.abs(e[t]));let i=s>.99,a=0;if(this.noiseFloor){for(let e=0;e<Math.min(t.length,this.noiseFloor.length);e++)a+=this.noiseFloor[e];a=this.linearToDb(a/t.length)}return{snr:Math.max(0,n-a),volume:n,noiseLevel:a,isClipping:i,isSpeech:o>this.config.voiceActivityThreshold}}getCalibrationStatus(){return{isCalibrated:this.isCalibrated,calibrationProgress:Math.min(100,this.calibrationFrameCount/this.calibrationTarget*100),noiseFloor:this.noiseFloor?new Float32Array(this.noiseFloor):null,spectralProfile:this.spectralProfile?new Float32Array(this.spectralProfile):null}}reset(){this.noiseFloor=null,this.spectralProfile=null,this.isCalibrated=!1,this.calibrationFrameCount=0,this.currentPosition=0}getConfig(){return{...this.config}}updateConfig(e){Object.assign(this.config,e)}constructor(e=4096){this.fftSize=4096,this.overlapFactor=.5,this.noiseFloor=null,this.spectralProfile=null,this.isCalibrated=!1,this.calibrationFrameCount=0,this.calibrationTarget=50,this.currentPosition=0,this.config={suppressionFactor:.8,minimumMask:.1,temporalSmoothing:.98,frequencySmoothing:.95,voiceActivityThreshold:.02,noiseGateDb:-50},this.fftSize=e,this.window=this.createHannWindow(e),this.inputBuffer=new Float32Array(e),this.outputBuffer=new Float32Array(e)}}var b=o(1233),v=o(2141),y=o(3287);function w(e){let{userId:t,onClose:o,remainingInterviews:i,currentPlan:a}=e,[r,l]=(0,s.useState)([]),[c,u]=(0,s.useState)(!0);(0,s.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=await fetch("/api/subscription-plans?userId=".concat(t)),o=await e.json();l(o.plans||[])}catch(e){console.error("Error loading plans:",e)}finally{u(!1)}},m=e=>{console.log("Upgrade to plan:",e),alert("Payment integration coming soon! Contact support for manual upgrade.")};return(0,n.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:o,children:(0,n.jsx)(y.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg max-w-4xl w-full max-h-96 overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,n.jsxs)("div",{className:"p-8",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-3xl font-bold text-slate-900",children:"Interview Limit Reached"}),(0,n.jsxs)("p",{className:"text-slate-600 mt-2",children:["You've used all ",0===i?2:i," free interviews on your ",a," plan"]})]}),(0,n.jsx)("button",{onClick:o,className:"text-slate-400 hover:text-slate-600 text-2xl",children:"✕"})]}),c?(0,n.jsx)("div",{className:"text-center py-8",children:(0,n.jsx)("p",{className:"text-slate-600",children:"Loading subscription plans..."})}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:r.map(e=>(0,n.jsxs)("div",{className:"rounded-lg border-2 p-6 transition-all ".concat("Pro"===e.name?"border-blue-500 bg-blue-50 scale-105":"border-slate-200 hover:border-slate-300"),children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-slate-900",children:e.name}),(0,n.jsx)("p",{className:"text-slate-600 text-sm mt-2 h-10",children:e.description}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("span",{className:"text-3xl font-bold text-slate-900",children:["$",parseFloat(e.price).toFixed(2)]}),(0,n.jsx)("span",{className:"text-slate-600 ml-2",children:"/month"})]}),(0,n.jsxs)("p",{className:"text-sm font-semibold text-slate-900 mt-4",children:[999999===e.interview_limit?"∞ Unlimited":e.interview_limit," interviews"]}),(0,n.jsx)("div",{className:"mt-6 space-y-2",children:e.features&&JSON.parse(e.features).map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-green-600",children:"✓"}),(0,n.jsx)("span",{className:"text-sm text-slate-700",children:e})]},t))}),(0,n.jsx)("button",{onClick:()=>m(e.id),className:"w-full mt-6 py-2 rounded-lg font-semibold transition-colors ".concat("Pro"===e.name?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-100 text-slate-900 hover:bg-slate-200"),children:0===e.price?"Current Plan":"Upgrade Now"})]},e.id))}),(0,n.jsx)("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,n.jsxs)("p",{className:"text-sm text-slate-700",children:[(0,n.jsx)("strong",{children:"Tip:"})," The Pro plan includes unlimited interviews, advanced AI analysis, detailed feedback, and performance tracking!"]})})]})})})}function N(e){let{messages:t,isListening:o=!1,messageCount:i=0,loading:a=!1}=e,r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]),(0,n.jsxs)("div",{className:"lg:col-span-3 flex flex-col bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-lg shadow-sm overflow-hidden h-full",children:[(0,n.jsx)("div",{className:"p-3 border-b border-[#11cd68]/20 bg-white/50",children:(0,n.jsxs)("h3",{className:"text-[#007a78] font-bold text-sm",children:["\uD83D\uDCAC Conversation ",t.length>0&&"(".concat(t.length,")")]})}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:0===t.length?(0,n.jsx)("p",{className:"text-slate-500 text-xs text-center py-4",children:"Waiting for conversation to start..."}):(0,n.jsxs)(n.Fragment,{children:[t.map(e=>(0,n.jsxs)("div",{className:"space-y-1 animate-in fade-in",children:[(0,n.jsx)("div",{className:"text-xs font-bold ".concat("ai"===e.role?"text-[#007a78]":"text-blue-600"),children:"ai"===e.role?"\uD83E\uDD16 AI Assistant":"\uD83D\uDC64 You"}),(0,n.jsx)("div",{className:"text-xs leading-relaxed ml-2 p-3 rounded-lg whitespace-pre-wrap break-words ".concat("ai"===e.role?"bg-[#f0fdf4] border border-[#11cd68]/50 text-slate-800":"bg-blue-50 border border-blue-300 text-slate-800"),children:e.content||"(empty message)"}),(0,n.jsx)("div",{className:"text-xs text-slate-400 ml-2",children:e.timestamp?new Date(e.timestamp).toLocaleTimeString():""})]},e.id)),(0,n.jsx)("div",{ref:r})]})}),(0,n.jsxs)("div",{className:"border-t border-[#11cd68]/20 p-3 bg-white/50 space-y-2 text-xs",children:[o&&(0,n.jsx)("div",{className:"p-2 bg-[#fff3cd] border border-[#ffc107]/50 rounded-lg",children:(0,n.jsx)("p",{className:"text-[#856404] font-semibold",children:"\uD83E\uDD16 AI Speaking"})}),!o&&t.length>0&&(0,n.jsx)("div",{className:"p-2 bg-[#d1ecf1] border border-[#0c5460]/30 rounded-lg",children:(0,n.jsx)("p",{className:"text-[#0c5460] font-semibold",children:"\uD83C\uDFA4 Your Turn"})}),a&&(0,n.jsx)("div",{className:"p-2 bg-gray-100 border border-gray-300 rounded-lg",children:(0,n.jsx)("p",{className:"text-gray-600 font-semibold",children:"⏳ Saving conversation..."})})]})]})}function A(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),{role:o,user:c,session:y,loading:A}=(0,b.a)(),[S,E]=(0,s.useState)(!1),[D,I]=(0,s.useState)(!1),[k,R]=(0,s.useState)(!1),[j,C]=(0,s.useState)(null),[O,T]=(0,s.useState)(null),[P,L]=(0,s.useState)(null),[F,U]=(0,s.useState)(null),[M,G]=(0,s.useState)(null),[_,q]=(0,s.useState)(null),[z,H]=(0,s.useState)(null),[J,V]=(0,s.useState)(0),[W,B]=(0,s.useState)(!1),[Y]=(0,s.useState)(600),[K,Z]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(0),[$,ee]=(0,s.useState)(2),[et,eo]=(0,s.useState)(!0),[en,es]=(0,s.useState)(!0),[ei,ea]=(0,s.useState)(null),[er,el]=(0,s.useState)(null),[ec,eu]=(0,s.useState)(!1),[ed,em]=(0,s.useState)(null),[ep,eg]=(0,s.useState)(!1),[eh,ef]=(0,s.useState)(!1),[ex,eb]=(0,s.useState)(!1),[ev,ey]=(0,s.useState)({name:"",email:"",phone:"",position:"",resumeFile:null}),[ew,eN]=(0,s.useState)(!1),[eA,eS]=(0,s.useState)(null),eE=(0,s.useRef)(null);(0,s.useRef)(null);let{messages:eD,addMessage:eI,saveToDatabase:ek}=function(){let[e,t]=(0,s.useState)([]),o=(0,s.useRef)(0),n=(0,s.useCallback)((e,n)=>{let s="msg-".concat(Date.now(),"-").concat(o.current++),i={id:s,role:e,content:n,timestamp:new Date,status:"complete"};return t(e=>[...e,i]),console.log("[ConversationManager] Added ".concat(e," message:"),n.substring(0,100)),s},[]),i=(0,s.useCallback)((e,o)=>{t(t=>t.map(t=>t.id===e?{...t,...o}:t)),console.log("[ConversationManager] Updated message ".concat(e))},[]),a=(0,s.useCallback)(()=>{t([]),o.current=0,console.log("[ConversationManager] Cleared all messages")},[]),r=(0,s.useCallback)(()=>e.map(e=>{let t="ai"===e.role?"AI Assistant":"Candidate",o=e.timestamp.toLocaleTimeString();return"[".concat(o,"] ").concat(t,": ").concat(e.content)}).join("\n\n"),[e]),l=(0,s.useCallback)(async(t,o)=>{try{var n,s;if(0===e.length)return console.warn("[ConversationManager] No messages to save"),!1;let i={interviewId:t,applicantId:o||null,messages:e.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString(),status:e.status||"complete"})),messageCount:e.length,startTime:null===(n=e[0])||void 0===n?void 0:n.timestamp.toISOString(),endTime:null===(s=e[e.length-1])||void 0===s?void 0:s.timestamp.toISOString(),conversationText:r()};console.log("[ConversationManager] Saving conversation:",{interviewId:t,messageCount:e.length});let a=await fetch("/api/interviews/save-conversation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to save conversation")}let l=await a.json();return console.log("[ConversationManager] Conversation saved successfully:",l),!0}catch(e){return console.error("[ConversationManager] Error saving conversation:",e),!1}},[e,r]);return{messages:e,addMessage:n,updateMessage:i,clearMessages:a,saveToDatabase:l,getConversationText:r}}(),{connected:eR,isListening:ej,error:eC,connect:eO,disconnect:eT}=function(){let[e,t]=(0,s.useState)(!1),[o,n]=(0,s.useState)(!1),[i,a]=(0,s.useState)(null),r=(0,s.useRef)(null),l=(0,s.useRef)(null),c=(0,s.useRef)(null),u=(0,s.useRef)(null),d=(0,s.useRef)(null),m=(0,s.useRef)([]),p=(0,s.useRef)(null),b=(0,s.useRef)(""),v=(0,s.useRef)(!1),y=(0,s.useRef)(0),w=(0,s.useRef)(""),N=(0,s.useRef)(!1),A=(0,s.useRef)(null),S=(0,s.useRef)(!1),E=(0,s.useRef)(!1),D=(0,s.useRef)(!1),I=(0,s.useCallback)(async(o,s,i)=>{o&&(p.current=o,console.log("[RealtimeAudio] ✅ Conversation callback set")),a(null),b.current="",y.current=0;let l=g(s,i);s&&s.length>0&&console.log("[RealtimeAudio] Skills provided:",s);try{console.log("[RealtimeAudio] Starting connection...");let i="wss://backend-v9kv.onrender.com/ws/realtime";console.log("[RealtimeAudio] Connecting to backend WebSocket proxy:",i);let c=new WebSocket(i);r.current=c,await new Promise((t,i)=>{let r=setTimeout(()=>{console.error("[RealtimeAudio] Connection timeout"),i(Error("Connection timeout"))},3e4);c.onopen=()=>{console.log("[RealtimeAudio] ✅ WebSocket opened"),clearTimeout(r);let e=f(s),o={language_policy:"ENGLISH_ONLY",core_directives:["ENGLISH LANGUAGE ONLY - Respond ONLY in English","PROFESSIONAL TONE - no casual language, jokes, slang","ONE QUESTION AT A TIME - ask only one question per turn","TECHNICAL FOCUS - concentrate exclusively on job-related skills","NO PERSONAL QUESTIONS - never ask about age, gender, religion, location","OPEN-ENDED QUESTIONS - avoid yes/no questions","RESPECTFUL LISTENING - never interrupt","REDIRECT IF OFF-TOPIC - keep focus on technical questions"],prohibited_behaviors:["Speaking in any language other than English","Asking personal or demographic questions","Making jokes or using casual language","Asking multiple questions in one turn","Interrupting the candidate","Going off-topic","Making assumptions about the candidate","Expressing personal opinions","Discussing salary before appropriate stage"],validation_checks:["Must speak only English","Must ask one question at a time","Must maintain professional tone","Must focus on technical skills only","Must avoid personal questions"]},n={skills:s&&s.length>0?s:[],skillCount:(null==s?void 0:s.length)||0,interviewContext:e},i="".concat(l,"\n\n=== GUARDRAILS CONFIGURATION (JSON FORMAT) ===\n").concat(JSON.stringify(o,null,2),"\n=== END GUARDRAILS JSON ===\n\n=== INTERVIEW CONTEXT & SKILLS (JSON FORMAT) ===\n").concat(JSON.stringify(n,null,2),"\n=== END SKILLS JSON ===");c.send(JSON.stringify({type:"session.update",session:{type:"realtime",instructions:i}})),console.log("[RealtimeAudio] ✅ Session configuration sent with instructions"),console.log("[RealtimeAudio] Guardrails included:",o),console.log("[RealtimeAudio] Skills included:",n),console.log("[RealtimeAudio] Instructions included in session.update"),w.current="",t()},c.onmessage=async e=>{try{var t,o,s;let i=JSON.parse(e.data);if(i.type&&!["input_audio_buffer.append","response.output_audio.delta"].includes(i.type)&&console.log("[RealtimeAudio] \uD83D\uDCE8 Incoming message type:",i.type),"session.created"===i.type&&(console.log("[RealtimeAudio] ✅ Session created with instructions embedded"),c.send(JSON.stringify({type:"conversation.item.create",item:{type:"message",role:"assistant",content:[{type:"output_text",text:'Welcome to your technical interview!\n\nPlease keep your microphone and camera ON during the session. This interview is being recorded for evaluation purposes.\n\nYou will be asked a series of questions. If you are unsure about any question, simply say "skip" and we will move to the next one.\n\nGood luck!'}]}})),console.log("[RealtimeAudio] \uD83C\uDFA4 Sent welcome message for AI to speak"),c.send(JSON.stringify({type:"response.create"})),console.log("[RealtimeAudio] ⏳ Requesting AI to speak welcome message...")),"session.updated"===i.type&&console.log("[RealtimeAudio] ✅ Session updated"),"response.created"===i.type&&(console.log("[RealtimeAudio] ✅ Response created, AI will speak soon"),console.log("[RealtimeAudio] \uD83D\uDD34 BLOCKING USER INPUT - AI is speaking"),E.current=!0,N.current=!0,n(!0)),"response.text.delta"===i.type&&i.delta&&(b.current+=i.delta,console.log("[RealtimeAudio] \uD83D\uDCDD AI text delta:",i.delta,"Total:",b.current)),"response.content_part.created"===i.type&&console.log("[RealtimeAudio] Content part created:",i.content_part),"response.content_part.done"===i.type&&(console.log("[RealtimeAudio] Content part done, transcript:",b.current),console.log("[RealtimeAudio] onConversationRef.current exists?",!!p.current),b.current.trim()&&p.current)){let e=h(b.current);e.isValid?console.log("[RealtimeAudio] ✅ Guardrails validated"):console.warn("[RealtimeAudio] ⚠️ Guardrail violations detected:",e.violations),console.log("[RealtimeAudio] ✅ CALLING callback with AI message:",b.current.substring(0,100)),p.current({role:"ai",content:b.current,timestamp:new Date}),console.log("[RealtimeAudio] ✅ Callback invoked successfully"),b.current=""}if("response.done"===i.type){if(console.log("[RealtimeAudio] ===== RESPONSE.DONE EVENT ====="),console.log("[RealtimeAudio] Full response.done message:",JSON.stringify(i,null,2)),console.log("[RealtimeAudio] \uD83D\uDFE2 AI FINISHED SPEAKING - User can now speak"),E.current=!1,N.current=!1,n(!1),i.response&&i.response.output){console.log("[RealtimeAudio] ✅ Response has output array with",i.response.output.length,"items");for(let e=0;e<i.response.output.length;e++){let t=i.response.output[e];if(console.log("[RealtimeAudio] Output item ".concat(e,":"),JSON.stringify(t,null,2)),"message"===t.type&&t.content){let e="assistant"===t.role?"ai":t.role;for(let o of t.content)"output_audio"===o.type&&o.transcript?(console.log("[RealtimeAudio] \uD83D\uDCDD Found transcript in output_audio:",o.transcript,"from role:",e),p.current&&p.current({role:e,content:o.transcript,timestamp:new Date})):"input_audio"===o.type&&o.transcript?(console.log("[RealtimeAudio] \uD83D\uDCDD Found transcript in input_audio:",o.transcript),p.current&&p.current({role:"user",content:o.transcript,timestamp:new Date})):"input_text"===o.type&&o.text?(console.log("[RealtimeAudio] \uD83D\uDCDD Found input_text:",o.text),p.current&&p.current({role:"user",content:o.text,timestamp:new Date})):"text"===o.type&&o.text&&(console.log("[RealtimeAudio] \uD83D\uDCDD Found text in response output:",o.text),p.current&&p.current({role:e,content:o.text,timestamp:new Date}))}}}else console.warn("[RealtimeAudio] ⚠️ No response.output found in response.done");b.current.trim()&&p.current&&(console.log("[RealtimeAudio] ✅ CALLING callback with remaining AI message from response.done:",b.current.substring(0,100)),p.current({role:"ai",content:b.current,timestamp:new Date}),console.log("[RealtimeAudio] ✅ Callback invoked from response.done"),b.current="")}if("response.output_audio.delta"===i.type&&i.delta)try{let e=atob(i.delta),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);m.current.push(t)}catch(e){console.error("[RealtimeAudio] Failed to decode audio delta:",e)}if("response.output_audio.done"===i.type&&(console.log("[RealtimeAudio] Audio output done, playing..."),m.current.length>0&&(j(),m.current=[])),"conversation.item.created"===i.type){if(console.log("[RealtimeAudio] \uD83D\uDCEC conversation.item.created event:"),console.log("[RealtimeAudio] - Full item:",JSON.stringify(i.item,null,2)),console.log("[RealtimeAudio] - Item role:",null===(t=i.item)||void 0===t?void 0:t.role),console.log("[RealtimeAudio] - Item content:",null===(o=i.item)||void 0===o?void 0:o.content),i.item&&"user"===i.item.role){console.log("[RealtimeAudio] \uD83D\uDC64 USER MESSAGE DETECTED");let e=i.item.content&&i.item.content[0];console.log("[RealtimeAudio] - User content structure:",JSON.stringify(e,null,2));let t=null;if(e&&"input_text"===e.type&&e.text?(t=e.text,console.log("[RealtimeAudio] Found input_text:",t)):e&&"input_audio"===e.type&&e.transcript&&(t=e.transcript,console.log("[RealtimeAudio] Found audio transcript:",t)),t){let e=t.toLowerCase();(e.includes("speak")||e.includes("language")||e.includes("espa\xf1ol")||e.includes("switch"))&&(D.current=!0,console.log("[RealtimeAudio] \uD83C\uDF10 Language switch requested by candidate")),console.log("[RealtimeAudio] ✅ CALLING callback with user message:",t.substring(0,100)),p.current?(p.current({role:"user",content:t,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked")):console.warn("[RealtimeAudio] ⚠️ onConversationRef.current is null!")}else console.warn("[RealtimeAudio] ⚠️ Could not find user text in:",e)}if(i.item&&"assistant"===i.item.role){console.log("[RealtimeAudio] \uD83E\uDD16 ASSISTANT MESSAGE DETECTED");let e=i.item.content&&i.item.content[0];console.log("[RealtimeAudio] - Content structure:",JSON.stringify(e,null,2)),e&&"output_audio"===e.type&&e.transcript?(console.log("[RealtimeAudio] ✅ CALLING callback with AI message (from transcript):",e.transcript.substring(0,100)),p.current&&(p.current({role:"ai",content:e.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ AI message callback invoked"))):e&&"text"===e.type&&e.text?(console.log("[RealtimeAudio] ✅ CALLING callback with AI message (from text):",e.text.substring(0,100)),p.current&&(p.current({role:"ai",content:e.text,timestamp:new Date}),console.log("[RealtimeAudio] ✅ AI message callback invoked"))):console.warn("[RealtimeAudio] ⚠️ No text content found in assistant message")}}if("conversation.item.added"===i.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: conversation.item.added FULL STRUCTURE:"),console.log("[RealtimeAudio] Full message:",JSON.stringify(i,null,2)),i.item&&console.log("[RealtimeAudio] - Has msg.item:",i.item.role),i.delta&&console.log("[RealtimeAudio] - Has msg.delta:",i.delta),i.previous_item_id&&console.log("[RealtimeAudio] - Has previous_item_id:",i.previous_item_id)),"conversation.item.done"===i.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: conversation.item.done FULL STRUCTURE:"),console.log("[RealtimeAudio] Full message:",JSON.stringify(i,null,2)),i.item&&"user"===i.item.role&&(console.log("[RealtimeAudio] \uD83C\uDFA4 USER ITEM FOUND in conversation.item.done"),console.log("[RealtimeAudio] Item content:",JSON.stringify(i.item.content,null,2)),i.item.content&&i.item.content.length>0)))for(let e of i.item.content)"input_audio"===e.type&&e.transcript&&(console.log("[RealtimeAudio] ✅ FOUND USER TRANSCRIPT:",e.transcript),p.current&&(p.current({role:"user",content:e.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked from conversation.item.done")));"response.content_part.added"===i.type&&console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: response.content_part.added (AI output):",JSON.stringify(i,null,2)),"response.content_part.done"===i.type&&console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: response.content_part.done (AI output) - DO NOT USE FOR USER MESSAGES"),"input_audio_transcript.delta"===i.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: input_audio_transcript.delta:",JSON.stringify(i,null,2)),i.delta&&console.log("[RealtimeAudio] \uD83C\uDFA4 USER TRANSCRIPT DELTA:",i.delta)),"input_audio_transcript.done"===i.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: input_audio_transcript.done:",JSON.stringify(i,null,2)),i.transcript&&i.transcript.trim()&&(console.log("[RealtimeAudio] \uD83C\uDFA4 USER TRANSCRIPT (FINAL):",i.transcript),p.current&&(p.current({role:"user",content:i.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked from input_audio_transcript")))),"input_audio_buffer.speech_started"===i.type&&console.log("[RealtimeAudio] \uD83C\uDFA4 CANDIDATE SPEAKING STARTED"),"input_audio_buffer.speech_stopped"===i.type&&console.log("[RealtimeAudio] \uD83E\uDD10 CANDIDATE SPEAKING STOPPED - expecting transcript soon"),"input_audio_buffer.committed"===i.type&&console.log("[RealtimeAudio] ✅ AUDIO BUFFER COMMITTED - transcript should follow"),"error"===i.type&&(console.error("[RealtimeAudio] Error from OpenAI:",i.error),a((null===(s=i.error)||void 0===s?void 0:s.message)||"OpenAI error"))}catch(e){console.error("[RealtimeAudio] Failed to parse message:",e)}},c.onerror=e=>{console.error("[RealtimeAudio] WebSocket error:",e),a("WebSocket connection error"),i(Error("WebSocket error"))},c.onclose=t=>{console.log("[RealtimeAudio] WebSocket closed: ".concat(t.code," ").concat(t.reason)),!e&&y.current<3?(y.current++,console.log("[RealtimeAudio] Attempting reconnect ".concat(y.current,"/").concat(3,"...")),setTimeout(()=>{I(o,s).catch(e=>{console.error("[RealtimeAudio] Reconnect failed:",e)})},1e3)):y.current>=3&&i(Error("Failed to connect after ".concat(3," attempts")))}}),await k(c),t(!0),console.log("[RealtimeAudio] ✅ Fully connected and ready")}catch(e){throw console.error("[RealtimeAudio] Connection failed:",e),a((null==e?void 0:e.message)||"Connection failed"),t(!1),e}},[]),k=async e=>{if(v.current){console.log("[RealtimeAudio] Audio already setup");return}try{console.log("[RealtimeAudio] Setting up audio capture...");let t=new(window.AudioContext||window.webkitAudioContext);l.current=t;let o=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1},sampleRate:{ideal:16e3}}});c.current=o,console.log("[RealtimeAudio] ✅ Microphone permission granted with noise suppression enabled");try{await t.audioWorklet.addModule("/worklet/realtime-audio-worklet.js")}catch(n){console.error("[RealtimeAudio] Failed to load worklet, using fallback:",n),A.current=new x(4096),console.log("[RealtimeAudio] ✅ Noise suppression processor initialized");let e=new Blob(["\n          class RealtimeAudioWorklet extends AudioWorkletProcessor {\n            constructor() {\n              super()\n              this.port.onmessage = (e) => {\n                if (e.data.type === 'start') {\n                  this.isRecording = true\n                  this.calibrationStart = 0\n                  this.noiseProfileSet = false\n                  console.log('[Worklet] Recording started')\n                } else if (e.data.type === 'stop') {\n                  this.isRecording = false\n                  console.log('[Worklet] Recording stopped')\n                }\n              }\n              this.isRecording = false\n              this.noiseGateThreshold = 0.02\n              this.bufferSize = 0\n              this.calibrationStart = 0\n              this.noiseProfileSet = false\n              this.calibrationDuration = 2000\n              this.audioFrames = 0\n            }\n            \n            process(inputs, outputs, parameters) {\n              if (!this.isRecording) return true\n              \n              const input = inputs[0]\n              if (input && input.length > 0) {\n                const audioData = input[0]\n                \n                // Track calibration\n                if (!this.noiseProfileSet) {\n                  const now = Date.now()\n                  if (!this.calibrationStart) {\n                    this.calibrationStart = now\n                    this.port.postMessage({\n                      type: 'calibration',\n                      progress: 0,\n                      message: 'Starting noise profile calibration...'\n                    })\n                  }\n                  \n                  const elapsed = now - this.calibrationStart\n                  const progress = Math.min(100, (elapsed / this.calibrationDuration) * 100)\n                  \n                  if (progress % 25 < 1) { // Update every 25%\n                    this.port.postMessage({\n                      type: 'calibration',\n                      progress: Math.round(progress),\n                      message: `Calibrating noise profile: ${Math.round(progress)}%`\n                    })\n                  }\n                  \n                  if (elapsed >= this.calibrationDuration) {\n                    this.noiseProfileSet = true\n                    this.port.postMessage({\n                      type: 'calibration_complete',\n                      message: 'Noise profile calibrated!'\n                    })\n                  }\n                }\n                \n                // Process audio with noise suppression\n                let processedAudio = audioData\n                \n                // Apply high-pass filter to remove rumble\n                const filtered = new Float32Array(audioData.length)\n                let prev = 0\n                for (let i = 0; i < audioData.length; i++) {\n                  filtered[i] = 0.99 * (prev + audioData[i] - (audioData[i > 0 ? i - 1 : 0]))\n                  prev = filtered[i]\n                }\n                processedAudio = filtered\n                \n                // Apply noise suppression gating\n                const gatedAudio = new Float32Array(processedAudio.length)\n                let rms = 0\n                for (let i = 0; i < processedAudio.length; i++) {\n                  rms += processedAudio[i] * processedAudio[i]\n                }\n                rms = Math.sqrt(rms / processedAudio.length)\n                \n                const hasVoice = rms > this.noiseGateThreshold\n                const gateAmount = hasVoice ? 1.0 : 0.1\n                \n                for (let i = 0; i < processedAudio.length; i++) {\n                  gatedAudio[i] = processedAudio[i] * gateAmount\n                }\n                \n                // Send processed audio\n                if (hasVoice || this.bufferSize < 5) {\n                  this.port.postMessage({\n                    type: 'audio',\n                    audio: gatedAudio,\n                    hasVoice: hasVoice\n                  })\n                  this.bufferSize = 0\n                }\n                \n                this.bufferSize++\n              }\n              return true\n            }\n          }\n          \n          registerProcessor('realtime-audio-worklet', RealtimeAudioWorklet)\n        "],{type:"application/javascript"}),o=URL.createObjectURL(e);await t.audioWorklet.addModule(o),URL.revokeObjectURL(o)}let n=new AudioWorkletNode(t,"realtime-audio-worklet");u.current=n,n.port.onmessage=t=>{if("calibration"===t.data.type&&console.log("[RealtimeAudio] \uD83C\uDF99️ Calibration:",t.data.message),"calibration_complete"===t.data.type&&(console.log("[RealtimeAudio] ✅ Calibration complete:",t.data.message),S.current=!0),"audio"===t.data.type&&e.readyState===WebSocket.OPEN){if(E.current){console.log("[RealtimeAudio] \uD83D\uDD34 User audio blocked - AI is currently speaking");return}let o=t.data.audio;if(A.current){let{audio:e,metrics:t}=A.current.processAudio(o);o=e,Date.now()%1e3<50&&console.log("[RealtimeAudio] \uD83D\uDCCA Audio Quality:",{SNR:t.snr.toFixed(2),Volume:t.volume.toFixed(2),NoiseLevel:t.noiseLevel.toFixed(2),IsSpeech:t.isSpeech,IsClipping:t.isClipping})}o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,o=0;for(let t=0;t<e.length;t++)o+=e[t]*e[t];let n=Math.sqrt(o/e.length);if(n<1e-5)return e;let s=t/n,i=new Float32Array(e.length);for(let t=0;t<e.length;t++)i[t]=Math.max(-1,Math.min(1,e[t]*s));return i}(o);let n=new Int16Array(o.length);for(let e=0;e<o.length;e++){let t=Math.max(-1,Math.min(1,o[e]));n[e]=t<0?32768*t:32767*t}let s=new Uint8Array(n.buffer),i="";for(let e=0;e<s.byteLength;e++)i+=String.fromCharCode(s[e]);let a=btoa(i);e.send(JSON.stringify({type:"input_audio_buffer.append",audio:a}))}},t.createMediaStreamSource(o).connect(n),n.connect(t.destination),n.port.postMessage({type:"start"}),v.current=!0,console.log("[RealtimeAudio] ✅ Audio setup complete")}catch(e){throw console.error("[RealtimeAudio] Audio setup failed:",e),Error("Audio setup failed: ".concat(e))}},R=(0,s.useCallback)(async()=>{if(console.log("[RealtimeAudio] \uD83D\uDED1 HARD DISCONNECT - Closing all connections NOW"),r.current){try{console.log("[RealtimeAudio] Force closing WebSocket"),r.current.onopen=null,r.current.onmessage=null,r.current.onerror=null,r.current.onclose=null,(r.current.readyState===WebSocket.OPEN||r.current.readyState===WebSocket.CONNECTING)&&r.current.close(1e3,"Client closing")}catch(e){console.error("[RealtimeAudio] Error force closing WebSocket:",e)}r.current=null}try{u.current&&(u.current.port.postMessage({type:"stop"}),u.current=null),c.current&&(c.current.getTracks().forEach(e=>{try{e.stop()}catch(e){}}),c.current=null),l.current&&"closed"!==l.current.state&&(await l.current.close(),l.current=null),d.current&&(d.current.pause(),d.current.src="")}catch(e){console.error("[RealtimeAudio] Error during cleanup:",e)}N.current=!1,t(!1),n(!1),v.current=!1,m.current=[],b.current="",console.log("[RealtimeAudio] ✅ HARD DISCONNECT Complete")},[]),j=()=>{try{if(0===m.current.length){console.log("[RealtimeAudio] No audio data to play");return}let e=m.current.reduce((e,t)=>e+t.length,0),t=new Uint8Array(e),o=0;for(let e of m.current)t.set(e,o),o+=e.length;console.log("[RealtimeAudio] Playing audio, total bytes:",e);let n=new ArrayBuffer(44),s=new DataView(n);s.setUint32(0,1179011410,!0),s.setUint32(4,36+t.length,!0),s.setUint32(8,1163280727,!0),s.setUint32(12,544501094,!0),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,24e3,!0),s.setUint32(28,48e3,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),s.setUint32(36,1635017060,!0),s.setUint32(40,t.length,!0);let i=new Uint8Array(n.byteLength+t.length);i.set(new Uint8Array(n),0),i.set(t,n.byteLength);let a=new Blob([i],{type:"audio/wav"}),r=URL.createObjectURL(a);d.current||(d.current=new Audio);let l=d.current;l.src=r,l.volume=1,l.onended=()=>{console.log("[RealtimeAudio] ✅ Audio finished playing"),URL.revokeObjectURL(r)},l.onerror=e=>{console.error("[RealtimeAudio] Audio error:",l.error,e)};let c=l.play();void 0!==c&&c.catch(e=>{console.error("[RealtimeAudio] Failed to play audio:",e)})}catch(e){console.error("[RealtimeAudio] Failed to play audio:",e)}};return{connected:e,isListening:o,error:i,connect:I,disconnect:R}}();(0,s.useEffect)(()=>{if(A){console.log("⏳ Waiting for auth context...");return}let o=null==t?void 0:t.get("applicantId"),n=null==t?void 0:t.get("jobId"),s=null==t?void 0:t.get("type"),i=!!s;if(B(i),console.log("[InterviewPage] Query params:",{applicantIdParam:o,jobIdParam:n,typeParam:s,isPracticeMode:i}),console.log("[InterviewPage] Interview type:",i?"\uD83D\uDCDD PRACTICE (2-min limit)":"\uD83C\uDFAF REAL JOB INTERVIEW"),o||n||s)console.log("✅ Candidate interview (no auth required)",{applicantIdParam:o,jobIdParam:n,typeParam:s}),o&&G(o),n&&(q(n),console.log("[InterviewPage] Job ID set to:",n));else if(c&&y)console.log("✅ User authenticated:",c.email),o&&G(o),n&&q(n);else{console.warn("❌ Not authenticated - redirecting to login"),e.push("/auth/login");return}if(s){let e=sessionStorage.getItem("selectedPracticeType");if(e)try{let t=JSON.parse(e);console.log("✅ Loaded practice type:",t),el({title:t.title,systemPrompt:t.systemPrompt,skills:t.skills.map(e=>({name:e,reason:"Essential for ".concat(t.title),importance:"high"}))}),sessionStorage.removeItem("selectedPracticeType")}catch(e){console.error("Failed to parse practice type:",e)}}let a=localStorage.getItem("applicantData");if(a)try{let e=JSON.parse(a);H(e),localStorage.removeItem("applicantData")}catch(e){console.error("Failed to load applicant data:",e)}let r=localStorage.getItem("interviewData");if(r)try{el(JSON.parse(r)),localStorage.removeItem("interviewData")}catch(e){console.error("Failed to load interview data:",e)}n&&!r&&(console.log("Loading job info from database for jobId:",n),eF(n)),E(!0),eP()},[A,c,y,t,e]);let eP=async()=>{try{let e=await navigator.permissions.query({name:"microphone"}),t=await navigator.permissions.query({name:"camera"});T("granted"===e.state),L("granted"===t.state)}catch(e){console.log("Permission check not supported, will prompt on access")}},eL=async e=>{e.preventDefault(),eN(!0),eS(null);try{if(!ev.name.trim())throw Error("Name is required");if(!ev.email.trim())throw Error("Email is required");if(!ev.phone.trim())throw Error("Phone number is required");if(!ev.position.trim())throw Error("Position applying for is required");console.log("[Interview Form] \uD83D\uDCCB Form validation passed"),console.log("[Interview Form] Candidate info:",{name:ev.name,email:ev.email,phone:ev.phone,position:ev.position,jobId:_,hasResume:!!ev.resumeFile});let e=new FormData;e.append("name",ev.name),e.append("email",ev.email),e.append("phone",ev.phone),e.append("position",ev.position),e.append("jobId",_||""),ev.resumeFile&&e.append("resume",ev.resumeFile),console.log("[Interview Form] \uD83D\uDE80 Submitting to /api/candidate-intake...");let t=await fetch("/api/candidate-intake",{method:"POST",body:e});if(console.log("[Interview Form] \uD83D\uDCE1 API Response status:",t.status),console.log("[Interview Form] API Response ok:",t.ok),!t.ok){let e=await t.json();throw console.error("[Interview Form] ❌ API Error:",e),Error(e.error||"Failed to save candidate information")}let o=await t.json();console.log("[Interview Form] ✅ Success! Candidate saved:",o),eb(!0)}catch(e){console.error("[Interview Form] ❌ Error:",e.message),eS(e.message||"Failed to save information")}finally{eN(!1)}},eF=async e=>{try{console.log("[Page] Loading job info for jobId:",e);let t=new AbortController,o=setTimeout(()=>t.abort(),5e3),n=await fetch("/api/jobs/".concat(e),{signal:t.signal});if(clearTimeout(o),n.ok){let t=await n.json();console.log("[Page] Job loaded:",t);let o=(Array.isArray(t.required_skills)?t.required_skills:t.skills||[]).map(e=>({name:"string"==typeof e?e:e.name||e,reason:"Required for ".concat(t.title),importance:"high"}));el({title:t.title||"Technical Interview",client:t.company||"Unknown",hiringFor:t.position||t.title,jobId:e,description:t.description||"",jobDescription:t.description||"",skills:o,systemPrompt:function(e,t,o,n){let s=o.map(e=>"• ".concat(e.name)).join("\n");return'You are a professional technical job interviewer conducting a formal interview in English.\n\n\uD83D\uDD12 LANGUAGE POLICY (CRITICAL - MUST FOLLOW):\n- SPEAK ONLY ENGLISH - Every single response must be in English, no exceptions\n- START IN ENGLISH - Greet in English: "Hello, thank you for joining me today..."\n- NEVER USE OTHER LANGUAGES - No Spanish, French, German, or any other language\n\nPOSITION DETAILS:\n- Job Title: '.concat(e,"\n- Company: ").concat(n,"\n- Job Description:\n").concat(t,'\n\nCORE DIRECTIVES:\n1. ENGLISH LANGUAGE ONLY - Respond ONLY in English. This is not negotiable.\n2. PROFESSIONAL TONE - no casual language, jokes, slang, or small talk\n3. ONE QUESTION AT A TIME - ask only one question per turn, wait for complete response\n4. TECHNICAL FOCUS - concentrate exclusively on job-related skills and experience\n5. NO PERSONAL QUESTIONS - never ask about age, gender, religion, location, family, or salary\n6. OPEN-ENDED QUESTIONS - avoid yes/no questions, encourage detailed explanations\n7. RESPECTFUL LISTENING - never interrupt the candidate\n8. REDIRECT IF OFF-TOPIC - if candidate goes off-topic, say "Let\'s keep our focus on the technical questions"\n\n\uD83E\uDDE0 INTELLIGENT RESPONSE VALIDATION (HUMAN-LIKE BEHAVIOR):\n- SHORT/INCOMPLETE ANSWERS - If a candidate gives a very short answer (like "hello" or "yes"), recognize it as incomplete\n- ASK FOLLOW-UP QUESTIONS - Push for more details naturally: "That\'s a start! Could you tell me more about your background, education, and professional experience?"\n- VALIDATE COMPLETENESS - A proper introduction should include: name, current role/position, years of experience, key accomplishments, and relevant skills\n- BE CONVERSATIONAL - Use natural language like a real interviewer: "Tell me more...", "Can you elaborate on that?", "I\'d like to understand better..."\n- RECOGNIZE INSUFFICIENT RESPONSES - Don\'t accept one-word answers or greetings as adequate responses to questions about background/introduction\n- PERSIST PROFESSIONALLY - If you need more information, gently re-ask: "I appreciate that, but I\'d really like to hear more about your professional background and what brought you to this role."\n\nREQUIRED SKILLS TO EVALUATE (High Priority):\n').concat(s,"\n\nSKILL ASSESSMENT STRATEGY:\n- For each required skill listed above, ask 2-3 targeted technical questions\n- Base questions on the job description and responsibilities\n- Probe for depth of understanding, not just familiarity\n- Ask for real-world examples of using each skill\n- Assess both theoretical knowledge and practical experience\n- Reference specific job requirements in your questions\n- Ask about specific responsibilities from the job description\n- Evaluate how the candidate's experience aligns with the exact needs of this position\n\nINTERVIEW PHASES:\n1. INTRODUCTION - \"Hello, thank you for joining me today. I'm your technical interviewer for the ").concat(e," position at ").concat(n,'. Could you please introduce yourself and share your background, including your name, current role, years of experience, and key accomplishments relevant to this position?"\n2. BACKGROUND - Ask about education, work experience, and current role relevant to this position. If they give short answers, probe deeper with follow-up questions\n3. TECHNICAL SKILLS - Deep dive into the required skills with practical questions related to the job description\n4. PROBLEM-SOLVING - Ask scenario-based questions relevant to the ').concat(e,' position\n5. CLOSING - Summarize discussion and ask if they have questions\n\nHUMAN INTERVIEWER TRAITS TO EMULATE:\n✓ Ask follow-up questions naturally when answers are too brief\n✓ Show genuine interest by asking for specific examples and details\n✓ Validate that answers meet your expectations before moving on\n✓ Use conversational language and transitions ("I see...", "That\'s helpful...", "Tell me more about...")\n✓ Recognize when someone is being evasive or incomplete\n✓ Guide the conversation naturally, not robotic\n✓ Remember previous answers and reference them in later questions\n✓ Be patient but also persistent in getting the information you need\n\nPROHIBITED BEHAVIORS:\n❌ Speaking in any language other than English\n❌ Asking personal or demographic questions\n❌ Making jokes or using casual language\n❌ Asking multiple questions in one turn\n❌ Interrupting the candidate\n❌ Going off-topic\n❌ Making assumptions about the candidate\n❌ Expressing personal opinions\n❌ Discussing salary before appropriate stage\n❌ Accepting incomplete answers without follow-up - push for details like a real interviewer would\n❌ Moving on too quickly when you haven\'t gotten enough information\n\nREMEMBER:\nYou are ONLY a technical job interviewer for this specific ').concat(e," position. Your role is to fairly assess the candidate's qualifications based on the job description and required skills. Be respectful, professional, and focused on job-related competencies. Most importantly, act like a human interviewer - when someone gives you a vague or incomplete answer, ask follow-up questions naturally to get the information you need. Don't settle for one-word answers to open-ended questions.")}(t.title,t.description,o,t.company)})}else console.warn("[Page] Failed to load job info, status:",n.status),el({title:"Technical Interview",jobId:e})}catch(t){console.error("[Page] Error loading job info:",t),el({title:"Technical Interview",jobId:e})}},eU=async()=>{try{C(null),console.log("\uD83D\uDCE2 Requesting microphone permission with noise suppression...");let e=(await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1},sampleRate:{ideal:16e3}}})).getAudioTracks();return e.length>0&&console.log("✅ Microphone granted - Noise suppression:",e[0].getSettings().noiseSuppression),e.forEach(e=>e.stop()),T(!0),console.log("\uD83D\uDCF7 Requesting camera permission..."),(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks().forEach(e=>e.stop()),L(!0),!0}catch(t){let e="Failed to access camera or microphone.";return"NotAllowedError"===t.name?e="You denied camera/microphone access. Please allow access in your browser settings to start the interview.":"NotFoundError"===t.name&&(e="No camera or microphone found on your device. Please check your hardware."),console.error("❌ Permission error:",t),C(e),!1}};(0,s.useEffect)(()=>{if(!D)return;let e=setInterval(()=>{try{if(!navigator.mediaDevices)return;navigator.mediaDevices.enumerateDevices().then(e=>{let t=e.some(e=>"audioinput"===e.kind),o=e.some(e=>"videoinput"===e.kind);!t&&et?(U("Microphone disconnected! Please reconnect."),eo(!1)):t&&(null==F?void 0:F.includes("Microphone"))&&U(null),!o&&en?(U("Camera disconnected! Please reconnect."),es(!1)):o&&(null==F?void 0:F.includes("Camera"))&&U(null)})}catch(e){console.error("Device check error:",e)}},2e3);return()=>clearInterval(e)},[D,et,en,F]),(0,s.useEffect)(()=>{if(!en||!D){ei&&(ei.getTracks().forEach(e=>e.stop()),ea(null)),eE.current&&(eE.current.srcObject=null);return}return(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});ea(e),eE.current&&(eE.current.srcObject=e,console.log("[Page] Camera stream set to video element")),U(null)}catch(e){console.error("Camera error:",e),U("Failed to access camera. Please check permissions.")}})(),()=>{ei&&(ei.getTracks().forEach(e=>e.stop()),ea(null)),eE.current&&(eE.current.srcObject=null)}},[en,D]),(0,s.useEffect)(()=>{if(!D)return;let e=setInterval(()=>{V(e=>{let t=e+1;return t>=Y?(console.log("[Timer] ⏱️ 10-MINUTE INTERVIEW TIME LIMIT REACHED! Auto-ending interview..."),I(!1),C("Interview time limit reached (10 minutes max). Your interview has been ended."),setTimeout(()=>{var e;null===(e=document.getElementById("end-interview-btn"))||void 0===e||e.click()},500)):(t===Y-60&&(console.log("[Timer] \uD83D\uDD14 1 MINUTE REMAINING! Interview will end soon!"),Z(!0)),t===Y-300&&console.log("[Timer] \uD83D\uDD14 5 MINUTES REMAINING in your interview")),t})},1e3);return()=>clearInterval(e)},[D,Y]);let eM=async()=>{try{var e;if(null==y?void 0:null===(e=y.user)||void 0===e?void 0:e.id){console.log("[Page] Checking interview limit...");let e=await fetch("/api/check-interview-limit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:y.user.id})}),t=await e.json();if(console.log("[Page] Interview limit check:",t),!t.canContinue){console.log("[Page] Interview limit reached, showing paywall"),em({currentPlan:t.planName,remainingInterviews:t.remainingInterviews,message:t.message}),eu(!0);return}}else console.log("[Page] No authenticated user, skipping interview limit check (applicant flow)");if(!await eU())return;console.log("[Page] Starting interview..."),console.log("[Page] Interview data:",er),I(!0),V(0),eI("ai",'Welcome to your technical interview!\n\nPlease keep your microphone and camera ON during the session. This interview is being recorded for evaluation purposes.\n\nYou will be asked a series of questions. If you are unsure about any question, simply say "skip" and we will move to the next one.\n\nGood luck!'),await eO(e=>{console.log("[Page] \uD83C\uDFAF Received conversation message:",e.role,e.content),"ai"===e.role&&(ef(!0),console.log("[Page] \uD83D\uDD34 AI started speaking - blocking user input")),eI(e.role,e.content),console.log("[Page] \uD83D\uDCCB Message added to conversation manager"),e.role,"user"===e.role&&(ef(!1),console.log("[Page] \uD83D\uDFE2 User speaking - AI finished"))},(null==er?void 0:er.skills)||[],null==er?void 0:er.systemPrompt),console.log("[Page] Connected! Starting interview.")}catch(e){console.error("[Page] Failed to start:",e),I(!1),C("Failed to start interview: "+e.message)}},eG=async()=>{try{var e,t;if(console.log("[Page] Ending interview..."),I(!1),eD&&eD.length>0){eg(!0);try{let e="interview-".concat(Date.now());await ek(e,M)?console.log("[Page] ✅ Conversation saved successfully"):console.warn("[Page] ⚠️ Conversation save failed, but continuing...")}catch(e){console.error("[Page] Error saving conversation:",e)}finally{eg(!1)}}try{await eT(),console.log("[Page] Disconnected from AI")}catch(e){console.warn("[Page] Warning during disconnect:",e)}ei&&(ei.getTracks().forEach(e=>e.stop()),ea(null));let o=(null==c?void 0:c.id)||(null==y?void 0:null===(e=y.user)||void 0===e?void 0:e.id);o||(o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),console.log("[Page] Generated anonymous user UUID:",o));let n=eD.filter(e=>"user"===e.role).length,s=Math.min(J/300*30,30),i={id:crypto.randomUUID(),user_id:o,applicant_id:M||null,job_id:_||null,interview_type:W?"practice":"real",title:(null==er?void 0:er.title)||"Technical Interview",position:(null==er?void 0:er.hiringFor)||(null==er?void 0:er.title)||"Interview",company:(null==er?void 0:er.client)||"Unknown",client:(null==er?void 0:er.client)||"Unknown",duration:J,status:"completed",score:Math.min(Math.round(s+Math.min(n/10*20,20)+50),100),timestamp:new Date().toISOString(),skills:(null==er?void 0:er.skills)||[],conversation:eD.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString()})),systemPrompt:(null==er?void 0:er.systemPrompt)||null,notes:"Duration: ".concat(J,"s, Messages: ").concat(eD.length,", Type: ").concat(W?"\uD83D\uDCDD Practice":"\uD83C\uDFAF Real",", Practice Type: ").concat(null==er?void 0:er.title)};console.log("[Page] Saving interview:",i),console.log("[Page] Interview type:",W?"\uD83D\uDCDD PRACTICE (Test Mode)":"\uD83C\uDFAF REAL JOB INTERVIEW");try{let e=await fetch("/api/interviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),o=await e.json();if(e.ok){console.log("[Page] Interview saved successfully:",o.data);let e=(null===(t=o.data)||void 0===t?void 0:t.id)||i.id;console.log("[Page] Saved interview ID:",e),console.log("[Page] Analyzing interview with AI..."),console.log("[Page] Conversation to analyze:",JSON.stringify(eD,null,2)),console.log("[Page] Number of messages:",eD.length);try{if(eD&&0!==eD.length){let t=await fetch("/api/analyze-interview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation:eD,skills:i.skills,duration:J,applicantId:M,interviewId:e})}),o=await t.json();t.ok?console.log("[Page] Interview analysis completed:",o.analysis):(console.error("[Page] Analysis failed:",o.error),console.error("[Page] Status code:",t.status))}else console.warn("[Page] No conversation to analyze, skipping analysis")}catch(e){console.error("[Page] Analysis API call error:",e)}}else console.error("[Page] Failed to save interview - Status:",e.status),console.error("[Page] Error response:",JSON.stringify(o,null,2)),console.error("[Page] Error message:",o.error),console.error("[Page] Error code:",o.code),console.error("[Page] Full error:",o.fullError)}catch(e){console.error("[Page] API call error:",e)}if(M){let{error:e}=await v.OQ.from("job_applicants").update({status:"completed"}).eq("id",M);e?console.error("[Page] Failed to update applicant status:",e):console.log("[Page] Applicant status updated to completed")}V(0),U(null),console.log("[Page] Interview ended, cleanup complete."),R(!0),C(null),console.log("[Page] Interview marked as completed")}catch(e){console.error("[Page] Error ending interview:",e),C("Interview ended. "+e.message),I(!1),R(!0)}};return!S||A?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-slate-600 font-semibold",children:S?"Verifying your authentication...":"Initializing interview..."})]})}):_&&!ex?(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,n.jsxs)("div",{className:"fixed inset-0 pointer-events-none opacity-30",children:[(0,n.jsx)("div",{className:"absolute top-0 right-0 w-[400px] h-[400px] bg-gradient-to-b from-blue-500/20 to-transparent rounded-full blur-3xl"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-[300px] h-[300px] bg-gradient-to-t from-blue-600/15 to-transparent rounded-full blur-3xl"})]}),(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 relative z-10",children:(0,n.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Join Interview"}),(0,n.jsx)("p",{className:"text-slate-600 mb-6",children:"Please provide your information to begin"}),(0,n.jsxs)("form",{onSubmit:eL,className:"space-y-4",children:[eA&&(0,n.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:eA}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Full Name *"}),(0,n.jsx)("input",{type:"text",value:ev.name,onChange:e=>ey({...ev,name:e.target.value}),placeholder:"John Doe",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Email Address *"}),(0,n.jsx)("input",{type:"email",value:ev.email,onChange:e=>ey({...ev,email:e.target.value}),placeholder:"john@example.com",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Phone Number *"}),(0,n.jsx)("input",{type:"tel",value:ev.phone,onChange:e=>ey({...ev,phone:e.target.value}),placeholder:"+1 (555) 000-0000",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Position Applying For *"}),(0,n.jsx)("input",{type:"text",value:ev.position,onChange:e=>ey({...ev,position:e.target.value}),placeholder:"e.g., Senior React Developer",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Resume (Optional)"}),(0,n.jsx)("input",{type:"file",accept:".pdf,.doc,.docx",onChange:e=>{var t;return ey({...ev,resumeFile:(null===(t=e.target.files)||void 0===t?void 0:t[0])||null})},className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600"}),(0,n.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"PDF, DOC, or DOCX format"})]}),(0,n.jsx)("button",{type:"submit",disabled:ew,className:"w-full mt-6 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-semibold hover:shadow-lg hover:shadow-blue-400/30 transition-all disabled:opacity-50",children:ew?"Saving...":"Start Interview"})]})]})})]}):(0,n.jsxs)("div",{className:"min-h-screen bg-white text-slate-900 overflow-hidden flex flex-col",children:[(0,n.jsxs)("div",{className:"fixed inset-0 pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white via-[#f8fefb] to-[#f0fdf4]"}),(0,n.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-gradient-to-b from-[#d4f1f5]/50 via-[#e6f7f5]/40 to-transparent rounded-full blur-3xl opacity-60"}),(0,n.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-gradient-to-b from-white/80 via-[#f0f9fa]/60 to-transparent rounded-full blur-3xl opacity-50"}),(0,n.jsx)("div",{className:"absolute top-10 right-0 w-[600px] h-[600px] bg-gradient-to-bl from-[#e6fdf4]/45 via-[#f0fdf4]/25 to-transparent rounded-full blur-3xl opacity-50"}),(0,n.jsx)("div",{className:"absolute bottom-0 -left-20 w-[500px] h-[500px] bg-gradient-to-tr from-[#d4f1f5]/35 to-transparent rounded-full blur-3xl opacity-40"}),(0,n.jsx)("div",{className:"absolute top-1/2 -right-20 w-[600px] h-[600px] bg-gradient-to-l from-white/60 to-transparent rounded-full blur-3xl opacity-50"})]}),(0,n.jsx)("nav",{className:"fixed top-0 left-0 right-0 z-50 border-b border-[#11cd68]/15 bg-white/80 backdrop-blur-xl",children:(0,n.jsxs)("div",{className:"mx-auto px-4 md:px-6 lg:px-8 py-3 flex justify-between items-center relative z-10",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#007a78] to-[#11cd68] flex items-center justify-center text-white font-bold text-sm",children:"X"}),(0,n.jsx)("span",{className:"text-lg font-bold text-[#007a78]",children:"InterviewX"})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:D&&(0,n.jsx)("div",{className:"text-xl font-bold text-[#007a78] font-mono px-3 py-1 bg-[#f0fdf4] rounded-lg border border-[#11cd68]/30 text-sm",children:"".concat(Math.floor(J/60),":").concat((J%60).toString().padStart(2,"0"))})})]})}),(0,n.jsxs)("div",{className:"relative z-10 flex-1 overflow-y-auto pt-16 pb-6 px-0 md:px-0",children:[(null==y?void 0:y.user)&&!D&&(0,n.jsx)("div",{className:"mx-auto max-w-6xl mb-6 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,n.jsxs)("p",{className:"text-green-800 font-semibold text-sm",children:["✅ Authenticated as: ",(0,n.jsx)("span",{className:"font-mono",children:y.user.email})]})}),D?(0,n.jsxs)("div",{className:"h-[calc(100vh-64px)] w-full flex flex-col lg:flex-row gap-4 p-3 md:p-4 lg:gap-0",children:[(0,n.jsx)("div",{className:"w-full lg:flex-1 flex flex-col gap-3 lg:gap-0",children:(0,n.jsxs)("div",{className:"flex-1 bg-slate-900 rounded-lg lg:rounded-none overflow-hidden flex items-center justify-center relative min-h-[300px] lg:min-h-full",children:[en?(0,n.jsx)("video",{ref:eE,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}):(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,n.jsx)(m,{size:48,className:"text-slate-400"}),(0,n.jsx)("span",{className:"text-slate-400 text-sm",children:"Camera Off"})]}),(0,n.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-40 flex gap-2 md:gap-3 bg-white/95 backdrop-blur-md border border-slate-200 rounded-full px-3 md:px-4 py-2 md:py-3 shadow-lg hover:shadow-xl transition-shadow",children:[(0,n.jsx)("button",{onClick:()=>eo(!et),className:"w-10 md:w-12 h-10 md:h-12 rounded-full flex items-center justify-center transition-all flex-shrink-0 ".concat(et?"bg-[#11cd68] text-white hover:bg-[#0a9f5d]":"bg-red-500 text-white hover:bg-red-600"),title:et?"Mute":"Unmute",children:et?(0,n.jsx)(l.Z,{size:18,className:"md:block"}):(0,n.jsx)(u,{size:18})}),(0,n.jsx)("button",{onClick:()=>es(!en),className:"w-10 md:w-12 h-10 md:h-12 rounded-full flex items-center justify-center transition-all flex-shrink-0 ".concat(en?"bg-[#11cd68] text-white hover:bg-[#0a9f5d]":"bg-red-500 text-white hover:bg-red-600"),title:en?"Stop Camera":"Start Camera",children:en?(0,n.jsx)(d,{size:18}):(0,n.jsx)(m,{size:18})}),(0,n.jsx)("div",{className:"w-px bg-slate-300 hidden md:block"}),(0,n.jsx)("button",{onClick:eG,className:"w-10 md:w-12 h-10 md:h-12 rounded-full flex items-center justify-center bg-red-600 text-white hover:bg-red-700 transition-all flex-shrink-0",title:"End Interview",children:(0,n.jsx)(p.Z,{size:18,style:{transform:"rotate(135deg)"}})})]})]})}),(0,n.jsxs)("div",{className:"hidden lg:flex lg:w-96 flex-col h-full overflow-hidden border-l border-slate-200 bg-white",children:[(0,n.jsx)(N,{messages:eD,isListening:ej,loading:ep}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-end p-4 bg-gradient-to-b from-slate-50 to-slate-100",children:[(0,n.jsxs)("div",{className:"relative w-24 h-24 md:w-28 md:h-28 flex items-center justify-center mb-3",children:[(0,n.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-blue-400 via-purple-400 to-cyan-400 opacity-20 blur-3xl animate-pulse"}),(0,n.jsxs)("div",{className:"relative w-16 md:w-20 h-16 md:h-20 rounded-full bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 shadow-2xl overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white to-transparent opacity-30 animate-spin",style:{animationDuration:"3s"}}),(0,n.jsx)("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-300 opacity-50 animate-pulse",style:{animationDuration:"1.5s"}}),(0,n.jsx)("div",{className:"absolute inset-2 rounded-full border border-purple-300 opacity-40 animate-ping",style:{animationDuration:"2s"}}),(0,n.jsx)("div",{className:"absolute top-2 left-3 w-3 h-3 bg-white rounded-full opacity-60 blur-sm"})]}),(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-cyan-400 rounded-full top-2 left-8 animate-bounce",style:{animationDuration:"1.2s"}}),(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-purple-400 rounded-full bottom-4 right-6 animate-bounce",style:{animationDuration:"1.5s",animationDelay:"0.3s"}}),(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-pink-400 rounded-full top-8 right-4 animate-bounce",style:{animationDuration:"1.3s",animationDelay:"0.6s"}})]}),(0,n.jsx)("p",{className:"text-xs md:text-sm font-medium text-slate-600",children:"AI Agent"}),(0,n.jsx)("p",{className:"text-xs mt-1 font-medium ".concat(eh?"text-red-600 animate-pulse":ej?"text-green-600":ep?"text-blue-600":"text-slate-500"),children:eh?"\uD83D\uDD34 Please wait - AI is speaking...":ej?"\uD83C\uDFA4 Your turn - speak now!":ep?"Processing...":"Ready"})]})]}),(0,n.jsx)("div",{className:"lg:hidden w-full h-auto max-h-64 md:max-h-96 overflow-y-auto bg-white rounded-lg border border-slate-200",children:(0,n.jsx)(N,{messages:eD,isListening:ej,loading:ep})})]}):(0,n.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-[#007a78] mb-1",children:(null==er?void 0:er.title)?"Interview: ".concat(er.title):"Technical Interview"}),(0,n.jsx)("p",{className:"text-sm text-slate-600",children:(null==er?void 0:er.hiringFor)?"Hiring for: ".concat(er.hiringFor):(null==er?void 0:er.client)&&"Unknown"!==er.client?"Hiring for: ".concat(er.client):(null==er?void 0:er.skills)&&er.skills.length>0?"Skills: ".concat(er.skills.slice(0,3).map(e=>e.name).join(", ")):"Powered by OpenAI Realtime API"})]}),(null==er?void 0:er.skills)&&er.skills.length>0&&(0,n.jsxs)("div",{className:"mb-4 p-4 bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl shadow-sm",children:[(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm mb-2",children:"Key Skills"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:er.skills.map((e,t)=>(0,n.jsx)("div",{className:"px-3 py-1 rounded-full bg-gradient-to-r from-[#11cd68]/10 to-[#007a78]/10 border border-[#11cd68]/30 text-[#007a78] font-semibold text-xs hover:shadow-md transition-all",children:e.name},t))})]}),eC&&(0,n.jsxs)("div",{className:"mx-auto max-w-6xl mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 text-sm",children:[(0,n.jsx)(a.Z,{className:"text-red-600 flex-shrink-0 mt-0.5",size:18}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-red-900 font-semibold",children:"Connection Error"}),(0,n.jsx)("p",{className:"text-red-700 text-xs",children:eC})]})]}),k?(0,n.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl p-8 shadow-sm text-center",children:[(0,n.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-[#11cd68] to-[#007a78] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg",children:(0,n.jsx)(r.Z,{className:"text-white",size:40})}),(0,n.jsx)("h2",{className:"text-3xl font-bold text-[#007a78] mb-3",children:"Thank You!"}),(0,n.jsx)("p",{className:"text-slate-600 text-base mb-6",children:"Your technical interview has been completed and recorded."}),(0,n.jsx)("p",{className:"text-slate-600 text-sm mb-8",children:"Our team will review your responses and get back to you soon with feedback."}),(0,n.jsxs)("div",{className:"bg-[#f0fdf4] border border-[#11cd68]/30 rounded-lg p-4 mb-6",children:[(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Interview responses saved"}),(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Analysis in progress"}),(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Feedback coming soon"})]}),(0,n.jsx)("p",{className:"text-slate-500 text-xs",children:"This interview session has ended. You cannot start a new interview in this session."})]}):(0,n.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl p-6 shadow-sm",children:[(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-[#007a78] to-[#11cd68] rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,n.jsx)(l.Z,{className:"text-white",size:32})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-[#007a78] mb-2",children:"Ready?"}),(0,n.jsx)("p",{className:"text-slate-600 text-sm",children:"Start your AI-powered technical interview."})]}),j&&(0,n.jsxs)("div",{className:"mb-4 p-4 bg-red-50 border border-red-300 rounded-lg flex items-start gap-3 text-sm",children:[(0,n.jsx)(a.Z,{className:"text-red-600 flex-shrink-0 mt-0.5",size:20}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-red-900 font-semibold mb-2",children:j}),"Not authenticated"===j&&(0,n.jsxs)("div",{className:"text-red-700 text-xs space-y-2",children:[(0,n.jsx)("p",{children:"You need to be logged in to start an interview."}),(0,n.jsx)("button",{onClick:()=>e.push("/auth/login"),className:"inline-block mt-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold transition-all",children:"Go to Login"})]}),"Not authenticated"!==j&&(0,n.jsx)("p",{className:"text-red-700",children:j})]})]}),(0,n.jsxs)("div",{className:"bg-[#f0fdf4] border border-[#11cd68]/30 rounded-lg p-4 mb-6 space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(O?"bg-[#11cd68]":"bg-slate-400")}),(0,n.jsxs)("span",{className:"text-slate-700",children:["Microphone: ",(0,n.jsx)("span",{className:"font-semibold",children:O?"Granted":"Not Granted"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(P?"bg-[#11cd68]":"bg-slate-400")}),(0,n.jsxs)("span",{className:"text-slate-700",children:["Camera: ",(0,n.jsx)("span",{className:"font-semibold",children:P?"Granted":"Not Granted"})]})]})]}),F&&(0,n.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg flex items-start gap-2 text-sm",children:[(0,n.jsx)(a.Z,{className:"text-yellow-600 flex-shrink-0 mt-0.5",size:18}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-yellow-900 font-semibold",children:"Device Alert"}),(0,n.jsx)("p",{className:"text-yellow-800 text-xs",children:F})]})]}),(0,n.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-lg p-4 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex gap-2 justify-center mb-4",children:[(0,n.jsx)("button",{onClick:()=>eo(!et),className:"p-2 rounded-lg transition-all ".concat(et?"bg-[#11cd68]/20 text-[#007a78] border border-[#11cd68]/50":"bg-red-50 text-red-600 border border-red-200"),title:et?"Mute":"Unmute",children:et?(0,n.jsx)(l.Z,{size:20}):(0,n.jsx)(u,{size:20})}),(0,n.jsx)("button",{onClick:()=>es(!en),className:"p-2 rounded-lg transition-all ".concat(en?"bg-[#11cd68]/20 text-[#007a78] border border-[#11cd68]/50":"bg-red-50 text-red-600 border border-red-200"),title:en?"Stop Camera":"Start Camera",children:en?(0,n.jsx)(d,{size:20}):(0,n.jsx)(m,{size:20})})]}),(0,n.jsx)("button",{onClick:eM,disabled:null!==j,className:"w-full py-2 px-4 rounded-lg font-semibold text-white transition-all text-sm ".concat(null!==j?"bg-slate-400 cursor-not-allowed":"bg-gradient-to-r from-[#007a78] to-[#0a9f5d] hover:shadow-lg active:scale-95"),children:"Start Interview"})]})]})]})]}),ec&&(0,n.jsx)(w,{userId:null==c?void 0:c.id,onClose:()=>eu(!1),remainingInterviews:ed.remainingInterviews,currentPlan:ed.currentPlan})]})}function S(){return(0,n.jsx)(s.Suspense,{fallback:(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:(0,n.jsx)("p",{style:{color:"white"},children:"Loading..."})}),children:(0,n.jsx)(A,{})})}},1233:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return r},a:function(){return l}});var n=o(7437),s=o(2265),i=o(2141);let a=(0,s.createContext)();function r(e){let{children:t}=e,[o,r]=(0,s.useState)(null),[l,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[f,x]=(0,s.useState)(!1),b=(e,t,o)=>{let n={user:e,session:t,role:o,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(n)),console.log("[Auth] Auth state saved to localStorage")},v=()=>{try{let t=localStorage.getItem("authState");if(t){var e;let o=JSON.parse(t);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=o.user)||void 0===e?void 0:e.email),o}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},y=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,s.useEffect)(()=>{let e=v();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)?(console.log("[Auth] ✅ Restored session from localStorage:",e.user.email),r(e.user),c(e.session),d(e.role),h(!0),x(!0)):console.log("[Auth] ⏳ No cached session, verifying with Supabase...");let t=async()=>{try{let{data:{session:t}}=await i.OQ.auth.getSession();if(null==t?void 0:t.user){console.log("[Auth] ✅ Valid Supabase session found"),c(t),r(t.user),h(!0);let{data:e}=await i.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(d(e.role),b(t.user,t,e.role))}else(null==e?void 0:e.user)||(console.log("[Auth] ❌ No session found anywhere"),c(null),r(null),d(null),h(!1),y());x(!0)}catch(e){console.warn("[Auth] ⚠️ Session verification error:",e.message),x(!0)}};(null==e?void 0:e.user)?t().catch(e=>console.warn("[Auth] Background verification failed:",e)):t();let{data:{subscription:n}}=i.OQ.auth.onAuthStateChange(async(e,t)=>{if(console.log("[Auth] Auth state change event:",e),null==t?void 0:t.user){console.log("[Auth] Session valid, updating state"),c(t),r(t.user),h(!0);let{data:e}=await i.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(d(e.role),b(t.user,t,e.role))}else if("SIGNED_OUT"===e)console.log("[Auth] User signed out, clearing session"),c(null),r(null),d(null),h(!1),y();else{let e=v();if(null==e?void 0:e.user){var n;console.log("[Auth] Keeping cached session for:",null===(n=e.user)||void 0===n?void 0:n.email),o||(r(e.user),c(e.session),d(e.role),h(!0))}else console.log("[Auth] No current session and no cached session"),h(!1)}});return()=>null==n?void 0:n.unsubscribe()},[]);let w=async(e,t)=>{try{console.log("[Signup] Attempting signup for:",e.email);let o=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:t})});if(!o.ok){let e=await o.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let n=await o.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:n.user,needsLogin:!0,message:n.message}}catch(e){throw console.error("[Signup] Error:",e),e}},N=async(e,t,o)=>{try{var n,s;console.log("[AuthContext] Attempting login:",{email:e,role:o});let i=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,role:o})});if(console.log("[AuthContext] Login response status:",i.status),!i.ok){let e=await i.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let a=await i.json();console.log("[AuthContext] Login successful, setting session"),a.session&&(c(a.session),r(a.session.user||a.user));let l=(null===(n=a.user)||void 0===n?void 0:n.role)||o;return d(l),h(!0),b((null===(s=a.session)||void 0===s?void 0:s.user)||a.user,a.session,l),console.log("[AuthContext] Auth state saved to localStorage"),a.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},A=async()=>{try{await i.OQ.auth.signOut(),c(null),r(null),d(null),h(!1),y(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,n.jsx)(a.Provider,{value:{user:o,session:l,role:u,loading:m,isAuthenticated:g,isHydrated:f,signup:w,login:N,logout:A},children:t})}let l=()=>{let e=(0,s.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2141:function(e,t,o){"use strict";o.d(t,{OQ:function(){return l}});var n=o(9066),s=o(257);let i=s.env.NEXT_PUBLIC_SUPABASE_URL,a=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,r=s.env.SUPABASE_SERVICE_ROLE_KEY;if(!i||!a)throw Error("Missing Supabase environment variables");let l=(0,n.eI)(i,a);(0,n.eI)(i,r||a)},9376:function(e,t,o){"use strict";var n=o(5475);o.o(n,"useParams")&&o.d(t,{useParams:function(){return n.useParams}}),o.o(n,"usePathname")&&o.d(t,{usePathname:function(){return n.usePathname}}),o.o(n,"useRouter")&&o.d(t,{useRouter:function(){return n.useRouter}}),o.o(n,"useSearchParams")&&o.d(t,{useSearchParams:function(){return n.useSearchParams}})},8301:function(e,t,o){"use strict";o.d(t,{Z:function(){return a}});var n=o(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var a=(e,t)=>{let o=(0,n.forwardRef)((o,a)=>{let{color:r="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:u,children:d,...m}=o;return(0,n.createElement)("svg",{ref:a,...s,width:l,height:l,stroke:r,strokeWidth:u?24*Number(c)/Number(l):c,className:"lucide lucide-".concat(i(e)),...m},[...t.map(e=>{let[t,o]=e;return(0,n.createElement)(t,o)}),...(Array.isArray(d)?d:[d])||[]])});return o.displayName="".concat(e),o}},8279:function(e,t,o){"use strict";o.d(t,{Z:function(){return n}});let n=(0,o(8301).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5795:function(e,t,o){"use strict";o.d(t,{Z:function(){return n}});let n=(0,o(8301).Z)("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},7608:function(e,t,o){"use strict";o.d(t,{Z:function(){return n}});let n=(0,o(8301).Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},9811:function(e,t,o){"use strict";o.d(t,{Z:function(){return n}});let n=(0,o(8301).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])}},function(e){e.O(0,[9066,3287,2971,2117,1744],function(){return e(e.s=3378)}),_N_E=e.O()}]);