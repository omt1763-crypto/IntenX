(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7362],{93378:function(e,t,n){Promise.resolve().then(n.bind(n,36768))},36768:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var o=n(57437),i=n(2265),s=n(99376),a=n(78279),r=n(5795),l=n(67608),c=n(8301);let u=(0,c.Z)("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),d=(0,c.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),h=(0,c.Z)("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var m=n(69811);let g=(e,t)=>{let n=t||'You MUST speak ONLY in ENGLISH. Do NOT speak Spanish, French, German, or any other language.\n\nYou are a professional technical job interviewer conducting a formal interview in English.\n\n\uD83D\uDD12 LANGUAGE POLICY (CRITICAL - MUST FOLLOW):\n- SPEAK ONLY ENGLISH - Every single response must be in English, no exceptions\n- START IN ENGLISH - Greet in English: "Hello, thank you for joining me today..."\n- NEVER USE OTHER LANGUAGES - No Spanish "hola", no French, no German, nothing but English\n- DEFAULT LANGUAGE IS ENGLISH - If candidate asks to switch, acknowledge but continue in English\n- ENGLISH ONLY UNTIL EXPLICITLY INSTRUCTED OTHERWISE\n\nCORE DIRECTIVES:\n1. ENGLISH LANGUAGE ONLY - Respond ONLY in English. This is not negotiable.\n2. PROFESSIONAL TONE - no casual language, jokes, slang, or small talk\n3. ONE QUESTION AT A TIME - ask only one question per turn, wait for complete response\n4. TECHNICAL FOCUS - concentrate exclusively on job-related skills and experience\n5. NO PERSONAL QUESTIONS - never ask about age, gender, religion, location, family, or salary\n6. OPEN-ENDED QUESTIONS - avoid yes/no questions, encourage detailed explanations\n7. RESPECTFUL LISTENING - never interrupt the candidate\n8. REDIRECT IF OFF-TOPIC - if candidate goes off-topic, say "Let\'s keep our focus on the technical questions"\n\nINTERVIEW PHASES:\n1. INTRODUCTION - "Hello, thank you for joining me today. I\'m your technical interviewer. Could you please introduce yourself and share your background?"\n2. BACKGROUND - Ask about education, work experience, and current role\n3. TECHNICAL SKILLS - Deep dive into required skills with practical questions\n4. PROBLEM-SOLVING - Ask scenario-based questions relevant to the position\n5. CLOSING - Summarize discussion and ask if they have questions\n\nREMEMBER: YOU MUST SPEAK ONLY IN ENGLISH. NO OTHER LANGUAGES ALLOWED.';if(e&&e.length>0){let t=e.map(e=>"• ".concat(e.name).concat(e.reason?": ".concat(e.reason):"")).join("\n"),o=e.map(e=>({name:e.name,reason:e.reason||"Required skill for this position"}));n+="\n\n=== REQUIRED SKILLS TO EVALUATE (JSON FORMAT) ===\n".concat(JSON.stringify(o,null,2),"\n=== END SKILLS JSON ===\n\nREQUIRED SKILLS TO EVALUATE:\n").concat(t,"\n\nSKILL ASSESSMENT STRATEGY:\n- For each required skill listed above, ask 2-3 targeted technical questions\n- Probe for depth of understanding, not just familiarity\n- Ask for real-world examples of using each skill\n- Assess both theoretical knowledge and practical experience\n- Reference the specific skills from the JSON section above")}return n+"\n\nPROHIBITED BEHAVIORS:\n❌ Speaking in any language other than English\n❌ Asking personal or demographic questions\n❌ Making jokes or using casual language\n❌ Asking multiple questions in one turn\n❌ Interrupting the candidate\n❌ Going off-topic\n❌ Making assumptions about the candidate\n❌ Expressing personal opinions\n❌ Discussing salary before appropriate stage\n\nREMEMBER:\nYou are ONLY a technical job interviewer. Your role is to fairly assess the candidate's qualifications for the open position. Be respectful, professional, and focused on job-related competencies."},p=e=>{let t=[],n=e.toLowerCase();for(let e of["hola","buenos","d\xedas","noche","gracias","por favor","c\xf3mo","qu\xe9","d\xf3nde","cu\xe1ndo","s\xed","no"])n.includes(e)&&t.push('Possible non-English content detected: "'.concat(e,'"'));let o=(e.match(/\?/g)||[]).length;for(let e of(o>1&&t.push("Multiple questions detected (".concat(o,"). Should ask one question at a time.")),["hey","what's up","lol","btw","umm","uh","gonna","wanna","kinda","sorta"]))n.includes(e)&&t.push('Casual language detected: "'.concat(e,'". Use professional tone.'));for(let e of["age","married","children","religion","politics","salary","where do you live","personal life"])n.includes(e)&&t.push('Potential personal question detected: "'.concat(e,'". Focus on job-related topics.'));return{isValid:0===t.length,violations:t}},f=(e,t)=>({role:"technical_interviewer",interview_type:"structured_technical",position:t||"Technical Position",required_skills:e||[],assessment_criteria:["Technical knowledge and depth","Practical experience","Problem-solving ability","Communication skills","Job fit and relevant expertise"],interview_duration_minutes:45,question_count:5,language:"English (only)",professional_standards:"ISO 9001, EEOC compliant"});class b{createHannWindow(e){let t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=.5*(1-Math.cos(2*Math.PI*n/(e-1)));return t}calculateRMS(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t/e.length)}linearToDb(e){return 20*Math.log10(Math.max(e,1e-5))}dbToLinear(e){return Math.pow(10,e/20)}fft(e,t){let n=e.length;if(n<=1)return;let o=new Float32Array(n/2),i=new Float32Array(n/2),s=new Float32Array(n/2),a=new Float32Array(n/2);for(let r=0;r<n/2;r++)o[r]=e[2*r],i[r]=t[2*r],s[r]=e[2*r+1],a[r]=t[2*r+1];this.fft(o,i),this.fft(s,a);for(let r=0;r<n/2;r++){let l=-2*Math.PI*r/n,c=Math.cos(l),u=Math.sin(l),d=s[r]*c-a[r]*u,h=s[r]*u+a[r]*c;e[r]=o[r]+d,t[r]=i[r]+h,e[r+n/2]=o[r]-d,t[r+n/2]=i[r]-h}}processAudio(e){let t=new Float32Array(this.fftSize);for(let n=0;n<Math.min(e.length,this.fftSize);n++)t[n]=(e[n]||0)*this.window[n];let n=new Float32Array(this.fftSize),o=new Float32Array(this.fftSize);for(let e=0;e<this.fftSize;e++)n[e]=t[e];this.fft(n,o);let i=new Float32Array(this.fftSize/2);for(let e=0;e<this.fftSize/2;e++)i[e]=Math.sqrt(n[e]*n[e]+o[e]*o[e]);this.isCalibrated||this.calibrateNoiseProfile(i);let s=this.suppressNoise(i);for(let e=0;e<this.fftSize/2;e++){let t=Math.atan2(o[e],n[e]);n[e]=s[e]*Math.cos(t),o[e]=s[e]*Math.sin(t)}let a=this.ifft(n,o),r=new Float32Array(this.fftSize);for(let e=0;e<this.fftSize;e++)r[e]=a[e]*this.window[e];let l=this.calculateMetrics(e,s);return{audio:r.slice(0,e.length),metrics:l}}calibrateNoiseProfile(e){if(null===this.noiseFloor)this.noiseFloor=new Float32Array(e.length),this.spectralProfile=new Float32Array(e.length),this.noiseFloor.set(e),this.spectralProfile.set(e);else for(let t=0;t<e.length;t++)this.noiseFloor[t]=Math.min(this.noiseFloor[t],this.config.temporalSmoothing*this.noiseFloor[t]+(1-this.config.temporalSmoothing)*e[t]);this.calibrationFrameCount++,this.calibrationFrameCount>=this.calibrationTarget&&(this.isCalibrated=!0,console.log("[AdvancedAudioProcessor] ✅ Noise profile calibrated"))}suppressNoise(e){if(!this.noiseFloor||!this.isCalibrated)return e;let t=new Float32Array(e.length);for(let n=0;n<e.length;n++){let o=this.noiseFloor[n]*this.config.suppressionFactor,i=e[n]-o;i=Math.max(i,this.config.minimumMask*e[n]),n>0&&n<e.length-1?t[n]=.5*i+.25*t[n-1]+.25*(n<e.length-1?e[n+1]:e[n]):t[n]=i}return t}ifft(e,t){let n=e.length,o=new Float32Array(n);for(let i=0;i<n;i++){let s=0;for(let o=0;o<n;o++){let a=2*Math.PI*o*i/n,r=Math.cos(a),l=Math.sin(a);s+=e[o]*r-t[o]*l,e[o],t[o]}o[i]=s/n}return o}calculateMetrics(e,t){let n=this.calculateRMS(e),o=this.linearToDb(n),i=0;for(let t=0;t<e.length;t++)i=Math.max(i,Math.abs(e[t]));let s=i>.99,a=0;if(this.noiseFloor){for(let e=0;e<Math.min(t.length,this.noiseFloor.length);e++)a+=this.noiseFloor[e];a=this.linearToDb(a/t.length)}return{snr:Math.max(0,o-a),volume:o,noiseLevel:a,isClipping:s,isSpeech:n>this.config.voiceActivityThreshold}}getCalibrationStatus(){return{isCalibrated:this.isCalibrated,calibrationProgress:Math.min(100,this.calibrationFrameCount/this.calibrationTarget*100),noiseFloor:this.noiseFloor?new Float32Array(this.noiseFloor):null,spectralProfile:this.spectralProfile?new Float32Array(this.spectralProfile):null}}reset(){this.noiseFloor=null,this.spectralProfile=null,this.isCalibrated=!1,this.calibrationFrameCount=0,this.currentPosition=0}getConfig(){return{...this.config}}updateConfig(e){Object.assign(this.config,e)}constructor(e=4096){this.fftSize=4096,this.overlapFactor=.5,this.noiseFloor=null,this.spectralProfile=null,this.isCalibrated=!1,this.calibrationFrameCount=0,this.calibrationTarget=50,this.currentPosition=0,this.config={suppressionFactor:.8,minimumMask:.1,temporalSmoothing:.98,frequencySmoothing:.95,voiceActivityThreshold:.02,noiseGateDb:-50},this.fftSize=e,this.window=this.createHannWindow(e),this.inputBuffer=new Float32Array(e),this.outputBuffer=new Float32Array(e)}}class x{createHannWindow(e){let t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=.5*(1-Math.cos(2*Math.PI*n/(e-1)));return t}calibrateFromSilence(e){if(this.isCalibrated)return;if(null===this.noiseBaseline){let t=this.computeSpectrum(e);this.noiseBaseline=t,this.smoothedNoise=new Float32Array(t),console.log("[NoiseSuppressionLayer] Starting calibration...")}else{let t=this.computeSpectrum(e);for(let e=0;e<t.length;e++)this.noiseBaseline[e]=.95*this.noiseBaseline[e]+.05*t[e]}this.calibrationFrames++;let t=Math.round(this.calibrationFrames/this.calibrationTarget*100);this.calibrationFrames%20==0&&console.log("[NoiseSuppressionLayer] Calibration progress: ".concat(t,"%")),this.calibrationFrames>=this.calibrationTarget&&(this.isCalibrated=!0,console.log("[NoiseSuppressionLayer] ✅ Calibration complete - Ready for noise suppression"))}processAudio(e){let t=this.applyPreEmphasis(e),n=this.computeSpectrum(t),o=this.estimateNoise(n),i=this.spectralSubtraction(n,o),s=this.applyVoiceActivityMask(i,n),a=this.reconstructAudio(s,t);return{audio:this.removePreEmphasis(a),metrics:this.calculateMetrics(e,o,n,i)}}applyPreEmphasis(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;n++){let o=n>0?e[n-1]:0;t[n]=e[n]-.97*o}return t}removePreEmphasis(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;n++){let o=n>0?t[n-1]:0;t[n]=e[n]+.97*o}return t}computeSpectrum(e){let t=Math.min(2048,Math.pow(2,Math.ceil(Math.log2(e.length)))),n=new Float32Array(t),o=new Float32Array(t);for(let o=0;o<Math.min(e.length,t);o++){let i=o*this.hannWindow.length/t,s=this.hannWindow[Math.floor(i)];n[o]=e[o]*s}this.fft(n,o);let i=new Float32Array(t/2);for(let e=0;e<t/2;e++)i[e]=Math.sqrt(n[e]*n[e]+o[e]*o[e]);return i}fft(e,t){let n=e.length;if(n<=1)return;let o=0;for(let i=0;i<n-1;i++){if(i<o){let n=e[i],s=t[i];e[i]=e[o],t[i]=t[o],e[o]=n,t[o]=s}let s=n/2;for(;s<=o;)o-=s,s/=2;o+=s}for(let o=2;o<=n;o*=2){let i=2*Math.PI/o,s=Math.cos(i),a=-Math.sin(i);for(let i=0;i<n;i+=o){let n=1,r=0;for(let l=0;l<o/2;l++){let c=i+l,u=i+l+o/2,d=e[u]*n-t[u]*r,h=e[u]*r+t[u]*n;e[u]=e[c]-d,t[u]=t[c]-h,e[c]+=d,t[c]+=h;let m=n*s-r*a,g=n*a+r*s;n=m,r=g}}}}estimateNoise(e){if(!this.isCalibrated||!this.noiseBaseline)return new Float32Array(e.length).fill(1e-6);let t=new Float32Array(e.length);for(let n=0;n<e.length;n++)this.smoothedNoise||(this.smoothedNoise=new Float32Array(e.length)),this.smoothedNoise[n]=Math.min(e[n],.998*(this.smoothedNoise[n]||e[n])+.0020000000000000018*e[n]),t[n]=this.smoothedNoise[n]*(1+.1*this.config.aggressiveness);return t}spectralSubtraction(e,t){let n=new Float32Array(e.length),o=1.2+.2*this.config.aggressiveness;for(let i=0;i<e.length;i++){let s=t[i]*o,a=e[i]-s;a=Math.max(a,.05*e[i]),n[i]=a}return n}applyVoiceActivityMask(e,t){let n=new Float32Array(e.length);for(let o=0;o<e.length;o++){let i=o>20&&o<200?.95:.7;n[o]=e[o]*i+t[o]*(1-i)}return n}reconstructAudio(e,t){t.length;let n=new Float32Array(t.length),o=this.calculateMean(t),i=this.calculateMean(e),s=o>1e-6?i/o:1;for(let e=0;e<n.length;e++)n[e]=t[e]*s;return n}calculateMean(e){let t=0;for(let n=0;n<e.length;n++)t+=Math.abs(e[n]);return t/e.length}calculateRmsDb(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return 20*Math.log10(Math.max(Math.sqrt(t/e.length),1e-6))}calculateMetrics(e,t,n,o){let i=this.calculateRmsDb(e),s=this.calculateRmsDb(new Float32Array(Array.from(t).slice(0,Math.min(100,t.length)))),a=this.calculateRmsDb(new Float32Array(Array.from(o).slice(20,Math.min(200,o.length)))),r=a-s,l=r>-5&&i>this.config.minVoiceDb;this.voiceHistory.push(l?1:0),this.noiseHistory.push(s),this.voiceHistory.length>this.historySize&&(this.voiceHistory.shift(),this.noiseHistory.shift());let c=this.calculateRmsDb(new Float32Array(Array.from(n).slice(0,Math.min(100,n.length))))-s;return{inputDb:i,noiseDb:s,voiceDb:a,snr:r,isVoiceDetected:l,noiseReductionDb:Math.max(0,c)}}getCalibrationStatus(){let e=Math.min(100,Math.round(this.calibrationFrames/this.calibrationTarget*100));return{isCalibrated:this.isCalibrated,progress:e}}resetCalibration(){this.noiseBaseline=null,this.smoothedNoise=null,this.calibrationFrames=0,this.isCalibrated=!1,console.log("[NoiseSuppressionLayer] Calibration reset")}updateConfig(e){this.config={...this.config,...e},console.log("[NoiseSuppressionLayer] Configuration updated:",this.config)}constructor(e){this.noiseBaseline=null,this.calibrationFrames=0,this.calibrationTarget=120,this.isCalibrated=!1,this.smoothedNoise=null,this.spectralGate=null,this.noiseHistory=[],this.voiceHistory=[],this.historySize=10,this.prevAudio=null,this.frequencyBins=512,this.config={aggressiveness:2,minVoiceDb:-30,maxNoiseDb:-50,enableBandpassFilter:!0,enableSpectralSubtraction:!0,enableAdaptiveNoise:!0,...e},this.hannWindow=this.createHannWindow(1024),this.smoothedNoise=new Float32Array(this.frequencyBins),this.spectralGate=new Float32Array(this.frequencyBins)}}class y{signalAISpeakingStart(){this.isAISpeaking||(this.isUserSpeaking&&this.signalUserSpeakingEnd(),this.isAISpeaking=!0,this.currentTurn="ai",this.aiSpeakingStartTime=Date.now(),this.lastTurnChangeTime=this.aiSpeakingStartTime,this.turnHistory.push({speaker:"ai",startTime:this.aiSpeakingStartTime}),console.log("[ConversationFlow] \uD83E\uDD16 AI SPEAKING START"))}signalAISpeakingEnd(){if(!this.isAISpeaking)return;let e=Date.now();if(this.isAISpeaking=!1,this.turnHistory.length>0){let t=this.turnHistory[this.turnHistory.length-1];"ai"!==t.speaker||t.endTime||(t.endTime=e)}let t=e-this.aiSpeakingStartTime;console.log("[ConversationFlow] \uD83E\uDD16 AI SPEAKING END - Duration: ".concat(t,"ms")),this.currentTurn="silence",this.lastTurnChangeTime=e}signalUserSpeakingStart(){if(this.isUserSpeaking)return;if(this.isAISpeaking){console.log("[ConversationFlow] ⚠️ User speaking but AI is still speaking - ignoring");return}let e=Date.now();this.isUserSpeaking=!0,this.currentTurn="user",this.userSpeakingStartTime=e,this.lastTurnChangeTime=e,this.turnHistory.push({speaker:"user",startTime:e}),console.log("[ConversationFlow] \uD83D\uDC64 USER SPEAKING START")}signalUserSpeakingEnd(){if(!this.isUserSpeaking)return;let e=Date.now();if(this.isUserSpeaking=!1,this.turnHistory.length>0){let t=this.turnHistory[this.turnHistory.length-1];"user"!==t.speaker||t.endTime||(t.endTime=e)}let t=e-this.userSpeakingStartTime;console.log("[ConversationFlow] \uD83D\uDC64 USER SPEAKING END - Duration: ".concat(t,"ms")),this.currentTurn="silence",this.lastTurnChangeTime=e}canUserSpeak(){if(this.isAISpeaking)return!1;let e=Date.now()-this.lastTurnChangeTime;return"silence"!==this.currentTurn||!(e<200)}canAISpeak(){if(this.isUserSpeaking)return!1;if("user"===this.currentTurn&&this.turnHistory.length>0){let e=this.turnHistory[this.turnHistory.length-1];if((e.endTime||Date.now())-e.startTime<this.minUserSpeechDuration)return!1}return!0}getState(){return{currentTurn:this.currentTurn,isAISpeaking:this.isAISpeaking,isUserSpeaking:this.isUserSpeaking,lastTurnChangeTime:this.lastTurnChangeTime,turnHistory:this.turnHistory,aiSpeakingDuration:this.isAISpeaking?Date.now()-this.aiSpeakingStartTime:0,userSpeakingDuration:this.isUserSpeaking?Date.now()-this.userSpeakingStartTime:0}}getConversationSummary(){let e=this.turnHistory.filter(e=>"ai"===e.speaker).length,t=this.turnHistory.filter(e=>"user"===e.speaker).length,n=0;for(let e of this.turnHistory)n+=(e.endTime||Date.now())-e.startTime;return{totalTurns:this.turnHistory.length,aiTurns:e,userTurns:t,totalDuration:n}}reset(){this.currentTurn="silence",this.isAISpeaking=!1,this.isUserSpeaking=!1,this.lastTurnChangeTime=Date.now(),this.turnHistory=[],this.aiSpeakingStartTime=0,this.userSpeakingStartTime=0,console.log("[ConversationFlow] Reset")}getTurnHistoryLog(){return this.turnHistory.map((e,t)=>{let n=(e.endTime||Date.now())-e.startTime,o="ai"===e.speaker?"\uD83E\uDD16 AI":"\uD83D\uDC64 User";return"".concat(t+1,". ").concat(o," - ").concat(n,"ms")}).join("\n")}constructor(){this.currentTurn="silence",this.isAISpeaking=!1,this.isUserSpeaking=!1,this.lastTurnChangeTime=Date.now(),this.turnHistory=[],this.aiSpeakingStartTime=0,this.userSpeakingStartTime=0,this.minUserSpeechDuration=300,this.maxAISpeechDuration=12e4,this.turnChangeBuffer=500}}class v{analyzeFrame(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=this.calculateEnergy(e),o=this.linearToDb(n);this.smoothedEnergy=this.config.smoothingFactor*this.smoothedEnergy+(1-this.config.smoothingFactor)*o,this.energyHistory.push(this.smoothedEnergy),this.energyHistory.length>this.maxHistorySize&&this.energyHistory.shift();let i=this.smoothedEnergy>this.config.threshold;i&&!this.isSpeaking?(this.isSpeaking=!0,this.voiceStartTime=t,this.silenceStartTime=t,console.log("[VAD] \uD83C\uDFA4 Speech started")):!i&&this.isSpeaking?(this.silenceStartTime===t&&(this.silenceStartTime=t),t-this.silenceStartTime>this.config.maxSilence&&(this.isSpeaking=!1,console.log("[VAD] \uD83E\uDD10 Speech ended, duration:",t-this.voiceStartTime,"ms"),this.lastVoiceTime=t)):i&&this.isSpeaking&&(this.silenceStartTime=t);let s=this.calculateConfidence(),a=this.isSpeaking?Math.max(0,t-this.voiceStartTime):0,r=this.isSpeaking?Math.max(0,t-this.silenceStartTime):t-this.lastVoiceTime;return{isSpeaking:this.isSpeaking&&a>=this.config.minDuration,confidence:s,voiceDuration:a,silenceDuration:r}}calculateEnergy(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t/e.length)}linearToDb(e){return 20*Math.log10(Math.max(e,1e-6))}calculateConfidence(){if(0===this.energyHistory.length)return 0;let e=this.energyHistory.slice(-10),t=e.reduce((e,t)=>e+t,0)/e.length;return Math.max(0,1-Math.sqrt(e.reduce((e,n)=>e+(n-t)**2,0)/e.length)/20)}reset(){this.isSpeaking=!1,this.voiceStartTime=0,this.silenceStartTime=0,this.energyHistory=[],this.smoothedEnergy=0,this.lastVoiceTime=0,console.log("[VAD] Reset")}updateConfig(e){this.config={...this.config,...e},console.log("[VAD] Configuration updated:",this.config)}getState(){return{isSpeaking:this.isSpeaking,confidence:this.calculateConfidence(),voiceDuration:this.isSpeaking?Date.now()-this.voiceStartTime:0,silenceDuration:Date.now()-(this.isSpeaking?this.silenceStartTime:this.lastVoiceTime)}}constructor(e){this.isSpeaking=!1,this.voiceStartTime=0,this.silenceStartTime=0,this.energyHistory=[],this.maxHistorySize=50,this.smoothedEnergy=0,this.lastVoiceTime=0,this.config={threshold:-40,minDuration:100,maxSilence:800,smoothingFactor:.7,...e}}}var w=n(1233),S=n(2141),A=n(13287);function N(e){let{userId:t,onClose:n,remainingInterviews:s,currentPlan:a}=e,[r,l]=(0,i.useState)([]),[c,u]=(0,i.useState)(!0);(0,i.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=await fetch("/api/subscription-plans?userId=".concat(t)),n=await e.json();l(n.plans||[])}catch(e){console.error("Error loading plans:",e)}finally{u(!1)}},h=e=>{console.log("Upgrade to plan:",e),alert("Payment integration coming soon! Contact support for manual upgrade.")};return(0,o.jsx)(A.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:n,children:(0,o.jsx)(A.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg max-w-4xl w-full max-h-96 overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,o.jsxs)("div",{className:"p-8",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{className:"text-3xl font-bold text-slate-900",children:"Interview Limit Reached"}),(0,o.jsxs)("p",{className:"text-slate-600 mt-2",children:["You've used all ",0===s?2:s," free interviews on your ",a," plan"]})]}),(0,o.jsx)("button",{onClick:n,className:"text-slate-400 hover:text-slate-600 text-2xl",children:"✕"})]}),c?(0,o.jsx)("div",{className:"text-center py-8",children:(0,o.jsx)("p",{className:"text-slate-600",children:"Loading subscription plans..."})}):(0,o.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:r.map(e=>(0,o.jsxs)("div",{className:"rounded-lg border-2 p-6 transition-all ".concat("Pro"===e.name?"border-blue-500 bg-blue-50 scale-105":"border-slate-200 hover:border-slate-300"),children:[(0,o.jsx)("h3",{className:"text-xl font-bold text-slate-900",children:e.name}),(0,o.jsx)("p",{className:"text-slate-600 text-sm mt-2 h-10",children:e.description}),(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsxs)("span",{className:"text-3xl font-bold text-slate-900",children:["$",parseFloat(e.price).toFixed(2)]}),(0,o.jsx)("span",{className:"text-slate-600 ml-2",children:"/month"})]}),(0,o.jsxs)("p",{className:"text-sm font-semibold text-slate-900 mt-4",children:[999999===e.interview_limit?"∞ Unlimited":e.interview_limit," interviews"]}),(0,o.jsx)("div",{className:"mt-6 space-y-2",children:e.features&&JSON.parse(e.features).map((e,t)=>(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("span",{className:"text-green-600",children:"✓"}),(0,o.jsx)("span",{className:"text-sm text-slate-700",children:e})]},t))}),(0,o.jsx)("button",{onClick:()=>h(e.id),className:"w-full mt-6 py-2 rounded-lg font-semibold transition-colors ".concat("Pro"===e.name?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-100 text-slate-900 hover:bg-slate-200"),children:0===e.price?"Current Plan":"Upgrade Now"})]},e.id))}),(0,o.jsx)("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,o.jsxs)("p",{className:"text-sm text-slate-700",children:[(0,o.jsx)("strong",{children:"Tip:"})," The Pro plan includes unlimited interviews, advanced AI analysis, detailed feedback, and performance tracking!"]})})]})})})}function D(e){let{messages:t,isListening:n=!1,messageCount:s=0,loading:a=!1}=e,r=(0,i.useRef)(null);return(0,i.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]),(0,o.jsxs)("div",{className:"lg:col-span-3 flex flex-col bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-lg shadow-sm overflow-hidden h-full",children:[(0,o.jsx)("div",{className:"p-3 border-b border-[#11cd68]/20 bg-white/50",children:(0,o.jsxs)("h3",{className:"text-[#007a78] font-bold text-sm",children:["\uD83D\uDCAC Conversation ",t.length>0&&"(".concat(t.length,")")]})}),(0,o.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:0===t.length?(0,o.jsx)("p",{className:"text-slate-500 text-xs text-center py-4",children:"Waiting for conversation to start..."}):(0,o.jsxs)(o.Fragment,{children:[t.map(e=>(0,o.jsxs)("div",{className:"space-y-1 animate-in fade-in",children:[(0,o.jsx)("div",{className:"text-xs font-bold ".concat("ai"===e.role?"text-[#007a78]":"text-blue-600"),children:"ai"===e.role?"\uD83E\uDD16 AI Assistant":"\uD83D\uDC64 You"}),(0,o.jsx)("div",{className:"text-xs leading-relaxed ml-2 p-3 rounded-lg whitespace-pre-wrap break-words ".concat("ai"===e.role?"bg-[#f0fdf4] border border-[#11cd68]/50 text-slate-800":"bg-blue-50 border border-blue-300 text-slate-800"),children:e.content||"(empty message)"}),(0,o.jsx)("div",{className:"text-xs text-slate-400 ml-2",children:e.timestamp?new Date(e.timestamp).toLocaleTimeString():""})]},e.id)),(0,o.jsx)("div",{ref:r})]})}),(0,o.jsxs)("div",{className:"border-t border-[#11cd68]/20 p-3 bg-white/50 space-y-2 text-xs",children:[n&&(0,o.jsx)("div",{className:"p-2 bg-[#fff3cd] border border-[#ffc107]/50 rounded-lg",children:(0,o.jsx)("p",{className:"text-[#856404] font-semibold",children:"\uD83E\uDD16 AI Speaking"})}),!n&&t.length>0&&(0,o.jsx)("div",{className:"p-2 bg-[#d1ecf1] border border-[#0c5460]/30 rounded-lg",children:(0,o.jsx)("p",{className:"text-[#0c5460] font-semibold",children:"\uD83C\uDFA4 Your Turn"})}),a&&(0,o.jsx)("div",{className:"p-2 bg-gray-100 border border-gray-300 rounded-lg",children:(0,o.jsx)("p",{className:"text-gray-600 font-semibold",children:"⏳ Saving conversation..."})})]})]})}function E(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),{role:n,user:c,session:A,loading:E}=(0,w.a)(),[k,I]=(0,i.useState)(!1),[R,C]=(0,i.useState)(!1),[T,j]=(0,i.useState)(!1),[O,F]=(0,i.useState)(null),[P,L]=(0,i.useState)(null),[M,U]=(0,i.useState)(null),[G,q]=(0,i.useState)(null),[H,_]=(0,i.useState)(null),[V,B]=(0,i.useState)(null),[z,W]=(0,i.useState)(null),[J,Y]=(0,i.useState)(0),[K,Z]=(0,i.useState)(!1),[Q]=(0,i.useState)(600),[X,$]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(0),[en,eo]=(0,i.useState)(2),[ei,es]=(0,i.useState)(!0),[ea,er]=(0,i.useState)(!0),[el,ec]=(0,i.useState)(null),[eu,ed]=(0,i.useState)(null),[eh,em]=(0,i.useState)(!1),[eg,ep]=(0,i.useState)(null),[ef,eb]=(0,i.useState)(!1),[ex,ey]=(0,i.useState)(!1),[ev,ew]=(0,i.useState)(!1),[eS,eA]=(0,i.useState)({name:"",email:"",phone:"",position:"",resumeFile:null}),[eN,eD]=(0,i.useState)(!1),[eE,ek]=(0,i.useState)(null),eI=(0,i.useRef)(null);(0,i.useRef)(null);let{messages:eR,addMessage:eC,saveToDatabase:eT}=function(){let[e,t]=(0,i.useState)([]),n=(0,i.useRef)(0),o=(0,i.useCallback)((e,o)=>{let i="msg-".concat(Date.now(),"-").concat(n.current++),s={id:i,role:e,content:o,timestamp:new Date,status:"complete"};return t(e=>[...e,s]),console.log("[ConversationManager] Added ".concat(e," message:"),o.substring(0,100)),i},[]),s=(0,i.useCallback)((e,n)=>{t(t=>t.map(t=>t.id===e?{...t,...n}:t)),console.log("[ConversationManager] Updated message ".concat(e))},[]),a=(0,i.useCallback)(()=>{t([]),n.current=0,console.log("[ConversationManager] Cleared all messages")},[]),r=(0,i.useCallback)(()=>e.map(e=>{let t="ai"===e.role?"AI Assistant":"Candidate",n=e.timestamp.toLocaleTimeString();return"[".concat(n,"] ").concat(t,": ").concat(e.content)}).join("\n\n"),[e]),l=(0,i.useCallback)(async(t,n)=>{try{var o,i;if(0===e.length)return console.warn("[ConversationManager] No messages to save"),!1;let s={interviewId:t,applicantId:n||null,messages:e.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString(),status:e.status||"complete"})),messageCount:e.length,startTime:null===(o=e[0])||void 0===o?void 0:o.timestamp.toISOString(),endTime:null===(i=e[e.length-1])||void 0===i?void 0:i.timestamp.toISOString(),conversationText:r()};console.log("[ConversationManager] Saving conversation:",{interviewId:t,messageCount:e.length});let a=await fetch("/api/interviews/save-conversation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to save conversation")}let l=await a.json();return console.log("[ConversationManager] Conversation saved successfully:",l),!0}catch(e){return console.error("[ConversationManager] Error saving conversation:",e),!1}},[e,r]);return{messages:e,addMessage:o,updateMessage:s,clearMessages:a,saveToDatabase:l,getConversationText:r}}(),{connected:ej,isListening:eO,error:eF,connect:eP,disconnect:eL}=function(){let[e,t]=(0,i.useState)(!1),[n,o]=(0,i.useState)(!1),[s,a]=(0,i.useState)(null),r=(0,i.useRef)(null),l=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(0,i.useRef)(null),d=(0,i.useRef)(null),h=(0,i.useRef)([]),m=(0,i.useRef)(null),w=(0,i.useRef)(""),S=(0,i.useRef)(!1),A=(0,i.useRef)(0),N=(0,i.useRef)(""),D=(0,i.useRef)(!1),E=(0,i.useRef)(null),k=(0,i.useRef)(null),I=(0,i.useRef)(new y);(0,i.useRef)(new v);let R=(0,i.useRef)(!1),C=(0,i.useRef)(!1);(0,i.useRef)([]);let T=(0,i.useRef)(!1),j=(0,i.useRef)(!1),O=(0,i.useRef)(!1),F=(0,i.useRef)(0),P=(0,i.useRef)(0),L=(0,i.useRef)(0),M=(0,i.useCallback)(async(n,i,s)=>{n&&(m.current=n,console.log("[RealtimeAudio] ✅ Conversation callback set")),a(null),w.current="",A.current=0;let l=g(i,s);i&&i.length>0&&console.log("[RealtimeAudio] Skills provided:",i);try{console.log("[RealtimeAudio] Starting connection...");let s="wss://backend-production-214c.up.railway.app/ws/realtime";console.log("[RealtimeAudio] Connecting to backend WebSocket proxy:",s);let c=new WebSocket(s);r.current=c,await new Promise((t,s)=>{let r=setTimeout(()=>{console.error("[RealtimeAudio] Connection timeout"),s(Error("Connection timeout"))},3e4);c.onopen=()=>{console.log("[RealtimeAudio] ✅ WebSocket opened"),clearTimeout(r);let e=f(i),n={language_policy:"ENGLISH_ONLY",core_directives:["ENGLISH LANGUAGE ONLY - Respond ONLY in English","PROFESSIONAL TONE - no casual language, jokes, slang","ONE QUESTION AT A TIME - ask only one question per turn","TECHNICAL FOCUS - concentrate exclusively on job-related skills","NO PERSONAL QUESTIONS - never ask about age, gender, religion, location","OPEN-ENDED QUESTIONS - avoid yes/no questions","RESPECTFUL LISTENING - never interrupt","REDIRECT IF OFF-TOPIC - keep focus on technical questions"],prohibited_behaviors:["Speaking in any language other than English","Asking personal or demographic questions","Making jokes or using casual language","Asking multiple questions in one turn","Interrupting the candidate","Going off-topic","Making assumptions about the candidate","Expressing personal opinions","Discussing salary before appropriate stage"],validation_checks:["Must speak only English","Must ask one question at a time","Must maintain professional tone","Must focus on technical skills only","Must avoid personal questions"]},o={skills:i&&i.length>0?i:[],skillCount:(null==i?void 0:i.length)||0,interviewContext:e},s="".concat(l,"\n\n=== GUARDRAILS CONFIGURATION (JSON FORMAT) ===\n").concat(JSON.stringify(n,null,2),"\n=== END GUARDRAILS JSON ===\n\n=== INTERVIEW CONTEXT & SKILLS (JSON FORMAT) ===\n").concat(JSON.stringify(o,null,2),"\n=== END SKILLS JSON ===");c.send(JSON.stringify({type:"session.update",session:{type:"realtime",instructions:s}})),console.log("[RealtimeAudio] ✅ Session configuration sent with instructions"),console.log("[RealtimeAudio] Guardrails included:",n),console.log("[RealtimeAudio] Skills included:",o),console.log("[RealtimeAudio] Instructions included in session.update"),N.current="",t()},c.onmessage=async e=>{try{var t,n,i;let s=JSON.parse(e.data);if(s.type&&!["input_audio_buffer.append","response.output_audio.delta"].includes(s.type)&&console.log("[RealtimeAudio] \uD83D\uDCE8 Incoming message type:",s.type),"session.created"===s.type&&(console.log("[RealtimeAudio] ✅ Session created with instructions embedded"),c.send(JSON.stringify({type:"conversation.item.create",item:{type:"message",role:"user",content:[{type:"input_text",text:"Hello, I am ready to start the interview."}]}})),console.log("[RealtimeAudio] \uD83D\uDCE4 Sent initial greeting to trigger AI welcome"),c.send(JSON.stringify({type:"response.create"})),console.log("[RealtimeAudio] ⏳ Requesting AI to generate and speak welcome message...")),"session.updated"===s.type&&console.log("[RealtimeAudio] ✅ Session updated"),"response.created"===s.type&&(console.log("[RealtimeAudio] ✅ Response created, AI will speak soon"),console.log("[RealtimeAudio] \uD83D\uDD34 BLOCKING USER INPUT - AI is speaking"),I.current.signalAISpeakingStart(),C.current=!0,T.current=!0,D.current=!0,o(!0),w.current="",console.log("[RealtimeAudio] \uD83D\uDCE4 AI starting to speak - User input will be blocked until response.done")),"response.text.delta"===s.type&&s.delta&&(w.current+=s.delta,console.log("[RealtimeAudio] \uD83D\uDCDD AI text delta:",s.delta,"Total:",w.current)),"response.content_part.created"===s.type&&console.log("[RealtimeAudio] Content part created:",s.content_part),"response.content_part.done"===s.type&&(console.log("[RealtimeAudio] Content part done, transcript:",w.current),console.log("[RealtimeAudio] onConversationRef.current exists?",!!m.current),w.current.trim()&&m.current)){let e=p(w.current);e.isValid?console.log("[RealtimeAudio] ✅ Guardrails validated"):console.warn("[RealtimeAudio] ⚠️ Guardrail violations detected:",e.violations),console.log("[RealtimeAudio] ✅ CALLING callback with AI message:",w.current.substring(0,100)),m.current({role:"ai",content:w.current,timestamp:new Date}),console.log("[RealtimeAudio] ✅ Callback invoked successfully"),w.current=""}if("response.done"===s.type&&(console.log("[RealtimeAudio] ===== RESPONSE.DONE EVENT ====="),console.log("[RealtimeAudio] Full response.done message:",JSON.stringify(s,null,2)),I.current.signalAISpeakingEnd(),setTimeout(()=>{if(console.log("[RealtimeAudio] \uD83D\uDFE2 AI FINISHED SPEAKING - User can now speak"),C.current=!1,T.current=!1,D.current=!1,o(!1),w.current.trim()&&m.current&&(console.log("[RealtimeAudio] ✅ CALLING callback with COMPLETE AI message:",w.current.substring(0,100)),m.current({role:"ai",content:w.current,timestamp:new Date}),console.log("[RealtimeAudio] ✅ Callback invoked from response.done with complete message"),w.current=""),s.response&&s.response.output){console.log("[RealtimeAudio] ✅ Response has output array with",s.response.output.length,"items");for(let e=0;e<s.response.output.length;e++){let t=s.response.output[e];if(console.log("[RealtimeAudio] Output item ".concat(e,":"),JSON.stringify(t,null,2)),"message"===t.type&&t.content){let e="assistant"===t.role?"ai":t.role;for(let n of t.content)"output_audio"===n.type&&n.transcript?(console.log("[RealtimeAudio] \uD83D\uDCDD Found transcript in output_audio:",n.transcript,"from role:",e),"user"===e&&m.current&&m.current({role:e,content:n.transcript,timestamp:new Date})):"input_audio"===n.type&&n.transcript?(console.log("[RealtimeAudio] \uD83D\uDCDD Found transcript in input_audio:",n.transcript),m.current&&m.current({role:"user",content:n.transcript,timestamp:new Date})):"input_text"===n.type&&n.text?(console.log("[RealtimeAudio] \uD83D\uDCDD Found input_text:",n.text),m.current&&m.current({role:"user",content:n.text,timestamp:new Date})):"text"===n.type&&n.text&&(console.log("[RealtimeAudio] \uD83D\uDCDD Found text in response output:",n.text),"assistant"!==t.role&&m.current&&m.current({role:e,content:n.text,timestamp:new Date}))}}}},1200)),"response.output_audio.delta"===s.type&&s.delta)try{let e=atob(s.delta),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);h.current.push(t)}catch(e){console.error("[RealtimeAudio] Failed to decode audio delta:",e)}if("response.output_audio.done"===s.type&&(console.log("[RealtimeAudio] Audio output done, playing..."),h.current.length>0&&(q(),h.current=[])),"conversation.item.created"===s.type){if(console.log("[RealtimeAudio] \uD83D\uDCEC conversation.item.created event:"),console.log("[RealtimeAudio] - Full item:",JSON.stringify(s.item,null,2)),console.log("[RealtimeAudio] - Item role:",null===(t=s.item)||void 0===t?void 0:t.role),console.log("[RealtimeAudio] - Item content:",null===(n=s.item)||void 0===n?void 0:n.content),s.item&&"user"===s.item.role){console.log("[RealtimeAudio] \uD83D\uDC64 USER MESSAGE DETECTED");let e=s.item.content&&s.item.content[0];console.log("[RealtimeAudio] - User content structure:",JSON.stringify(e,null,2));let t=null;if(e&&"input_text"===e.type&&e.text?(t=e.text,console.log("[RealtimeAudio] Found input_text:",t)):e&&"input_audio"===e.type&&e.transcript&&(t=e.transcript,console.log("[RealtimeAudio] Found audio transcript:",t)),t){let e=t.toLowerCase();(e.includes("speak")||e.includes("language")||e.includes("espa\xf1ol")||e.includes("switch"))&&(j.current=!0,console.log("[RealtimeAudio] \uD83C\uDF10 Language switch requested by candidate")),console.log("[RealtimeAudio] ✅ CALLING callback with user message:",t.substring(0,100)),m.current?(m.current({role:"user",content:t,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked")):console.warn("[RealtimeAudio] ⚠️ onConversationRef.current is null!")}else console.warn("[RealtimeAudio] ⚠️ Could not find user text in:",e)}if(s.item&&"assistant"===s.item.role){console.log("[RealtimeAudio] \uD83E\uDD16 ASSISTANT MESSAGE DETECTED");let e=s.item.content&&s.item.content[0];console.log("[RealtimeAudio] - Content structure:",JSON.stringify(e,null,2)),e&&"output_audio"===e.type&&e.transcript?(console.log("[RealtimeAudio] ✅ CALLING callback with AI message (from transcript):",e.transcript.substring(0,100)),m.current&&(m.current({role:"ai",content:e.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ AI message callback invoked"))):e&&"text"===e.type&&e.text?(console.log("[RealtimeAudio] ✅ CALLING callback with AI message (from text):",e.text.substring(0,100)),m.current&&(m.current({role:"ai",content:e.text,timestamp:new Date}),console.log("[RealtimeAudio] ✅ AI message callback invoked"))):console.warn("[RealtimeAudio] ⚠️ No text content found in assistant message")}}if("conversation.item.added"===s.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: conversation.item.added FULL STRUCTURE:"),console.log("[RealtimeAudio] Full message:",JSON.stringify(s,null,2)),s.item&&console.log("[RealtimeAudio] - Has msg.item:",s.item.role),s.delta&&console.log("[RealtimeAudio] - Has msg.delta:",s.delta),s.previous_item_id&&console.log("[RealtimeAudio] - Has previous_item_id:",s.previous_item_id)),"conversation.item.done"===s.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: conversation.item.done FULL STRUCTURE:"),console.log("[RealtimeAudio] Full message:",JSON.stringify(s,null,2)),s.item&&"user"===s.item.role&&(console.log("[RealtimeAudio] \uD83C\uDFA4 USER ITEM FOUND in conversation.item.done"),console.log("[RealtimeAudio] Item content:",JSON.stringify(s.item.content,null,2)),s.item.content&&s.item.content.length>0)))for(let e of s.item.content)"input_audio"===e.type&&e.transcript&&(console.log("[RealtimeAudio] ✅ FOUND USER TRANSCRIPT:",e.transcript),m.current&&(m.current({role:"user",content:e.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked from conversation.item.done")));if("response.content_part.added"===s.type&&console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: response.content_part.added (AI output):",JSON.stringify(s,null,2)),"response.content_part.done"===s.type&&console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: response.content_part.done (AI output) - DO NOT USE FOR USER MESSAGES"),"input_audio_transcript.delta"===s.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: input_audio_transcript.delta:",JSON.stringify(s,null,2)),s.delta&&console.log("[RealtimeAudio] \uD83C\uDFA4 USER TRANSCRIPT DELTA:",s.delta)),"input_audio_transcript.done"===s.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: input_audio_transcript.done:",JSON.stringify(s,null,2)),s.transcript&&s.transcript.trim()&&(console.log("[RealtimeAudio] \uD83C\uDFA4 USER TRANSCRIPT (FINAL):",s.transcript),m.current&&(m.current({role:"user",content:s.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked from input_audio_transcript")))),"input_audio_buffer.speech_started"===s.type&&console.log("[RealtimeAudio] \uD83C\uDFA4 CANDIDATE SPEAKING STARTED - listening for audio"),"input_audio_buffer.speech_stopped"===s.type){console.log("[RealtimeAudio] \uD83E\uDD10 CANDIDATE SPEAKING STOPPED");let e=L.current,t=P.current;console.log("[RealtimeAudio] \uD83D\uDCCA Audio stats: ".concat(t," chunks, ").concat(e.toFixed(0),"ms")),e>=100&&t>0?(console.log("[RealtimeAudio] ✅ Committing ".concat(t," chunks (").concat(e.toFixed(0),"ms of audio)")),c.send(JSON.stringify({type:"input_audio_buffer.commit"})),console.log("[RealtimeAudio] \uD83D\uDCE4 Audio buffer committed - AI will process and respond automatically"),P.current=0):console.log("[RealtimeAudio] ⏭️ Insufficient audio (".concat(e.toFixed(0),"ms, need 100ms+) or no chunks sent")),L.current=0}"input_audio_buffer.committed"===s.type&&(console.log("[RealtimeAudio] ✅ AUDIO BUFFER COMMITTED - waiting for AI response"),P.current=0,L.current=0),"error"===s.type&&(console.error("[RealtimeAudio] Error from OpenAI:",s.error),a((null===(i=s.error)||void 0===i?void 0:i.message)||"OpenAI error"))}catch(e){console.error("[RealtimeAudio] Failed to parse message:",e)}},c.onerror=e=>{console.error("[RealtimeAudio] WebSocket error:",e),a("WebSocket connection error"),s(Error("WebSocket error"))},c.onclose=t=>{console.log("[RealtimeAudio] WebSocket closed: ".concat(t.code," ").concat(t.reason)),!e&&A.current<3?(A.current++,console.log("[RealtimeAudio] Attempting reconnect ".concat(A.current,"/").concat(3,"...")),setTimeout(()=>{M(n,i).catch(e=>{console.error("[RealtimeAudio] Reconnect failed:",e)})},1e3)):A.current>=3&&s(Error("Failed to connect after ".concat(3," attempts")))}}),await U(c),t(!0),console.log("[RealtimeAudio] ✅ Fully connected and ready")}catch(e){throw console.error("[RealtimeAudio] Connection failed:",e),a((null==e?void 0:e.message)||"Connection failed"),t(!1),e}},[]),U=async e=>{if(S.current){console.log("[RealtimeAudio] Audio already setup");return}try{console.log("[RealtimeAudio] Setting up audio capture...");let t=new(window.AudioContext||window.webkitAudioContext);l.current=t;let n=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1},sampleRate:{ideal:16e3}}});c.current=n,console.log("[RealtimeAudio] ✅ Microphone permission granted with noise suppression enabled");try{await t.audioWorklet.addModule("/worklet/realtime-audio-worklet.js")}catch(o){console.error("[RealtimeAudio] Failed to load worklet, using fallback:",o),E.current=new b(4096),console.log("[RealtimeAudio] ✅ Noise suppression processor initialized");let e=new Blob(["\n          class RealtimeAudioWorklet extends AudioWorkletProcessor {\n            constructor() {\n              super()\n              this.port.onmessage = (e) => {\n                if (e.data.type === 'start') {\n                  this.isRecording = true\n                  this.calibrationStart = 0\n                  this.noiseProfileSet = false\n                  console.log('[Worklet] Recording started')\n                } else if (e.data.type === 'stop') {\n                  this.isRecording = false\n                  console.log('[Worklet] Recording stopped')\n                }\n              }\n              this.isRecording = false\n              this.noiseGateThreshold = 0.02\n              this.bufferSize = 0\n              this.calibrationStart = 0\n              this.noiseProfileSet = false\n              this.calibrationDuration = 2000\n              this.audioFrames = 0\n            }\n            \n            process(inputs, outputs, parameters) {\n              if (!this.isRecording) return true\n              \n              const input = inputs[0]\n              if (input && input.length > 0) {\n                const audioData = input[0]\n                \n                // Track calibration\n                if (!this.noiseProfileSet) {\n                  const now = Date.now()\n                  if (!this.calibrationStart) {\n                    this.calibrationStart = now\n                    this.port.postMessage({\n                      type: 'calibration',\n                      progress: 0,\n                      message: 'Starting noise profile calibration...'\n                    })\n                  }\n                  \n                  const elapsed = now - this.calibrationStart\n                  const progress = Math.min(100, (elapsed / this.calibrationDuration) * 100)\n                  \n                  if (progress % 25 < 1) { // Update every 25%\n                    this.port.postMessage({\n                      type: 'calibration',\n                      progress: Math.round(progress),\n                      message: `Calibrating noise profile: ${Math.round(progress)}%`\n                    })\n                  }\n                  \n                  if (elapsed >= this.calibrationDuration) {\n                    this.noiseProfileSet = true\n                    this.port.postMessage({\n                      type: 'calibration_complete',\n                      message: 'Noise profile calibrated!'\n                    })\n                  }\n                }\n                \n                // Process audio with noise suppression\n                let processedAudio = audioData\n                \n                // Apply high-pass filter to remove rumble\n                const filtered = new Float32Array(audioData.length)\n                let prev = 0\n                for (let i = 0; i < audioData.length; i++) {\n                  filtered[i] = 0.99 * (prev + audioData[i] - (audioData[i > 0 ? i - 1 : 0]))\n                  prev = filtered[i]\n                }\n                processedAudio = filtered\n                \n                // Apply noise suppression gating\n                const gatedAudio = new Float32Array(processedAudio.length)\n                let rms = 0\n                for (let i = 0; i < processedAudio.length; i++) {\n                  rms += processedAudio[i] * processedAudio[i]\n                }\n                rms = Math.sqrt(rms / processedAudio.length)\n                \n                const hasVoice = rms > this.noiseGateThreshold\n                const gateAmount = hasVoice ? 1.0 : 0.1\n                \n                for (let i = 0; i < processedAudio.length; i++) {\n                  gatedAudio[i] = processedAudio[i] * gateAmount\n                }\n                \n                // Send processed audio\n                if (hasVoice || this.bufferSize < 5) {\n                  this.port.postMessage({\n                    type: 'audio',\n                    audio: gatedAudio,\n                    hasVoice: hasVoice\n                  })\n                  this.bufferSize = 0\n                }\n                \n                this.bufferSize++\n              }\n              return true\n            }\n          }\n          \n          registerProcessor('realtime-audio-worklet', RealtimeAudioWorklet)\n        "],{type:"application/javascript"}),n=URL.createObjectURL(e);await t.audioWorklet.addModule(n),URL.revokeObjectURL(n)}let o=new AudioWorkletNode(t,"realtime-audio-worklet");u.current=o,o.port.onmessage=t=>{if("calibration"===t.data.type&&console.log("[RealtimeAudio] \uD83C\uDF99️ Calibration:",t.data.message),"calibration_complete"===t.data.type&&(console.log("[RealtimeAudio] ✅ Calibration complete:",t.data.message),R.current=!0),"audio"===t.data.type&&e.readyState===WebSocket.OPEN){if(C.current){console.log("[RealtimeAudio] \uD83D\uDD34 User audio blocked - AI is currently speaking");return}let n=t.data.audio;k.current||(k.current=new x({aggressiveness:2,enableBandpassFilter:!0,enableSpectralSubtraction:!0,enableAdaptiveNoise:!0}),console.log("[RealtimeAudio] ✅ Background noise suppression layer initialized")),!R.current&&(k.current.calibrateFromSilence(n),k.current.getCalibrationStatus().isCalibrated&&(R.current=!0,console.log("[RealtimeAudio] ✅ Noise profile calibration complete")));let{audio:o,metrics:i}=k.current.processAudio(n);if(n=o,O.current=i.isVoiceDetected,i.isVoiceDetected&&(F.current=Date.now()),Date.now()%1e3<50&&i.isVoiceDetected&&console.log("[RealtimeAudio] \uD83C\uDF99️ Voice detected - SNR:",i.snr.toFixed(1),"dB, Noise reduction:",i.noiseReductionDb.toFixed(1),"dB"),E.current){let{audio:e,metrics:t}=E.current.processAudio(n);n=e,Date.now()%1e3<50&&console.log("[RealtimeAudio] \uD83D\uDCCA Audio Quality:",{SNR:t.snr.toFixed(2),Volume:t.volume.toFixed(2),NoiseLevel:t.noiseLevel.toFixed(2),IsSpeech:t.isSpeech,IsClipping:t.isClipping})}n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,n=0;for(let t=0;t<e.length;t++)n+=e[t]*e[t];let o=Math.sqrt(n/e.length);if(o<1e-5)return e;let i=t/o,s=new Float32Array(e.length);for(let t=0;t<e.length;t++)s[t]=Math.max(-1,Math.min(1,e[t]*i));return s}(n);let s=new Int16Array(n.length);for(let e=0;e<n.length;e++){let t=Math.max(-1,Math.min(1,n[e]));s[e]=t<0?32768*t:32767*t}let a=new Uint8Array(s.buffer),r="";for(let e=0;e<a.byteLength;e++)r+=String.fromCharCode(a[e]);let l=btoa(r);if(C.current)Date.now()%5e3<50&&console.log("[RealtimeAudio] \uD83D\uDD07 BLOCKING user audio - AI is currently speaking");else{e.send(JSON.stringify({type:"input_audio_buffer.append",audio:l})),P.current++;let t=n.length/24e3*1e3;L.current+=t}}},t.createMediaStreamSource(n).connect(o),o.connect(t.destination),o.port.postMessage({type:"start"}),S.current=!0,console.log("[RealtimeAudio] ✅ Audio setup complete")}catch(e){throw console.error("[RealtimeAudio] Audio setup failed:",e),Error("Audio setup failed: ".concat(e))}},G=(0,i.useCallback)(async()=>{if(console.log("[RealtimeAudio] \uD83D\uDED1 HARD DISCONNECT - Closing all connections NOW"),r.current){try{console.log("[RealtimeAudio] Force closing WebSocket"),r.current.onopen=null,r.current.onmessage=null,r.current.onerror=null,r.current.onclose=null,(r.current.readyState===WebSocket.OPEN||r.current.readyState===WebSocket.CONNECTING)&&r.current.close(1e3,"Client closing")}catch(e){console.error("[RealtimeAudio] Error force closing WebSocket:",e)}r.current=null}try{u.current&&(u.current.port.postMessage({type:"stop"}),u.current=null),c.current&&(c.current.getTracks().forEach(e=>{try{e.stop()}catch(e){}}),c.current=null),l.current&&"closed"!==l.current.state&&(await l.current.close(),l.current=null),d.current&&(d.current.pause(),d.current.src="")}catch(e){console.error("[RealtimeAudio] Error during cleanup:",e)}D.current=!1,t(!1),o(!1),S.current=!1,h.current=[],w.current="",console.log("[RealtimeAudio] ✅ HARD DISCONNECT Complete")},[]),q=()=>{try{if(0===h.current.length){console.log("[RealtimeAudio] No audio data to play");return}let e=h.current.reduce((e,t)=>e+t.length,0),t=new Uint8Array(e),n=0;for(let e of h.current)t.set(e,n),n+=e.length;console.log("[RealtimeAudio] Playing audio, total bytes:",e);let o=new ArrayBuffer(44),i=new DataView(o);i.setUint32(0,1179011410,!0),i.setUint32(4,36+t.length,!0),i.setUint32(8,1163280727,!0),i.setUint32(12,544501094,!0),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,24e3,!0),i.setUint32(28,48e3,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),i.setUint32(36,1635017060,!0),i.setUint32(40,t.length,!0);let s=new Uint8Array(o.byteLength+t.length);s.set(new Uint8Array(o),0),s.set(t,o.byteLength);let a=new Blob([s],{type:"audio/wav"}),r=URL.createObjectURL(a);d.current||(d.current=new Audio);let l=d.current;l.src=r,l.volume=1,l.onended=()=>{console.log("[RealtimeAudio] ✅ Audio finished playing"),URL.revokeObjectURL(r)},l.onerror=e=>{console.error("[RealtimeAudio] Audio error:",l.error,e)};let c=l.play();void 0!==c&&c.catch(e=>{console.error("[RealtimeAudio] Failed to play audio:",e)})}catch(e){console.error("[RealtimeAudio] Failed to play audio:",e)}};return{connected:e,isListening:n,error:s,connect:M,disconnect:G}}();(0,i.useEffect)(()=>{if(E){console.log("⏳ Waiting for auth context...");return}let n=null==t?void 0:t.get("applicantId"),o=null==t?void 0:t.get("jobId"),i=null==t?void 0:t.get("type"),s=!!i;if(Z(s),console.log("[InterviewPage] Query params:",{applicantIdParam:n,jobIdParam:o,typeParam:i,isPracticeMode:s}),console.log("[InterviewPage] Interview type:",s?"\uD83D\uDCDD PRACTICE (2-min limit)":"\uD83C\uDFAF REAL JOB INTERVIEW"),n||o||i)console.log("✅ Candidate interview (no auth required)",{applicantIdParam:n,jobIdParam:o,typeParam:i}),n&&_(n),o&&(B(o),console.log("[InterviewPage] Job ID set to:",o));else if(c&&A)console.log("✅ User authenticated:",c.email),n&&_(n),o&&B(o);else{console.warn("❌ Not authenticated - redirecting to login"),e.push("/auth/login");return}if(i){let e=sessionStorage.getItem("selectedPracticeType");if(e)try{let t=JSON.parse(e);console.log("✅ Loaded practice type:",t),ed({title:t.title,systemPrompt:t.systemPrompt,skills:t.skills.map(e=>({name:e,reason:"Essential for ".concat(t.title),importance:"high"}))}),sessionStorage.removeItem("selectedPracticeType")}catch(e){console.error("Failed to parse practice type:",e)}}let a=localStorage.getItem("applicantData");if(a)try{let e=JSON.parse(a);W(e),localStorage.removeItem("applicantData")}catch(e){console.error("Failed to load applicant data:",e)}let r=localStorage.getItem("interviewData");if(r)try{ed(JSON.parse(r)),localStorage.removeItem("interviewData")}catch(e){console.error("Failed to load interview data:",e)}o&&!r&&(console.log("Loading job info from database for jobId:",o),eG(o)),I(!0),eM()},[E,c,A,t,e]);let eM=async()=>{try{let e=await navigator.permissions.query({name:"microphone"}),t=await navigator.permissions.query({name:"camera"});L("granted"===e.state),U("granted"===t.state)}catch(e){console.log("Permission check not supported, will prompt on access")}},eU=async e=>{e.preventDefault(),eD(!0),ek(null);try{if(!eS.name.trim())throw Error("Name is required");if(!eS.email.trim())throw Error("Email is required");if(!eS.phone.trim())throw Error("Phone number is required");if(!eS.position.trim())throw Error("Position applying for is required");console.log("[Interview Form] \uD83D\uDCCB Form validation passed"),console.log("[Interview Form] Candidate info:",{name:eS.name,email:eS.email,phone:eS.phone,position:eS.position,jobId:V,hasResume:!!eS.resumeFile});let e=new FormData;e.append("name",eS.name),e.append("email",eS.email),e.append("phone",eS.phone),e.append("position",eS.position),e.append("jobId",V||""),eS.resumeFile&&e.append("resume",eS.resumeFile),console.log("[Interview Form] \uD83D\uDE80 Submitting to /api/candidate-intake...");let t=await fetch("/api/candidate-intake",{method:"POST",body:e});if(console.log("[Interview Form] \uD83D\uDCE1 API Response status:",t.status),console.log("[Interview Form] API Response ok:",t.ok),!t.ok){let e=await t.json();throw console.error("[Interview Form] ❌ API Error:",e),Error(e.error||"Failed to save candidate information")}let n=await t.json();console.log("[Interview Form] ✅ Success! Candidate saved:",n),ew(!0)}catch(e){console.error("[Interview Form] ❌ Error:",e.message),ek(e.message||"Failed to save information")}finally{eD(!1)}},eG=async e=>{try{console.log("[Page] Loading job info for jobId:",e);let t=new AbortController,n=setTimeout(()=>t.abort(),5e3),o=await fetch("/api/jobs/".concat(e),{signal:t.signal});if(clearTimeout(n),o.ok){let t=await o.json();console.log("[Page] Job loaded:",t);let n=(Array.isArray(t.required_skills)?t.required_skills:t.skills||[]).map(e=>({name:"string"==typeof e?e:e.name||e,reason:"Required for ".concat(t.title),importance:"high"}));ed({title:t.title||"Technical Interview",client:t.company||"Unknown",hiringFor:t.position||t.title,jobId:e,description:t.description||"",jobDescription:t.description||"",skills:n,systemPrompt:function(e,t,n,o){let i=n.map(e=>"• ".concat(e.name)).join("\n");return'You are a professional technical job interviewer conducting a formal interview in English.\n\n\uD83D\uDD12 LANGUAGE POLICY (CRITICAL - MUST FOLLOW):\n- SPEAK ONLY ENGLISH - Every single response must be in English, no exceptions\n- START IN ENGLISH - Greet in English: "Hello, thank you for joining me today..."\n- NEVER USE OTHER LANGUAGES - No Spanish, French, German, or any other language\n\nPOSITION DETAILS:\n- Job Title: '.concat(e,"\n- Company: ").concat(o,"\n- Job Description:\n").concat(t,"\n\nCRITICAL - FIRST RESPONSE PROTOCOL:\n\uD83C\uDFAF YOUR FIRST RESPONSE MUST BE:\n\"Welcome to your technical interview! I'm your interviewer for the ").concat(e," position at ").concat(o,". This interview is being recorded for evaluation. I'll be asking you questions to assess your technical skills and experience. If you're unsure about any question, just say 'skip' and we'll move to the next one.\n\nNow, let me start by asking you to introduce yourself. Could you please share your name, your current role or position, your years of professional experience, and a brief overview of your key accomplishments relevant to this ").concat(e,' position?"\n\n⚠️ IMPORTANT: This welcome must be your FIRST response. Don\'t ask it in a separate turn - include it as part of your introduction in one cohesive response.\n\nCORE DIRECTIVES:\n1. ENGLISH LANGUAGE ONLY - Respond ONLY in English. This is not negotiable.\n2. PROFESSIONAL TONE - no casual language, jokes, slang, or small talk\n3. ONE QUESTION AT A TIME - ask only one question per turn, wait for complete response\n4. TECHNICAL FOCUS - concentrate exclusively on job-related skills and experience\n5. NO PERSONAL QUESTIONS - never ask about age, gender, religion, location, family, or salary\n6. OPEN-ENDED QUESTIONS - avoid yes/no questions, encourage detailed explanations\n7. RESPECTFUL LISTENING - never interrupt the candidate\n8. REDIRECT IF OFF-TOPIC - if candidate goes off-topic, say "Let\'s keep our focus on the technical questions"\n\n\uD83E\uDDE0 ACKNOWLEDGE WHAT THE USER SAYS (HUMAN-LIKE BEHAVIOR):\n- ALWAYS acknowledge what the candidate said: "I see you said X...", "So you have experience with Y...", "That\'s helpful, thank you for sharing..."\n- NEVER pretend you didn\'t hear something when you clearly did\n- If user says "hello" or greets you, ACKNOWLEDGE it: "Hello! Nice to meet you. Let me ask you..." - don\'t ignore greetings\n- Show you\'re listening by referencing their specific words back to them\n- Validate their responses even when asking follow-up questions\n\nSHORT/INCOMPLETE ANSWERS - If a candidate gives a very short answer (like "hello" or "yes"), recognize it as incomplete:\n- Example: If they just say "Hello" → "Hello! I appreciate the greeting. Now, could you tell me more about your background and experience?"\n- Example: If they only say "Yes" → "Good, I see you have that skill. Could you elaborate on your experience with it?"\n- Always connect simple greetings or one-word answers to the actual question you need answered\n\nVALIDATE COMPLETENESS - A proper introduction should include: name, current role/position, years of experience, key accomplishments, and relevant skills\n- BE CONVERSATIONAL - Use natural language like a real interviewer: "Tell me more...", "Can you elaborate on that?", "I\'d like to understand better...", "That\'s great, thanks for sharing that!"\n- RECOGNIZE INSUFFICIENT RESPONSES - Don\'t accept one-word answers or simple greetings as adequate responses to questions\n- PERSIST PROFESSIONALLY - If you need more information, gently re-ask: "Thanks for that! Could you also tell me about..."\n- REMEMBER AND REFERENCE - Keep track of what they said and reference it in follow-up questions\n\nREQUIRED SKILLS TO EVALUATE (High Priority):\n').concat(i,"\n\nSKILL ASSESSMENT STRATEGY:\n- For each required skill listed above, ask 2-3 targeted technical questions\n- Base questions on the job description and responsibilities\n- Probe for depth of understanding, not just familiarity\n- Ask for real-world examples of using each skill\n- Assess both theoretical knowledge and practical experience\n- Reference specific job requirements in your questions\n- Ask about specific responsibilities from the job description\n- Evaluate how the candidate's experience aligns with the exact needs of this position\n\nINTERVIEW PHASES:\n1. INTRODUCTION - Start with your welcome and introduction request (see FIRST RESPONSE PROTOCOL above)\n2. BACKGROUND - Ask about education, work experience, and current role relevant to this position. Always acknowledge what they say.\n3. TECHNICAL SKILLS - Deep dive into the required skills with practical questions related to the job description\n4. PROBLEM-SOLVING - Ask scenario-based questions relevant to the ").concat(e,' position\n5. CLOSING - Summarize discussion and ask if they have questions\n\nHUMAN INTERVIEWER TRAITS TO EMULATE:\n✓ Acknowledge everything the candidate says - show you\'re listening\n✓ Ask follow-up questions naturally when answers are too brief\n✓ Show genuine interest by asking for specific examples and details\n✓ Validate that answers meet your expectations before moving on\n✓ Use conversational language and transitions ("I see...", "That\'s helpful...", "Tell me more about...", "Got it, so you...")\n✓ Recognize when someone is being evasive or incomplete\n✓ Guide the conversation naturally, not robotic\n✓ Remember previous answers and reference them in later questions\n✓ Be patient but also persistent in getting the information you need\n✓ Don\'t ignore simple greetings - acknowledge them and transition to your question\n\nPROHIBITED BEHAVIORS:\n❌ Speaking in any language other than English\n❌ Asking personal or demographic questions\n❌ Making jokes or using casual language\n❌ Asking multiple questions in one turn\n❌ Interrupting the candidate\n❌ Going off-topic\n❌ Making assumptions about the candidate\n❌ Expressing personal opinions\n❌ Discussing salary before appropriate stage\n❌ Accepting incomplete answers without follow-up\n❌ Ignoring simple greetings like "hello" - always acknowledge them\n❌ Moving on too quickly when you haven\'t gotten enough information\n❌ Pretending you didn\'t hear something when you clearly did\n\nREMEMBER:\nYou are ONLY a technical job interviewer for this specific ').concat(e," position. Your role is to fairly assess the candidate's qualifications based on the job description and required skills. Be respectful, professional, and focused on job-related competencies. Most importantly, act like a human interviewer - acknowledge what people say to you, especially simple greetings and responses. When someone greets you or gives a short answer, integrate that into your question naturally. Don't ignore inputs - acknowledge them and build on them conversationally.")}(t.title,t.description,n,t.company)})}else console.warn("[Page] Failed to load job info, status:",o.status),ed({title:"Technical Interview",jobId:e})}catch(t){console.error("[Page] Error loading job info:",t),ed({title:"Technical Interview",jobId:e})}},eq=async()=>{try{F(null),console.log("\uD83D\uDCE2 Requesting microphone permission with noise suppression...");let e=(await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1},sampleRate:{ideal:16e3}}})).getAudioTracks();return e.length>0&&console.log("✅ Microphone granted - Noise suppression:",e[0].getSettings().noiseSuppression),e.forEach(e=>e.stop()),L(!0),console.log("\uD83D\uDCF7 Requesting camera permission..."),(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks().forEach(e=>e.stop()),U(!0),!0}catch(t){let e="Failed to access camera or microphone.";return"NotAllowedError"===t.name?e="You denied camera/microphone access. Please allow access in your browser settings to start the interview.":"NotFoundError"===t.name&&(e="No camera or microphone found on your device. Please check your hardware."),console.error("❌ Permission error:",t),F(e),!1}};(0,i.useEffect)(()=>{if(!R)return;let e=setInterval(()=>{try{if(!navigator.mediaDevices)return;navigator.mediaDevices.enumerateDevices().then(e=>{let t=e.some(e=>"audioinput"===e.kind),n=e.some(e=>"videoinput"===e.kind);!t&&ei?(q("Microphone disconnected! Please reconnect."),es(!1)):t&&(null==G?void 0:G.includes("Microphone"))&&q(null),!n&&ea?(q("Camera disconnected! Please reconnect."),er(!1)):n&&(null==G?void 0:G.includes("Camera"))&&q(null)})}catch(e){console.error("Device check error:",e)}},2e3);return()=>clearInterval(e)},[R,ei,ea,G]),(0,i.useEffect)(()=>{if(!ea||!R){el&&(el.getTracks().forEach(e=>e.stop()),ec(null)),eI.current&&(eI.current.srcObject=null);return}return(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});ec(e),eI.current&&(eI.current.srcObject=e,console.log("[Page] Camera stream set to video element")),q(null)}catch(e){console.error("Camera error:",e),q("Failed to access camera. Please check permissions.")}})(),()=>{el&&(el.getTracks().forEach(e=>e.stop()),ec(null)),eI.current&&(eI.current.srcObject=null)}},[ea,R]),(0,i.useEffect)(()=>{if(!R)return;let e=setInterval(()=>{Y(e=>{let t=e+1;return t>=Q?(console.log("[Timer] ⏱️ 10-MINUTE INTERVIEW TIME LIMIT REACHED! Auto-ending interview..."),C(!1),F("Interview time limit reached (10 minutes max). Your interview has been ended."),setTimeout(()=>{var e;null===(e=document.getElementById("end-interview-btn"))||void 0===e||e.click()},500)):(t===Q-60&&(console.log("[Timer] \uD83D\uDD14 1 MINUTE REMAINING! Interview will end soon!"),$(!0)),t===Q-300&&console.log("[Timer] \uD83D\uDD14 5 MINUTES REMAINING in your interview")),t})},1e3);return()=>clearInterval(e)},[R,Q]);let eH=async()=>{try{var e;if(null==A?void 0:null===(e=A.user)||void 0===e?void 0:e.id){console.log("[Page] Checking interview limit...");let e=await fetch("/api/check-interview-limit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:A.user.id})}),t=await e.json();if(console.log("[Page] Interview limit check:",t),!t.canContinue){console.log("[Page] Interview limit reached, showing paywall"),ep({currentPlan:t.planName,remainingInterviews:t.remainingInterviews,message:t.message}),em(!0);return}}else console.log("[Page] No authenticated user, skipping interview limit check (applicant flow)");if(!await eq())return;console.log("[Page] Starting interview..."),console.log("[Page] Interview data:",eu),C(!0),Y(0),await eP(e=>{console.log("[Page] \uD83C\uDFAF Received conversation message:",e.role,e.content),"ai"===e.role?(ey(!0),console.log("[Page] \uD83D\uDD34 AI started speaking - blocking user input")):"user"===e.role&&(ey(!1),console.log("[Page] \uD83D\uDFE2 User speaking - AI finished")),eC(e.role,e.content),console.log("[Page] \uD83D\uDCCB Message added to conversation manager"),e.role,e.role},(null==eu?void 0:eu.skills)||[],null==eu?void 0:eu.systemPrompt),console.log("[Page] Connected! Starting interview.")}catch(e){console.error("[Page] Failed to start:",e),C(!1),F("Failed to start interview: "+e.message)}},e_=async()=>{try{var e,t;if(console.log("[Page] Ending interview..."),C(!1),eR&&eR.length>0){eb(!0);try{let e="interview-".concat(Date.now());await eT(e,H)?console.log("[Page] ✅ Conversation saved successfully"):console.warn("[Page] ⚠️ Conversation save failed, but continuing...")}catch(e){console.error("[Page] Error saving conversation:",e)}finally{eb(!1)}}try{await eL(),console.log("[Page] Disconnected from AI")}catch(e){console.warn("[Page] Warning during disconnect:",e)}el&&(el.getTracks().forEach(e=>e.stop()),ec(null));let n=(null==c?void 0:c.id)||(null==A?void 0:null===(e=A.user)||void 0===e?void 0:e.id);n||(n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),console.log("[Page] Generated anonymous user UUID:",n));let o=eR.filter(e=>"user"===e.role).length,i=Math.min(J/300*30,30),s={id:crypto.randomUUID(),user_id:n,applicant_id:H||null,job_id:V||null,interview_type:K?"practice":"real",title:(null==eu?void 0:eu.title)||"Technical Interview",position:(null==eu?void 0:eu.hiringFor)||(null==eu?void 0:eu.title)||"Interview",company:(null==eu?void 0:eu.client)||"Unknown",client:(null==eu?void 0:eu.client)||"Unknown",duration:J,status:"completed",score:Math.min(Math.round(i+Math.min(o/10*20,20)+50),100),timestamp:new Date().toISOString(),skills:(null==eu?void 0:eu.skills)||[],conversation:eR.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString()})),systemPrompt:(null==eu?void 0:eu.systemPrompt)||null,notes:"Duration: ".concat(J,"s, Messages: ").concat(eR.length,", Type: ").concat(K?"\uD83D\uDCDD Practice":"\uD83C\uDFAF Real",", Practice Type: ").concat(null==eu?void 0:eu.title)};console.log("[Page] Saving interview:",s),console.log("[Page] Interview type:",K?"\uD83D\uDCDD PRACTICE (Test Mode)":"\uD83C\uDFAF REAL JOB INTERVIEW");try{let e=await fetch("/api/interviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await e.json();if(e.ok){console.log("[Page] Interview saved successfully:",n.data);let e=(null===(t=n.data)||void 0===t?void 0:t.id)||s.id;console.log("[Page] Saved interview ID:",e),console.log("[Page] Analyzing interview with AI..."),console.log("[Page] Conversation to analyze:",JSON.stringify(eR,null,2)),console.log("[Page] Number of messages:",eR.length),console.log("[Page] Interview duration:",J,"seconds");try{if(eR&&0!==eR.length){let t=await fetch("/api/analyze-interview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation:eR,skills:s.skills,duration:J,applicantId:H,interviewId:e})}),n=await t.json();t.ok?(console.log("[Page] Interview analysis completed:",n.analysis),console.log("[Page] Final score:",n.analysis.overall)):(console.warn("[Page] Analysis validation failed:",n.message),console.warn("[Page] Analysis error:",n.error),console.warn("[Page] Status code:",t.status),console.warn("[Page] This interview did not meet minimum requirements for scoring"),n.minRequired&&void 0!==n.actual&&("Interview duration too short"===n.error?console.warn("[Page] Interview was only ".concat(n.actual,"s, minimum required: ").concat(n.minRequired,"s")):"Not enough candidate participation"===n.error?console.warn("[Page] Only ".concat(n.actual," candidate responses, minimum required: ").concat(n.minRequired)):"Candidate responses too brief"===n.error&&console.warn("[Page] Average response length: ".concat(n.actual," chars, minimum required: ").concat(n.minRequired))))}else console.warn("[Page] No conversation to analyze, skipping analysis")}catch(e){console.error("[Page] Analysis API call error:",e)}}else console.error("[Page] Failed to save interview - Status:",e.status),console.error("[Page] Error response:",JSON.stringify(n,null,2)),console.error("[Page] Error message:",n.error),console.error("[Page] Error code:",n.code),console.error("[Page] Full error:",n.fullError)}catch(e){console.error("[Page] API call error:",e)}if(H){let{error:e}=await S.OQ.from("job_applicants").update({status:"completed"}).eq("id",H);e?console.error("[Page] Failed to update applicant status:",e):console.log("[Page] Applicant status updated to completed")}Y(0),q(null),console.log("[Page] Interview ended, cleanup complete."),j(!0),F(null),console.log("[Page] Interview marked as completed")}catch(e){console.error("[Page] Error ending interview:",e),F("Interview ended. "+e.message),C(!1),j(!0)}};return!k||E?(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500 mx-auto mb-4"}),(0,o.jsx)("p",{className:"text-slate-600 font-semibold",children:k?"Verifying your authentication...":"Initializing interview..."})]})}):V&&!ev?(0,o.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,o.jsxs)("div",{className:"fixed inset-0 pointer-events-none opacity-30",children:[(0,o.jsx)("div",{className:"absolute top-0 right-0 w-[400px] h-[400px] bg-gradient-to-b from-blue-500/20 to-transparent rounded-full blur-3xl"}),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 w-[300px] h-[300px] bg-gradient-to-t from-blue-600/15 to-transparent rounded-full blur-3xl"})]}),(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 relative z-10",children:(0,o.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Join Interview"}),(0,o.jsx)("p",{className:"text-slate-600 mb-6",children:"Please provide your information to begin"}),(0,o.jsxs)("form",{onSubmit:eU,className:"space-y-4",children:[eE&&(0,o.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:eE}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Full Name *"}),(0,o.jsx)("input",{type:"text",value:eS.name,onChange:e=>eA({...eS,name:e.target.value}),placeholder:"John Doe",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Email Address *"}),(0,o.jsx)("input",{type:"email",value:eS.email,onChange:e=>eA({...eS,email:e.target.value}),placeholder:"john@example.com",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Phone Number *"}),(0,o.jsx)("input",{type:"tel",value:eS.phone,onChange:e=>eA({...eS,phone:e.target.value}),placeholder:"+1 (555) 000-0000",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Position Applying For *"}),(0,o.jsx)("input",{type:"text",value:eS.position,onChange:e=>eA({...eS,position:e.target.value}),placeholder:"e.g., Senior React Developer",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Resume (Optional)"}),(0,o.jsx)("input",{type:"file",accept:".pdf,.doc,.docx",onChange:e=>{var t;return eA({...eS,resumeFile:(null===(t=e.target.files)||void 0===t?void 0:t[0])||null})},className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600"}),(0,o.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"PDF, DOC, or DOCX format"})]}),(0,o.jsx)("button",{type:"submit",disabled:eN,className:"w-full mt-6 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-semibold hover:shadow-lg hover:shadow-blue-400/30 transition-all disabled:opacity-50",children:eN?"Saving...":"Start Interview"})]})]})})]}):(0,o.jsxs)("div",{className:"min-h-screen bg-white text-slate-900 overflow-hidden flex flex-col",children:[(0,o.jsxs)("div",{className:"fixed inset-0 pointer-events-none",children:[(0,o.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white via-[#f8fefb] to-[#f0fdf4]"}),(0,o.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-gradient-to-b from-[#d4f1f5]/50 via-[#e6f7f5]/40 to-transparent rounded-full blur-3xl opacity-60"}),(0,o.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-gradient-to-b from-white/80 via-[#f0f9fa]/60 to-transparent rounded-full blur-3xl opacity-50"}),(0,o.jsx)("div",{className:"absolute top-10 right-0 w-[600px] h-[600px] bg-gradient-to-bl from-[#e6fdf4]/45 via-[#f0fdf4]/25 to-transparent rounded-full blur-3xl opacity-50"}),(0,o.jsx)("div",{className:"absolute bottom-0 -left-20 w-[500px] h-[500px] bg-gradient-to-tr from-[#d4f1f5]/35 to-transparent rounded-full blur-3xl opacity-40"}),(0,o.jsx)("div",{className:"absolute top-1/2 -right-20 w-[600px] h-[600px] bg-gradient-to-l from-white/60 to-transparent rounded-full blur-3xl opacity-50"})]}),(0,o.jsx)("nav",{className:"fixed top-0 left-0 right-0 z-50 border-b border-[#11cd68]/15 bg-white/80 backdrop-blur-xl",children:(0,o.jsxs)("div",{className:"mx-auto px-4 md:px-6 lg:px-8 py-3 flex justify-between items-center relative z-10",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#007a78] to-[#11cd68] flex items-center justify-center text-white font-bold text-sm",children:"X"}),(0,o.jsx)("span",{className:"text-lg font-bold text-[#007a78]",children:"InterviewX"})]}),(0,o.jsx)("div",{className:"flex items-center gap-4",children:R&&(0,o.jsx)("div",{className:"text-xl font-bold text-[#007a78] font-mono px-3 py-1 bg-[#f0fdf4] rounded-lg border border-[#11cd68]/30 text-sm",children:"".concat(Math.floor(J/60),":").concat((J%60).toString().padStart(2,"0"))})})]})}),(0,o.jsxs)("div",{className:"relative z-10 flex-1 overflow-y-auto pt-16 pb-6 px-0 md:px-0",children:[(null==A?void 0:A.user)&&!R&&(0,o.jsx)("div",{className:"mx-auto max-w-6xl mb-6 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,o.jsxs)("p",{className:"text-green-800 font-semibold text-sm",children:["✅ Authenticated as: ",(0,o.jsx)("span",{className:"font-mono",children:A.user.email})]})}),R?(0,o.jsxs)("div",{className:"h-[calc(100vh-64px)] w-full flex flex-col lg:flex-row gap-4 p-3 md:p-4 lg:gap-0",children:[(0,o.jsx)("div",{className:"w-full lg:flex-1 flex flex-col gap-3 lg:gap-0",children:(0,o.jsxs)("div",{className:"flex-1 bg-slate-900 rounded-lg lg:rounded-none overflow-hidden flex items-center justify-center relative min-h-[300px] lg:min-h-full",children:[ea?(0,o.jsx)("video",{ref:eI,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}):(0,o.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,o.jsx)(h,{size:48,className:"text-slate-400"}),(0,o.jsx)("span",{className:"text-slate-400 text-sm",children:"Camera Off"})]}),(0,o.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-40 flex gap-2 md:gap-3 bg-white/95 backdrop-blur-md border border-slate-200 rounded-full px-3 md:px-4 py-2 md:py-3 shadow-lg hover:shadow-xl transition-shadow",children:[(0,o.jsx)("button",{onClick:()=>es(!ei),className:"w-10 md:w-12 h-10 md:h-12 rounded-full flex items-center justify-center transition-all flex-shrink-0 ".concat(ei?"bg-[#11cd68] text-white hover:bg-[#0a9f5d]":"bg-red-500 text-white hover:bg-red-600"),title:ei?"Mute":"Unmute",children:ei?(0,o.jsx)(l.Z,{size:18,className:"md:block"}):(0,o.jsx)(u,{size:18})}),(0,o.jsx)("button",{onClick:()=>er(!ea),className:"w-10 md:w-12 h-10 md:h-12 rounded-full flex items-center justify-center transition-all flex-shrink-0 ".concat(ea?"bg-[#11cd68] text-white hover:bg-[#0a9f5d]":"bg-red-500 text-white hover:bg-red-600"),title:ea?"Stop Camera":"Start Camera",children:ea?(0,o.jsx)(d,{size:18}):(0,o.jsx)(h,{size:18})}),(0,o.jsx)("div",{className:"w-px bg-slate-300 hidden md:block"}),(0,o.jsx)("button",{onClick:e_,className:"w-10 md:w-12 h-10 md:h-12 rounded-full flex items-center justify-center bg-red-600 text-white hover:bg-red-700 transition-all flex-shrink-0",title:"End Interview",children:(0,o.jsx)(m.Z,{size:18,style:{transform:"rotate(135deg)"}})})]})]})}),(0,o.jsxs)("div",{className:"hidden lg:flex lg:w-96 flex-col h-full overflow-hidden border-l border-slate-200 bg-white",children:[(0,o.jsx)(D,{messages:eR,isListening:eO,loading:ef}),(0,o.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-end p-4 bg-gradient-to-b from-slate-50 to-slate-100",children:[(0,o.jsxs)("div",{className:"relative w-24 h-24 md:w-28 md:h-28 flex items-center justify-center mb-3",children:[(0,o.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-blue-400 via-purple-400 to-cyan-400 opacity-20 blur-3xl animate-pulse"}),(0,o.jsxs)("div",{className:"relative w-16 md:w-20 h-16 md:h-20 rounded-full bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 shadow-2xl overflow-hidden",children:[(0,o.jsx)("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white to-transparent opacity-30 animate-spin",style:{animationDuration:"3s"}}),(0,o.jsx)("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-300 opacity-50 animate-pulse",style:{animationDuration:"1.5s"}}),(0,o.jsx)("div",{className:"absolute inset-2 rounded-full border border-purple-300 opacity-40 animate-ping",style:{animationDuration:"2s"}}),(0,o.jsx)("div",{className:"absolute top-2 left-3 w-3 h-3 bg-white rounded-full opacity-60 blur-sm"})]}),(0,o.jsx)("div",{className:"absolute w-1 h-1 bg-cyan-400 rounded-full top-2 left-8 animate-bounce",style:{animationDuration:"1.2s"}}),(0,o.jsx)("div",{className:"absolute w-1 h-1 bg-purple-400 rounded-full bottom-4 right-6 animate-bounce",style:{animationDuration:"1.5s",animationDelay:"0.3s"}}),(0,o.jsx)("div",{className:"absolute w-1 h-1 bg-pink-400 rounded-full top-8 right-4 animate-bounce",style:{animationDuration:"1.3s",animationDelay:"0.6s"}})]}),(0,o.jsx)("p",{className:"text-xs md:text-sm font-medium text-slate-600",children:"AI Agent"}),(0,o.jsx)("p",{className:"text-xs mt-1 font-medium ".concat(ex?"text-red-600 animate-pulse":eO?"text-green-600":ef?"text-blue-600":"text-slate-500"),children:ex?"\uD83D\uDD34 Please wait - AI is speaking...":eO?"\uD83C\uDFA4 Your turn - speak now!":ef?"Processing...":"Ready"})]})]}),(0,o.jsx)("div",{className:"lg:hidden w-full h-auto max-h-64 md:max-h-96 overflow-y-auto bg-white rounded-lg border border-slate-200",children:(0,o.jsx)(D,{messages:eR,isListening:eO,loading:ef})})]}):(0,o.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-[#007a78] mb-1",children:(null==eu?void 0:eu.title)?"Interview: ".concat(eu.title):"Technical Interview"}),(0,o.jsx)("p",{className:"text-sm text-slate-600",children:(null==eu?void 0:eu.hiringFor)?"Hiring for: ".concat(eu.hiringFor):(null==eu?void 0:eu.client)&&"Unknown"!==eu.client?"Hiring for: ".concat(eu.client):(null==eu?void 0:eu.skills)&&eu.skills.length>0?"Skills: ".concat(eu.skills.slice(0,3).map(e=>e.name).join(", ")):"Powered by OpenAI Realtime API"})]}),(null==eu?void 0:eu.skills)&&eu.skills.length>0&&(0,o.jsxs)("div",{className:"mb-4 p-4 bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl shadow-sm",children:[(0,o.jsx)("p",{className:"text-[#007a78] font-semibold text-sm mb-2",children:"Key Skills"}),(0,o.jsx)("div",{className:"flex flex-wrap gap-2",children:eu.skills.map((e,t)=>(0,o.jsx)("div",{className:"px-3 py-1 rounded-full bg-gradient-to-r from-[#11cd68]/10 to-[#007a78]/10 border border-[#11cd68]/30 text-[#007a78] font-semibold text-xs hover:shadow-md transition-all",children:e.name},t))})]}),eF&&(0,o.jsxs)("div",{className:"mx-auto max-w-6xl mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 text-sm",children:[(0,o.jsx)(a.Z,{className:"text-red-600 flex-shrink-0 mt-0.5",size:18}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-red-900 font-semibold",children:"Connection Error"}),(0,o.jsx)("p",{className:"text-red-700 text-xs",children:eF})]})]}),T?(0,o.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl p-8 shadow-sm text-center",children:[(0,o.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-[#11cd68] to-[#007a78] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg",children:(0,o.jsx)(r.Z,{className:"text-white",size:40})}),(0,o.jsx)("h2",{className:"text-3xl font-bold text-[#007a78] mb-3",children:"Thank You!"}),(0,o.jsx)("p",{className:"text-slate-600 text-base mb-6",children:"Your technical interview has been completed and recorded."}),(0,o.jsx)("p",{className:"text-slate-600 text-sm mb-8",children:"Our team will review your responses and get back to you soon with feedback."}),(0,o.jsxs)("div",{className:"bg-[#f0fdf4] border border-[#11cd68]/30 rounded-lg p-4 mb-6",children:[(0,o.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Interview responses saved"}),(0,o.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Analysis in progress"}),(0,o.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Feedback coming soon"})]}),(0,o.jsx)("p",{className:"text-slate-500 text-xs",children:"This interview session has ended. You cannot start a new interview in this session."})]}):(0,o.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl p-6 shadow-sm",children:[(0,o.jsxs)("div",{className:"text-center mb-6",children:[(0,o.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-[#007a78] to-[#11cd68] rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,o.jsx)(l.Z,{className:"text-white",size:32})}),(0,o.jsx)("h2",{className:"text-2xl font-bold text-[#007a78] mb-2",children:"Ready?"}),(0,o.jsx)("p",{className:"text-slate-600 text-sm",children:"Start your AI-powered technical interview."})]}),O&&(0,o.jsxs)("div",{className:"mb-4 p-4 bg-red-50 border border-red-300 rounded-lg flex items-start gap-3 text-sm",children:[(0,o.jsx)(a.Z,{className:"text-red-600 flex-shrink-0 mt-0.5",size:20}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("p",{className:"text-red-900 font-semibold mb-2",children:O}),"Not authenticated"===O&&(0,o.jsxs)("div",{className:"text-red-700 text-xs space-y-2",children:[(0,o.jsx)("p",{children:"You need to be logged in to start an interview."}),(0,o.jsx)("button",{onClick:()=>e.push("/auth/login"),className:"inline-block mt-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold transition-all",children:"Go to Login"})]}),"Not authenticated"!==O&&(0,o.jsx)("p",{className:"text-red-700",children:O})]})]}),(0,o.jsxs)("div",{className:"bg-[#f0fdf4] border border-[#11cd68]/30 rounded-lg p-4 mb-6 space-y-2 text-sm",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(P?"bg-[#11cd68]":"bg-slate-400")}),(0,o.jsxs)("span",{className:"text-slate-700",children:["Microphone: ",(0,o.jsx)("span",{className:"font-semibold",children:P?"Granted":"Not Granted"})]})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(M?"bg-[#11cd68]":"bg-slate-400")}),(0,o.jsxs)("span",{className:"text-slate-700",children:["Camera: ",(0,o.jsx)("span",{className:"font-semibold",children:M?"Granted":"Not Granted"})]})]})]}),G&&(0,o.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg flex items-start gap-2 text-sm",children:[(0,o.jsx)(a.Z,{className:"text-yellow-600 flex-shrink-0 mt-0.5",size:18}),(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-yellow-900 font-semibold",children:"Device Alert"}),(0,o.jsx)("p",{className:"text-yellow-800 text-xs",children:G})]})]}),(0,o.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-lg p-4 shadow-sm",children:[(0,o.jsxs)("div",{className:"flex gap-2 justify-center mb-4",children:[(0,o.jsx)("button",{onClick:()=>es(!ei),className:"p-2 rounded-lg transition-all ".concat(ei?"bg-[#11cd68]/20 text-[#007a78] border border-[#11cd68]/50":"bg-red-50 text-red-600 border border-red-200"),title:ei?"Mute":"Unmute",children:ei?(0,o.jsx)(l.Z,{size:20}):(0,o.jsx)(u,{size:20})}),(0,o.jsx)("button",{onClick:()=>er(!ea),className:"p-2 rounded-lg transition-all ".concat(ea?"bg-[#11cd68]/20 text-[#007a78] border border-[#11cd68]/50":"bg-red-50 text-red-600 border border-red-200"),title:ea?"Stop Camera":"Start Camera",children:ea?(0,o.jsx)(d,{size:20}):(0,o.jsx)(h,{size:20})})]}),(0,o.jsx)("button",{onClick:eH,disabled:null!==O,className:"w-full py-2 px-4 rounded-lg font-semibold text-white transition-all text-sm ".concat(null!==O?"bg-slate-400 cursor-not-allowed":"bg-gradient-to-r from-[#007a78] to-[#0a9f5d] hover:shadow-lg active:scale-95"),children:"Start Interview"})]})]})]})]}),eh&&(0,o.jsx)(N,{userId:null==c?void 0:c.id,onClose:()=>em(!1),remainingInterviews:eg.remainingInterviews,currentPlan:eg.currentPlan})]})}function k(){return(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:(0,o.jsx)("p",{style:{color:"white"},children:"Loading..."})}),children:(0,o.jsx)(E,{})})}},1233:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return r},a:function(){return l}});var o=n(57437),i=n(2265),s=n(2141);let a=(0,i.createContext)();function r(e){let{children:t}=e,[n,r]=(0,i.useState)(null),[l,c]=(0,i.useState)(null),[u,d]=(0,i.useState)(null),[h,m]=(0,i.useState)(!1),[g,p]=(0,i.useState)(!1),[f,b]=(0,i.useState)(!1),x=(e,t,n)=>{let o={user:e,session:t,role:n,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(o)),console.log("[Auth] Auth state saved to localStorage")},y=()=>{try{let t=localStorage.getItem("authState");if(t){var e;let n=JSON.parse(t);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=n.user)||void 0===e?void 0:e.email),n}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},v=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,i.useEffect)(()=>{let e=y();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)?(console.log("[Auth] ✅ Restored session from localStorage:",e.user.email),r(e.user),c(e.session),d(e.role),p(!0),b(!0)):console.log("[Auth] ⏳ No cached session, verifying with Supabase...");let t=async()=>{try{let{data:{session:t}}=await s.OQ.auth.getSession();if(null==t?void 0:t.user){console.log("[Auth] ✅ Valid Supabase session found"),c(t),r(t.user),p(!0);let{data:e}=await s.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(d(e.role),x(t.user,t,e.role))}else(null==e?void 0:e.user)||(console.log("[Auth] ❌ No session found anywhere"),c(null),r(null),d(null),p(!1),v());b(!0)}catch(e){console.warn("[Auth] ⚠️ Session verification error:",e.message),b(!0)}};(null==e?void 0:e.user)?t().catch(e=>console.warn("[Auth] Background verification failed:",e)):t();let{data:{subscription:o}}=s.OQ.auth.onAuthStateChange(async(e,t)=>{if(console.log("[Auth] Auth state change event:",e),null==t?void 0:t.user){console.log("[Auth] Session valid, updating state"),c(t),r(t.user),p(!0);let{data:e}=await s.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(d(e.role),x(t.user,t,e.role))}else if("SIGNED_OUT"===e)console.log("[Auth] User signed out, clearing session"),c(null),r(null),d(null),p(!1),v();else{let e=y();if(null==e?void 0:e.user){var o;console.log("[Auth] Keeping cached session for:",null===(o=e.user)||void 0===o?void 0:o.email),n||(r(e.user),c(e.session),d(e.role),p(!0))}else console.log("[Auth] No current session and no cached session"),p(!1)}});return()=>null==o?void 0:o.unsubscribe()},[]);let w=async(e,t)=>{try{console.log("[Signup] Attempting signup for:",e.email);let n=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:t})});if(!n.ok){let e=await n.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let o=await n.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:o.user,needsLogin:!0,message:o.message}}catch(e){throw console.error("[Signup] Error:",e),e}},S=async(e,t,n)=>{try{var o,i;console.log("[AuthContext] Attempting login:",{email:e,role:n});let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,role:n})});if(console.log("[AuthContext] Login response status:",s.status),!s.ok){let e=await s.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let a=await s.json();console.log("[AuthContext] Login successful, setting session"),a.session&&(c(a.session),r(a.session.user||a.user));let l=(null===(o=a.user)||void 0===o?void 0:o.role)||n;return d(l),p(!0),x((null===(i=a.session)||void 0===i?void 0:i.user)||a.user,a.session,l),console.log("[AuthContext] Auth state saved to localStorage"),a.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},A=async()=>{try{await s.OQ.auth.signOut(),c(null),r(null),d(null),p(!1),v(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,o.jsx)(a.Provider,{value:{user:n,session:l,role:u,loading:h,isAuthenticated:g,isHydrated:f,signup:w,login:S,logout:A},children:t})}let l=()=>{let e=(0,i.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2141:function(e,t,n){"use strict";n.d(t,{OQ:function(){return l}});var o=n(69066),i=n(40257);let s=i.env.NEXT_PUBLIC_SUPABASE_URL,a=i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,r=i.env.SUPABASE_SERVICE_ROLE_KEY,l=null;s&&a&&(l=(0,o.eI)(s,a),(0,o.eI)(s,r||a))},99376:function(e,t,n){"use strict";var o=n(35475);n.o(o,"useParams")&&n.d(t,{useParams:function(){return o.useParams}}),n.o(o,"usePathname")&&n.d(t,{usePathname:function(){return o.usePathname}}),n.o(o,"useRouter")&&n.d(t,{useRouter:function(){return o.useRouter}}),n.o(o,"useSearchParams")&&n.d(t,{useSearchParams:function(){return o.useSearchParams}})},8301:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var o=n(2265),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var a=(e,t)=>{let n=(0,o.forwardRef)((n,a)=>{let{color:r="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:u,children:d,...h}=n;return(0,o.createElement)("svg",{ref:a,...i,width:l,height:l,stroke:r,strokeWidth:u?24*Number(c)/Number(l):c,className:"lucide lucide-".concat(s(e)),...h},[...t.map(e=>{let[t,n]=e;return(0,o.createElement)(t,n)}),...(Array.isArray(d)?d:[d])||[]])});return n.displayName="".concat(e),n}},78279:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});let o=(0,n(8301).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5795:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});let o=(0,n(8301).Z)("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},67608:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});let o=(0,n(8301).Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},69811:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});let o=(0,n(8301).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])}},function(e){e.O(0,[9066,3287,2971,2117,1744],function(){return e(e.s=93378)}),_N_E=e.O()}]);