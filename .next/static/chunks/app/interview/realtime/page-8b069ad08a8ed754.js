(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7362],{7953:function(e,t,o){Promise.resolve().then(o.bind(o,4314))},4314:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return RealtimeInterviewPage}});var n=o(7437),s=o(2265),a=o(4033),i=o(4115),r=o(2609),l=o(7726),c=o(7865);let d=(0,c.Z)("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),u=(0,c.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),m=(0,c.Z)("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);var p=o(1840);let generateInterviewerInstructions=(e,t)=>{let o=t||'You MUST speak ONLY in ENGLISH. Do NOT speak Spanish, French, German, or any other language.\n\nYou are a professional technical job interviewer conducting a formal interview in English.\n\n\uD83D\uDD12 LANGUAGE POLICY (CRITICAL - MUST FOLLOW):\n- SPEAK ONLY ENGLISH - Every single response must be in English, no exceptions\n- START IN ENGLISH - Greet in English: "Hello, thank you for joining me today..."\n- NEVER USE OTHER LANGUAGES - No Spanish "hola", no French, no German, nothing but English\n- DEFAULT LANGUAGE IS ENGLISH - If candidate asks to switch, acknowledge but continue in English\n- ENGLISH ONLY UNTIL EXPLICITLY INSTRUCTED OTHERWISE\n\nCORE DIRECTIVES:\n1. ENGLISH LANGUAGE ONLY - Respond ONLY in English. This is not negotiable.\n2. PROFESSIONAL TONE - no casual language, jokes, slang, or small talk\n3. ONE QUESTION AT A TIME - ask only one question per turn, wait for complete response\n4. TECHNICAL FOCUS - concentrate exclusively on job-related skills and experience\n5. NO PERSONAL QUESTIONS - never ask about age, gender, religion, location, family, or salary\n6. OPEN-ENDED QUESTIONS - avoid yes/no questions, encourage detailed explanations\n7. RESPECTFUL LISTENING - never interrupt the candidate\n8. REDIRECT IF OFF-TOPIC - if candidate goes off-topic, say "Let\'s keep our focus on the technical questions"\n\nINTERVIEW PHASES:\n1. INTRODUCTION - "Hello, thank you for joining me today. I\'m your technical interviewer. Could you please introduce yourself and share your background?"\n2. BACKGROUND - Ask about education, work experience, and current role\n3. TECHNICAL SKILLS - Deep dive into required skills with practical questions\n4. PROBLEM-SOLVING - Ask scenario-based questions relevant to the position\n5. CLOSING - Summarize discussion and ask if they have questions\n\nREMEMBER: YOU MUST SPEAK ONLY IN ENGLISH. NO OTHER LANGUAGES ALLOWED.';if(e&&e.length>0){let t=e.map(e=>"• ".concat(e.name).concat(e.reason?": ".concat(e.reason):"")).join("\n"),n=e.map(e=>({name:e.name,reason:e.reason||"Required skill for this position"}));o+="\n\n=== REQUIRED SKILLS TO EVALUATE (JSON FORMAT) ===\n".concat(JSON.stringify(n,null,2),"\n=== END SKILLS JSON ===\n\nREQUIRED SKILLS TO EVALUATE:\n").concat(t,"\n\nSKILL ASSESSMENT STRATEGY:\n- For each required skill listed above, ask 2-3 targeted technical questions\n- Probe for depth of understanding, not just familiarity\n- Ask for real-world examples of using each skill\n- Assess both theoretical knowledge and practical experience\n- Reference the specific skills from the JSON section above")}return o+"\n\nPROHIBITED BEHAVIORS:\n❌ Speaking in any language other than English\n❌ Asking personal or demographic questions\n❌ Making jokes or using casual language\n❌ Asking multiple questions in one turn\n❌ Interrupting the candidate\n❌ Going off-topic\n❌ Making assumptions about the candidate\n❌ Expressing personal opinions\n❌ Discussing salary before appropriate stage\n\nREMEMBER:\nYou are ONLY a technical job interviewer. Your role is to fairly assess the candidate's qualifications for the open position. Be respectful, professional, and focused on job-related competencies."},validateGuardrails=e=>{let t=[],o=e.toLowerCase();for(let e of["hola","buenos","d\xedas","noche","gracias","por favor","c\xf3mo","qu\xe9","d\xf3nde","cu\xe1ndo","s\xed","no"])o.includes(e)&&t.push('Possible non-English content detected: "'.concat(e,'"'));let n=(e.match(/\?/g)||[]).length;for(let e of(n>1&&t.push("Multiple questions detected (".concat(n,"). Should ask one question at a time.")),["hey","what's up","lol","btw","umm","uh","gonna","wanna","kinda","sorta"]))o.includes(e)&&t.push('Casual language detected: "'.concat(e,'". Use professional tone.'));for(let e of["age","married","children","religion","politics","salary","where do you live","personal life"])o.includes(e)&&t.push('Potential personal question detected: "'.concat(e,'". Focus on job-related topics.'));return{isValid:0===t.length,violations:t}},formatInterviewContext=(e,t)=>({role:"technical_interviewer",interview_type:"structured_technical",position:t||"Technical Position",required_skills:e||[],assessment_criteria:["Technical knowledge and depth","Practical experience","Problem-solving ability","Communication skills","Job fit and relevant expertise"],interview_duration_minutes:45,question_count:5,language:"English (only)",professional_standards:"ISO 9001, EEOC compliant"});function useRealtimeAudio(){let[e,t]=(0,s.useState)(!1),[o,n]=(0,s.useState)(!1),[a,i]=(0,s.useState)(null),r=(0,s.useRef)(null),l=(0,s.useRef)(null),c=(0,s.useRef)(null),d=(0,s.useRef)(null),u=(0,s.useRef)(null),m=(0,s.useRef)([]),p=(0,s.useRef)(null),g=(0,s.useRef)(""),h=(0,s.useRef)(!1),f=(0,s.useRef)(0),x=(0,s.useRef)(""),b=(0,s.useRef)(!1),v=(0,s.useRef)(!1),y=(0,s.useCallback)(async(o,s,a)=>{o&&(p.current=o,console.log("[RealtimeAudio] ✅ Conversation callback set")),i(null),g.current="",f.current=0;let l=generateInterviewerInstructions(s,a);s&&s.length>0&&console.log("[RealtimeAudio] Skills provided:",s);try{console.log("[RealtimeAudio] Starting connection...");let a="ws://localhost:8001/ws/realtime";console.log("[RealtimeAudio] Connecting to backend WebSocket proxy:",a);let c=new WebSocket(a);r.current=c,await new Promise((t,a)=>{let r=setTimeout(()=>{console.error("[RealtimeAudio] Connection timeout"),a(Error("Connection timeout"))},15e3);c.onopen=()=>{console.log("[RealtimeAudio] ✅ WebSocket opened"),clearTimeout(r);let e=formatInterviewContext(s),o={language_policy:"ENGLISH_ONLY",core_directives:["ENGLISH LANGUAGE ONLY - Respond ONLY in English","PROFESSIONAL TONE - no casual language, jokes, slang","ONE QUESTION AT A TIME - ask only one question per turn","TECHNICAL FOCUS - concentrate exclusively on job-related skills","NO PERSONAL QUESTIONS - never ask about age, gender, religion, location","OPEN-ENDED QUESTIONS - avoid yes/no questions","RESPECTFUL LISTENING - never interrupt","REDIRECT IF OFF-TOPIC - keep focus on technical questions"],prohibited_behaviors:["Speaking in any language other than English","Asking personal or demographic questions","Making jokes or using casual language","Asking multiple questions in one turn","Interrupting the candidate","Going off-topic","Making assumptions about the candidate","Expressing personal opinions","Discussing salary before appropriate stage"],validation_checks:["Must speak only English","Must ask one question at a time","Must maintain professional tone","Must focus on technical skills only","Must avoid personal questions"]},n={skills:s&&s.length>0?s:[],skillCount:(null==s?void 0:s.length)||0,interviewContext:e},a="".concat(l,"\n\n=== GUARDRAILS CONFIGURATION (JSON FORMAT) ===\n").concat(JSON.stringify(o,null,2),"\n=== END GUARDRAILS JSON ===\n\n=== INTERVIEW CONTEXT & SKILLS (JSON FORMAT) ===\n").concat(JSON.stringify(n,null,2),"\n=== END SKILLS JSON ===");c.send(JSON.stringify({type:"session.update",session:{type:"realtime",instructions:a}})),console.log("[RealtimeAudio] ✅ Session configuration sent with instructions"),console.log("[RealtimeAudio] Guardrails included:",o),console.log("[RealtimeAudio] Skills included:",n),console.log("[RealtimeAudio] Instructions included in session.update"),x.current="",t()},c.onmessage=async e=>{try{var t,o,s;let a=JSON.parse(e.data);if(a.type&&!["input_audio_buffer.append","response.output_audio.delta"].includes(a.type)&&console.log("[RealtimeAudio] \uD83D\uDCE8 Incoming message type:",a.type),"session.created"===a.type&&(console.log("[RealtimeAudio] ✅ Session created with instructions embedded"),c.send(JSON.stringify({type:"conversation.item.create",item:{type:"message",role:"assistant",content:[{type:"output_text",text:'Welcome to your technical interview!\n\nPlease keep your microphone and camera ON during the session. This interview is being recorded for evaluation purposes.\n\nYou will be asked a series of questions. If you are unsure about any question, simply say "skip" and we will move to the next one.\n\nGood luck!'}]}})),console.log("[RealtimeAudio] \uD83C\uDFA4 Sent welcome message for AI to speak"),c.send(JSON.stringify({type:"response.create"})),console.log("[RealtimeAudio] ⏳ Requesting AI to speak welcome message...")),"session.updated"===a.type&&console.log("[RealtimeAudio] ✅ Session updated"),"response.created"===a.type&&(console.log("[RealtimeAudio] ✅ Response created, AI will speak soon"),b.current=!0,n(!0)),"response.text.delta"===a.type&&a.delta&&(g.current+=a.delta,console.log("[RealtimeAudio] \uD83D\uDCDD AI text delta:",a.delta,"Total:",g.current)),"response.content_part.created"===a.type&&console.log("[RealtimeAudio] Content part created:",a.content_part),"response.content_part.done"===a.type&&(console.log("[RealtimeAudio] Content part done, transcript:",g.current),console.log("[RealtimeAudio] onConversationRef.current exists?",!!p.current),g.current.trim()&&p.current)){let e=validateGuardrails(g.current);e.isValid?console.log("[RealtimeAudio] ✅ Guardrails validated"):console.warn("[RealtimeAudio] ⚠️ Guardrail violations detected:",e.violations),console.log("[RealtimeAudio] ✅ CALLING callback with AI message:",g.current.substring(0,100)),p.current({role:"ai",content:g.current,timestamp:new Date}),console.log("[RealtimeAudio] ✅ Callback invoked successfully"),g.current=""}if("response.done"===a.type){if(console.log("[RealtimeAudio] ===== RESPONSE.DONE EVENT ====="),console.log("[RealtimeAudio] Full response.done message:",JSON.stringify(a,null,2)),b.current=!1,n(!1),a.response&&a.response.output){console.log("[RealtimeAudio] ✅ Response has output array with",a.response.output.length,"items");for(let e=0;e<a.response.output.length;e++){let t=a.response.output[e];if(console.log("[RealtimeAudio] Output item ".concat(e,":"),JSON.stringify(t,null,2)),"message"===t.type&&t.content){let e="assistant"===t.role?"ai":t.role;for(let o of t.content)"output_audio"===o.type&&o.transcript?(console.log("[RealtimeAudio] \uD83D\uDCDD Found transcript in output_audio:",o.transcript,"from role:",e),p.current&&p.current({role:e,content:o.transcript,timestamp:new Date})):"input_audio"===o.type&&o.transcript?(console.log("[RealtimeAudio] \uD83D\uDCDD Found transcript in input_audio:",o.transcript),p.current&&p.current({role:"user",content:o.transcript,timestamp:new Date})):"input_text"===o.type&&o.text?(console.log("[RealtimeAudio] \uD83D\uDCDD Found input_text:",o.text),p.current&&p.current({role:"user",content:o.text,timestamp:new Date})):"text"===o.type&&o.text&&(console.log("[RealtimeAudio] \uD83D\uDCDD Found text in response output:",o.text),p.current&&p.current({role:e,content:o.text,timestamp:new Date}))}}}else console.warn("[RealtimeAudio] ⚠️ No response.output found in response.done");g.current.trim()&&p.current&&(console.log("[RealtimeAudio] ✅ CALLING callback with remaining AI message from response.done:",g.current.substring(0,100)),p.current({role:"ai",content:g.current,timestamp:new Date}),console.log("[RealtimeAudio] ✅ Callback invoked from response.done"),g.current="")}if("response.output_audio.delta"===a.type&&a.delta)try{let e=atob(a.delta),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);m.current.push(t)}catch(e){console.error("[RealtimeAudio] Failed to decode audio delta:",e)}if("response.output_audio.done"===a.type&&(console.log("[RealtimeAudio] Audio output done, playing..."),m.current.length>0&&(playAudio(),m.current=[])),"conversation.item.created"===a.type){if(console.log("[RealtimeAudio] \uD83D\uDCEC conversation.item.created event:"),console.log("[RealtimeAudio] - Full item:",JSON.stringify(a.item,null,2)),console.log("[RealtimeAudio] - Item role:",null===(t=a.item)||void 0===t?void 0:t.role),console.log("[RealtimeAudio] - Item content:",null===(o=a.item)||void 0===o?void 0:o.content),a.item&&"user"===a.item.role){console.log("[RealtimeAudio] \uD83D\uDC64 USER MESSAGE DETECTED");let e=a.item.content&&a.item.content[0];console.log("[RealtimeAudio] - User content structure:",JSON.stringify(e,null,2));let t=null;if(e&&"input_text"===e.type&&e.text?(t=e.text,console.log("[RealtimeAudio] Found input_text:",t)):e&&"input_audio"===e.type&&e.transcript&&(t=e.transcript,console.log("[RealtimeAudio] Found audio transcript:",t)),t){let e=t.toLowerCase();(e.includes("speak")||e.includes("language")||e.includes("espa\xf1ol")||e.includes("switch"))&&(v.current=!0,console.log("[RealtimeAudio] \uD83C\uDF10 Language switch requested by candidate")),console.log("[RealtimeAudio] ✅ CALLING callback with user message:",t.substring(0,100)),p.current?(p.current({role:"user",content:t,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked")):console.warn("[RealtimeAudio] ⚠️ onConversationRef.current is null!")}else console.warn("[RealtimeAudio] ⚠️ Could not find user text in:",e)}if(a.item&&"assistant"===a.item.role){console.log("[RealtimeAudio] \uD83E\uDD16 ASSISTANT MESSAGE DETECTED");let e=a.item.content&&a.item.content[0];console.log("[RealtimeAudio] - Content structure:",JSON.stringify(e,null,2)),e&&"output_audio"===e.type&&e.transcript?(console.log("[RealtimeAudio] ✅ CALLING callback with AI message (from transcript):",e.transcript.substring(0,100)),p.current&&(p.current({role:"ai",content:e.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ AI message callback invoked"))):e&&"text"===e.type&&e.text?(console.log("[RealtimeAudio] ✅ CALLING callback with AI message (from text):",e.text.substring(0,100)),p.current&&(p.current({role:"ai",content:e.text,timestamp:new Date}),console.log("[RealtimeAudio] ✅ AI message callback invoked"))):console.warn("[RealtimeAudio] ⚠️ No text content found in assistant message")}}if("conversation.item.added"===a.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: conversation.item.added FULL STRUCTURE:"),console.log("[RealtimeAudio] Full message:",JSON.stringify(a,null,2)),a.item&&console.log("[RealtimeAudio] - Has msg.item:",a.item.role),a.delta&&console.log("[RealtimeAudio] - Has msg.delta:",a.delta),a.previous_item_id&&console.log("[RealtimeAudio] - Has previous_item_id:",a.previous_item_id)),"conversation.item.done"===a.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: conversation.item.done FULL STRUCTURE:"),console.log("[RealtimeAudio] Full message:",JSON.stringify(a,null,2)),a.item&&"user"===a.item.role&&(console.log("[RealtimeAudio] \uD83C\uDFA4 USER ITEM FOUND in conversation.item.done"),console.log("[RealtimeAudio] Item content:",JSON.stringify(a.item.content,null,2)),a.item.content&&a.item.content.length>0)))for(let e of a.item.content)"input_audio"===e.type&&e.transcript&&(console.log("[RealtimeAudio] ✅ FOUND USER TRANSCRIPT:",e.transcript),p.current&&(p.current({role:"user",content:e.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked from conversation.item.done")));"response.content_part.added"===a.type&&console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: response.content_part.added (AI output):",JSON.stringify(a,null,2)),"response.content_part.done"===a.type&&console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: response.content_part.done (AI output) - DO NOT USE FOR USER MESSAGES"),"input_audio_transcript.delta"===a.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: input_audio_transcript.delta:",JSON.stringify(a,null,2)),a.delta&&console.log("[RealtimeAudio] \uD83C\uDFA4 USER TRANSCRIPT DELTA:",a.delta)),"input_audio_transcript.done"===a.type&&(console.log("[RealtimeAudio] \uD83D\uDD0D DEBUG: input_audio_transcript.done:",JSON.stringify(a,null,2)),a.transcript&&a.transcript.trim()&&(console.log("[RealtimeAudio] \uD83C\uDFA4 USER TRANSCRIPT (FINAL):",a.transcript),p.current&&(p.current({role:"user",content:a.transcript,timestamp:new Date}),console.log("[RealtimeAudio] ✅ User message callback invoked from input_audio_transcript")))),"input_audio_buffer.speech_started"===a.type&&console.log("[RealtimeAudio] \uD83C\uDFA4 CANDIDATE SPEAKING STARTED"),"input_audio_buffer.speech_stopped"===a.type&&console.log("[RealtimeAudio] \uD83E\uDD10 CANDIDATE SPEAKING STOPPED - expecting transcript soon"),"input_audio_buffer.committed"===a.type&&console.log("[RealtimeAudio] ✅ AUDIO BUFFER COMMITTED - transcript should follow"),"error"===a.type&&(console.error("[RealtimeAudio] Error from OpenAI:",a.error),i((null===(s=a.error)||void 0===s?void 0:s.message)||"OpenAI error"))}catch(e){console.error("[RealtimeAudio] Failed to parse message:",e)}},c.onerror=e=>{console.error("[RealtimeAudio] WebSocket error:",e),i("WebSocket connection error"),a(Error("WebSocket error"))},c.onclose=t=>{console.log("[RealtimeAudio] WebSocket closed: ".concat(t.code," ").concat(t.reason)),!e&&f.current<3?(f.current++,console.log("[RealtimeAudio] Attempting reconnect ".concat(f.current,"/").concat(3,"...")),setTimeout(()=>{y(o,s).catch(e=>{console.error("[RealtimeAudio] Reconnect failed:",e)})},1e3)):f.current>=3&&a(Error("Failed to connect after ".concat(3," attempts")))}}),await setupAudio(c),t(!0),console.log("[RealtimeAudio] ✅ Fully connected and ready")}catch(e){throw console.error("[RealtimeAudio] Connection failed:",e),i((null==e?void 0:e.message)||"Connection failed"),t(!1),e}},[]),setupAudio=async e=>{if(h.current){console.log("[RealtimeAudio] Audio already setup");return}try{console.log("[RealtimeAudio] Setting up audio capture...");let t=new(window.AudioContext||window.webkitAudioContext);l.current=t;let o=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1},sampleRate:{ideal:16e3}}});c.current=o,console.log("[RealtimeAudio] ✅ Microphone permission granted with noise suppression enabled");try{await t.audioWorklet.addModule("/worklet/realtime-audio-worklet.js")}catch(n){console.error("[RealtimeAudio] Failed to load worklet, using fallback:",n);let e=new Blob(["\n          class RealtimeAudioWorklet extends AudioWorkletProcessor {\n            constructor() {\n              super()\n              this.port.onmessage = (e) => {\n                if (e.data.type === 'start') {\n                  this.isRecording = true\n                  console.log('[Worklet] Recording started')\n                } else if (e.data.type === 'stop') {\n                  this.isRecording = false\n                  console.log('[Worklet] Recording stopped')\n                }\n              }\n              this.isRecording = false\n              this.noiseGateThreshold = 0.02 // Gate threshold for noise suppression\n              this.bufferSize = 0\n            }\n            \n            process(inputs, outputs, parameters) {\n              if (!this.isRecording) return true\n              \n              const input = inputs[0]\n              if (input && input.length > 0) {\n                const audioData = input[0]\n                \n                // Apply noise gate - suppress very quiet audio (background noise)\n                const gatedAudio = new Float32Array(audioData.length)\n                let hasSignal = false\n                \n                for (let i = 0; i < audioData.length; i++) {\n                  const sample = audioData[i]\n                  const amplitude = Math.abs(sample)\n                  \n                  if (amplitude > this.noiseGateThreshold) {\n                    gatedAudio[i] = sample\n                    hasSignal = true\n                  } else {\n                    gatedAudio[i] = 0 // Suppress noise\n                  }\n                }\n                \n                // Only send if there's actual speech signal\n                if (hasSignal) {\n                  this.port.postMessage({\n                    type: 'audio',\n                    audio: gatedAudio\n                  })\n                  this.bufferSize++\n                }\n              }\n              return true\n            }\n          }\n          \n          registerProcessor('realtime-audio-worklet', RealtimeAudioWorklet)\n        "],{type:"application/javascript"}),o=URL.createObjectURL(e);await t.audioWorklet.addModule(o),URL.revokeObjectURL(o)}let n=new AudioWorkletNode(t,"realtime-audio-worklet");d.current=n,n.port.onmessage=t=>{if("audio"===t.data.type&&e.readyState===WebSocket.OPEN){let o=t.data.audio,n=new Int16Array(o.length);for(let e=0;e<o.length;e++){let t=Math.max(-1,Math.min(1,o[e]));n[e]=t<0?32768*t:32767*t}let s=new Uint8Array(n.buffer),a="";for(let e=0;e<s.byteLength;e++)a+=String.fromCharCode(s[e]);let i=btoa(a);e.send(JSON.stringify({type:"input_audio_buffer.append",audio:i}))}};let s=t.createMediaStreamSource(o);s.connect(n),n.connect(t.destination),n.port.postMessage({type:"start"}),h.current=!0,console.log("[RealtimeAudio] ✅ Audio setup complete")}catch(e){throw console.error("[RealtimeAudio] Audio setup failed:",e),Error("Audio setup failed: ".concat(e))}},w=(0,s.useCallback)(async()=>{if(console.log("[RealtimeAudio] \uD83D\uDED1 HARD DISCONNECT - Closing all connections NOW"),r.current){try{console.log("[RealtimeAudio] Force closing WebSocket"),r.current.onopen=null,r.current.onmessage=null,r.current.onerror=null,r.current.onclose=null,(r.current.readyState===WebSocket.OPEN||r.current.readyState===WebSocket.CONNECTING)&&r.current.close(1e3,"Client closing")}catch(e){console.error("[RealtimeAudio] Error force closing WebSocket:",e)}r.current=null}try{d.current&&(d.current.port.postMessage({type:"stop"}),d.current=null),c.current&&(c.current.getTracks().forEach(e=>{try{e.stop()}catch(e){}}),c.current=null),l.current&&"closed"!==l.current.state&&(await l.current.close(),l.current=null),u.current&&(u.current.pause(),u.current.src="")}catch(e){console.error("[RealtimeAudio] Error during cleanup:",e)}b.current=!1,t(!1),n(!1),h.current=!1,m.current=[],g.current="",console.log("[RealtimeAudio] ✅ HARD DISCONNECT Complete")},[]),playAudio=()=>{try{if(0===m.current.length){console.log("[RealtimeAudio] No audio data to play");return}let e=m.current.reduce((e,t)=>e+t.length,0),t=new Uint8Array(e),o=0;for(let e of m.current)t.set(e,o),o+=e.length;console.log("[RealtimeAudio] Playing audio, total bytes:",e);let n=new ArrayBuffer(44),s=new DataView(n);s.setUint32(0,1179011410,!0),s.setUint32(4,36+t.length,!0),s.setUint32(8,1163280727,!0),s.setUint32(12,544501094,!0),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,24e3,!0),s.setUint32(28,48e3,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),s.setUint32(36,1635017060,!0),s.setUint32(40,t.length,!0);let a=new Uint8Array(n.byteLength+t.length);a.set(new Uint8Array(n),0),a.set(t,n.byteLength);let i=new Blob([a],{type:"audio/wav"}),r=URL.createObjectURL(i);u.current||(u.current=new Audio);let l=u.current;l.src=r,l.volume=1,l.onended=()=>{console.log("[RealtimeAudio] ✅ Audio finished playing"),URL.revokeObjectURL(r)},l.onerror=e=>{console.error("[RealtimeAudio] Audio error:",l.error,e)};let c=l.play();void 0!==c&&c.catch(e=>{console.error("[RealtimeAudio] Failed to play audio:",e)})}catch(e){console.error("[RealtimeAudio] Failed to play audio:",e)}};return{connected:e,isListening:o,error:a,connect:y,disconnect:w}}function useConversationManager(){let[e,t]=(0,s.useState)([]),o=(0,s.useRef)(0),n=(0,s.useCallback)((e,n)=>{let s="msg-".concat(Date.now(),"-").concat(o.current++),a={id:s,role:e,content:n,timestamp:new Date,status:"complete"};return t(e=>[...e,a]),console.log("[ConversationManager] Added ".concat(e," message:"),n.substring(0,100)),s},[]),a=(0,s.useCallback)((e,o)=>{t(t=>t.map(t=>t.id===e?{...t,...o}:t)),console.log("[ConversationManager] Updated message ".concat(e))},[]),i=(0,s.useCallback)(()=>{t([]),o.current=0,console.log("[ConversationManager] Cleared all messages")},[]),r=(0,s.useCallback)(()=>e.map(e=>{let t="ai"===e.role?"AI Assistant":"Candidate",o=e.timestamp.toLocaleTimeString();return"[".concat(o,"] ").concat(t,": ").concat(e.content)}).join("\n\n"),[e]),l=(0,s.useCallback)(async(t,o)=>{try{var n,s;if(0===e.length)return console.warn("[ConversationManager] No messages to save"),!1;let a={interviewId:t,applicantId:o||null,messages:e.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString(),status:e.status||"complete"})),messageCount:e.length,startTime:null===(n=e[0])||void 0===n?void 0:n.timestamp.toISOString(),endTime:null===(s=e[e.length-1])||void 0===s?void 0:s.timestamp.toISOString(),conversationText:r()};console.log("[ConversationManager] Saving conversation:",{interviewId:t,messageCount:e.length});let i=await fetch("/api/interviews/save-conversation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to save conversation")}let l=await i.json();return console.log("[ConversationManager] Conversation saved successfully:",l),!0}catch(e){return console.error("[ConversationManager] Error saving conversation:",e),!1}},[e,r]);return{messages:e,addMessage:n,updateMessage:a,clearMessages:i,saveToDatabase:l,getConversationText:r}}var g=o(4678),h=o(2899),f=o(732);function SubscriptionPaywall(e){let{userId:t,onClose:o,remainingInterviews:a,currentPlan:i}=e,[r,l]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0);(0,s.useEffect)(()=>{loadPlans()},[]);let loadPlans=async()=>{try{let e=await fetch("/api/subscription-plans?userId=".concat(t)),o=await e.json();l(o.plans||[])}catch(e){console.error("Error loading plans:",e)}finally{d(!1)}},handleUpgrade=e=>{console.log("Upgrade to plan:",e),alert("Payment integration coming soon! Contact support for manual upgrade.")};return(0,n.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:o,children:(0,n.jsx)(f.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg max-w-4xl w-full max-h-96 overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,n.jsxs)("div",{className:"p-8",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-3xl font-bold text-slate-900",children:"Interview Limit Reached"}),(0,n.jsxs)("p",{className:"text-slate-600 mt-2",children:["You've used all ",0===a?2:a," free interviews on your ",i," plan"]})]}),(0,n.jsx)("button",{onClick:o,className:"text-slate-400 hover:text-slate-600 text-2xl",children:"✕"})]}),c?(0,n.jsx)("div",{className:"text-center py-8",children:(0,n.jsx)("p",{className:"text-slate-600",children:"Loading subscription plans..."})}):(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:r.map(e=>(0,n.jsxs)("div",{className:"rounded-lg border-2 p-6 transition-all ".concat("Pro"===e.name?"border-blue-500 bg-blue-50 scale-105":"border-slate-200 hover:border-slate-300"),children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-slate-900",children:e.name}),(0,n.jsx)("p",{className:"text-slate-600 text-sm mt-2 h-10",children:e.description}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("span",{className:"text-3xl font-bold text-slate-900",children:["$",parseFloat(e.price).toFixed(2)]}),(0,n.jsx)("span",{className:"text-slate-600 ml-2",children:"/month"})]}),(0,n.jsxs)("p",{className:"text-sm font-semibold text-slate-900 mt-4",children:[999999===e.interview_limit?"∞ Unlimited":e.interview_limit," interviews"]}),(0,n.jsx)("div",{className:"mt-6 space-y-2",children:e.features&&JSON.parse(e.features).map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-green-600",children:"✓"}),(0,n.jsx)("span",{className:"text-sm text-slate-700",children:e})]},t))}),(0,n.jsx)("button",{onClick:()=>handleUpgrade(e.id),className:"w-full mt-6 py-2 rounded-lg font-semibold transition-colors ".concat("Pro"===e.name?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-100 text-slate-900 hover:bg-slate-200"),children:0===e.price?"Current Plan":"Upgrade Now"})]},e.id))}),(0,n.jsx)("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,n.jsxs)("p",{className:"text-sm text-slate-700",children:[(0,n.jsx)("strong",{children:"Tip:"})," The Pro plan includes unlimited interviews, advanced AI analysis, detailed feedback, and performance tracking!"]})})]})})})}function ConversationDisplay(e){let{messages:t,isListening:o=!1,messageCount:a=0,loading:i=!1}=e,r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]),(0,n.jsxs)("div",{className:"lg:col-span-3 flex flex-col bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-lg shadow-sm overflow-hidden h-full",children:[(0,n.jsx)("div",{className:"p-3 border-b border-[#11cd68]/20 bg-white/50",children:(0,n.jsxs)("h3",{className:"text-[#007a78] font-bold text-sm",children:["\uD83D\uDCAC Conversation ",t.length>0&&"(".concat(t.length,")")]})}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:0===t.length?(0,n.jsx)("p",{className:"text-slate-500 text-xs text-center py-4",children:"Waiting for conversation to start..."}):(0,n.jsxs)(n.Fragment,{children:[t.map(e=>(0,n.jsxs)("div",{className:"space-y-1 animate-in fade-in",children:[(0,n.jsx)("div",{className:"text-xs font-bold ".concat("ai"===e.role?"text-[#007a78]":"text-blue-600"),children:"ai"===e.role?"\uD83E\uDD16 AI Assistant":"\uD83D\uDC64 You"}),(0,n.jsx)("div",{className:"text-xs leading-relaxed ml-2 p-3 rounded-lg whitespace-pre-wrap break-words ".concat("ai"===e.role?"bg-[#f0fdf4] border border-[#11cd68]/50 text-slate-800":"bg-blue-50 border border-blue-300 text-slate-800"),children:e.content||"(empty message)"}),(0,n.jsx)("div",{className:"text-xs text-slate-400 ml-2",children:e.timestamp?new Date(e.timestamp).toLocaleTimeString():""})]},e.id)),(0,n.jsx)("div",{ref:r})]})}),(0,n.jsxs)("div",{className:"border-t border-[#11cd68]/20 p-3 bg-white/50 space-y-2 text-xs",children:[o&&(0,n.jsx)("div",{className:"p-2 bg-[#fff3cd] border border-[#ffc107]/50 rounded-lg",children:(0,n.jsx)("p",{className:"text-[#856404] font-semibold",children:"\uD83E\uDD16 AI Speaking"})}),!o&&t.length>0&&(0,n.jsx)("div",{className:"p-2 bg-[#d1ecf1] border border-[#0c5460]/30 rounded-lg",children:(0,n.jsx)("p",{className:"text-[#0c5460] font-semibold",children:"\uD83C\uDFA4 Your Turn"})}),i&&(0,n.jsx)("div",{className:"p-2 bg-gray-100 border border-gray-300 rounded-lg",children:(0,n.jsx)("p",{className:"text-gray-600 font-semibold",children:"⏳ Saving conversation..."})})]})]})}function generateSystemPromptWithJobDetails(e,t,o,n){let s=o.map(e=>"• ".concat(e.name)).join("\n");return'You are a professional technical job interviewer conducting a formal interview in English.\n\n\uD83D\uDD12 LANGUAGE POLICY (CRITICAL - MUST FOLLOW):\n- SPEAK ONLY ENGLISH - Every single response must be in English, no exceptions\n- START IN ENGLISH - Greet in English: "Hello, thank you for joining me today..."\n- NEVER USE OTHER LANGUAGES - No Spanish, French, German, or any other language\n\nPOSITION DETAILS:\n- Job Title: '.concat(e,"\n- Company: ").concat(n,"\n- Job Description:\n").concat(t,'\n\nCORE DIRECTIVES:\n1. ENGLISH LANGUAGE ONLY - Respond ONLY in English. This is not negotiable.\n2. PROFESSIONAL TONE - no casual language, jokes, slang, or small talk\n3. ONE QUESTION AT A TIME - ask only one question per turn, wait for complete response\n4. TECHNICAL FOCUS - concentrate exclusively on job-related skills and experience\n5. NO PERSONAL QUESTIONS - never ask about age, gender, religion, location, family, or salary\n6. OPEN-ENDED QUESTIONS - avoid yes/no questions, encourage detailed explanations\n7. RESPECTFUL LISTENING - never interrupt the candidate\n8. REDIRECT IF OFF-TOPIC - if candidate goes off-topic, say "Let\'s keep our focus on the technical questions"\n\nREQUIRED SKILLS TO EVALUATE (High Priority):\n').concat(s,"\n\nSKILL ASSESSMENT STRATEGY:\n- For each required skill listed above, ask 2-3 targeted technical questions\n- Base questions on the job description and responsibilities\n- Probe for depth of understanding, not just familiarity\n- Ask for real-world examples of using each skill\n- Assess both theoretical knowledge and practical experience\n- Reference specific job requirements in your questions\n\nINTERVIEW PHASES:\n1. INTRODUCTION - \"Hello, thank you for joining me today. I'm your technical interviewer for the ").concat(e," position at ").concat(n,'. Could you please introduce yourself and share your background?"\n2. BACKGROUND - Ask about education, work experience, and current role relevant to this position\n3. TECHNICAL SKILLS - Deep dive into the required skills with practical questions related to the job description\n4. PROBLEM-SOLVING - Ask scenario-based questions relevant to the ').concat(e," position\n5. CLOSING - Summarize discussion and ask if they have questions\n\nPROHIBITED BEHAVIORS:\n❌ Speaking in any language other than English\n❌ Asking personal or demographic questions\n❌ Making jokes or using casual language\n❌ Asking multiple questions in one turn\n❌ Interrupting the candidate\n❌ Going off-topic\n❌ Making assumptions about the candidate\n❌ Expressing personal opinions\n❌ Discussing salary before appropriate stage\n\nREMEMBER:\nYou are ONLY a technical job interviewer for this specific ").concat(e," position. Your role is to fairly assess the candidate's qualifications based on the job description and required skills. Be respectful, professional, and focused on job-related competencies.")}function RealtimeInterviewPage(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),{role:o,user:c,session:f,loading:x}=(0,g.useAuth)(),[b,v]=(0,s.useState)(!1),[y,w]=(0,s.useState)(!1),[N,S]=(0,s.useState)(!1),[A,E]=(0,s.useState)(null),[j,k]=(0,s.useState)(null),[D,I]=(0,s.useState)(null),[R,C]=(0,s.useState)(null),[O,T]=(0,s.useState)(null),[P,L]=(0,s.useState)(null),[U,F]=(0,s.useState)(null),[M,_]=(0,s.useState)(0),[G,q]=(0,s.useState)(!1),[J]=(0,s.useState)(120),[H,W]=(0,s.useState)(!1),[Y,z]=(0,s.useState)(!0),[B,V]=(0,s.useState)(!0),[Z,K]=(0,s.useState)(null),[Q,X]=(0,s.useState)(null),[$,ee]=(0,s.useState)(!1),[et,eo]=(0,s.useState)(null),[en,es]=(0,s.useState)(!1),[ea,ei]=(0,s.useState)(!1),[er,el]=(0,s.useState)({name:"",email:"",phone:"",position:"",resumeFile:null}),[ec,ed]=(0,s.useState)(!1),[eu,em]=(0,s.useState)(null),ep=(0,s.useRef)(null);(0,s.useRef)(null);let{messages:eg,addMessage:eh,saveToDatabase:ef}=useConversationManager(),{connected:ex,isListening:eb,error:ev,connect:ey,disconnect:ew}=useRealtimeAudio();(0,s.useEffect)(()=>{if(x){console.log("⏳ Waiting for auth context...");return}let o=null==t?void 0:t.get("applicantId"),n=null==t?void 0:t.get("jobId"),s=null==t?void 0:t.get("type"),a=!!s;if(q(a),console.log("[InterviewPage] Query params:",{applicantIdParam:o,jobIdParam:n,typeParam:s,isPracticeMode:a}),console.log("[InterviewPage] Interview type:",a?"\uD83D\uDCDD PRACTICE (2-min limit)":"\uD83C\uDFAF REAL JOB INTERVIEW"),o||n||s)console.log("✅ Candidate interview (no auth required)",{applicantIdParam:o,jobIdParam:n,typeParam:s}),o&&T(o),n&&(L(n),console.log("[InterviewPage] Job ID set to:",n));else if(c&&f)console.log("✅ User authenticated:",c.email),o&&T(o),n&&L(n);else{console.warn("❌ Not authenticated - redirecting to login"),e.push("/auth/login");return}if(s){let e=sessionStorage.getItem("selectedPracticeType");if(e)try{let t=JSON.parse(e);console.log("✅ Loaded practice type:",t),X({title:t.title,systemPrompt:t.systemPrompt,skills:t.skills.map(e=>({name:e,reason:"Essential for ".concat(t.title),importance:"high"}))}),sessionStorage.removeItem("selectedPracticeType")}catch(e){console.error("Failed to parse practice type:",e)}}let i=localStorage.getItem("applicantData");if(i)try{let e=JSON.parse(i);F(e),localStorage.removeItem("applicantData")}catch(e){console.error("Failed to load applicant data:",e)}let r=localStorage.getItem("interviewData");if(r)try{X(JSON.parse(r)),localStorage.removeItem("interviewData")}catch(e){console.error("Failed to load interview data:",e)}n&&!r&&(console.log("Loading job info from database for jobId:",n),loadJobInfo(n)),v(!0),checkMediaPermissions()},[x,c,f,t,e]);let checkMediaPermissions=async()=>{try{let e=await navigator.permissions.query({name:"microphone"}),t=await navigator.permissions.query({name:"camera"});k("granted"===e.state),I("granted"===t.state)}catch(e){console.log("Permission check not supported, will prompt on access")}},handleCandidateFormSubmit=async e=>{e.preventDefault(),ed(!0),em(null);try{if(!er.name.trim())throw Error("Name is required");if(!er.email.trim())throw Error("Email is required");if(!er.phone.trim())throw Error("Phone number is required");if(!er.position.trim())throw Error("Position applying for is required");let e=new FormData;e.append("name",er.name),e.append("email",er.email),e.append("phone",er.phone),e.append("position",er.position),e.append("jobId",P||""),er.resumeFile&&e.append("resume",er.resumeFile);let t=await fetch("/api/candidate-intake",{method:"POST",body:e});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to save candidate information")}let o=await t.json();console.log("[Interview] Candidate info saved:",o),ei(!0)}catch(e){console.error("[Interview] Error saving candidate info:",e),em(e.message||"Failed to save information")}finally{ed(!1)}},loadJobInfo=async e=>{try{console.log("[Page] Loading job info for jobId:",e);let t=new AbortController,o=setTimeout(()=>t.abort(),5e3),n=await fetch("/api/jobs/".concat(e),{signal:t.signal});if(clearTimeout(o),n.ok){let t=await n.json();console.log("[Page] Job loaded:",t);let o=Array.isArray(t.required_skills)?t.required_skills:t.skills||[],s=o.map(e=>({name:"string"==typeof e?e:e.name||e,reason:"Required for ".concat(t.title),importance:"high"}));X({title:t.title||"Technical Interview",client:t.company||"Unknown",hiringFor:t.position||t.title,jobId:e,description:t.description||"",jobDescription:t.description||"",skills:s,systemPrompt:generateSystemPromptWithJobDetails(t.title,t.description,s,t.company)})}else console.warn("[Page] Failed to load job info, status:",n.status),X({title:"Technical Interview",jobId:e})}catch(t){console.error("[Page] Error loading job info:",t),X({title:"Technical Interview",jobId:e})}},requestMediaPermissions=async()=>{try{E(null),console.log("\uD83D\uDCE2 Requesting microphone permission with noise suppression...");let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1},sampleRate:{ideal:16e3}}}),t=e.getAudioTracks();t.length>0&&console.log("✅ Microphone granted - Noise suppression:",t[0].getSettings().noiseSuppression),t.forEach(e=>e.stop()),k(!0),console.log("\uD83D\uDCF7 Requesting camera permission...");let o=await navigator.mediaDevices.getUserMedia({video:!0}),n=o.getVideoTracks();return n.forEach(e=>e.stop()),I(!0),!0}catch(t){let e="Failed to access camera or microphone.";return"NotAllowedError"===t.name?e="You denied camera/microphone access. Please allow access in your browser settings to start the interview.":"NotFoundError"===t.name&&(e="No camera or microphone found on your device. Please check your hardware."),console.error("❌ Permission error:",t),E(e),!1}};(0,s.useEffect)(()=>{if(!y)return;let e=setInterval(()=>{try{if(!navigator.mediaDevices)return;navigator.mediaDevices.enumerateDevices().then(e=>{let t=e.some(e=>"audioinput"===e.kind),o=e.some(e=>"videoinput"===e.kind);!t&&Y?(C("Microphone disconnected! Please reconnect."),z(!1)):t&&(null==R?void 0:R.includes("Microphone"))&&C(null),!o&&B?(C("Camera disconnected! Please reconnect."),V(!1)):o&&(null==R?void 0:R.includes("Camera"))&&C(null)})}catch(e){console.error("Device check error:",e)}},2e3);return()=>clearInterval(e)},[y,Y,B,R]),(0,s.useEffect)(()=>{if(!B||!y){Z&&(Z.getTracks().forEach(e=>e.stop()),K(null)),ep.current&&(ep.current.srcObject=null);return}let setupCamera=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});K(e),ep.current&&(ep.current.srcObject=e,console.log("[Page] Camera stream set to video element")),C(null)}catch(e){console.error("Camera error:",e),C("Failed to access camera. Please check permissions.")}};return setupCamera(),()=>{Z&&(Z.getTracks().forEach(e=>e.stop()),K(null)),ep.current&&(ep.current.srcObject=null)}},[B,y]),(0,s.useEffect)(()=>{if(!y)return;let e=setInterval(()=>{_(e=>{let t=e+1;return G&&t>=J?(console.log("[Timer] \uD83D\uDCDD Practice interview time limit reached! Auto-ending..."),w(!1),setTimeout(()=>{var e;null===(e=document.getElementById("end-interview-btn"))||void 0===e||e.click()},500)):G&&t===J-30&&(console.log("[Timer] ⏰ 30 seconds remaining in practice interview!"),W(!0)),t})},1e3);return()=>clearInterval(e)},[y,G,J]);let handleStart=async()=>{try{var e;if(null==f?void 0:null===(e=f.user)||void 0===e?void 0:e.id){console.log("[Page] Checking interview limit...");let e=await fetch("/api/check-interview-limit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:f.user.id})}),t=await e.json();if(console.log("[Page] Interview limit check:",t),!t.canContinue){console.log("[Page] Interview limit reached, showing paywall"),eo({currentPlan:t.planName,remainingInterviews:t.remainingInterviews,message:t.message}),ee(!0);return}}else console.log("[Page] No authenticated user, skipping interview limit check (applicant flow)");let t=await requestMediaPermissions();if(!t)return;console.log("[Page] Starting interview..."),console.log("[Page] Interview data:",Q),w(!0),_(0),eh("ai",'Welcome to your technical interview!\n\nPlease keep your microphone and camera ON during the session. This interview is being recorded for evaluation purposes.\n\nYou will be asked a series of questions. If you are unsure about any question, simply say "skip" and we will move to the next one.\n\nGood luck!'),await ey(e=>{console.log("[Page] \uD83C\uDFAF Received conversation message:",e.role,e.content),eh(e.role,e.content),console.log("[Page] \uD83D\uDCCB Message added to conversation manager"),e.role,e.role},(null==Q?void 0:Q.skills)||[],null==Q?void 0:Q.systemPrompt),console.log("[Page] Connected! Starting interview.")}catch(e){console.error("[Page] Failed to start:",e),w(!1),E("Failed to start interview: "+e.message)}},handleEnd=async()=>{try{var e,t;if(console.log("[Page] Ending interview..."),w(!1),eg&&eg.length>0){es(!0);try{let e="interview-".concat(Date.now()),t=await ef(e,O);t?console.log("[Page] ✅ Conversation saved successfully"):console.warn("[Page] ⚠️ Conversation save failed, but continuing...")}catch(e){console.error("[Page] Error saving conversation:",e)}finally{es(!1)}}try{await ew(),console.log("[Page] Disconnected from AI")}catch(e){console.warn("[Page] Warning during disconnect:",e)}Z&&(Z.getTracks().forEach(e=>e.stop()),K(null));let o=(null==c?void 0:c.id)||(null==f?void 0:null===(e=f.user)||void 0===e?void 0:e.id);o||(o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),console.log("[Page] Generated anonymous user UUID:",o));let n=eg.filter(e=>"user"===e.role).length,s={id:crypto.randomUUID(),user_id:o,applicant_id:O||null,job_id:P||null,interview_type:G?"practice":"real",title:(null==Q?void 0:Q.title)||"Technical Interview",position:(null==Q?void 0:Q.hiringFor)||(null==Q?void 0:Q.title)||"Interview",company:(null==Q?void 0:Q.client)||"Unknown",client:(null==Q?void 0:Q.client)||"Unknown",duration:M,status:"completed",score:Math.min(Math.round(Math.min(M/300*30,30)+Math.min(n/10*20,20)+50),100),timestamp:new Date().toISOString(),skills:(null==Q?void 0:Q.skills)||[],conversation:eg.map(e=>({role:e.role,content:e.content,timestamp:e.timestamp.toISOString()})),systemPrompt:(null==Q?void 0:Q.systemPrompt)||null,notes:"Duration: ".concat(M,"s, Messages: ").concat(eg.length,", Type: ").concat(G?"\uD83D\uDCDD Practice":"\uD83C\uDFAF Real",", Practice Type: ").concat(null==Q?void 0:Q.title)};console.log("[Page] Saving interview:",s),console.log("[Page] Interview type:",G?"\uD83D\uDCDD PRACTICE (Test Mode)":"\uD83C\uDFAF REAL JOB INTERVIEW");try{let e=await fetch("/api/interviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),o=await e.json();if(e.ok){console.log("[Page] Interview saved successfully:",o.data);let e=(null===(t=o.data)||void 0===t?void 0:t.id)||s.id;console.log("[Page] Saved interview ID:",e),console.log("[Page] Analyzing interview with AI..."),console.log("[Page] Conversation to analyze:",JSON.stringify(eg,null,2)),console.log("[Page] Number of messages:",eg.length);try{if(eg&&0!==eg.length){let t=await fetch("/api/analyze-interview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation:eg,skills:s.skills,duration:M,applicantId:O,interviewId:e})}),o=await t.json();t.ok?console.log("[Page] Interview analysis completed:",o.analysis):(console.error("[Page] Analysis failed:",o.error),console.error("[Page] Status code:",t.status))}else console.warn("[Page] No conversation to analyze, skipping analysis")}catch(e){console.error("[Page] Analysis API call error:",e)}}else console.error("[Page] Failed to save interview - Status:",e.status),console.error("[Page] Error response:",JSON.stringify(o,null,2)),console.error("[Page] Error message:",o.error),console.error("[Page] Error code:",o.code),console.error("[Page] Full error:",o.fullError)}catch(e){console.error("[Page] API call error:",e)}if(O){let{error:e}=await h.OQ.from("job_applicants").update({status:"completed"}).eq("id",O);e?console.error("[Page] Failed to update applicant status:",e):console.log("[Page] Applicant status updated to completed")}_(0),C(null),console.log("[Page] Interview ended, cleanup complete."),S(!0),E(null),console.log("[Page] Interview marked as completed")}catch(e){console.error("[Page] Error ending interview:",e),E("Interview ended. "+e.message),w(!1),S(!0)}};return!b||x?(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-slate-600 font-semibold",children:b?"Verifying your authentication...":"Initializing interview..."})]})}):P&&!ea?(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,n.jsxs)("div",{className:"fixed inset-0 pointer-events-none opacity-30",children:[(0,n.jsx)("div",{className:"absolute top-0 right-0 w-[400px] h-[400px] bg-gradient-to-b from-blue-500/20 to-transparent rounded-full blur-3xl"}),(0,n.jsx)("div",{className:"absolute bottom-0 left-0 w-[300px] h-[300px] bg-gradient-to-t from-blue-600/15 to-transparent rounded-full blur-3xl"})]}),(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 relative z-10",children:(0,n.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-xl border border-slate-200 p-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Join Interview"}),(0,n.jsx)("p",{className:"text-slate-600 mb-6",children:"Please provide your information to begin"}),(0,n.jsxs)("form",{onSubmit:handleCandidateFormSubmit,className:"space-y-4",children:[eu&&(0,n.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:eu}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Full Name *"}),(0,n.jsx)("input",{type:"text",value:er.name,onChange:e=>el({...er,name:e.target.value}),placeholder:"John Doe",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Email Address *"}),(0,n.jsx)("input",{type:"email",value:er.email,onChange:e=>el({...er,email:e.target.value}),placeholder:"john@example.com",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Phone Number *"}),(0,n.jsx)("input",{type:"tel",value:er.phone,onChange:e=>el({...er,phone:e.target.value}),placeholder:"+1 (555) 000-0000",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Position Applying For *"}),(0,n.jsx)("input",{type:"text",value:er.position,onChange:e=>el({...er,position:e.target.value}),placeholder:"e.g., Senior React Developer",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600 focus:ring-2 focus:ring-blue-500/20",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-slate-700 mb-1",children:"Resume (Optional)"}),(0,n.jsx)("input",{type:"file",accept:".pdf,.doc,.docx",onChange:e=>{var t;return el({...er,resumeFile:(null===(t=e.target.files)||void 0===t?void 0:t[0])||null})},className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:border-blue-600"}),(0,n.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"PDF, DOC, or DOCX format"})]}),(0,n.jsx)("button",{type:"submit",disabled:ec,className:"w-full mt-6 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-semibold hover:shadow-lg hover:shadow-blue-400/30 transition-all disabled:opacity-50",children:ec?"Saving...":"Start Interview"})]})]})})]}):(0,n.jsxs)("div",{className:"min-h-screen bg-white text-slate-900 overflow-hidden flex flex-col",children:[(0,n.jsxs)("div",{className:"fixed inset-0 pointer-events-none",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-white via-[#f8fefb] to-[#f0fdf4]"}),(0,n.jsx)("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-gradient-to-b from-[#d4f1f5]/50 via-[#e6f7f5]/40 to-transparent rounded-full blur-3xl opacity-60"}),(0,n.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[400px] bg-gradient-to-b from-white/80 via-[#f0f9fa]/60 to-transparent rounded-full blur-3xl opacity-50"}),(0,n.jsx)("div",{className:"absolute top-10 right-0 w-[600px] h-[600px] bg-gradient-to-bl from-[#e6fdf4]/45 via-[#f0fdf4]/25 to-transparent rounded-full blur-3xl opacity-50"}),(0,n.jsx)("div",{className:"absolute bottom-0 -left-20 w-[500px] h-[500px] bg-gradient-to-tr from-[#d4f1f5]/35 to-transparent rounded-full blur-3xl opacity-40"}),(0,n.jsx)("div",{className:"absolute top-1/2 -right-20 w-[600px] h-[600px] bg-gradient-to-l from-white/60 to-transparent rounded-full blur-3xl opacity-50"})]}),(0,n.jsx)("nav",{className:"fixed top-0 left-0 right-0 z-50 border-b border-[#11cd68]/15 bg-white/80 backdrop-blur-xl",children:(0,n.jsxs)("div",{className:"mx-auto px-4 md:px-6 lg:px-8 py-3 flex justify-between items-center relative z-10",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#007a78] to-[#11cd68] flex items-center justify-center text-white font-bold text-sm",children:"X"}),(0,n.jsx)("span",{className:"text-lg font-bold text-[#007a78]",children:"InterviewX"})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:y&&(0,n.jsx)("div",{className:"text-xl font-bold text-[#007a78] font-mono px-3 py-1 bg-[#f0fdf4] rounded-lg border border-[#11cd68]/30 text-sm",children:"".concat(Math.floor(M/60),":").concat((M%60).toString().padStart(2,"0"))})})]})}),(0,n.jsxs)("div",{className:"relative z-10 flex-1 overflow-y-auto pt-16 pb-6 px-0 md:px-0",children:[(null==f?void 0:f.user)&&!y&&(0,n.jsx)("div",{className:"mx-auto max-w-6xl mb-6 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,n.jsxs)("p",{className:"text-green-800 font-semibold text-sm",children:["✅ Authenticated as: ",(0,n.jsx)("span",{className:"font-mono",children:f.user.email})]})}),y?(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-0 h-screen w-screen fixed inset-0 top-16 bg-white",children:[(0,n.jsxs)("div",{className:"lg:col-span-8 flex flex-col gap-0 h-full overflow-hidden relative",children:[(0,n.jsx)("div",{className:"bg-slate-900 rounded-none shadow-none overflow-hidden flex items-center justify-center w-full h-full",children:B?(0,n.jsx)("video",{ref:ep,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}}):(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,n.jsx)(m,{size:64,className:"text-slate-400"}),(0,n.jsx)("span",{className:"text-slate-400 text-base",children:"Camera Off"})]})}),(0,n.jsxs)("div",{className:"absolute bottom-6 left-1/2 transform -translate-x-1/2 flex gap-3 bg-white/90 backdrop-blur-md border border-slate-200 rounded-full px-4 py-3 shadow-lg hover:shadow-xl transition-shadow",children:[(0,n.jsx)("button",{onClick:()=>z(!Y),className:"w-12 h-12 rounded-full flex items-center justify-center transition-all ".concat(Y?"bg-[#11cd68] text-white hover:bg-[#0a9f5d]":"bg-red-500 text-white hover:bg-red-600"),title:Y?"Mute":"Unmute",children:Y?(0,n.jsx)(l.Z,{size:24}):(0,n.jsx)(d,{size:24})}),(0,n.jsx)("button",{onClick:()=>V(!B),className:"w-12 h-12 rounded-full flex items-center justify-center transition-all ".concat(B?"bg-[#11cd68] text-white hover:bg-[#0a9f5d]":"bg-red-500 text-white hover:bg-red-600"),title:B?"Stop Camera":"Start Camera",children:B?(0,n.jsx)(u,{size:24}):(0,n.jsx)(m,{size:24})}),(0,n.jsx)("div",{className:"w-px bg-slate-300"}),(0,n.jsx)("button",{onClick:handleEnd,className:"w-12 h-12 rounded-full flex items-center justify-center bg-red-600 text-white hover:bg-red-700 transition-all",title:"End Interview",children:(0,n.jsx)(p.Z,{size:24,style:{transform:"rotate(135deg)"}})})]})]}),(0,n.jsxs)("div",{className:"lg:col-span-4 flex flex-col h-full overflow-hidden border-l border-slate-200",children:[(0,n.jsx)(ConversationDisplay,{messages:eg,isListening:eb,loading:en}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-end p-4 bg-gradient-to-b from-slate-50 to-slate-100",children:[(0,n.jsxs)("div",{className:"relative w-28 h-28 flex items-center justify-center mb-3",children:[(0,n.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-blue-400 via-purple-400 to-cyan-400 opacity-20 blur-3xl animate-pulse"}),(0,n.jsxs)("div",{className:"relative w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 shadow-2xl overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-white to-transparent opacity-30 animate-spin",style:{animationDuration:"3s"}}),(0,n.jsx)("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-300 opacity-50 animate-pulse",style:{animationDuration:"1.5s"}}),(0,n.jsx)("div",{className:"absolute inset-2 rounded-full border border-purple-300 opacity-40 animate-ping",style:{animationDuration:"2s"}}),(0,n.jsx)("div",{className:"absolute top-2 left-3 w-3 h-3 bg-white rounded-full opacity-60 blur-sm"})]}),(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-cyan-400 rounded-full top-2 left-8 animate-bounce",style:{animationDuration:"1.2s"}}),(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-purple-400 rounded-full bottom-4 right-6 animate-bounce",style:{animationDuration:"1.5s",animationDelay:"0.3s"}}),(0,n.jsx)("div",{className:"absolute w-1 h-1 bg-pink-400 rounded-full top-8 right-4 animate-bounce",style:{animationDuration:"1.3s",animationDelay:"0.6s"}})]}),(0,n.jsx)("p",{className:"text-sm font-medium text-slate-600",children:"AI Agent"}),(0,n.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:eb?"Listening...":en?"Processing...":"Ready"})]})]})]}):(0,n.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-[#007a78] mb-1",children:(null==Q?void 0:Q.title)?"Interview: ".concat(Q.title):"Technical Interview"}),(0,n.jsx)("p",{className:"text-sm text-slate-600",children:(null==Q?void 0:Q.hiringFor)?"Hiring for: ".concat(Q.hiringFor):(null==Q?void 0:Q.client)&&"Unknown"!==Q.client?"Hiring for: ".concat(Q.client):(null==Q?void 0:Q.skills)&&Q.skills.length>0?"Skills: ".concat(Q.skills.slice(0,3).map(e=>e.name).join(", ")):"Powered by OpenAI Realtime API"})]}),(null==Q?void 0:Q.skills)&&Q.skills.length>0&&(0,n.jsxs)("div",{className:"mb-4 p-4 bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl shadow-sm",children:[(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm mb-2",children:"Key Skills"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:Q.skills.map((e,t)=>(0,n.jsx)("div",{className:"px-3 py-1 rounded-full bg-gradient-to-r from-[#11cd68]/10 to-[#007a78]/10 border border-[#11cd68]/30 text-[#007a78] font-semibold text-xs hover:shadow-md transition-all",children:e.name},t))})]}),ev&&(0,n.jsxs)("div",{className:"mx-auto max-w-6xl mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2 text-sm",children:[(0,n.jsx)(i.Z,{className:"text-red-600 flex-shrink-0 mt-0.5",size:18}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-red-900 font-semibold",children:"Connection Error"}),(0,n.jsx)("p",{className:"text-red-700 text-xs",children:ev})]})]}),N?(0,n.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl p-8 shadow-sm text-center",children:[(0,n.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-[#11cd68] to-[#007a78] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg",children:(0,n.jsx)(r.Z,{className:"text-white",size:40})}),(0,n.jsx)("h2",{className:"text-3xl font-bold text-[#007a78] mb-3",children:"Thank You!"}),(0,n.jsx)("p",{className:"text-slate-600 text-base mb-6",children:"Your technical interview has been completed and recorded."}),(0,n.jsx)("p",{className:"text-slate-600 text-sm mb-8",children:"Our team will review your responses and get back to you soon with feedback."}),(0,n.jsxs)("div",{className:"bg-[#f0fdf4] border border-[#11cd68]/30 rounded-lg p-4 mb-6",children:[(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Interview responses saved"}),(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Analysis in progress"}),(0,n.jsx)("p",{className:"text-[#007a78] font-semibold text-sm",children:"✓ Feedback coming soon"})]}),(0,n.jsx)("p",{className:"text-slate-500 text-xs",children:"This interview session has ended. You cannot start a new interview in this session."})]}):(0,n.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-xl p-6 shadow-sm",children:[(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-[#007a78] to-[#11cd68] rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,n.jsx)(l.Z,{className:"text-white",size:32})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-[#007a78] mb-2",children:"Ready?"}),(0,n.jsx)("p",{className:"text-slate-600 text-sm",children:"Start your AI-powered technical interview."})]}),A&&(0,n.jsxs)("div",{className:"mb-4 p-4 bg-red-50 border border-red-300 rounded-lg flex items-start gap-3 text-sm",children:[(0,n.jsx)(i.Z,{className:"text-red-600 flex-shrink-0 mt-0.5",size:20}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-red-900 font-semibold mb-2",children:A}),"Not authenticated"===A&&(0,n.jsxs)("div",{className:"text-red-700 text-xs space-y-2",children:[(0,n.jsx)("p",{children:"You need to be logged in to start an interview."}),(0,n.jsx)("button",{onClick:()=>e.push("/auth/login"),className:"inline-block mt-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold transition-all",children:"Go to Login"})]}),"Not authenticated"!==A&&(0,n.jsx)("p",{className:"text-red-700",children:A})]})]}),(0,n.jsxs)("div",{className:"bg-[#f0fdf4] border border-[#11cd68]/30 rounded-lg p-4 mb-6 space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(j?"bg-[#11cd68]":"bg-slate-400")}),(0,n.jsxs)("span",{className:"text-slate-700",children:["Microphone: ",(0,n.jsx)("span",{className:"font-semibold",children:j?"Granted":"Not Granted"})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(D?"bg-[#11cd68]":"bg-slate-400")}),(0,n.jsxs)("span",{className:"text-slate-700",children:["Camera: ",(0,n.jsx)("span",{className:"font-semibold",children:D?"Granted":"Not Granted"})]})]})]}),R&&(0,n.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg flex items-start gap-2 text-sm",children:[(0,n.jsx)(i.Z,{className:"text-yellow-600 flex-shrink-0 mt-0.5",size:18}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-yellow-900 font-semibold",children:"Device Alert"}),(0,n.jsx)("p",{className:"text-yellow-800 text-xs",children:R})]})]}),(0,n.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-[#11cd68]/30 rounded-lg p-4 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex gap-2 justify-center mb-4",children:[(0,n.jsx)("button",{onClick:()=>z(!Y),className:"p-2 rounded-lg transition-all ".concat(Y?"bg-[#11cd68]/20 text-[#007a78] border border-[#11cd68]/50":"bg-red-50 text-red-600 border border-red-200"),title:Y?"Mute":"Unmute",children:Y?(0,n.jsx)(l.Z,{size:20}):(0,n.jsx)(d,{size:20})}),(0,n.jsx)("button",{onClick:()=>V(!B),className:"p-2 rounded-lg transition-all ".concat(B?"bg-[#11cd68]/20 text-[#007a78] border border-[#11cd68]/50":"bg-red-50 text-red-600 border border-red-200"),title:B?"Stop Camera":"Start Camera",children:B?(0,n.jsx)(u,{size:20}):(0,n.jsx)(m,{size:20})})]}),(0,n.jsx)("button",{onClick:handleStart,disabled:null!==A,className:"w-full py-2 px-4 rounded-lg font-semibold text-white transition-all text-sm ".concat(null!==A?"bg-slate-400 cursor-not-allowed":"bg-gradient-to-r from-[#007a78] to-[#0a9f5d] hover:shadow-lg active:scale-95"),children:"Start Interview"})]})]})]})]}),$&&(0,n.jsx)(SubscriptionPaywall,{userId:null==c?void 0:c.id,onClose:()=>ee(!1),remainingInterviews:et.remainingInterviews,currentPlan:et.currentPlan})]})}},4678:function(e,t,o){"use strict";o.r(t),o.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var n=o(7437),s=o(2265),a=o(2899);let i=(0,s.createContext)();function AuthProvider(e){let{children:t}=e,[o,r]=(0,s.useState)(null),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),saveAuthState=(e,t,o)=>{let n={user:e,session:t,role:o,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(n)),console.log("[Auth] Auth state saved to localStorage")},loadAuthState=()=>{try{let t=localStorage.getItem("authState");if(t){var e;let o=JSON.parse(t);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=o.user)||void 0===e?void 0:e.email),o}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},clearAuthState=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,s.useEffect)(()=>{let e=loadAuthState();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)&&(console.log("[Auth] Restored session from localStorage:",e.user.email),r(e.user),c(e.session),u(e.role),h(!0));let verifySession=async()=>{try{let{data:{session:t}}=await a.OQ.auth.getSession();if(null==t?void 0:t.user){console.log("[Auth] Valid Supabase session found"),c(t),r(t.user),h(!0);let{data:e}=await a.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(u(e.role),saveAuthState(t.user,t,e.role))}else(null==e?void 0:e.user)||(c(null),r(null),u(null),h(!1),clearAuthState())}catch(e){console.warn("[Auth] Session verification error:",e.message)}};verifySession();let{data:{subscription:t}}=a.OQ.auth.onAuthStateChange(async(e,t)=>{if(console.log("[Auth] Auth state change event:",e),null==t?void 0:t.user){c(t),r(t.user),h(!0);let{data:e}=await a.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(u(e.role),saveAuthState(t.user,t,e.role))}else c(null),r(null),u(null),h(!1),clearAuthState()});return()=>null==t?void 0:t.unsubscribe()},[]);let signup=async(e,t)=>{try{console.log("[Signup] Attempting signup for:",e.email);let o=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:t})});if(!o.ok){let e=await o.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let n=await o.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:n.user,needsLogin:!0,message:n.message}}catch(e){throw console.error("[Signup] Error:",e),e}},login=async(e,t,o)=>{try{var n,s;console.log("[AuthContext] Attempting login:",{email:e,role:o});let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,role:o})});if(console.log("[AuthContext] Login response status:",a.status),!a.ok){let e=await a.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let i=await a.json();console.log("[AuthContext] Login successful, setting session"),i.session&&(c(i.session),r(i.session.user||i.user));let l=(null===(n=i.user)||void 0===n?void 0:n.role)||o;return u(l),h(!0),saveAuthState((null===(s=i.session)||void 0===s?void 0:s.user)||i.user,i.session,l),console.log("[AuthContext] Auth state saved to localStorage"),i.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},logout=async()=>{try{await a.OQ.auth.signOut(),c(null),r(null),u(null),h(!1),clearAuthState(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,n.jsx)(i.Provider,{value:{user:o,session:l,role:d,loading:m,isAuthenticated:g,signup,login,logout},children:t})}let useAuth=()=>{let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2899:function(e,t,o){"use strict";o.d(t,{OQ:function(){return l}});var n=o(6932),s=o(2601);let a=s.env.NEXT_PUBLIC_SUPABASE_URL,i=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,r=s.env.SUPABASE_SERVICE_ROLE_KEY;if(!a||!i)throw Error("Missing Supabase environment variables");let l=(0,n.eI)(a,i);(0,n.eI)(a,r||i)},4033:function(e,t,o){e.exports=o(94)},7865:function(e,t,o){"use strict";o.d(t,{Z:function(){return createLucideIcon$1}});var n=o(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var createLucideIcon$1=(e,t)=>{let o=(0,n.forwardRef)(({color:o="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:r,children:l,...c},d)=>(0,n.createElement)("svg",{ref:d,...s,width:a,height:a,stroke:o,strokeWidth:r?24*Number(i)/Number(a):i,className:`lucide lucide-${toKebabCase(e)}`,...c},[...t.map(([e,t])=>(0,n.createElement)(e,t)),...(Array.isArray(l)?l:[l])||[]]));return o.displayName=`${e}`,o}},4115:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(7865);let s=(0,n.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},2609:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(7865);let s=(0,n.Z)("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},7726:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(7865);let s=(0,n.Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},1840:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(7865);let s=(0,n.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])}},function(e){e.O(0,[7653,732,2971,2472,1744],function(){return e(e.s=7953)}),_N_E=e.O()}]);