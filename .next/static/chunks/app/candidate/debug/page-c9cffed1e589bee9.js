(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5056],{90713:function(e,s,t){Promise.resolve().then(t.bind(t,84933))},84933:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return a}});var o=t(57437),l=t(2265),n=t(1233),r=t(2141);function a(){let{user:e,session:s}=(0,n.a)(),[t,a]=(0,l.useState)(null),[i,u]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async()=>{try{var t,o;console.log("\uD83D\uDD0D Auth user:",e),console.log("\uD83D\uDD0D Session:",s),a({authUserId:null==e?void 0:e.id,authEmail:null==e?void 0:e.email,sessionUserId:null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.id,sessionEmail:null==s?void 0:null===(o=s.user)||void 0===o?void 0:o.email});let{data:l,error:n}=await r.OQ.from("interviews").select("*").limit(5);n?console.error("Error fetching all interviews:",n):(console.log("\uD83D\uDCDD All interviews:",l),u(l||[]))}catch(e){console.error("Error:",e)}finally{d(!1)}})()},[e,s]),(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8",children:(0,o.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-8",children:"\uD83D\uDD0D Candidate Debug Info"}),(0,o.jsxs)("div",{className:"bg-white rounded-lg p-6 mb-6 border border-slate-200",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"\uD83D\uDC64 Your User IDs"}),t?(0,o.jsxs)("div",{className:"space-y-2 font-mono text-sm",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Auth User ID:"})," ",t.authUserId||"Not found"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Auth Email:"})," ",t.authEmail||"Not found"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Session User ID:"})," ",t.sessionUserId||"Not found"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Session Email:"})," ",t.sessionEmail||"Not found"]})]}):(0,o.jsx)("p",{className:"text-slate-600",children:"Loading..."})]}),(0,o.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-slate-200",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"\uD83D\uDCDD All Interviews in DB"}),c?(0,o.jsx)("p",{className:"text-slate-600",children:"Loading..."}):0===i.length?(0,o.jsx)("p",{className:"text-slate-600",children:"No interviews found"}):(0,o.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,o.jsxs)("div",{className:"bg-slate-50 p-4 rounded border border-slate-200",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"ID:"})," ",e.id]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"User ID:"})," ",(0,o.jsx)("span",{className:"bg-yellow-100 px-2 py-1 rounded",children:e.user_id})]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Title:"})," ",e.title]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Status:"})," ",e.status]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("span",{className:"font-bold",children:"Created:"})," ",new Date(e.created_at).toLocaleString()]})]},e.id))})]}),(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6",children:[(0,o.jsx)("h3",{className:"font-bold text-blue-900 mb-2",children:"\uD83D\uDCCC What to check:"}),(0,o.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm text-blue-800",children:[(0,o.jsx)("li",{children:'Does your "Auth User ID" match the "User ID" in the interview?'}),(0,o.jsx)("li",{children:"If not, the dashboard query won't find your interviews"}),(0,o.jsxs)("li",{children:["Copy your Auth User ID and run: ",(0,o.jsx)("code",{className:"bg-white px-2 py-1 rounded",children:"SELECT * FROM users WHERE id = 'YOUR_ID'"})]})]})]})]})})}},1233:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return a},a:function(){return i}});var o=t(57437),l=t(2265),n=t(2141);let r=(0,l.createContext)();function a(e){let{children:s}=e,[t,a]=(0,l.useState)(null),[i,u]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),[h,g]=(0,l.useState)(!1),[m,f]=(0,l.useState)(!1),[x,p]=(0,l.useState)(!1),v=(e,s,t)=>{let o={user:e,session:s,role:t,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(o)),console.log("[Auth] Auth state saved to localStorage")},S=()=>{try{let s=localStorage.getItem("authState");if(s){var e;let t=JSON.parse(s);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=t.user)||void 0===e?void 0:e.email),t}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},N=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,l.useEffect)(()=>{let e=S();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)?(console.log("[Auth] ✅ Restored session from localStorage:",e.user.email),a(e.user),u(e.session),d(e.role),f(!0),p(!0)):console.log("[Auth] ⏳ No cached session, verifying with Supabase...");let s=async()=>{try{let{data:{session:s}}=await n.OQ.auth.getSession();if(null==s?void 0:s.user){console.log("[Auth] ✅ Valid Supabase session found"),u(s),a(s.user),f(!0);let{data:e}=await n.OQ.from("users").select("role").eq("id",s.user.id).single();e&&(d(e.role),v(s.user,s,e.role))}else(null==e?void 0:e.user)||(console.log("[Auth] ❌ No session found anywhere"),u(null),a(null),d(null),f(!1),N());p(!0)}catch(e){console.warn("[Auth] ⚠️ Session verification error:",e.message),p(!0)}};(null==e?void 0:e.user)?s().catch(e=>console.warn("[Auth] Background verification failed:",e)):s();let{data:{subscription:o}}=n.OQ.auth.onAuthStateChange(async(e,s)=>{if(console.log("[Auth] Auth state change event:",e),null==s?void 0:s.user){console.log("[Auth] Session valid, updating state"),u(s),a(s.user),f(!0);let{data:e}=await n.OQ.from("users").select("role").eq("id",s.user.id).single();e&&(d(e.role),v(s.user,s,e.role))}else if("SIGNED_OUT"===e)console.log("[Auth] User signed out, clearing session"),u(null),a(null),d(null),f(!1),N();else{let e=S();if(null==e?void 0:e.user){var o;console.log("[Auth] Keeping cached session for:",null===(o=e.user)||void 0===o?void 0:o.email),t||(a(e.user),u(e.session),d(e.role),f(!0))}else console.log("[Auth] No current session and no cached session"),f(!1)}});return()=>null==o?void 0:o.unsubscribe()},[]);let b=async(e,s)=>{try{console.log("[Signup] Attempting signup for:",e.email);let t=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:s})});if(!t.ok){let e=await t.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let o=await t.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:o.user,needsLogin:!0,message:o.message}}catch(e){throw console.error("[Signup] Error:",e),e}},A=async(e,s,t)=>{try{var o,l;console.log("[AuthContext] Attempting login:",{email:e,role:t});let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s,role:t})});if(console.log("[AuthContext] Login response status:",n.status),!n.ok){let e=await n.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let r=await n.json();console.log("[AuthContext] Login successful, setting session"),r.session&&(u(r.session),a(r.session.user||r.user));let i=(null===(o=r.user)||void 0===o?void 0:o.role)||t;return d(i),f(!0),v((null===(l=r.session)||void 0===l?void 0:l.user)||r.user,r.session,i),console.log("[AuthContext] Auth state saved to localStorage"),r.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},j=async()=>{try{await n.OQ.auth.signOut(),u(null),a(null),d(null),f(!1),N(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,o.jsx)(r.Provider,{value:{user:t,session:i,role:c,loading:h,isAuthenticated:m,isHydrated:x,signup:b,login:A,logout:j},children:s})}let i=()=>{let e=(0,l.useContext)(r);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2141:function(e,s,t){"use strict";t.d(s,{OQ:function(){return i}});var o=t(69066),l=t(40257);let n=l.env.NEXT_PUBLIC_SUPABASE_URL,r=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=l.env.SUPABASE_SERVICE_ROLE_KEY,i=null;n&&r&&(i=(0,o.eI)(n,r),(0,o.eI)(n,a||r))}},function(e){e.O(0,[9066,2971,2117,1744],function(){return e(e.s=90713)}),_N_E=e.O()}]);