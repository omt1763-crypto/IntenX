(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5056],{1250:function(e,t,s){Promise.resolve().then(s.bind(s,6170))},6170:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return CandidateDebugPage}});var l=s(7437),o=s(2265),r=s(4678),n=s(2899);function CandidateDebugPage(){let{user:e,session:t}=(0,r.useAuth)(),[s,a]=(0,o.useState)(null),[i,u]=(0,o.useState)([]),[d,c]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{let loadData=async()=>{try{var s,l;console.log("\uD83D\uDD0D Auth user:",e),console.log("\uD83D\uDD0D Session:",t),a({authUserId:null==e?void 0:e.id,authEmail:null==e?void 0:e.email,sessionUserId:null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.id,sessionEmail:null==t?void 0:null===(l=t.user)||void 0===l?void 0:l.email});let{data:o,error:r}=await n.OQ.from("interviews").select("*").limit(5);r?console.error("Error fetching all interviews:",r):(console.log("\uD83D\uDCDD All interviews:",o),u(o||[]))}catch(e){console.error("Error:",e)}finally{c(!1)}};loadData()},[e,t]),(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-8",children:(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-slate-900 mb-8",children:"\uD83D\uDD0D Candidate Debug Info"}),(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 mb-6 border border-slate-200",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"\uD83D\uDC64 Your User IDs"}),s?(0,l.jsxs)("div",{className:"space-y-2 font-mono text-sm",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Auth User ID:"})," ",s.authUserId||"Not found"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Auth Email:"})," ",s.authEmail||"Not found"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Session User ID:"})," ",s.sessionUserId||"Not found"]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Session Email:"})," ",s.sessionEmail||"Not found"]})]}):(0,l.jsx)("p",{className:"text-slate-600",children:"Loading..."})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-slate-200",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-900 mb-4",children:"\uD83D\uDCDD All Interviews in DB"}),d?(0,l.jsx)("p",{className:"text-slate-600",children:"Loading..."}):0===i.length?(0,l.jsx)("p",{className:"text-slate-600",children:"No interviews found"}):(0,l.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,l.jsxs)("div",{className:"bg-slate-50 p-4 rounded border border-slate-200",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"ID:"})," ",e.id]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"User ID:"})," ",(0,l.jsx)("span",{className:"bg-yellow-100 px-2 py-1 rounded",children:e.user_id})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Title:"})," ",e.title]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Status:"})," ",e.status]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-bold",children:"Created:"})," ",new Date(e.created_at).toLocaleString()]})]},e.id))})]}),(0,l.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6",children:[(0,l.jsx)("h3",{className:"font-bold text-blue-900 mb-2",children:"\uD83D\uDCCC What to check:"}),(0,l.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm text-blue-800",children:[(0,l.jsx)("li",{children:'Does your "Auth User ID" match the "User ID" in the interview?'}),(0,l.jsx)("li",{children:"If not, the dashboard query won't find your interviews"}),(0,l.jsxs)("li",{children:["Copy your Auth User ID and run: ",(0,l.jsx)("code",{className:"bg-white px-2 py-1 rounded",children:"SELECT * FROM users WHERE id = 'YOUR_ID'"})]})]})]})]})})}},4678:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var l=s(7437),o=s(2265),r=s(2899);let n=(0,o.createContext)();function AuthProvider(e){let{children:t}=e,[s,a]=(0,o.useState)(null),[i,u]=(0,o.useState)(null),[d,c]=(0,o.useState)(null),[h,g]=(0,o.useState)(!1),[m,f]=(0,o.useState)(!1),saveAuthState=(e,t,s)=>{let l={user:e,session:t,role:s,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(l)),console.log("[Auth] Auth state saved to localStorage")},loadAuthState=()=>{try{let t=localStorage.getItem("authState");if(t){var e;let s=JSON.parse(t);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=s.user)||void 0===e?void 0:e.email),s}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},clearAuthState=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,o.useEffect)(()=>{let e=loadAuthState();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)&&(console.log("[Auth] Restored session from localStorage:",e.user.email),a(e.user),u(e.session),c(e.role),f(!0));let verifySession=async()=>{try{let{data:{session:t}}=await r.OQ.auth.getSession();if(null==t?void 0:t.user){console.log("[Auth] Valid Supabase session found"),u(t),a(t.user),f(!0);let{data:e}=await r.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(c(e.role),saveAuthState(t.user,t,e.role))}else(null==e?void 0:e.user)||(u(null),a(null),c(null),f(!1),clearAuthState())}catch(e){console.warn("[Auth] Session verification error:",e.message)}};verifySession();let{data:{subscription:t}}=r.OQ.auth.onAuthStateChange(async(e,t)=>{if(console.log("[Auth] Auth state change event:",e),null==t?void 0:t.user){u(t),a(t.user),f(!0);let{data:e}=await r.OQ.from("users").select("role").eq("id",t.user.id).single();e&&(c(e.role),saveAuthState(t.user,t,e.role))}else u(null),a(null),c(null),f(!1),clearAuthState()});return()=>null==t?void 0:t.unsubscribe()},[]);let signup=async(e,t)=>{try{console.log("[Signup] Attempting signup for:",e.email);let s=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:t})});if(!s.ok){let e=await s.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let l=await s.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:l.user,needsLogin:!0,message:l.message}}catch(e){throw console.error("[Signup] Error:",e),e}},login=async(e,t,s)=>{try{var l,o;console.log("[AuthContext] Attempting login:",{email:e,role:s});let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,role:s})});if(console.log("[AuthContext] Login response status:",r.status),!r.ok){let e=await r.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let n=await r.json();console.log("[AuthContext] Login successful, setting session"),n.session&&(u(n.session),a(n.session.user||n.user));let i=(null===(l=n.user)||void 0===l?void 0:l.role)||s;return c(i),f(!0),saveAuthState((null===(o=n.session)||void 0===o?void 0:o.user)||n.user,n.session,i),console.log("[AuthContext] Auth state saved to localStorage"),n.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},logout=async()=>{try{await r.OQ.auth.signOut(),u(null),a(null),c(null),f(!1),clearAuthState(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,l.jsx)(n.Provider,{value:{user:s,session:i,role:d,loading:h,isAuthenticated:m,signup,login,logout},children:t})}let useAuth=()=>{let e=(0,o.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2899:function(e,t,s){"use strict";s.d(t,{OQ:function(){return i}});var l=s(6932),o=s(2601);let r=o.env.NEXT_PUBLIC_SUPABASE_URL,n=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,a=o.env.SUPABASE_SERVICE_ROLE_KEY;if(!r||!n)throw Error("Missing Supabase environment variables");let i=(0,l.eI)(r,n);(0,l.eI)(r,a||n)}},function(e){e.O(0,[7653,2971,2472,1744],function(){return e(e.s=1250)}),_N_E=e.O()}]);