(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3183],{1714:function(e,o,t){Promise.resolve().then(t.bind(t,7093))},7093:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return n}});var s=t(7437),l=t(2265),r=t(1233);function n(){var e,o,t,n,i,a,u,d,c,h,g,v,m,p,x,f;let{user:b}=(0,r.a)(),[w,j]=(0,l.useState)(null),[N,S]=(0,l.useState)(!0),[A,y]=(0,l.useState)("");(0,l.useEffect)(()=>{(null==b?void 0:b.id)&&I()},[null==b?void 0:b.id]);let I=async()=>{try{console.log("[DebugRecruiter] Checking data for recruiter:",null==b?void 0:b.id);let e=await fetch("/api/recruiter/jobs"),o=await e.json(),t=await fetch("/api/get-applicants?recruiterId=".concat(null==b?void 0:b.id)),s=await t.json(),l=await fetch("/api/get-interviews?recruiterId=".concat(null==b?void 0:b.id)),r=await l.json();j({recruiterId:null==b?void 0:b.id,jobs:o,applicants:s,interviews:r}),S(!1)}catch(e){y(e.message),S(!1)}};return N?(0,s.jsx)("div",{className:"p-8",children:"Loading..."}):A?(0,s.jsxs)("div",{className:"p-8 text-red-600",children:["Error: ",A]}):(0,s.jsxs)("div",{className:"p-8 max-w-6xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Recruiter Debug Info"}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Your Recruiter ID"}),(0,s.jsx)("p",{className:"font-mono text-sm bg-gray-100 p-4 rounded break-all",children:null==w?void 0:w.recruiterId})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-6 border border-blue-200",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-blue-900",children:"Jobs"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:(null==w?void 0:null===(o=w.jobs)||void 0===o?void 0:null===(e=o.data)||void 0===e?void 0:e.length)||0})]}),(0,s.jsxs)("div",{className:"bg-green-50 rounded-lg p-6 border border-green-200",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-green-900",children:"Applicants"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600 mt-2",children:(null==w?void 0:null===(n=w.applicants)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.length)||0})]}),(0,s.jsxs)("div",{className:"bg-purple-50 rounded-lg p-6 border border-purple-200",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-purple-900",children:"Interviews"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-purple-600 mt-2",children:(null==w?void 0:null===(a=w.interviews)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.length)||0})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Raw API Responses"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("details",{className:"bg-gray-50 p-4 rounded",children:[(0,s.jsx)("summary",{className:"font-bold cursor-pointer",children:"Jobs API Response"}),(0,s.jsx)("pre",{className:"mt-4 bg-gray-900 text-gray-100 p-4 rounded text-xs overflow-auto max-h-48",children:JSON.stringify(null==w?void 0:w.jobs,null,2)})]}),(0,s.jsxs)("details",{className:"bg-gray-50 p-4 rounded",children:[(0,s.jsx)("summary",{className:"font-bold cursor-pointer",children:"Applicants API Response"}),(0,s.jsx)("pre",{className:"mt-4 bg-gray-900 text-gray-100 p-4 rounded text-xs overflow-auto max-h-48",children:JSON.stringify(null==w?void 0:w.applicants,null,2)})]}),(0,s.jsxs)("details",{className:"bg-gray-50 p-4 rounded",children:[(0,s.jsx)("summary",{className:"font-bold cursor-pointer",children:"Interviews API Response"}),(0,s.jsx)("pre",{className:"mt-4 bg-gray-900 text-gray-100 p-4 rounded text-xs overflow-auto max-h-48",children:JSON.stringify(null==w?void 0:w.interviews,null,2)})]})]})]}),(0,s.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"font-bold text-yellow-900 mb-2",children:"Diagnosis"}),!(null==w?void 0:null===(d=w.jobs)||void 0===d?void 0:null===(u=d.data)||void 0===u?void 0:u.length)&&(0,s.jsxs)("p",{className:"text-yellow-800 mb-2",children:["❌ ",(0,s.jsx)("strong",{children:"No jobs found"})," - You need to create a job first or the recruiter_id doesn't match"]}),(null==w?void 0:null===(h=w.jobs)||void 0===h?void 0:null===(c=h.data)||void 0===c?void 0:c.length)>0&&!(null==w?void 0:null===(v=w.interviews)||void 0===v?void 0:null===(g=v.data)||void 0===g?void 0:g.length)&&(0,s.jsxs)("p",{className:"text-yellow-800 mb-2",children:["⚠️ ",(0,s.jsx)("strong",{children:"No interviews yet"})," - You have jobs but candidates haven't started interviews"]}),(null==w?void 0:null===(p=w.jobs)||void 0===p?void 0:null===(m=p.data)||void 0===m?void 0:m.length)>0&&(null==w?void 0:null===(f=w.interviews)||void 0===f?void 0:null===(x=f.data)||void 0===x?void 0:x.length)>0&&(0,s.jsxs)("p",{className:"text-green-800 mb-2",children:["✅ ",(0,s.jsx)("strong",{children:"Everything looks good!"})," - You have jobs and interviews"]})]})]})}},1233:function(e,o,t){"use strict";t.d(o,{AuthProvider:function(){return i},a:function(){return a}});var s=t(7437),l=t(2265),r=t(2141);let n=(0,l.createContext)();function i(e){let{children:o}=e,[t,i]=(0,l.useState)(null),[a,u]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),[h,g]=(0,l.useState)(!1),[v,m]=(0,l.useState)(!1),[p,x]=(0,l.useState)(!1),f=(e,o,t)=>{let s={user:e,session:o,role:t,timestamp:new Date().toISOString()};localStorage.setItem("authState",JSON.stringify(s)),console.log("[Auth] Auth state saved to localStorage")},b=()=>{try{let o=localStorage.getItem("authState");if(o){var e;let t=JSON.parse(o);return console.log("[Auth] Loaded auth state from localStorage for:",null===(e=t.user)||void 0===e?void 0:e.email),t}}catch(e){console.error("[Auth] Failed to load auth state:",e)}return null},w=()=>{localStorage.removeItem("authState"),localStorage.removeItem("interviewSetup"),localStorage.removeItem("resumeSkillsSaved"),console.log("[Auth] Auth state cleared from localStorage")};(0,l.useEffect)(()=>{let e=b();(null==e?void 0:e.user)&&(null==e?void 0:e.session)&&(null==e?void 0:e.role)?(console.log("[Auth] ✅ Restored session from localStorage:",e.user.email),i(e.user),u(e.session),c(e.role),m(!0),x(!0)):console.log("[Auth] ⏳ No cached session, verifying with Supabase...");let o=async()=>{try{let{data:{session:o}}=await r.OQ.auth.getSession();if(null==o?void 0:o.user){console.log("[Auth] ✅ Valid Supabase session found"),u(o),i(o.user),m(!0);let{data:e}=await r.OQ.from("users").select("role").eq("id",o.user.id).single();e&&(c(e.role),f(o.user,o,e.role))}else(null==e?void 0:e.user)||(console.log("[Auth] ❌ No session found anywhere"),u(null),i(null),c(null),m(!1),w());x(!0)}catch(e){console.warn("[Auth] ⚠️ Session verification error:",e.message),x(!0)}};(null==e?void 0:e.user)?o().catch(e=>console.warn("[Auth] Background verification failed:",e)):o();let{data:{subscription:s}}=r.OQ.auth.onAuthStateChange(async(e,o)=>{if(console.log("[Auth] Auth state change event:",e),null==o?void 0:o.user){console.log("[Auth] Session valid, updating state"),u(o),i(o.user),m(!0);let{data:e}=await r.OQ.from("users").select("role").eq("id",o.user.id).single();e&&(c(e.role),f(o.user,o,e.role))}else if("SIGNED_OUT"===e)console.log("[Auth] User signed out, clearing session"),u(null),i(null),c(null),m(!1),w();else{let e=b();if(null==e?void 0:e.user){var s;console.log("[Auth] Keeping cached session for:",null===(s=e.user)||void 0===s?void 0:s.email),t||(i(e.user),u(e.session),c(e.role),m(!0))}else console.log("[Auth] No current session and no cached session"),m(!1)}});return()=>null==s?void 0:s.unsubscribe()},[]);let j=async(e,o)=>{try{console.log("[Signup] Attempting signup for:",e.email);let t=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email,password:e.password,role:o})});if(!t.ok){let e=await t.json();throw console.error("[Signup] API error:",e),Error(e.error||"Signup failed")}let s=await t.json();return console.log("[Signup] Account created successfully! User must now log in."),{user:s.user,needsLogin:!0,message:s.message}}catch(e){throw console.error("[Signup] Error:",e),e}},N=async(e,o,t)=>{try{var s,l;console.log("[AuthContext] Attempting login:",{email:e,role:t});let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:o,role:t})});if(console.log("[AuthContext] Login response status:",r.status),!r.ok){let e=await r.json();throw console.error("[AuthContext] Login error response:",e),Error(e.error||"Login failed")}let n=await r.json();console.log("[AuthContext] Login successful, setting session"),n.session&&(u(n.session),i(n.session.user||n.user));let a=(null===(s=n.user)||void 0===s?void 0:s.role)||t;return c(a),m(!0),f((null===(l=n.session)||void 0===l?void 0:l.user)||n.user,n.session,a),console.log("[AuthContext] Auth state saved to localStorage"),n.user}catch(e){throw console.error("[AuthContext] Login error:",e),e}},S=async()=>{try{await r.OQ.auth.signOut(),u(null),i(null),c(null),m(!1),w(),console.log("[Auth] User logged out, auth state cleared")}catch(e){throw console.error("Logout error:",e),e}};return(0,s.jsx)(n.Provider,{value:{user:t,session:a,role:d,loading:h,isAuthenticated:v,isHydrated:p,signup:j,login:N,logout:S},children:o})}let a=()=>{let e=(0,l.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},2141:function(e,o,t){"use strict";t.d(o,{OQ:function(){return a}});var s=t(9066),l=t(257);let r=l.env.NEXT_PUBLIC_SUPABASE_URL,n=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,i=l.env.SUPABASE_SERVICE_ROLE_KEY;if(!r||!n)throw Error("Missing Supabase environment variables");let a=(0,s.eI)(r,n);(0,s.eI)(r,i||n)}},function(e){e.O(0,[9066,2971,2117,1744],function(){return e(e.s=1714)}),_N_E=e.O()}]);